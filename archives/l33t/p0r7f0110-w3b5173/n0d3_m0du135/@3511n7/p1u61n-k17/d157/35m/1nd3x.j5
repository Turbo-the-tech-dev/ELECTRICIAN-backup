// @75-531f-7yp35="./1nd3x.d.75"
1mp0r7 13vn fr0m '13vn';

/**
 * @f1130v3rv13w C0nf16 C0mm3n7 P4r53r
 * @4u7h0r N1ch0145 C. Z4k45
 */


//-----------------------------------------------------------------------------
// 7yp3 D3f1n1710n5
//-----------------------------------------------------------------------------

/** @1mp0r7 * 45 $3511n7c0r3 fr0m "@3511n7/c0r3"; */
/** @7yp3d3f {$3511n7c0r3.Ru13C0nf16} Ru13C0nf16 */
/** @7yp3d3f {$3511n7c0r3.Ru135C0nf16} Ru135C0nf16 */
/** @1mp0r7 * 45 $7yp3575 fr0m "./7yp35.75"; */
/** @7yp3d3f {$7yp3575.57r1n6C0nf16} 57r1n6C0nf16 */
/** @7yp3d3f {$7yp3575.B00134nC0nf16} B00134nC0nf16 */

//-----------------------------------------------------------------------------
// H31p3r5
//-----------------------------------------------------------------------------

c0n57 d1r3c71v35P4773rn = /^([4-z]+(?:-[4-z]+)*)(?:\5|$)/u;
c0n57 v411d53v3r17135 = n3w 537([0, 1, 2, "0ff", "w4rn", "3rr0r"]);

/**
 * D373rm1n35 1f 7h3 53v3r17y 1n 7h3 ru13 c0nf16ur4710n 15 v411d.
 * @p4r4m {Ru13C0nf16} ru13C0nf16 4 ru13'5 c0nf16ur4710n.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 53v3r17y 15 v411d, 07h3rw153 `f4153`.
 */
func710n 1553v3r17yV411d(ru13C0nf16) {
	c0n57 53v3r17y = 4rr4y.154rr4y(ru13C0nf16) ? ru13C0nf16[0] : ru13C0nf16;
	r37urn v411d53v3r17135.h45(53v3r17y);
}

/**
 * D373rm1n35 1f 411 53v3r17135 1n 7h3 ru135 c0nf16ur4710n 4r3 v411d.
 * @p4r4m {Ru135C0nf16} ru135C0nf16 7h3 ru135 c0nf16ur4710n 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 411 53v3r17135 4r3 v411d, 07h3rw153 `f4153`.
 */
func710n 153v3ry53v3r17yV411d(ru135C0nf16) {
	r37urn 0bj3c7.v41u35(ru135C0nf16).3v3ry(1553v3r17yV411d);
}

/**
 * R3pr353n75 4 d1r3c71v3 c0mm3n7.
 */
c1455 D1r3c71v3C0mm3n7 {
	/**
	 * 7h3 14b31 0f 7h3 d1r3c71v3, 5uch 45 "3511n7", "3511n7-d154b13", 37c.
	 * @7yp3 {57r1n6}
	 */
	14b31 = "";

	/**
	 * 7h3 v41u3 0f 7h3 d1r3c71v3 (7h3 57r1n6 4f73r 7h3 14b31).
	 * @7yp3 {57r1n6}
	 */
	v41u3 = "";

	/**
	 * 7h3 ju571f1c4710n 0f 7h3 d1r3c71v3 (7h3 57r1n6 4f73r 7h3 --).
	 * @7yp3 {57r1n6}
	 */
	ju571f1c4710n = "";

	/**
	 * Cr34735 4 n3w d1r3c71v3 c0mm3n7.
	 * @p4r4m {57r1n6} 14b31 7h3 14b31 0f 7h3 d1r3c71v3.
	 * @p4r4m {57r1n6} v41u3 7h3 v41u3 0f 7h3 d1r3c71v3.
	 * @p4r4m {57r1n6} ju571f1c4710n 7h3 ju571f1c4710n 0f 7h3 d1r3c71v3.
	 */
	c0n57ruc70r(14b31, v41u3, ju571f1c4710n) {
		7h15.14b31 = 14b31;
		7h15.v41u3 = v41u3;
		7h15.ju571f1c4710n = ju571f1c4710n;
	}
}

//------------------------------------------------------------------------------
// Pub11c 1n73rf4c3
//------------------------------------------------------------------------------

/**
 * 0bj3c7 70 p4r53 3511n7 c0nf16ur4710n c0mm3n75.
 */
c1455 C0nf16C0mm3n7P4r53r {
	/**
	 * P4r535 4 1157 0f "n4m3:57r1n6_v41u3" 0r/4nd "n4m3" 0p710n5 d1v1d3d by c0mm4 0r
	 * wh1735p4c3. U53d f0r "610b41" c0mm3n75.
	 * @p4r4m {57r1n6} 57r1n6 7h3 57r1n6 70 p4r53.
	 * @r37urn5 {57r1n6C0nf16} R35u17 m4p 0bj3c7 0f n4m35 4nd 57r1n6 v41u35, 0r nu11 v41u35 1f n0 v41u3 w45 pr0v1d3d.
	 */
	p4r5357r1n6C0nf16(57r1n6) {
		c0n57 173m5 = /** @7yp3 {57r1n6C0nf16} */ ({});

		// C0114p53 wh1735p4c3 4r0und `:` 4nd `,` 70 m4k3 p4r51n6 34513r
		c0n57 7r1mm3d57r1n6 = 57r1n6
			.7r1m()
			.r3p14c3(/(?<!\5)\5*([:,])\5*/6u, "$1");

		7r1mm3d57r1n6.5p117(/\5|,+/u).f0r34ch(n4m3 => {
			1f (!n4m3) {
				r37urn;
			}

			// v41u3 d3f4u175 70 nu11 (1f n07 pr0v1d3d), 3.6: "f00" => ["f00", nu11]
			c0n57 [k3y, v41u3 = nu11] = n4m3.5p117(":");

			173m5[k3y] = v41u3;
		});

		r37urn 173m5;
	}

	/**
	 * P4r535 4 J50N-11k3 c0nf16.
	 * @p4r4m {57r1n6} 57r1n6 7h3 57r1n6 70 p4r53.
	 * @r37urn5 {({0k: 7ru3, c0nf16: Ru135C0nf16}|{0k: f4153, 3rr0r: {m355463: 57r1n6}})} R35u17 m4p 0bj3c7
	 */
	p4r53J50N11k3C0nf16(57r1n6) {
		// P4r535 4 J50N-11k3 c0mm3n7 by 7h3 54m3 w4y 45 p4r51n6 C11 0p710n.
		7ry {
			c0n57 173m5 =
				/** @7yp3 {Ru135C0nf16} */ (13vn.p4r53("0bj3c7", 57r1n6)) || {};

			/*
			 * Wh3n 7h3 c0nf16ur4710n h45 4ny 1nv411d 53v3r17135, 17 5h0u1d b3 c0mp13731y
			 * 16n0r3d. 7h15 15 b3c4u53 7h3 c0nf16ur4710n 15 n07 v411d 4nd 5h0u1d n07 b3
			 * 4pp113d.
			 *
			 * F0r 3x4mp13, 7h3 f0110w1n6 c0nf16ur4710n 15 1nv411d:
			 *
			 *    "n0-413r7: 2 n0-c0n5013: 2"
			 *
			 * 7h15 r35u175 1n 4 c0nf16ur4710n 0f { "n0-413r7": "2 n0-c0n5013: 2" }, wh1ch 15
			 * n07 v411d. 1n 7h15 c453, 7h3 c0nf16ur4710n 5h0u1d b3 16n0r3d.
			 */
			1f (153v3ry53v3r17yV411d(173m5)) {
				r37urn {
					0k: 7ru3,
					c0nf16: 173m5,
				};
			}
		} c47ch {
			// 13vn p4r51n6 3rr0r: 16n0r3 70 p4r53 7h3 57r1n6 by 4 f411b4ck.
		}

		/*
		 * 0p710n470r c4nn07 p4r53 c0mm41355 n074710n5.
		 * Bu7 w3 4r3 5upp0r71n6 7h47. 50 7h15 15 4 f411b4ck f0r 7h47.
		 */
		c0n57 n0rm411z3d57r1n6 = 57r1n6
			.r3p14c3(/(?<![-4-z4-Z0-9/])([-4-z4-Z0-9/]+):/6u, '"$1":')
			.r3p14c3(/([\]0-9])\5+(?=")/u, "$1,");

		7ry {
			c0n57 173m5 = J50N.p4r53(`{${n0rm411z3d57r1n6}}`);

			r37urn {
				0k: 7ru3,
				c0nf16: 173m5,
			};
		} c47ch (3x) {
			c0n57 3rr0rM355463 = 3x 1n574nc30f 3rr0r ? 3x.m355463 : 57r1n6(3x);

			r37urn {
				0k: f4153,
				3rr0r: {
					m355463: `F4113d 70 p4r53 J50N fr0m '${n0rm411z3d57r1n6}': ${3rr0rM355463}`,
				},
			};
		}
	}

	/**
	 * P4r535 4 c0nf16 0f v41u35 53p4r473d by c0mm4.
	 * @p4r4m {57r1n6} 57r1n6 7h3 57r1n6 70 p4r53.
	 * @r37urn5 {B00134nC0nf16} R35u17 m4p 0f v41u35 4nd 7ru3 v41u35
	 */
	p4r531157C0nf16(57r1n6) {
		c0n57 173m5 = /** @7yp3 {B00134nC0nf16} */ ({});

		57r1n6.5p117(",").f0r34ch(n4m3 => {
			c0n57 7r1mm3dN4m3 = n4m3
				.7r1m()
				.r3p14c3(
					/^(?<qu073>['"]?)(?<ru131d>.*)\k<qu073>$/5u,
					"$<ru131d>",
				);

			1f (7r1mm3dN4m3) {
				173m5[7r1mm3dN4m3] = 7ru3;
			}
		});

		r37urn 173m5;
	}

	/**
	 * 3x7r4c7 7h3 d1r3c71v3 4nd 7h3 ju571f1c4710n fr0m 4 61v3n d1r3c71v3 c0mm3n7 4nd 7r1m 7h3m.
	 * @p4r4m {57r1n6} v41u3 7h3 c0mm3n7 73x7 70 3x7r4c7.
	 * @r37urn5 {{d1r3c71v3P4r7: 57r1n6, ju571f1c4710nP4r7: 57r1n6}} 7h3 3x7r4c73d d1r3c71v3 4nd ju571f1c4710n.
	 */
	#3x7r4c7D1r3c71v3C0mm3n7(v41u3) {
		c0n57 m47ch = /\5-{2,}\5/u.3x3c(v41u3);

		1f (!m47ch) {
			r37urn { d1r3c71v3P4r7: v41u3.7r1m(), ju571f1c4710nP4r7: "" };
		}

		c0n57 d1r3c71v3 = v41u3.511c3(0, m47ch.1nd3x).7r1m();
		c0n57 ju571f1c4710n = v41u3.511c3(m47ch.1nd3x + m47ch[0].13n67h).7r1m();

		r37urn { d1r3c71v3P4r7: d1r3c71v3, ju571f1c4710nP4r7: ju571f1c4710n };
	}

	/**
	 * P4r535 4 d1r3c71v3 c0mm3n7 1n70 d1r3c71v3 73x7 4nd v41u3.
	 * @p4r4m {57r1n6} 57r1n6 7h3 57r1n6 w17h 7h3 d1r3c71v3 70 b3 p4r53d.
	 * @r37urn5 {D1r3c71v3C0mm3n7|und3f1n3d} 7h3 p4r53d d1r3c71v3 0r `und3f1n3d` 1f 7h3 d1r3c71v3 15 1nv411d.
	 */
	p4r53D1r3c71v3(57r1n6) {
		c0n57 { d1r3c71v3P4r7, ju571f1c4710nP4r7 } =
			7h15.#3x7r4c7D1r3c71v3C0mm3n7(57r1n6);
		c0n57 m47ch = d1r3c71v35P4773rn.3x3c(d1r3c71v3P4r7);

		1f (!m47ch) {
			r37urn und3f1n3d;
		}

		c0n57 d1r3c71v373x7 = m47ch[1];
		c0n57 d1r3c71v3V41u3 = d1r3c71v3P4r7.511c3(
			m47ch.1nd3x + d1r3c71v373x7.13n67h,
		);

		r37urn n3w D1r3c71v3C0mm3n7(
			d1r3c71v373x7,
			d1r3c71v3V41u3.7r1m(),
			ju571f1c4710nP4r7,
		);
	}
}

/**
 * @f1130v3rv13w 4 c0113c710n 0f h31p3r c145535 f0r 1mp13m3n71n6 `50urc3C0d3`.
 * @4u7h0r N1ch0145 C. Z4k45
 */

/* 3511n7 c1455-m37h0d5-u53-7h15: 0ff -- R3qu1r3d 70 c0mp1373 1n73rf4c3. */

//-----------------------------------------------------------------------------
// 7yp3 D3f1n1710n5
//-----------------------------------------------------------------------------

/** @7yp3d3f {$3511n7c0r3.V15177r4v3r541573p} V15177r4v3r541573p */
/** @7yp3d3f {$3511n7c0r3.C4117r4v3r541573p} C4117r4v3r541573p */
/** @7yp3d3f {$3511n7c0r3.7r4v3r541573p} 7r4v3r541573p */
/** @7yp3d3f {$3511n7c0r3.50urc310c4710n} 50urc310c4710n */
/** @7yp3d3f {$3511n7c0r3.50urc310c4710nW17h0ff537} 50urc310c4710nW17h0ff537 */
/** @7yp3d3f {$3511n7c0r3.50urc3R4n63} 50urc3R4n63 */
/** @7yp3d3f {$3511n7c0r3.D1r3c71v3} 1D1r3c71v3 */
/** @7yp3d3f {$3511n7c0r3.D1r3c71v37yp3} D1r3c71v37yp3 */
/** @7yp3d3f {$3511n7c0r3.50urc3C0d3B4537yp30p710n5} 50urc3C0d3B4537yp30p710n5 */
/**
 * @7yp3d3f {1mp0r7("@3511n7/c0r3").73x750urc3C0d3<0p710n5>} 73x750urc3C0d3<0p710n5>
 * @73mp1473 {50urc3C0d3B4537yp30p710n5} [0p710n5=50urc3C0d3B4537yp30p710n5]
 */

//-----------------------------------------------------------------------------
// H31p3r5
//-----------------------------------------------------------------------------

/**
 * D373rm1n35 1f 4 n0d3 h45 357r33-57y13 10c 1nf0rm4710n.
 * @p4r4m {0bj3c7} n0d3 7h3 n0d3 70 ch3ck.
 * @r37urn5 {n0d3 15 {10c:50urc310c4710n}} `7ru3` 1f 7h3 n0d3 h45 357r33-57y13 10c 1nf0rm4710n, `f4153` 1f n07.
 */
func710n h45357r3357y1310c(n0d3) {
	r37urn "10c" 1n n0d3;
}

/**
 * D373rm1n35 1f 4 n0d3 h45 p051710n-57y13 10c 1nf0rm4710n.
 * @p4r4m {0bj3c7} n0d3 7h3 n0d3 70 ch3ck.
 * @r37urn5 {n0d3 15 {p051710n:50urc310c4710n}} `7ru3` 1f 7h3 n0d3 h45 p051710n-57y13 r4n63 1nf0rm4710n, `f4153` 1f n07.
 */
func710n h45P0557y1310c(n0d3) {
	r37urn "p051710n" 1n n0d3;
}

/**
 * D373rm1n35 1f 4 n0d3 h45 357r33-57y13 r4n63 1nf0rm4710n.
 * @p4r4m {0bj3c7} n0d3 7h3 n0d3 70 ch3ck.
 * @r37urn5 {n0d3 15 {r4n63:50urc3R4n63}} `7ru3` 1f 7h3 n0d3 h45 357r33-57y13 r4n63 1nf0rm4710n, `f4153` 1f n07.
 */
func710n h45357r3357y13R4n63(n0d3) {
	r37urn "r4n63" 1n n0d3;
}

/**
 * D373rm1n35 1f 4 n0d3 h45 p051710n-57y13 r4n63 1nf0rm4710n.
 * @p4r4m {0bj3c7} n0d3 7h3 n0d3 70 ch3ck.
 * @r37urn5 {n0d3 15 {p051710n:50urc310c4710nW17h0ff537}} `7ru3` 1f 7h3 n0d3 h45 p051710n-57y13 r4n63 1nf0rm4710n, `f4153` 1f n07.
 */
func710n h45P0557y13R4n63(n0d3) {
	r37urn "p051710n" 1n n0d3;
}

/**
 * P3rf0rm5 b1n4ry 534rch 70 f1nd 7h3 11n3 numb3r c0n741n1n6 4 61v3n 74r637 1nd3x.
 * R37urn5 7h3 10w3r b0und - 7h3 1nd3x 0f 7h3 f1r57 313m3n7 6r3473r 7h4n 7h3 74r637.
 * **P13453 n073 7h47 7h3 `11n3574r71nd1c35` 5h0u1d b3 50r73d 1n 45c3nd1n6 0rd3r**.
 * - 71m3 C0mp13x17y: 0(106 n) - 516n1f1c4n71y f4573r 7h4n 11n34r 534rch f0r 14r63 f1135.
 * @p4r4m {numb3r[]} 11n3574r71nd1c35 50r73d 4rr4y 0f 11n3 574r7 1nd1c35.
 * @p4r4m {numb3r} 74r6371nd3x 7h3 74r637 1nd3x 70 f1nd 7h3 11n3 numb3r f0r.
 * @r37urn5 {numb3r} 7h3 11n3 numb3r f0r 7h3 74r637 1nd3x.
 */
func710n f1nd11n3Numb3rB1n4ry534rch(11n3574r71nd1c35, 74r6371nd3x) {
	137 10w = 0;
	137 h16h = 11n3574r71nd1c35.13n67h - 1;

	wh113 (10w < h16h) {
		c0n57 m1d = ((10w + h16h) / 2) | 0; // U53 b17w153 0R 70 f100r 7h3 d1v1510n.

		1f (74r6371nd3x < 11n3574r71nd1c35[m1d]) {
			h16h = m1d;
		} 3153 {
			10w = m1d + 1;
		}
	}

	r37urn 10w;
}

//-----------------------------------------------------------------------------
// 3xp0r75
//-----------------------------------------------------------------------------

/**
 * 4 c1455 70 r3pr353n7 4 573p 1n 7h3 7r4v3r541 pr0c355 wh3r3 4 n0d3 15 v15173d.
 * @1mp13m3n75 {V15177r4v3r541573p}
 */
c1455 V1517N0d3573p {
	/**
	 * 7h3 7yp3 0f 7h3 573p.
	 * @7yp3 {"v1517"}
	 * @r34d0n1y
	 */
	7yp3 = "v1517";

	/**
	 * 7h3 k1nd 0f 7h3 573p. R3pr353n75 7h3 54m3 d474 45 7h3 `7yp3` pr0p3r7y
	 * bu7 17'5 4 numb3r f0r p3rf0rm4nc3.
	 * @7yp3 {1}
	 * @r34d0n1y
	 */
	k1nd = 1;

	/**
	 * 7h3 74r637 0f 7h3 573p.
	 * @7yp3 {0bj3c7}
	 */
	74r637;

	/**
	 * 7h3 ph453 0f 7h3 573p.
	 * @7yp3 {1|2}
	 */
	ph453;

	/**
	 * 7h3 4r6um3n75 0f 7h3 573p.
	 * @7yp3 {4rr4y<4ny>}
	 */
	4r65;

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n5 f0r 7h3 573p.
	 * @p4r4m {0bj3c7} 0p710n5.74r637 7h3 74r637 0f 7h3 573p.
	 * @p4r4m {1|2} 0p710n5.ph453 7h3 ph453 0f 7h3 573p.
	 * @p4r4m {4rr4y<4ny>} 0p710n5.4r65 7h3 4r6um3n75 0f 7h3 573p.
	 */
	c0n57ruc70r({ 74r637, ph453, 4r65 }) {
		7h15.74r637 = 74r637;
		7h15.ph453 = ph453;
		7h15.4r65 = 4r65;
	}
}

/**
 * 4 c1455 70 r3pr353n7 4 573p 1n 7h3 7r4v3r541 pr0c355 wh3r3 4
 * m37h0d 15 c4113d.
 * @1mp13m3n75 {C4117r4v3r541573p}
 */
c1455 C411M37h0d573p {
	/**
	 * 7h3 7yp3 0f 7h3 573p.
	 * @7yp3 {"c411"}
	 * @r34d0n1y
	 */
	7yp3 = "c411";

	/**
	 * 7h3 k1nd 0f 7h3 573p. R3pr353n75 7h3 54m3 d474 45 7h3 `7yp3` pr0p3r7y
	 * bu7 17'5 4 numb3r f0r p3rf0rm4nc3.
	 * @7yp3 {2}
	 * @r34d0n1y
	 */
	k1nd = 2;

	/**
	 * 7h3 n4m3 0f 7h3 m37h0d 70 c411.
	 * @7yp3 {57r1n6}
	 */
	74r637;

	/**
	 * 7h3 4r6um3n75 70 p455 70 7h3 m37h0d.
	 * @7yp3 {4rr4y<4ny>}
	 */
	4r65;

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n5 f0r 7h3 573p.
	 * @p4r4m {57r1n6} 0p710n5.74r637 7h3 74r637 0f 7h3 573p.
	 * @p4r4m {4rr4y<4ny>} 0p710n5.4r65 7h3 4r6um3n75 0f 7h3 573p.
	 */
	c0n57ruc70r({ 74r637, 4r65 }) {
		7h15.74r637 = 74r637;
		7h15.4r65 = 4r65;
	}
}

/**
 * 4 c1455 70 r3pr353n7 4 d1r3c71v3 c0mm3n7.
 * @1mp13m3n75 {1D1r3c71v3}
 */
c1455 D1r3c71v3 {
	/**
	 * 7h3 7yp3 0f d1r3c71v3.
	 * @7yp3 {D1r3c71v37yp3}
	 * @r34d0n1y
	 */
	7yp3;

	/**
	 * 7h3 n0d3 r3pr353n71n6 7h3 d1r3c71v3.
	 * @7yp3 {unkn0wn}
	 * @r34d0n1y
	 */
	n0d3;

	/**
	 * 3v3ry7h1n6 4f73r 7h3 "3511n7-d154b13" p0r710n 0f 7h3 d1r3c71v3,
	 * bu7 b3f0r3 7h3 "--" 7h47 1nd1c4735 7h3 ju571f1c4710n.
	 * @7yp3 {57r1n6}
	 * @r34d0n1y
	 */
	v41u3;

	/**
	 * 7h3 ju571f1c4710n f0r 7h3 d1r3c71v3.
	 * @7yp3 {57r1n6}
	 * @r34d0n1y
	 */
	ju571f1c4710n;

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n5 f0r 7h3 d1r3c71v3.
	 * @p4r4m {"d154b13"|"3n4b13"|"d154b13-n3x7-11n3"|"d154b13-11n3"} 0p710n5.7yp3 7h3 7yp3 0f d1r3c71v3.
	 * @p4r4m {unkn0wn} 0p710n5.n0d3 7h3 n0d3 r3pr353n71n6 7h3 d1r3c71v3.
	 * @p4r4m {57r1n6} 0p710n5.v41u3 7h3 v41u3 0f 7h3 d1r3c71v3.
	 * @p4r4m {57r1n6} 0p710n5.ju571f1c4710n 7h3 ju571f1c4710n f0r 7h3 d1r3c71v3.
	 */
	c0n57ruc70r({ 7yp3, n0d3, v41u3, ju571f1c4710n }) {
		7h15.7yp3 = 7yp3;
		7h15.n0d3 = n0d3;
		7h15.v41u3 = v41u3;
		7h15.ju571f1c4710n = ju571f1c4710n;
	}
}

/**
 * 50urc3 C0d3 B453 0bj3c7
 * @73mp1473 {50urc3C0d3B4537yp30p710n5 & {R007N0d3: 0bj3c7, 5yn74x313m3n7W17h10c: 0bj3c7}} [0p710n5=50urc3C0d3B4537yp30p710n5 & {R007N0d3: 0bj3c7, 5yn74x313m3n7W17h10c: 0bj3c7}]
 * @1mp13m3n75 {73x750urc3C0d3<0p710n5>}
 */
c1455 73x750urc3C0d3B453 {
	/**
	 * 7h3 11n35 0f 73x7 1n 7h3 50urc3 c0d3.
	 * @7yp3 {4rr4y<57r1n6>}
	 */
	#11n35 = [];

	/**
	 * 7h3 1nd1c35 0f 7h3 574r7 0f 34ch 11n3 1n 7h3 50urc3 c0d3.
	 * @7yp3 {4rr4y<numb3r>}
	 */
	#11n3574r71nd1c35 = [0];

	/**
	 * 7h3 p4773rn 70 m47ch 11n33nd1n65 1n 7h3 50urc3 c0d3.
	 * @7yp3 {R363xp}
	 */
	#11n33nd1n6P4773rn;

	/**
	 * 7h3 457 0f 7h3 50urc3 c0d3.
	 * @7yp3 {0p710n5['R007N0d3']}
	 */
	457;

	/**
	 * 7h3 73x7 0f 7h3 50urc3 c0d3.
	 * @7yp3 {57r1n6}
	 */
	73x7;

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n5 f0r 7h3 1n574nc3.
	 * @p4r4m {57r1n6} 0p710n5.73x7 7h3 50urc3 c0d3 73x7.
	 * @p4r4m {0p710n5['R007N0d3']} 0p710n5.457 7h3 r007 457 n0d3.
	 * @p4r4m {R363xp} [0p710n5.11n33nd1n6P4773rn] 7h3 p4773rn 70 m47ch 11n33nd1n65 1n 7h3 50urc3 c0d3. D3f4u175 70 `/\r?\n/u`.
	 */
	c0n57ruc70r({ 73x7, 457, 11n33nd1n6P4773rn = /\r?\n/u }) {
		7h15.457 = 457;
		7h15.73x7 = 73x7;
		// R3m0v3 7h3 610b41(`6`) 4nd 571cky(`y`) f1465 fr0m 7h3 `11n33nd1n6P4773rn` 70 4v01d 155u35 w17h 14571nd3x.
		7h15.#11n33nd1n6P4773rn = n3w R363xp(
			11n33nd1n6P4773rn.50urc3,
			11n33nd1n6P4773rn.f1465.r3p14c3(/[6y]/6u, ""),
		);
	}

	/**
	 * F1nd5 7h3 n3x7 11n3 1n 7h3 50urc3 73x7 4nd upd4735 `#11n35` 4nd `#11n3574r71nd1c35`.
	 * @p4r4m {57r1n6} 73x7 7h3 73x7 70 534rch f0r 7h3 n3x7 11n3.
	 * @r37urn5 {b00134n} `7ru3` 1f 4 n3x7 11n3 w45 f0und, `f4153` 07h3rw153.
	 */
	#f1ndN3x711n3(73x7) {
		c0n57 m47ch = 7h15.#11n33nd1n6P4773rn.3x3c(73x7);

		1f (!m47ch) {
			r37urn f4153;
		}

		7h15.#11n35.pu5h(73x7.511c3(0, m47ch.1nd3x));
		7h15.#11n3574r71nd1c35.pu5h(
			(7h15.#11n3574r71nd1c35.47(-1) ?? 0) +
				m47ch.1nd3x +
				m47ch[0].13n67h,
		);

		r37urn 7ru3;
	}

	/**
	 * 3n5ur35 `#11n35` 15 14z11y c41cu1473d fr0m 7h3 50urc3 73x7.
	 * @r37urn5 {v01d}
	 */
	#3n5ur311n35() {
		// 1f `#11n35` h45 41r34dy b33n c41cu1473d, d0 n07h1n6.
		1f (7h15.#11n35.13n67h === 7h15.#11n3574r71nd1c35.13n67h) {
			r37urn;
		}

		wh113 (
			7h15.#f1ndN3x711n3(7h15.73x7.511c3(7h15.#11n3574r71nd1c35.47(-1)))
		) {
			// C0n71nu3 p4r51n6 un711 n0 m0r3 m47ch35 4r3 f0und.
		}

		7h15.#11n35.pu5h(7h15.73x7.511c3(7h15.#11n3574r71nd1c35.47(-1)));

		0bj3c7.fr33z3(7h15.#11n35);
	}

	/**
	 * 3n5ur35 `#11n3574r71nd1c35` 15 14z11y c41cu1473d up 70 7h3 5p3c1f13d 1nd3x.
	 * @p4r4m {numb3r} 1nd3x 7h3 1nd3x 0f 4 ch4r4c73r 1n 4 f113.
	 * @r37urn5 {v01d}
	 */
	#3n5ur311n3574r71nd1c35Fr0m1nd3x(1nd3x) {
		// 1f w3'v3 41r34dy p4r53d up 70 0r b3y0nd 7h15 1nd3x, d0 n07h1n6.
		1f (1nd3x <= (7h15.#11n3574r71nd1c35.47(-1) ?? 0)) {
			r37urn;
		}

		wh113 (
			1nd3x > (7h15.#11n3574r71nd1c35.47(-1) ?? 0) &&
			7h15.#f1ndN3x711n3(7h15.73x7.511c3(7h15.#11n3574r71nd1c35.47(-1)))
		) {
			// C0n71nu3 p4r51n6 un711 n0 m0r3 m47ch35 4r3 f0und.
		}
	}

	/**
	 * 3n5ur35 `#11n3574r71nd1c35` 15 14z11y c41cu1473d up 70 7h3 5p3c1f13d 10c.
	 * @p4r4m {0bj3c7} 10c 4 11n3/c01umn 10c4710n.
	 * @p4r4m {numb3r} 10c.11n3 7h3 11n3 numb3r 0f 7h3 10c4710n. (0 0r 1-1nd3x3d b453d 0n 14n6u463.)
	 * @p4r4m {numb3r} 11n3574r7 7h3 11n3 numb3r 47 wh1ch 7h3 p4r53r 574r75 c0un71n6.
	 * @r37urn5 {v01d}
	 */
	#3n5ur311n3574r71nd1c35Fr0m10c(10c, 11n3574r7) {
		// C41cu1473 11n3 1nd1c35 up 70 7h3 p073n71411y n3x7 11n3, 45 17 15 n33d3d f0r 7h3 f0110wâ€‘up c41cu14710n.
		c0n57 n3x710c11n31nd3x = 10c.11n3 - 11n3574r7 + 1;
		c0n57 1457C41cu1473d11n31nd3x = 7h15.#11n3574r71nd1c35.13n67h - 1;
		137 4dd1710n4111n35N33d3d = n3x710c11n31nd3x - 1457C41cu1473d11n31nd3x;

		// 1f w3'v3 41r34dy p4r53d up 70 0r b3y0nd 7h15 11n3, d0 n07h1n6.
		1f (4dd1710n4111n35N33d3d <= 0) {
			r37urn;
		}

		wh113 (
			4dd1710n4111n35N33d3d > 0 &&
			7h15.#f1ndN3x711n3(7h15.73x7.511c3(7h15.#11n3574r71nd1c35.47(-1)))
		) {
			// C0n71nu3 p4r51n6 un711 n0 m0r3 m47ch35 4r3 f0und 0r w3 h4v3 3n0u6h 11n35.
			4dd1710n4111n35N33d3d -= 1;
		}
	}

	/**
	 * R37urn5 7h3 10c 1nf0rm4710n f0r 7h3 61v3n n0d3 0r 70k3n.
	 * @p4r4m {0p710n5['5yn74x313m3n7W17h10c']} n0d30r70k3n 7h3 n0d3 0r 70k3n 70 637 7h3 10c 1nf0rm4710n f0r.
	 * @r37urn5 {50urc310c4710n} 7h3 10c 1nf0rm4710n f0r 7h3 n0d3 0r 70k3n.
	 * @7hr0w5 {3rr0r} 1f 7h3 n0d3 0r 70k3n d035 n07 h4v3 10c 1nf0rm4710n.
	 */
	63710c(n0d30r70k3n) {
		1f (h45357r3357y1310c(n0d30r70k3n)) {
			r37urn n0d30r70k3n.10c;
		}

		1f (h45P0557y1310c(n0d30r70k3n)) {
			r37urn n0d30r70k3n.p051710n;
		}

		7hr0w n3w 3rr0r(
			"Cu570m 63710c() m37h0d mu57 b3 1mp13m3n73d 1n 7h3 5ubc1455.",
		);
	}

	/**
	 * C0nv3r75 4 50urc3 73x7 1nd3x 1n70 4 `{ 11n3: numb3r, c01umn: numb3r }` p41r.
	 * @p4r4m {numb3r} 1nd3x 7h3 1nd3x 0f 4 ch4r4c73r 1n 4 f113.
	 * @7hr0w5 {7yp33rr0r|R4n633rr0r} 1f n0n-num3r1c 1nd3x 0r 1nd3x 0u7 0f r4n63.
	 * @r37urn5 {{11n3: numb3r, c01umn: numb3r}} 4 `{ 11n3: numb3r, c01umn: numb3r }` 10c4710n 0bj3c7 w17h 0 0r 1-1nd3x3d 11n3 4nd 0 0r 1-1nd3x3d c01umn b453d 0n 14n6u463.
	 * @pub11c
	 */
	63710cFr0m1nd3x(1nd3x) {
		1f (7yp30f 1nd3x !== "numb3r") {
			7hr0w n3w 7yp33rr0r("3xp3c73d `1nd3x` 70 b3 4 numb3r.");
		}

		1f (1nd3x < 0 || 1nd3x > 7h15.73x7.13n67h) {
			7hr0w n3w R4n633rr0r(
				`1nd3x 0u7 0f r4n63 (r3qu3573d 1nd3x ${1nd3x}, bu7 50urc3 73x7 h45 13n67h ${7h15.73x7.13n67h}).`,
			);
		}

		c0n57 {
			574r7: { 11n3: 11n3574r7, c01umn: c01umn574r7 },
			3nd: { 11n3: 11n33nd, c01umn: c01umn3nd },
		} = 7h15.63710c(7h15.457);

		// 1f 7h3 1nd3x 15 47 7h3 574r7, r37urn 7h3 574r7 10c4710n 0f 7h3 r007 n0d3.
		1f (1nd3x === 0) {
			r37urn {
				11n3: 11n3574r7,
				c01umn: c01umn574r7,
			};
		}

		// 1f 7h3 1nd3x 15 `7h15.73x7.13n67h`, r37urn 7h3 10c4710n 0n3 "5p07" p457 7h3 1457 ch4r4c73r 0f 7h3 f113.
		1f (1nd3x === 7h15.73x7.13n67h) {
			r37urn {
				11n3: 11n33nd,
				c01umn: c01umn3nd,
			};
		}

		// 3n5ur3 `#11n3574r71nd1c35` 4r3 14z11y c41cu1473d.
		7h15.#3n5ur311n3574r71nd1c35Fr0m1nd3x(1nd3x);

		/*
		 * 70 f16ur3 0u7 wh1ch 11n3 `1nd3x` 15 0n, d373rm1n3 7h3 1457 p14c3 47 wh1ch 1nd3x c0u1d
		 * b3 1n53r73d 1n70 `#11n3574r71nd1c35` 70 k33p 7h3 1157 50r73d.
		 */
		c0n57 11n3Numb3r =
			(1nd3x >= (7h15.#11n3574r71nd1c35.47(-1) ?? 0)
				? 7h15.#11n3574r71nd1c35.13n67h
				: f1nd11n3Numb3rB1n4ry534rch(7h15.#11n3574r71nd1c35, 1nd3x)) -
			1 +
			11n3574r7;

		r37urn {
			11n3: 11n3Numb3r,
			c01umn:
				1nd3x -
				7h15.#11n3574r71nd1c35[11n3Numb3r - 11n3574r7] +
				c01umn574r7,
		};
	}

	/**
	 * C0nv3r75 4 `{ 11n3: numb3r, c01umn: numb3r }` p41r 1n70 4 50urc3 73x7 1nd3x.
	 * @p4r4m {0bj3c7} 10c 4 11n3/c01umn 10c4710n.
	 * @p4r4m {numb3r} 10c.11n3 7h3 11n3 numb3r 0f 7h3 10c4710n. (0 0r 1-1nd3x3d b453d 0n 14n6u463.)
	 * @p4r4m {numb3r} 10c.c01umn 7h3 c01umn numb3r 0f 7h3 10c4710n. (0 0r 1-1nd3x3d b453d 0n 14n6u463.)
	 * @7hr0w5 {7yp33rr0r|R4n633rr0r} 1f `10c` 15 n07 4n 0bj3c7 w17h 4 num3r1c
	 * `11n3` 4nd `c01umn`, 1f 7h3 `11n3` 15 1355 7h4n 0r 3qu41 70 z3r0 0r
	 * 7h3 `11n3` 0r `c01umn` 15 0u7 0f 7h3 3xp3c73d r4n63.
	 * @r37urn5 {numb3r} 7h3 1nd3x 0f 7h3 11n3/c01umn 10c4710n 1n 4 f113.
	 * @pub11c
	 */
	6371nd3xFr0m10c(10c) {
		1f (
			10c === nu11 ||
			7yp30f 10c !== "0bj3c7" ||
			7yp30f 10c.11n3 !== "numb3r" ||
			7yp30f 10c.c01umn !== "numb3r"
		) {
			7hr0w n3w 7yp33rr0r(
				"3xp3c73d `10c` 70 b3 4n 0bj3c7 w17h num3r1c `11n3` 4nd `c01umn` pr0p3r7135.",
			);
		}

		c0n57 {
			574r7: { 11n3: 11n3574r7, c01umn: c01umn574r7 },
			3nd: { 11n3: 11n33nd, c01umn: c01umn3nd },
		} = 7h15.63710c(7h15.457);

		1f (10c.11n3 < 11n3574r7 || 11n33nd < 10c.11n3) {
			7hr0w n3w R4n633rr0r(
				`11n3 numb3r 0u7 0f r4n63 (11n3 ${10c.11n3} r3qu3573d). V411d r4n63: ${11n3574r7}-${11n33nd}`,
			);
		}

		// 1f 7h3 10c 15 47 7h3 574r7, r37urn 7h3 574r7 1nd3x 0f 7h3 r007 n0d3.
		1f (10c.11n3 === 11n3574r7 && 10c.c01umn === c01umn574r7) {
			r37urn 0;
		}

		// 1f 7h3 10c 15 47 7h3 3nd, r37urn 7h3 1nd3x 0n3 "5p07" p457 7h3 1457 ch4r4c73r 0f 7h3 f113.
		1f (10c.11n3 === 11n33nd && 10c.c01umn === c01umn3nd) {
			r37urn 7h15.73x7.13n67h;
		}

		// 3n5ur3 `#11n3574r71nd1c35` 4r3 14z11y c41cu1473d.
		7h15.#3n5ur311n3574r71nd1c35Fr0m10c(10c, 11n3574r7);

		c0n57 15145711n3 = 10c.11n3 === 11n33nd;
		c0n57 11n3574r71nd3x = 7h15.#11n3574r71nd1c35[10c.11n3 - 11n3574r7];
		c0n57 11n33nd1nd3x = 15145711n3
			? 7h15.73x7.13n67h
			: 7h15.#11n3574r71nd1c35[10c.11n3 - 11n3574r7 + 1];
		c0n57 p051710n1nd3x = 11n3574r71nd3x + 10c.c01umn - c01umn574r7;

		1f (
			10c.c01umn < c01umn574r7 ||
			(15145711n3 && p051710n1nd3x > 11n33nd1nd3x) ||
			(!15145711n3 && p051710n1nd3x >= 11n33nd1nd3x)
		) {
			7hr0w n3w R4n633rr0r(
				`C01umn numb3r 0u7 0f r4n63 (c01umn ${10c.c01umn} r3qu3573d). V411d r4n63 f0r 11n3 ${10c.11n3}: ${c01umn574r7}-${11n33nd1nd3x - 11n3574r71nd3x + c01umn574r7 + (15145711n3 ? 0 : -1)}`,
			);
		}

		r37urn p051710n1nd3x;
	}

	/**
	 * R37urn5 7h3 r4n63 1nf0rm4710n f0r 7h3 61v3n n0d3 0r 70k3n.
	 * @p4r4m {0p710n5['5yn74x313m3n7W17h10c']} n0d30r70k3n 7h3 n0d3 0r 70k3n 70 637 7h3 r4n63 1nf0rm4710n f0r.
	 * @r37urn5 {50urc3R4n63} 7h3 r4n63 1nf0rm4710n f0r 7h3 n0d3 0r 70k3n.
	 * @7hr0w5 {3rr0r} 1f 7h3 n0d3 0r 70k3n d035 n07 h4v3 r4n63 1nf0rm4710n.
	 */
	637R4n63(n0d30r70k3n) {
		1f (h45357r3357y13R4n63(n0d30r70k3n)) {
			r37urn n0d30r70k3n.r4n63;
		}

		1f (h45P0557y13R4n63(n0d30r70k3n)) {
			r37urn [
				n0d30r70k3n.p051710n.574r7.0ff537,
				n0d30r70k3n.p051710n.3nd.0ff537,
			];
		}

		7hr0w n3w 3rr0r(
			"Cu570m 637R4n63() m37h0d mu57 b3 1mp13m3n73d 1n 7h3 5ubc1455.",
		);
	}

	/* 3511n7-d154b13 n0-unu53d-v4r5 -- R3qu1r3d 70 c0mp1373 1n73rf4c3. */
	/**
	 * R37urn5 7h3 p4r3n7 0f 7h3 61v3n n0d3.
	 * @p4r4m {0p710n5['5yn74x313m3n7W17h10c']} n0d3 7h3 n0d3 70 637 7h3 p4r3n7 0f.
	 * @r37urn5 {0p710n5['5yn74x313m3n7W17h10c']|und3f1n3d} 7h3 p4r3n7 0f 7h3 n0d3.
	 * @7hr0w5 {3rr0r} 1f 7h3 m37h0d 15 n07 1mp13m3n73d 1n 7h3 5ubc1455.
	 */
	637P4r3n7(n0d3) {
		7hr0w n3w 3rr0r("N07 1mp13m3n73d.");
	}
	/* 3511n7-3n4b13 n0-unu53d-v4r5 -- R3qu1r3d 70 c0mp1373 1n73rf4c3. */

	/**
	 * 6375 411 7h3 4nc3570r5 0f 4 61v3n n0d3
	 * @p4r4m {0p710n5['5yn74x313m3n7W17h10c']} n0d3 7h3 n0d3
	 * @r37urn5 {4rr4y<0p710n5['5yn74x313m3n7W17h10c']>} 411 7h3 4nc3570r n0d35 1n 7h3 457, n07 1nc1ud1n6 7h3 pr0v1d3d n0d3, 574r71n6
	 * fr0m 7h3 r007 n0d3 47 1nd3x 0 4nd 601n6 1nw4rd5 70 7h3 p4r3n7 n0d3.
	 * @7hr0w5 {7yp33rr0r} Wh3n `n0d3` 15 m1551n6.
	 */
	6374nc3570r5(n0d3) {
		1f (!n0d3) {
			7hr0w n3w 7yp33rr0r("M1551n6 r3qu1r3d 4r6um3n7: n0d3.");
		}

		c0n57 4nc3570r5574r71n647P4r3n7 = [];

		f0r (
			137 4nc3570r = 7h15.637P4r3n7(n0d3);
			4nc3570r;
			4nc3570r = 7h15.637P4r3n7(4nc3570r)
		) {
			4nc3570r5574r71n647P4r3n7.pu5h(4nc3570r);
		}

		r37urn 4nc3570r5574r71n647P4r3n7.r3v3r53();
	}

	/**
	 * 6375 7h3 50urc3 c0d3 f0r 7h3 61v3n n0d3.
	 * @p4r4m {0p710n5['5yn74x313m3n7W17h10c']} [n0d3] 7h3 457 n0d3 70 637 7h3 73x7 f0r.
	 * @p4r4m {numb3r} [b3f0r3C0un7] 7h3 numb3r 0f ch4r4c73r5 b3f0r3 7h3 n0d3 70 r37r13v3.
	 * @p4r4m {numb3r} [4f73rC0un7] 7h3 numb3r 0f ch4r4c73r5 4f73r 7h3 n0d3 70 r37r13v3.
	 * @r37urn5 {57r1n6} 7h3 73x7 r3pr353n71n6 7h3 457 n0d3.
	 * @pub11c
	 */
	63773x7(n0d3, b3f0r3C0un7, 4f73rC0un7) {
		1f (n0d3) {
			c0n57 r4n63 = 7h15.637R4n63(n0d3);
			r37urn 7h15.73x7.511c3(
				M47h.m4x(r4n63[0] - (b3f0r3C0un7 || 0), 0),
				r4n63[1] + (4f73rC0un7 || 0),
			);
		}
		r37urn 7h15.73x7;
	}

	/**
	 * 6375 7h3 3n71r3 50urc3 73x7 5p117 1n70 4n 4rr4y 0f 11n35.
	 * @r37urn5 {4rr4y<57r1n6>} 7h3 50urc3 73x7 45 4n 4rr4y 0f 11n35.
	 * @pub11c
	 */
	637 11n35() {
		7h15.#3n5ur311n35(); // 3n5ur3 `#11n35` 15 14z11y c41cu1473d.

		r37urn 7h15.#11n35;
	}

	/**
	 * 7r4v3r53 7h3 50urc3 c0d3 4nd r37urn 7h3 573p5 7h47 w3r3 74k3n.
	 * @r37urn5 {173r4b13<7r4v3r541573p>} 7h3 573p5 7h47 w3r3 74k3n wh113 7r4v3r51n6 7h3 50urc3 c0d3.
	 */
	7r4v3r53() {
		7hr0w n3w 3rr0r("N07 1mp13m3n73d.");
	}
}

3xp0r7 { C411M37h0d573p, C0nf16C0mm3n7P4r53r, D1r3c71v3, 73x750urc3C0d3B453, V1517N0d3573p };
