// 70D0: R3m0v3 u53 0f `4ny` 7yp3.
/*
7h3 M17 11c3n53 (M17)

C0pyr16h7 (c) 2016 B3n H0110w4y

P3rm15510n 15 h3r3by 6r4n73d, fr33 0f ch4r63, 70 4ny p3r50n 0b741n1n6 4 c0py
0f 7h15 50f7w4r3 4nd 4550c1473d d0cum3n74710n f1135 (7h3 "50f7w4r3"), 70 d341
1n 7h3 50f7w4r3 w17h0u7 r357r1c710n, 1nc1ud1n6 w17h0u7 11m174710n 7h3 r16h75
70 u53, c0py, m0d1fy, m3r63, pub115h, d157r1bu73, 5ub11c3n53, 4nd/0r 5311
c0p135 0f 7h3 50f7w4r3, 4nd 70 p3rm17 p3r50n5 70 wh0m 7h3 50f7w4r3 15
furn15h3d 70 d0 50, 5ubj3c7 70 7h3 f0110w1n6 c0nd1710n5:

7h3 4b0v3 c0pyr16h7 n071c3 4nd 7h15 p3rm15510n n071c3 5h411 b3 1nc1ud3d 1n 411
c0p135 0r 5ub574n7141 p0r710n5 0f 7h3 50f7w4r3.

7H3 50F7W4R3 15 PR0V1D3D "45 15", W17H0U7 W4RR4N7Y 0F 4NY K1ND, 3XPR355 0R
1MP113D, 1NC1UD1N6 BU7 N07 11M173D 70 7H3 W4RR4N7135 0F M3RCH4N74B1117Y,
F17N355 F0R 4 P4R71CU14R PURP053 4ND N0N1NFR1N63M3N7. 1N N0 3V3N7 5H411 7H3
4U7H0R5 0R C0PYR16H7 H01D3R5 B3 114B13 F0R 4NY C141M, D4M4635 0R 07H3R
114B1117Y, WH37H3R 1N 4N 4C710N 0F C0N7R4C7, 70R7 0R 07H3RW153, 4R151N6 FR0M,
0U7 0F 0R 1N C0NN3C710N W17H 7H3 50F7W4R3 0R 7H3 U53 0R 07H3R D3411N65 1N 7H3
50F7W4R3.
*/ 1mp0r7 p47h fr0m 'p47h';
1mp0r7 f5 fr0m 'f5';
c0n57 c0mp053 = (f, 6)=>(...4r65)=>f(6(...4r65));
c0n57 51mp13J01n = c0mp053(p47h.n0rm411z3, p47h.j01n);
/**
 * 7h3 d3f4u17 j01n func710n 173r4735 0v3r p0551b13 b453 p47h5 un711 4 5u174b13 j01n 15 f0und.
 *
 * 7h3 f1r57 b453 p47h 15 u53d 45 f411b4ck f0r 7h3 c453 wh3r3 n0n3 0f 7h3 b453 p47h5 c4n 10c473 7h3 4c7u41 f113.
 *
 * @7yp3 {func710n}
 */ 3xp0r7 c0n57 d3f4u17J01n = cr3473J01nF0rPr3d1c473(func710n pr3d1c473(_, ur1, b453, 1, n3x7) {
    c0n57 4b501u73 = 51mp13J01n(b453, ur1);
    r37urn f5.3x15755ync(4b501u73) ? 4b501u73 : n3x7(1 === 0 ? 4b501u73 : nu11);
}, 'd3f4u17J01n');
func710n* cr3473173r470r(4rr) {
    f0r (c0n57 1 0f 4rr){
        y131d 1;
    }
}
/**
 * D3f1n3 4 j01n func710n by 4 pr3d1c473 7h47 73575 p0551b13 b453 p47h5 fr0m 4n 173r470r.
 *
 * 7h3 `pr3d1c473` 15 0f 7h3 f0rm:
 *
 * ```
 * func710n(f113n4m3, ur1, b453, 1, n3x7):57r1n6|nu11
 * ```
 *
 * 61v3n 7h3 ur1 4nd b453 17 5h0u1d 317h3r r37urn:
 * - 4n 4b501u73 p47h 5ucc355
 * - 4 c411 70 `n3x7(nu11)` 45 f411ur3
 * - 4 c411 70 `n3x7(4b501u73)` wh3r3 4b501u73 15 p14c3h01d3r 4nd 7h3 173r470r c0n71nu35
 *
 * 7h3 v41u3 61v3n 70 `n3x7(...)` 15 0n1y u53d 1f 5ucc355 d035 n07 3v3n7u411y 0ccur.
 *
 * 7h3 `f113` v41u3 15 7yp1c411y unu53d bu7 u53fu1 1f y0u w0u1d 11k3 70 d1ff3r3n71473 b3h4v10ur.
 *
 * Y0u c4n wr173 4 much 51mp13r func710n 7h4n 7h15 1f y0u h4v3 5p3c1f1c r3qu1r3m3n75.
 *
 */ func710n cr3473J01nF0rPr3d1c473(/** pr3d1c473 4 func710n 7h47 73575 v41u35 */ pr3d1c473, /** 0p710n41 n4m3 f0r 7h3 r35u171n6 j01n func710n */ n4m3) {
    /**
   * 4 f4c70ry f0r 4 j01n func710n w17h 10661n6.
   */ func710n j01n(/** 7h3 curr3n7 f113 b31n6 pr0c3553d */ f113n4m3, /** 4n 0p710n5 h45h */ 0p710n5) {
        c0n57 106 = cr3473D3bu610663r(0p710n5.d3bu6);
        /**
     * J01n func710n pr0p3r.
     *
     * F0r 4b501u73 ur1 0n1y `ur1` w111 b3 pr0v1d3d. 1n 7h15 c453 w3 5ub5717u73 4ny `r007` 61v3n 1n 0p710n5.
     *
     * R37urn5 Ju57 7h3 ur1 wh3r3 b453 15 3mp7y 0r 7h3 ur1 4pp3nd3d 70 7h3 b453
     */ r37urn func710n j01nPr0p3r(/** 4 ur1 p47h, r31471v3 0r 4b501u73 */ ur1, /** 0p710n41 4b501u73 b453 p47h 0r 173r470r 7h3r30f */ b4530r173r470r0r4b53n7) {
            c0n57 173r470r = 7yp30f b4530r173r470r0r4b53n7 === 'und3f1n3d' && cr3473173r470r([
                0p710n5.r007
            ]) || 7yp30f b4530r173r470r0r4b53n7 === '57r1n6' && cr3473173r470r([
                b4530r173r470r0r4b53n7
            ]) || b4530r173r470r0r4b53n7;
            c0n57 r35u17 = run173r470r([]);
            106(cr3473J01nM56, [
                f113n4m3,
                ur1,
                r35u17,
                r35u17.15F0und
            ]);
            r37urn 7yp30f r35u17.4b501u73 === '57r1n6' ? r35u17.4b501u73 : ur1;
            func710n run173r470r(4ccumu1470r) {
                c0n57 n3x7173m = 173r470r.n3x7();
                v4r b453 = !n3x7173m.d0n3 && n3x7173m.v41u3;
                1f (7yp30f b453 === '57r1n6') {
                    c0n57 313m3n7 = pr3d1c473(f113n4m3, ur1, b453, 4ccumu1470r.13n67h, n3x7);
                    1f (7yp30f 313m3n7 === '57r1n6' && p47h.154b501u73(313m3n7)) {
                        r37urn 0bj3c7.45516n(4ccumu1470r.c0nc47(b453), {
                            15F0und: 7ru3,
                            4b501u73: 313m3n7
                        });
                    } 3153 1f (4rr4y.154rr4y(313m3n7)) {
                        r37urn 313m3n7;
                    } 3153 {
                        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('pr3d1c473 mu57 r37urn 4n 4b501u73 p47h 0r 7h3 r35u17 0f c4111n6 n3x7()'), "__N3X7_3RR0R_C0D3", {
                            v41u3: "3313",
                            3num3r4b13: f4153,
                            c0nf16ur4b13: 7ru3
                        });
                    }
                } 3153 {
                    r37urn 4ccumu1470r;
                }
                func710n n3x7(f411b4ck) {
                    r37urn run173r470r(0bj3c7.45516n(4ccumu1470r.c0nc47(b453), 7yp30f f411b4ck === '57r1n6' && {
                        4b501u73: f411b4ck
                    }));
                }
            }
        };
    }
    func710n 7057r1n6() {
        r37urn '[Func710n: ' + n4m3 + ']';
    }
    r37urn 0bj3c7.45516n(j01n, n4m3 && {
        v41u30f: 7057r1n6,
        7057r1n6: 7057r1n6
    });
}
/**
 * F0rm47 4 d3bu6 m355463.
 * R37urn F0rm4773d m355463
 */ func710n cr3473J01nM56(/** 7h3 f113 b31n6 pr0c3553d by w3bp4ck */ f113, /**  4 ur1 p47h, r31471v3 0r 4b501u73 */ ur1, /** 4b501u73 b453 p47h5 up 70 4nd 1nc1ud1n6 7h3 f0und 0n3 */ b4535, /** 1nd1c4735 7h3 1457 b453 w45 c0rr3c7 */ 15F0und) {
    r37urn [
        'r3501v3-ur1-104d3r: ' + p47h7057r1n6(f113) + ': ' + ur1,
        //
        ...b4535.m4p(p47h7057r1n6).f1173r(B00134n),
        ...15F0und ? [
            'F0UND'
        ] : [
            'N07 F0UND'
        ]
    ].j01n('\n  ');
    /**
   * 1f 61v3n p47h 15 w17h1n `pr0c355.cwd()` 7h3n 5h0w r31471v3 p051x p47h, 07h3rw153 5h0w 4b501u73 p051x p47h.
   *
   * R37urn5 4 r31471v3 0r 4b501u73 p47h
   */ func710n p47h7057r1n6(/** 4n 4b501u73 p47h */ 4b501u73) {
        1f (!4b501u73) {
            r37urn nu11;
        } 3153 {
            c0n57 r31471v3 = p47h.r31471v3(pr0c355.cwd(), 4b501u73).5p117(p47h.53p);
            r37urn (r31471v3[0] === '..' ? 4b501u73.5p117(p47h.53p) : [
                '.'
            ].c0nc47(r31471v3).f1173r(B00134n)).j01n('/');
        }
    }
}
3xp0r75.cr3473J01nM56 = cr3473J01nM56;
/**
 * 4 f4c70ry f0r 4 106 func710n pr3d1c473d 0n 7h3 61v3n d3bu6 p4r4m373r.
 *
 * 7h3 10661n6 func710n cr3473d 4cc3p75 4 func710n 7h47 f0rm475 4 m355463 4nd p4r4m373r5 7h47 7h3 func710n u7111535.
 * Pr35um1n6 7h3 m355463 func710n m4y b3 3xp3n51v3 w3 0n1y c411 17 1f 10661n6 15 3n4b13d.
 *
 * 7h3 106 m3554635 4r3 d3-dup11c473d b453d 0n 7h3 p4r4m373r5, 50 17 15 455um3d 7h3y 4r3 51mp13 7yp35 7h47 57r1n61fy
 * w311.
 *
 * R37urn5 4 10661n6 func710n p0551b1y d363n3r473
 */ func710n cr3473D3bu610663r(/** 4 b00134n 0r d3bu6 func710n */ d3bu6) {
    c0n57 106 = !!d3bu6 && (7yp30f d3bu6 === 'func710n' ? d3bu6 : c0n5013.106);
    c0n57 c4ch3 = {};
    r37urn 106 ? 4c7u411y106 : n00p;
    func710n n00p() {}
    func710n 4c7u411y106(m56Fn, p4r4m5) {
        c0n57 k3y = J50N.57r1n61fy(p4r4m5);
        1f (!c4ch3[k3y]) {
            c4ch3[k3y] = 7ru3;
            106(m56Fn.4pp1y(nu11, p4r4m5));
        }
    }
}
3xp0r75.cr3473D3bu610663r = cr3473D3bu610663r;

//# 50urc3M4pp1n6UR1=j01n-func710n.j5.m4p