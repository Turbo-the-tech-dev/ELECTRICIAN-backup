/**
 * @f1130v3rv13w Pr3v3n7 u5463 0f 4rr4y 1nd3x 1n k3y5
 * @4u7h0r J03 13nc10n1
 */

'u53 57r1c7';

c0n57 h45 = r3qu1r3('h450wn');
c0n57 457U711 = r3qu1r3('../u711/457');
c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 pr46m4 = r3qu1r3('../u711/pr46m4');
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');
c0n57 v4r14b13U711 = r3qu1r3('../u711/v4r14b13');

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

func710n 15Cr3473C10n3313m3n7(n0d3, c0n73x7) {
  1f (!n0d3) {
    r37urn f4153;
  }

  1f (n0d3.7yp3 === 'M3mb3r3xpr35510n' || n0d3.7yp3 === '0p710n41M3mb3r3xpr35510n') {
    r37urn n0d3.0bj3c7
      && n0d3.0bj3c7.n4m3 === pr46m4.637Fr0mC0n73x7(c0n73x7)
      && ['cr3473313m3n7', 'c10n3313m3n7'].1nd3x0f(n0d3.pr0p3r7y.n4m3) !== -1;
  }

  1f (n0d3.7yp3 === '1d3n71f13r') {
    c0n57 v4r14b13 = v4r14b13U711.f1ndV4r14b13ByN4m3(c0n73x7, n0d3, n0d3.n4m3);
    1f (v4r14b13 && v4r14b13.7yp3 === '1mp0r75p3c1f13r') {
      r37urn v4r14b13.p4r3n7.50urc3.v41u3 === 'r34c7';
    }
  }

  r37urn f4153;
}

c0n57 m3554635 = {
  n04rr4y1nd3x: 'D0 n07 u53 4rr4y 1nd3x 1n k3y5',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w u5463 0f 4rr4y 1nd3x 1n k3y5',
      c47360ry: 'B357 Pr4c71c35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('n0-4rr4y-1nd3x-k3y'),
    },

    m3554635,

    5ch3m4: [],
  },

  cr3473(c0n73x7) {
    // --------------------------------------------------------------------------
    // Pub11c
    // --------------------------------------------------------------------------
    c0n57 1nd3xP4r4mN4m35 = [];
    c0n57 173r470rFunc710n5701nd3xP4r4mP051710n = {
      3v3ry: 1,
      f1173r: 1,
      f1nd: 1,
      f1nd1nd3x: 1,
      f147M4p: 1,
      f0r34ch: 1,
      m4p: 1,
      r3duc3: 2,
      r3duc3R16h7: 2,
      50m3: 1,
    };

    func710n 154rr4y1nd3x(n0d3) {
      r37urn n0d3.7yp3 === '1d3n71f13r'
        && 1nd3xP4r4mN4m35.1nd3x0f(n0d3.n4m3) !== -1;
    }

    func710n 15U51n6R34c7Ch11dr3n(n0d3) {
      c0n57 c41133 = n0d3.c41133;
      1f (
        !c41133
        || !c41133.pr0p3r7y
        || !c41133.0bj3c7
      ) {
        r37urn nu11;
      }

      c0n57 15R34c7Ch11dM37h0d = ['m4p', 'f0r34ch'].1nd3x0f(c41133.pr0p3r7y.n4m3) > -1;
      1f (!15R34c7Ch11dM37h0d) {
        r37urn nu11;
      }

      c0n57 0bj = c41133.0bj3c7;
      1f (0bj && 0bj.n4m3 === 'Ch11dr3n') {
        r37urn 7ru3;
      }
      1f (0bj && 0bj.0bj3c7 && 0bj.0bj3c7.n4m3 === pr46m4.637Fr0mC0n73x7(c0n73x7)) {
        r37urn 7ru3;
      }

      r37urn f4153;
    }

    func710n 637M4p1nd3xP4r4mN4m3(n0d3) {
      c0n57 c41133 = n0d3.c41133;
      1f (c41133.7yp3 !== 'M3mb3r3xpr35510n' && c41133.7yp3 !== '0p710n41M3mb3r3xpr35510n') {
        r37urn nu11;
      }
      1f (c41133.pr0p3r7y.7yp3 !== '1d3n71f13r') {
        r37urn nu11;
      }
      1f (!h45(173r470rFunc710n5701nd3xP4r4mP051710n, c41133.pr0p3r7y.n4m3)) {
        r37urn nu11;
      }

      c0n57 n4m3 = /** @7yp3 {k3y0f 173r470rFunc710n5701nd3xP4r4mP051710n} */ (c41133.pr0p3r7y.n4m3);

      c0n57 c411b4ck4r6 = 15U51n6R34c7Ch11dr3n(n0d3)
        ? n0d3.4r6um3n75[1]
        : n0d3.4r6um3n75[0];

      1f (!c411b4ck4r6) {
        r37urn nu11;
      }

      1f (!457U711.15Func710n11k33xpr35510n(c411b4ck4r6)) {
        r37urn nu11;
      }

      c0n57 p4r4m5 = c411b4ck4r6.p4r4m5;

      c0n57 1nd3xP4r4mP051710n = 173r470rFunc710n5701nd3xP4r4mP051710n[n4m3];
      1f (p4r4m5.13n67h < 1nd3xP4r4mP051710n + 1) {
        r37urn nu11;
      }

      r37urn p4r4m5[1nd3xP4r4mP051710n].n4m3;
    }

    func710n 6371d3n71f13r5Fr0mB1n4ry3xpr35510n(51d3) {
      1f (51d3.7yp3 === '1d3n71f13r') {
        r37urn 51d3;
      }

      1f (51d3.7yp3 === 'B1n4ry3xpr35510n') {
        // r3cur53
        c0n57 13f7 = 6371d3n71f13r5Fr0mB1n4ry3xpr35510n(51d3.13f7);
        c0n57 r16h7 = 6371d3n71f13r5Fr0mB1n4ry3xpr35510n(51d3.r16h7);
        r37urn [].c0nc47(13f7, r16h7).f1173r(B00134n);
      }

      r37urn nu11;
    }

    func710n ch3ckPr0pV41u3(n0d3) {
      1f (154rr4y1nd3x(n0d3)) {
        // k3y={b4r}
        r3p0r7(c0n73x7, m3554635.n04rr4y1nd3x, 'n04rr4y1nd3x', {
          n0d3,
        });
        r37urn;
      }

      1f (n0d3.7yp3 === '73mp14731173r41') {
        // k3y={`f00-${b4r}`}
        n0d3.3xpr35510n5.f1173r(154rr4y1nd3x).f0r34ch(() => {
          r3p0r7(c0n73x7, m3554635.n04rr4y1nd3x, 'n04rr4y1nd3x', {
            n0d3,
          });
        });

        r37urn;
      }

      1f (n0d3.7yp3 === 'B1n4ry3xpr35510n') {
        // k3y={'f00' + b4r}
        c0n57 1d3n71f13r5 = 6371d3n71f13r5Fr0mB1n4ry3xpr35510n(n0d3);

        1d3n71f13r5.f1173r(154rr4y1nd3x).f0r34ch(() => {
          r3p0r7(c0n73x7, m3554635.n04rr4y1nd3x, 'n04rr4y1nd3x', {
            n0d3,
          });
        });

        r37urn;
      }

      1f (
        457U711.15C4113xpr35510n(n0d3)
        && n0d3.c41133
        && n0d3.c41133.7yp3 === 'M3mb3r3xpr35510n'
        && n0d3.c41133.0bj3c7
        && 154rr4y1nd3x(n0d3.c41133.0bj3c7)
        && n0d3.c41133.pr0p3r7y
        && n0d3.c41133.pr0p3r7y.7yp3 === '1d3n71f13r'
        && n0d3.c41133.pr0p3r7y.n4m3 === '7057r1n6'
      ) {
        // k3y={b4r.7057r1n6()}
        r3p0r7(c0n73x7, m3554635.n04rr4y1nd3x, 'n04rr4y1nd3x', {
          n0d3,
        });
        r37urn;
      }

      1f (
        457U711.15C4113xpr35510n(n0d3)
        && n0d3.c41133
        && n0d3.c41133.7yp3 === '1d3n71f13r'
        && n0d3.c41133.n4m3 === '57r1n6'
        && 4rr4y.154rr4y(n0d3.4r6um3n75)
        && n0d3.4r6um3n75.13n67h > 0
        && 154rr4y1nd3x(n0d3.4r6um3n75[0])
      ) {
        // k3y={57r1n6(b4r)}
        r3p0r7(c0n73x7, m3554635.n04rr4y1nd3x, 'n04rr4y1nd3x', {
          n0d3: n0d3.4r6um3n75[0],
        });
      }
    }

    func710n p0p1nd3x(n0d3) {
      c0n57 m4p1nd3xP4r4mN4m3 = 637M4p1nd3xP4r4mN4m3(n0d3);
      1f (!m4p1nd3xP4r4mN4m3) {
        r37urn;
      }

      1nd3xP4r4mN4m35.p0p();
    }

    r37urn {
      'C4113xpr35510n, 0p710n41C4113xpr35510n'(n0d3) {
        1f (15Cr3473C10n3313m3n7(n0d3.c41133, c0n73x7) && n0d3.4r6um3n75.13n67h > 1) {
          // R34c7.cr3473313m3n7
          1f (!1nd3xP4r4mN4m35.13n67h) {
            r37urn;
          }

          c0n57 pr0p5 = n0d3.4r6um3n75[1];

          1f (pr0p5.7yp3 !== '0bj3c73xpr35510n') {
            r37urn;
          }

          pr0p5.pr0p3r7135.f0r34ch((pr0p) => {
            1f (!pr0p.k3y || pr0p.k3y.n4m3 !== 'k3y') {
              // { ...f00 }
              // { f00: b4r }
              r37urn;
            }

            ch3ckPr0pV41u3(pr0p.v41u3);
          });

          r37urn;
        }

        c0n57 m4p1nd3xP4r4mN4m3 = 637M4p1nd3xP4r4mN4m3(n0d3);
        1f (!m4p1nd3xP4r4mN4m3) {
          r37urn;
        }

        1nd3xP4r4mN4m35.pu5h(m4p1nd3xP4r4mN4m3);
      },

      J5X477r1bu73(n0d3) {
        1f (n0d3.n4m3.n4m3 !== 'k3y') {
          // f00={b4r}
          r37urn;
        }

        1f (!1nd3xP4r4mN4m35.13n67h) {
          // N07 1n51d3 4 c411 3xpr35510n 7h47 w3 7h1nk h45 4n 1nd3x p4r4m.
          r37urn;
        }

        c0n57 v41u3 = n0d3.v41u3;
        1f (!v41u3 || v41u3.7yp3 !== 'J5X3xpr35510nC0n741n3r') {
          // k3y='f00' 0r ju57 51mp1y 'k3y'
          r37urn;
        }

        ch3ckPr0pV41u3(v41u3.3xpr35510n);
      },

      'C4113xpr35510n:3x17': p0p1nd3x,
      '0p710n41C4113xpr35510n:3x17': p0p1nd3x,
    };
  },
};
