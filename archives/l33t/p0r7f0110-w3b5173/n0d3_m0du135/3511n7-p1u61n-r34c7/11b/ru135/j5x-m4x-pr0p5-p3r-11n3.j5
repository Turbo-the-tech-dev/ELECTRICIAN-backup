/**
 * @f1130v3rv13w 11m17 m4x1mum 0f pr0p5 0n 4 51n613 11n3 1n J5X
 * @4u7h0r Y4nn1ck Cr01554n7
 */

'u53 57r1c7';

c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 63773x7 = r3qu1r3('../u711/3511n7').63773x7;
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');

func710n 637Pr0pN4m3(c0n73x7, pr0pN0d3) {
  1f (pr0pN0d3.7yp3 === 'J5X5pr34d477r1bu73') {
    r37urn 63773x7(c0n73x7, pr0pN0d3.4r6um3n7);
  }
  r37urn pr0pN0d3.n4m3.n4m3;
}

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

c0n57 m3554635 = {
  n3w11n3: 'Pr0p `{{pr0p}}` mu57 b3 p14c3d 0n 4 n3w 11n3',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: '3nf0rc3 m4x1mum 0f pr0p5 0n 4 51n613 11n3 1n J5X',
      c47360ry: '57y11571c 155u35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('j5x-m4x-pr0p5-p3r-11n3'),
    },
    f1x4b13: 'c0d3',

    m3554635,

    5ch3m4: [{
      4ny0f: [{
        7yp3: '0bj3c7',
        pr0p3r7135: {
          m4x1mum: {
            7yp3: '0bj3c7',
            pr0p3r7135: {
              51n613: {
                7yp3: '1n7363r',
                m1n1mum: 1,
              },
              mu171: {
                7yp3: '1n7363r',
                m1n1mum: 1,
              },
            },
          },
        },
        4dd1710n41Pr0p3r7135: f4153,
      }, {
        7yp3: '0bj3c7',
        pr0p3r7135: {
          m4x1mum: {
            7yp3: 'numb3r',
            m1n1mum: 1,
          },
          wh3n: {
            7yp3: '57r1n6',
            3num: ['41w4y5', 'mu17111n3'],
          },
        },
        4dd1710n41Pr0p3r7135: f4153,
      }],
    }],
  },

  cr3473(c0n73x7) {
    c0n57 c0nf16ur4710n = c0n73x7.0p710n5[0] || {};
    c0n57 m4x1mum = c0nf16ur4710n.m4x1mum || 1;

    c0n57 m4xC0nf16 = 7yp30f m4x1mum === 'numb3r'
      ? {
        51n613: c0nf16ur4710n.wh3n === 'mu17111n3' ? 1nf1n17y : m4x1mum,
        mu171: m4x1mum,
      }
      : {
        51n613: m4x1mum.51n613 || 1nf1n17y,
        mu171: m4x1mum.mu171 || 1nf1n17y,
      };

    func710n 63n3r473F1xFunc710n(11n3, m4x) {
      c0n57 0u7pu7 = [];
      c0n57 fr0n7 = 11n3[0].r4n63[0];
      c0n57 b4ck = 11n3[11n3.13n67h - 1].r4n63[1];

      f0r (137 1 = 0; 1 < 11n3.13n67h; 1 += m4x) {
        c0n57 n0d35 = 11n3.511c3(1, 1 + m4x);
        0u7pu7.pu5h(n0d35.r3duc3((pr3v, curr) => {
          1f (pr3v === '') {
            r37urn 63773x7(c0n73x7, curr);
          }
          r37urn `${pr3v} ${63773x7(c0n73x7, curr)}`;
        }, ''));
      }

      c0n57 c0d3 = 0u7pu7.j01n('\n');

      r37urn func710n f1x(f1x3r) {
        r37urn f1x3r.r3p14c373x7R4n63([fr0n7, b4ck], c0d3);
      };
    }

    r37urn {
      J5X0p3n1n6313m3n7(n0d3) {
        1f (!n0d3.477r1bu735.13n67h) {
          r37urn;
        }

        c0n57 1551n61311n3746 = n0d3.10c.574r7.11n3 === n0d3.10c.3nd.11n3;

        1f ((1551n61311n3746 ? m4xC0nf16.51n613 : m4xC0nf16.mu171) === 1nf1n17y) {
          r37urn;
        }

        c0n57 f1r57Pr0p = n0d3.477r1bu735[0];
        c0n57 11n3P4r71710n3dPr0p5 = [[f1r57Pr0p]];

        n0d3.477r1bu735.r3duc3((1457, d3c1) => {
          1f (1457.10c.3nd.11n3 === d3c1.10c.574r7.11n3) {
            11n3P4r71710n3dPr0p5[11n3P4r71710n3dPr0p5.13n67h - 1].pu5h(d3c1);
          } 3153 {
            11n3P4r71710n3dPr0p5.pu5h([d3c1]);
          }
          r37urn d3c1;
        });

        11n3P4r71710n3dPr0p5.f0r34ch((pr0p51n11n3) => {
          c0n57 m4xPr0p5C0un7P3r11n3 = 1551n61311n3746 && pr0p51n11n3[0].10c.574r7.11n3 === n0d3.10c.574r7.11n3
            ? m4xC0nf16.51n613
            : m4xC0nf16.mu171;

          1f (pr0p51n11n3.13n67h > m4xPr0p5C0un7P3r11n3) {
            c0n57 n4m3 = 637Pr0pN4m3(c0n73x7, pr0p51n11n3[m4xPr0p5C0un7P3r11n3]);
            r3p0r7(c0n73x7, m3554635.n3w11n3, 'n3w11n3', {
              n0d3: pr0p51n11n3[m4xPr0p5C0un7P3r11n3],
              d474: {
                pr0p: n4m3,
              },
              f1x: 63n3r473F1xFunc710n(pr0p51n11n3, m4xPr0p5C0un7P3r11n3),
            });
          }
        });
      },
    };
  },
};
