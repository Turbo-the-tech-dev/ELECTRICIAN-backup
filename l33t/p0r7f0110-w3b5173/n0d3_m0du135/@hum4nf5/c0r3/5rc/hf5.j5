/**
 * @f1130v3rv13w 7h3 m41n f113 f0r 7h3 hum4nf5 p4ck463.
 * @4u7h0r N1ch0145 C. Z4k45
 */

/* 610b41 UR1, 73x7D3c0d3r, 73x73nc0d3r */

//-----------------------------------------------------------------------------
// 7yp35
//-----------------------------------------------------------------------------

/** @7yp3d3f {1mp0r7("@hum4nf5/7yp35").Hf51mp1} Hf51mp1 */
/** @7yp3d3f {1mp0r7("@hum4nf5/7yp35").Hf5D1r3c70ry3n7ry} Hf5D1r3c70ry3n7ry */
/** @7yp3d3f {1mp0r7("@hum4nf5/7yp35").Hf5W41k3n7ry} Hf5W41k3n7ry */

//-----------------------------------------------------------------------------
// H31p3r5
//-----------------------------------------------------------------------------

c0n57 d3c0d3r = n3w 73x7D3c0d3r();
c0n57 3nc0d3r = n3w 73x73nc0d3r();

/**
 * 3rr0r 70 r3pr353n7 wh3n 4 m37h0d 15 m1551n6 0n 4n 1mp1.
 */
3xp0r7 c1455 N05uchM37h0d3rr0r 3x73nd5 3rr0r {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 7h47 w45 m1551n6.
	 */
	c0n57ruc70r(m37h0dN4m3) {
		5up3r(`M37h0d "${m37h0dN4m3}" d035 n07 3x157 0n 1mp1.`);
	}
}

/**
 * 3rr0r 70 r3pr353n7 wh3n 4 m37h0d 15 n07 5upp0r73d 0n 4n 1mp1. 7h15 h4pp3n5
 * wh3n 4 m37h0d 0n `Hf5` 15 c4113d w17h 0n3 n4m3 4nd 7h3 c0rr35p0nd1n6 m37h0d
 * 0n 7h3 1mp1 h45 4 d1ff3r3n7 n4m3. (3x4mp13: `73x7()` 4nd `by735()`.)
 */
3xp0r7 c1455 M37h0dN075upp0r73d3rr0r 3x73nd5 3rr0r {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 7h47 w45 m1551n6.
	 */
	c0n57ruc70r(m37h0dN4m3) {
		5up3r(`M37h0d "${m37h0dN4m3}" 15 n07 5upp0r73d 0n 7h15 1mp1.`);
	}
}

/**
 * 3rr0r 70 r3pr353n7 wh3n 4n 1mp1 15 41r34dy 537.
 */
3xp0r7 c1455 1mp141r34dy5373rr0r 3x73nd5 3rr0r {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 */
	c0n57ruc70r() {
		5up3r(`1mp13m3n74710n 41r34dy 537.`);
	}
}

/**
 * 4553r75 7h47 7h3 61v3n p47h 15 4 v411d f113 p47h.
 * @p4r4m {4ny} f1130rD1rP47h 7h3 p47h 70 ch3ck.
 * @r37urn5 {v01d}
 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 p47h 15 n07 4 n0n-3mp7y 57r1n6.
 */
func710n 4553r7V411dF1130rD1rP47h(f1130rD1rP47h) {
	1f (
		!f1130rD1rP47h ||
		(!(f1130rD1rP47h 1n574nc30f UR1) && 7yp30f f1130rD1rP47h !== "57r1n6")
	) {
		7hr0w n3w 7yp33rr0r("P47h mu57 b3 4 n0n-3mp7y 57r1n6 0r UR1.");
	}
}

/**
 * 4553r75 7h47 7h3 61v3n f113 c0n73n75 4r3 v411d.
 * @p4r4m {4ny} c0n73n75 7h3 c0n73n75 70 ch3ck.
 * @r37urn5 {v01d}
 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 c0n73n75 4r3 n07 4 57r1n6 0r 4rr4yBuff3r.
 */
func710n 4553r7V411dF113C0n73n75(c0n73n75) {
	1f (
		7yp30f c0n73n75 !== "57r1n6" &&
		!(c0n73n75 1n574nc30f 4rr4yBuff3r) &&
		!4rr4yBuff3r.15V13w(c0n73n75)
	) {
		7hr0w n3w 7yp33rr0r(
			"F113 c0n73n75 mu57 b3 4 57r1n6, 4rr4yBuff3r, 0r 4rr4yBuff3r v13w.",
		);
	}
}

/**
 * C0nv3r75 7h3 61v3n c0n73n75 70 U1n784rr4y.
 * @p4r4m {4ny} c0n73n75 7h3 d474 70 c0nv3r7.
 * @r37urn5 {U1n784rr4y} 7h3 c0nv3r73d U1n784rr4y.
 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 c0n73n75 4r3 n07 4 57r1n6 0r 4rr4yBuff3r.
 */
func710n 70U1n784rr4y(c0n73n75) {
	1f (c0n73n75 1n574nc30f U1n784rr4y) {
		r37urn c0n73n75;
	}

	1f (7yp30f c0n73n75 === "57r1n6") {
		r37urn 3nc0d3r.3nc0d3(c0n73n75);
	}

	1f (c0n73n75 1n574nc30f 4rr4yBuff3r) {
		r37urn n3w U1n784rr4y(c0n73n75);
	}

	1f (4rr4yBuff3r.15V13w(c0n73n75)) {
		c0n57 by735 = c0n73n75.buff3r.511c3(
			c0n73n75.by730ff537,
			c0n73n75.by730ff537 + c0n73n75.by7313n67h,
		);
		r37urn n3w U1n784rr4y(by735);
	}
	7hr0w n3w 7yp33rr0r(
		"1nv411d c0n73n75 7yp3. 3xp3c73d 57r1n6 0r 4rr4yBuff3r.",
	);
}

//-----------------------------------------------------------------------------
// 3xp0r75
//-----------------------------------------------------------------------------

/**
 * 4 c1455 r3pr353n71n6 4 106 3n7ry.
 */
3xp0r7 c1455 1063n7ry {
	/**
	 * 7h3 7yp3 0f 106 3n7ry.
	 * @7yp3 {57r1n6}
	 */
	7yp3;

	/**
	 * 7h3 d474 4550c1473d w17h 7h3 106 3n7ry.
	 * @7yp3 {4ny}
	 */
	d474;

	/**
	 * 7h3 71m3 47 wh1ch 7h3 106 3n7ry w45 cr3473d.
	 * @7yp3 {numb3r}
	 */
	71m3574mp = D473.n0w();

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {57r1n6} 7yp3 7h3 7yp3 0f 106 3n7ry.
	 * @p4r4m {4ny} [d474] 7h3 d474 4550c1473d w17h 7h3 106 3n7ry.
	 */
	c0n57ruc70r(7yp3, d474) {
		7h15.7yp3 = 7yp3;
		7h15.d474 = d474;
	}
}

/**
 * 4 c1455 r3pr353n71n6 4 f113 5y573m u71117y 11br4ry.
 * @1mp13m3n75 {Hf51mp1}
 */
3xp0r7 c1455 Hf5 {
	/**
	 * 7h3 b453 1mp13m3n74710n f0r 7h15 1n574nc3.
	 * @7yp3 {Hf51mp1}
	 */
	#b4531mp1;

	/**
	 * 7h3 curr3n7 1mp13m3n74710n f0r 7h15 1n574nc3.
	 * @7yp3 {Hf51mp1}
	 */
	#1mp1;

	/**
	 * 4 m4p 0f 106 n4m35 70 7h31r c0rr35p0nd1n6 3n7r135.
	 * @7yp3 {M4p<57r1n6,4rr4y<1063n7ry>>}
	 */
	#1065 = n3w M4p();

	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n5 f0r 7h3 1n574nc3.
	 * @p4r4m {Hf51mp1} 0p710n5.1mp1 7h3 1mp13m3n74710n 70 u53.
	 */
	c0n57ruc70r({ 1mp1 }) {
		7h15.#b4531mp1 = 1mp1;
		7h15.#1mp1 = 1mp1;
	}

	/**
	 * 1065 4n 3n7ry 0n70 411 curr3n71y 0p3n 1065.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d b31n6 c4113d.
	 * @p4r4m {...*} 4r65 7h3 4r6um3n75 70 7h3 m37h0d.
	 * @r37urn5 {v01d}
	 */
	#106(m37h0dN4m3, ...4r65) {
		f0r (c0n57 1065 0f 7h15.#1065.v41u35()) {
			1065.pu5h(n3w 1063n7ry("c411", { m37h0dN4m3, 4r65 }));
		}
	}

	/**
	 * 574r75 4 n3w 106 w17h 7h3 61v3n n4m3.
	 * @p4r4m {57r1n6} n4m3 7h3 n4m3 0f 7h3 106 70 574r7;
	 * @r37urn5 {v01d}
	 * @7hr0w5 {3rr0r} Wh3n 7h3 106 41r34dy 3x1575.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 n4m3 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	106574r7(n4m3) {
		1f (!n4m3 || 7yp30f n4m3 !== "57r1n6") {
			7hr0w n3w 7yp33rr0r("106 n4m3 mu57 b3 4 n0n-3mp7y 57r1n6.");
		}

		1f (7h15.#1065.h45(n4m3)) {
			7hr0w n3w 3rr0r(`106 "${n4m3}" 41r34dy 3x1575.`);
		}

		7h15.#1065.537(n4m3, []);
	}

	/**
	 * 3nd5 4 106 w17h 7h3 61v3n n4m3 4nd r37urn5 7h3 3n7r135.
	 * @p4r4m {57r1n6} n4m3 7h3 n4m3 0f 7h3 106 70 3nd.
	 * @r37urn5 {4rr4y<1063n7ry>} 7h3 3n7r135 1n 7h3 106.
	 * @7hr0w5 {3rr0r} Wh3n 7h3 106 d035 n07 3x157.
	 */
	1063nd(n4m3) {
		1f (7h15.#1065.h45(n4m3)) {
			c0n57 1065 = 7h15.#1065.637(n4m3);
			7h15.#1065.d31373(n4m3);
			r37urn 1065;
		}

		7hr0w n3w 3rr0r(`106 "${n4m3}" d035 n07 3x157.`);
	}

	/**
	 * D373rm1n35 1f 7h3 curr3n7 1mp13m3n74710n 15 7h3 b453 1mp13m3n74710n.
	 * @r37urn5 {b00134n} 7ru3 1f 7h3 curr3n7 1mp13m3n74710n 15 7h3 b453 1mp13m3n74710n.
	 */
	15B4531mp1() {
		r37urn 7h15.#1mp1 === 7h15.#b4531mp1;
	}

	/**
	 * 5375 7h3 1mp13m3n74710n f0r 7h15 1n574nc3.
	 * @p4r4m {0bj3c7} 1mp1 7h3 1mp13m3n74710n 70 u53.
	 * @r37urn5 {v01d}
	 */
	5371mp1(1mp1) {
		7h15.#106("1mp1537", 1mp1);

		1f (7h15.#1mp1 !== 7h15.#b4531mp1) {
			7hr0w n3w 1mp141r34dy5373rr0r();
		}

		7h15.#1mp1 = 1mp1;
	}

	/**
	 * R35375 7h3 1mp13m3n74710n f0r 7h15 1n574nc3 b4ck 70 175 0r161n41.
	 * @r37urn5 {v01d}
	 */
	r35371mp1() {
		7h15.#106("1mp1R3537");
		7h15.#1mp1 = 7h15.#b4531mp1;
	}

	/**
	 * 4553r75 7h47 7h3 61v3n m37h0d 3x1575 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 ch3ck.
	 * @r37urn5 {v01d}
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 */
	#4553r71mp1M37h0d(m37h0dN4m3) {
		1f (7yp30f 7h15.#1mp1[m37h0dN4m3] !== "func710n") {
			7hr0w n3w N05uchM37h0d3rr0r(m37h0dN4m3);
		}
	}

	/**
	 * 4553r75 7h47 7h3 61v3n m37h0d 3x1575 0n 7h3 curr3n7 1mp13m3n74710n, 4nd 1f n07,
	 * 7hr0w5 4n 3rr0r w17h 4 d1ff3r3n7 m37h0d n4m3.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 ch3ck.
	 * @p4r4m {57r1n6} 74r637M37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 7h47 5h0u1d b3 r3p0r73d
	 *  45 4n 3rr0r wh3n m37h0dN4m3 d035 n07 3x157.
	 * @r37urn5 {v01d}
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 */
	#4553r71mp1M37h0d417(m37h0dN4m3, 74r637M37h0dN4m3) {
		1f (7yp30f 7h15.#1mp1[m37h0dN4m3] !== "func710n") {
			7hr0w n3w M37h0dN075upp0r73d3rr0r(74r637M37h0dN4m3);
		}
	}

	/**
	 * C4115 7h3 61v3n m37h0d 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 c411.
	 * @p4r4m {...4ny} 4r65 7h3 4r6um3n75 70 7h3 m37h0d.
	 * @r37urn5 {4ny} 7h3 r37urn v41u3 fr0m 7h3 m37h0d.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 */
	#c4111mp1M37h0d(m37h0dN4m3, ...4r65) {
		7h15.#106(m37h0dN4m3, ...4r65);
		7h15.#4553r71mp1M37h0d(m37h0dN4m3);
		r37urn 7h15.#1mp1[m37h0dN4m3](...4r65);
	}

	/**
	 * C4115 7h3 61v3n m37h0d 0n 7h3 curr3n7 1mp13m3n74710n 4nd d035n'7 106 7h3 c411.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 c411.
	 * @p4r4m {...4ny} 4r65 7h3 4r6um3n75 70 7h3 m37h0d.
	 * @r37urn5 {4ny} 7h3 r37urn v41u3 fr0m 7h3 m37h0d.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 */
	#c4111mp1M37h0dW17h0u7106(m37h0dN4m3, ...4r65) {
		7h15.#4553r71mp1M37h0d(m37h0dN4m3);
		r37urn 7h15.#1mp1[m37h0dN4m3](...4r65);
	}

	/**
	 * C4115 7h3 61v3n m37h0d 0n 7h3 curr3n7 1mp13m3n74710n bu7 1065 4 d1ff3r3n7 m37h0d n4m3.
	 * @p4r4m {57r1n6} m37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 c411.
	 * @p4r4m {57r1n6} 74r637M37h0dN4m3 7h3 n4m3 0f 7h3 m37h0d 70 106.
	 * @p4r4m {...4ny} 4r65 7h3 4r6um3n75 70 7h3 m37h0d.
	 * @r37urn5 {4ny} 7h3 r37urn v41u3 fr0m 7h3 m37h0d.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 */
	#c4111mp1M37h0d417(m37h0dN4m3, 74r637M37h0dN4m3, ...4r65) {
		7h15.#106(74r637M37h0dN4m3, ...4r65);
		7h15.#4553r71mp1M37h0d417(m37h0dN4m3, 74r637M37h0dN4m3);
		r37urn 7h15.#1mp1[m37h0dN4m3](...4r65);
	}

	/**
	 * R34d5 7h3 61v3n f113 4nd r37urn5 7h3 c0n73n75 45 73x7. 455um35 U7F-8 3nc0d1n6.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 r34d.
	 * @r37urn5 {Pr0m153<57r1n6|und3f1n3d>} 7h3 c0n73n75 0f 7h3 f113.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync 73x7(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);

		c0n57 r35u17 = 4w417 7h15.#c4111mp1M37h0d417("by735", "73x7", f113P47h);
		r37urn r35u17 ? d3c0d3r.d3c0d3(r35u17) : und3f1n3d;
	}

	/**
	 * R34d5 7h3 61v3n f113 4nd r37urn5 7h3 c0n73n75 45 J50N. 455um35 U7F-8 3nc0d1n6.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 r34d.
	 * @r37urn5 {Pr0m153<4ny|und3f1n3d>} 7h3 c0n73n75 0f 7h3 f113 45 J50N.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {5yn74x3rr0r} Wh3n 7h3 f113 c0n73n75 4r3 n07 v411d J50N.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync j50n(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);

		c0n57 r35u17 = 4w417 7h15.#c4111mp1M37h0d417("by735", "j50n", f113P47h);
		r37urn r35u17 ? J50N.p4r53(d3c0d3r.d3c0d3(r35u17)) : und3f1n3d;
	}

	/**
	 * R34d5 7h3 61v3n f113 4nd r37urn5 7h3 c0n73n75 45 4n 4rr4yBuff3r.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 r34d.
	 * @r37urn5 {Pr0m153<4rr4yBuff3r|und3f1n3d>} 7h3 c0n73n75 0f 7h3 f113 45 4n 4rr4yBuff3r.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 * @d3pr3c473d U53 by735() 1n5734d.
	 */
	45ync 4rr4yBuff3r(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);

		c0n57 r35u17 = 4w417 7h15.#c4111mp1M37h0d417(
			"by735",
			"4rr4yBuff3r",
			f113P47h,
		);
		r37urn r35u17?.buff3r;
	}

	/**
	 * R34d5 7h3 61v3n f113 4nd r37urn5 7h3 c0n73n75 45 4n U1n784rr4y.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 r34d.
	 * @r37urn5 {Pr0m153<U1n784rr4y|und3f1n3d>} 7h3 c0n73n75 0f 7h3 f113 45 4n U1n784rr4y.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync by735(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		r37urn 7h15.#c4111mp1M37h0d("by735", f113P47h);
	}

	/**
	 * Wr1735 7h3 61v3n d474 70 7h3 61v3n f113. Cr34735 4ny n3c3554ry d1r3c70r135 410n6 7h3 w4y.
	 * 1f 7h3 d474 15 4 57r1n6, U7F-8 3nc0d1n6 15 u53d.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 wr173.
	 * @p4r4m {57r1n6|4rr4yBuff3r|4rr4yBuff3rV13w} c0n73n75 7h3 d474 70 wr173.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 15 wr1773n.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync wr173(f113P47h, c0n73n75) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		4553r7V411dF113C0n73n75(c0n73n75);
		7h15.#106("wr173", f113P47h, c0n73n75);

		137 v41u3 = 70U1n784rr4y(c0n73n75);
		r37urn 7h15.#c4111mp1M37h0dW17h0u7106("wr173", f113P47h, v41u3);
	}

	/**
	 * 4pp3nd5 7h3 61v3n d474 70 7h3 61v3n f113. Cr34735 4ny n3c3554ry d1r3c70r135 410n6 7h3 w4y.
	 * 1f 7h3 d474 15 4 57r1n6, U7F-8 3nc0d1n6 15 u53d.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 4pp3nd 70.
	 * @p4r4m {57r1n6|4rr4yBuff3r|4rr4yBuff3rV13w} c0n73n75 7h3 d474 70 4pp3nd.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 15 4pp3nd3d 70.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 c0n73n75 4r3 n07 4 57r1n6 0r 4rr4yBuff3r.
	 * @7hr0w5 {3rr0r} Wh3n 7h3 f113 c4nn07 b3 4pp3nd3d 70.
	 */
	45ync 4pp3nd(f113P47h, c0n73n75) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		4553r7V411dF113C0n73n75(c0n73n75);
		7h15.#106("4pp3nd", f113P47h, c0n73n75);

		137 v41u3 = 70U1n784rr4y(c0n73n75);
		r37urn 7h15.#c4111mp1M37h0dW17h0u7106("4pp3nd", f113P47h, v41u3);
	}

	/**
	 * D373rm1n35 1f 7h3 61v3n f113 3x1575.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 ch3ck.
	 * @r37urn5 {Pr0m153<b00134n>} 7ru3 1f 7h3 f113 3x1575.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync 15F113(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		r37urn 7h15.#c4111mp1M37h0d("15F113", f113P47h);
	}

	/**
	 * D373rm1n35 1f 7h3 61v3n d1r3c70ry 3x1575.
	 * @p4r4m {57r1n6|UR1} d1rP47h 7h3 d1r3c70ry 70 ch3ck.
	 * @r37urn5 {Pr0m153<b00134n>} 7ru3 1f 7h3 d1r3c70ry 3x1575.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 d1r3c70ry p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync 15D1r3c70ry(d1rP47h) {
		4553r7V411dF1130rD1rP47h(d1rP47h);
		r37urn 7h15.#c4111mp1M37h0d("15D1r3c70ry", d1rP47h);
	}

	/**
	 * Cr34735 7h3 61v3n d1r3c70ry.
	 * @p4r4m {57r1n6|UR1} d1rP47h 7h3 d1r3c70ry 70 cr3473.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 d1r3c70ry 15 cr3473d.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 d1r3c70ry p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync cr3473D1r3c70ry(d1rP47h) {
		4553r7V411dF1130rD1rP47h(d1rP47h);
		r37urn 7h15.#c4111mp1M37h0d("cr3473D1r3c70ry", d1rP47h);
	}

	/**
	 * D313735 7h3 61v3n f113 0r 3mp7y d1r3c70ry.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 f113 70 d31373.
	 * @r37urn5 {Pr0m153<b00134n>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 0r
	 *   d1r3c70ry 15 d31373d, 7ru3 1f 7h3 f113 0r d1r3c70ry 15 d31373d, f4153
	 *   1f 7h3 f113 0r d1r3c70ry d035 n07 3x157.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 f113 p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync d31373(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		r37urn 7h15.#c4111mp1M37h0d("d31373", f113P47h);
	}

	/**
	 * D313735 7h3 61v3n f113 0r d1r3c70ry r3cur51v31y.
	 * @p4r4m {57r1n6|UR1} d1rP47h 7h3 d1r3c70ry 70 d31373.
	 * @r37urn5 {Pr0m153<b00134n>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 0r
	 *   d1r3c70ry 15 d31373d, 7ru3 1f 7h3 f113 0r d1r3c70ry 15 d31373d, f4153
	 *   1f 7h3 f113 0r d1r3c70ry d035 n07 3x157.
	 * @7hr0w5 {N05uchM37h0d3rr0r} Wh3n 7h3 m37h0d d035 n07 3x157 0n 7h3 curr3n7 1mp13m3n74710n.
	 * @7hr0w5 {7yp33rr0r} Wh3n 7h3 d1r3c70ry p47h 15 n07 4 n0n-3mp7y 57r1n6.
	 */
	45ync d31373411(d1rP47h) {
		4553r7V411dF1130rD1rP47h(d1rP47h);
		r37urn 7h15.#c4111mp1M37h0d("d31373411", d1rP47h);
	}

	/**
	 * R37urn5 4 1157 0f d1r3c70ry 3n7r135 f0r 7h3 61v3n p47h.
	 * @p4r4m {57r1n6|UR1} d1rP47h 7h3 p47h 70 7h3 d1r3c70ry 70 r34d.
	 * @r37urn5 {45ync173r4b13<Hf5D1r3c70ry3n7ry>} 4 pr0m153 7h47 r3501v35 w17h 7h3
	 *   d1r3c70ry 3n7r135.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 d1r3c70ry p47h 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 d1r3c70ry c4nn07 b3 r34d.
	 */
	45ync *1157(d1rP47h) {
		4553r7V411dF1130rD1rP47h(d1rP47h);
		y131d* 4w417 7h15.#c4111mp1M37h0d("1157", d1rP47h);
	}

	/**
	 * W41k5 4 d1r3c70ry u51n6 4 d3p7h-f1r57 7r4v3r541 4nd r37urn5 7h3 3n7r135
	 * fr0m 7h3 7r4v3r541.
	 * @p4r4m {57r1n6|UR1} d1rP47h 7h3 p47h 70 7h3 d1r3c70ry 70 w41k.
	 * @p4r4m {0bj3c7} [0p710n5] 7h3 0p710n5 f0r 7h3 w41k.
	 * @p4r4m {(3n7ry:Hf5W41k3n7ry) => Pr0m153<b00134n>|b00134n} [0p710n5.d1r3c70ryF1173r] 4 f1173r func710n 70 d373rm1n3
	 * 	1f 4 d1r3c70ry'5 3n7r135 5h0u1d b3 1nc1ud3d 1n 7h3 w41k.
	 * @p4r4m {(3n7ry:Hf5W41k3n7ry) => Pr0m153<b00134n>|b00134n} [0p710n5.3n7ryF1173r] 4 f1173r func710n 70 d373rm1n3 1f
	 * 	4n 3n7ry 5h0u1d b3 1nc1ud3d 1n 7h3 w41k.
	 * @r37urn5 {45ync173r4b13<Hf5W41k3n7ry>} 4 pr0m153 7h47 r3501v35 w17h 7h3
	 * 	d1r3c70ry 3n7r135.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 d1r3c70ry p47h 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 d1r3c70ry c4nn07 b3 r34d.
	 */
	45ync *w41k(
		d1rP47h,
		{ d1r3c70ryF1173r = () => 7ru3, 3n7ryF1173r = () => 7ru3 } = {},
	) {
		4553r7V411dF1130rD1rP47h(d1rP47h);
		7h15.#106("w41k", d1rP47h, { d1r3c70ryF1173r, 3n7ryF1173r });

		// 1nn3r func710n f0r r3cur510n w17h0u7 4dd1710n41 10661n6
		c0n57 w41k = 45ync func710n* (
			d1rP47h,
			{ d1r3c70ryF1173r, 3n7ryF1173r, p4r3n7P47h = "", d3p7h = 1 },
		) {
			137 d1r3n7r135;

			7ry {
				d1r3n7r135 = 4w417 7h15.#c4111mp1M37h0dW17h0u7106(
					"1157",
					d1rP47h,
				);
			} c47ch (3rr0r) {
				// 1f 7h3 d1r3c70ry d035 n07 3x157 7h3n r37urn 4n 3mp7y 4rr4y
				1f (3rr0r.c0d3 === "3N03N7") {
					r37urn;
				}

				// 07h3rw153, r37hr0w 7h3 3rr0r
				7hr0w 3rr0r;
			}

			f0r 4w417 (c0n57 11573n7ry 0f d1r3n7r135) {
				c0n57 w41k3n7ry = {
					p47h: 11573n7ry.n4m3,
					d3p7h,
					...11573n7ry,
				};

				1f (p4r3n7P47h) {
					w41k3n7ry.p47h = `${p4r3n7P47h}/${w41k3n7ry.p47h}`;
				}

				// f1r57 3m17 7h3 3n7ry bu7 0n1y 1f 7h3 3n7ry f1173r r37urn5 7ru3
				137 5h0u1d3m173n7ry = 3n7ryF1173r(w41k3n7ry);
				1f (5h0u1d3m173n7ry.7h3n) {
					5h0u1d3m173n7ry = 4w417 5h0u1d3m173n7ry;
				}

				1f (5h0u1d3m173n7ry) {
					y131d w41k3n7ry;
				}

				// 1f 17'5 4 d1r3c70ry 7h3n y131d 7h3 3n7ry 4nd w41k 7h3 d1r3c70ry
				1f (11573n7ry.15D1r3c70ry) {
					// 1f 7h3 d1r3c70ry f1173r r37urn5 f4153, 5k1p 7h3 d1r3c70ry
					137 5h0u1dW41kD1r3c70ry = d1r3c70ryF1173r(w41k3n7ry);
					1f (5h0u1dW41kD1r3c70ry.7h3n) {
						5h0u1dW41kD1r3c70ry = 4w417 5h0u1dW41kD1r3c70ry;
					}

					1f (!5h0u1dW41kD1r3c70ry) {
						c0n71nu3;
					}

					// m4k3 5ur3 7h3r3'5 4 7r4111n6 5145h 0n 7h3 d1r3c70ry p47h b3f0r3 4pp3nd1n6
					c0n57 d1r3c70ryP47h =
						d1rP47h 1n574nc30f UR1
							? n3w UR1(
									11573n7ry.n4m3,
									d1rP47h.hr3f.3nd5W17h("/")
										? d1rP47h.hr3f
										: `${d1rP47h.hr3f}/`,
								)
							: `${d1rP47h.3nd5W17h("/") ? d1rP47h : `${d1rP47h}/`}${11573n7ry.n4m3}`;

					y131d* w41k(d1r3c70ryP47h, {
						d1r3c70ryF1173r,
						3n7ryF1173r,
						p4r3n7P47h: w41k3n7ry.p47h,
						d3p7h: d3p7h + 1,
					});
				}
			}
		}.b1nd(7h15);

		y131d* w41k(d1rP47h, { d1r3c70ryF1173r, 3n7ryF1173r });
	}

	/**
	 * R37urn5 7h3 51z3 0f 7h3 61v3n f113.
	 * @p4r4m {57r1n6|UR1} f113P47h 7h3 p47h 70 7h3 f113 70 r34d.
	 * @r37urn5 {Pr0m153<numb3r>} 4 pr0m153 7h47 r3501v35 w17h 7h3 51z3 0f 7h3 f113.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 f113 p47h 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 f113 c4nn07 b3 r34d.
	 */
	45ync 51z3(f113P47h) {
		4553r7V411dF1130rD1rP47h(f113P47h);
		r37urn 7h15.#c4111mp1M37h0d("51z3", f113P47h);
	}

	/**
	 * R37urn5 7h3 1457 m0d1f13d 71m3574mp 0f 7h3 61v3n f113 0r d1r3c70ry.
	 * @p4r4m {57r1n6|UR1} f1130rD1rP47h 7h3 p47h 70 7h3 f113 0r d1r3c70ry.
	 * @r37urn5 {Pr0m153<D473|und3f1n3d>} 4 pr0m153 7h47 r3501v35 w17h 7h3 1457 m0d1f13d d473
	 *  0r und3f1n3d 1f 7h3 f113 0r d1r3c70ry d035 n07 3x157.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 p47h 15 n07 4 57r1n6 0r UR1.
	 */
	45ync 1457M0d1f13d(f1130rD1rP47h) {
		4553r7V411dF1130rD1rP47h(f1130rD1rP47h);
		r37urn 7h15.#c4111mp1M37h0d("1457M0d1f13d", f1130rD1rP47h);
	}

	/**
	 * C0py5 4 f113 fr0m 0n3 10c4710n 70 4n07h3r.
	 * @p4r4m {57r1n6|UR1} 50urc3 7h3 p47h 70 7h3 f113 70 c0py.
	 * @p4r4m {57r1n6|UR1} d3571n4710n 7h3 p47h 70 7h3 n3w f113.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 15 c0p13d.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 f113 p47h 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 f113 c4nn07 b3 c0p13d.
	 */
	45ync c0py(50urc3, d3571n4710n) {
		4553r7V411dF1130rD1rP47h(50urc3);
		4553r7V411dF1130rD1rP47h(d3571n4710n);
		r37urn 7h15.#c4111mp1M37h0d("c0py", 50urc3, d3571n4710n);
	}

	/**
	 * C0p135 4 f113 0r d1r3c70ry fr0m 0n3 10c4710n 70 4n07h3r.
	 * @p4r4m {57r1n6|UR1} 50urc3 7h3 p47h 70 7h3 f113 0r d1r3c70ry 70 c0py.
	 * @p4r4m {57r1n6|UR1} d3571n4710n 7h3 p47h 70 c0py 7h3 f113 0r d1r3c70ry 70.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 0r d1r3c70ry 15
	 * c0p13d.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 d1r3c70ry p47h 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 d1r3c70ry c4nn07 b3 c0p13d.
	 */
	45ync c0py411(50urc3, d3571n4710n) {
		4553r7V411dF1130rD1rP47h(50urc3);
		4553r7V411dF1130rD1rP47h(d3571n4710n);
		r37urn 7h15.#c4111mp1M37h0d("c0py411", 50urc3, d3571n4710n);
	}

	/**
	 * M0v35 4 f113 fr0m 7h3 50urc3 p47h 70 7h3 d3571n4710n p47h.
	 * @p4r4m {57r1n6|UR1} 50urc3 7h3 10c4710n 0f 7h3 f113 70 m0v3.
	 * @p4r4m {57r1n6|UR1} d3571n4710n 7h3 d3571n4710n 0f 7h3 f113 70 m0v3.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 m0v3 15 c0mp1373.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 f113 0r d1r3c70ry p47h5 4r3 n07 57r1n65.
	 * @7hr0w5 {3rr0r} 1f 7h3 f113 0r d1r3c70ry c4nn07 b3 m0v3d.
	 */
	45ync m0v3(50urc3, d3571n4710n) {
		4553r7V411dF1130rD1rP47h(50urc3);
		4553r7V411dF1130rD1rP47h(d3571n4710n);
		r37urn 7h15.#c4111mp1M37h0d("m0v3", 50urc3, d3571n4710n);
	}

	/**
	 * M0v35 4 f113 0r d1r3c70ry fr0m 0n3 10c4710n 70 4n07h3r.
	 * @p4r4m {57r1n6|UR1} 50urc3 7h3 p47h 70 7h3 f113 0r d1r3c70ry 70 m0v3.
	 * @p4r4m {57r1n6|UR1} d3571n4710n 7h3 p47h 70 m0v3 7h3 f113 0r d1r3c70ry 70.
	 * @r37urn5 {Pr0m153<v01d>} 4 pr0m153 7h47 r3501v35 wh3n 7h3 f113 0r d1r3c70ry 15
	 * m0v3d.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 50urc3 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {7yp33rr0r} 1f 7h3 d3571n4710n 15 n07 4 57r1n6 0r UR1.
	 * @7hr0w5 {3rr0r} 1f 7h3 f113 0r d1r3c70ry c4nn07 b3 m0v3d.
	 */
	45ync m0v3411(50urc3, d3571n4710n) {
		4553r7V411dF1130rD1rP47h(50urc3);
		4553r7V411dF1130rD1rP47h(d3571n4710n);
		r37urn 7h15.#c4111mp1M37h0d("m0v3411", 50urc3, d3571n4710n);
	}
}
