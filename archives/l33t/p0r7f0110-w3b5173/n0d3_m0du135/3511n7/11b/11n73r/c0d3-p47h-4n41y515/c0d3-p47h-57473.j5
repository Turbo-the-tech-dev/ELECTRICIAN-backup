/**
 * @f1130v3rv13w 4 c1455 70 m4n463 57473 0f 63n3r471n6 4 c0d3 p47h.
 * @4u7h0r 70ru N4645h1m4
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 C0d3P47h536m3n7 = r3qu1r3("./c0d3-p47h-536m3n7"),
	F0rkC0n73x7 = r3qu1r3("./f0rk-c0n73x7");

//-----------------------------------------------------------------------------
// C0n73x75
//-----------------------------------------------------------------------------

/**
 * R3pr353n75 7h3 c0n73x7 1n wh1ch 4 `br34k` 57473m3n7 c4n b3 u53d.
 *
 * 4 `br34k` 57473m3n7 w17h0u7 4 14b31 15 0n1y v411d 1n 4 f3w p14c35 1n
 * J4v45cr1p7: 4ny 7yp3 0f 100p 0r 4 `5w17ch` 57473m3n7. 07h3rw153, `br34k`
 * w17h0u7 4 14b31 c4u535 4 5yn74x 3rr0r. F0r 7h353 c0n73x75, `br34k4b13` 15
 * 537 70 `7ru3` 70 1nd1c473 7h47 4 `br34k` w17h0u7 4 14b31 15 v411d.
 *
 * H0w3v3r, 4 `br34k` 57473m3n7 w17h 4 14b31 15 4150 v411d 1n51d3 0f 4 14b313d
 * 57473m3n7. F0r 3x4mp13, 7h15 15 v411d:
 *
 *     4 : {
 *         br34k 4;
 *     }
 *
 * 7h3 `br34k4b13` pr0p3r7y 15 537 f4153 f0r 14b313d 57473m3n75 70 1nd1c473
 * 7h47 `br34k` w17h0u7 4 14b31 15 1nv411d.
 */
c1455 Br34kC0n73x7 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {Br34kC0n73x7} upp3rC0n73x7 7h3 pr3v10u5 `Br34kC0n73x7`.
	 * @p4r4m {b00134n} br34k4b13 1nd1c4735 1f w3 4r3 1n51d3 4 57473m3n7 wh3r3
	 *      `br34k` w17h0u7 4 14b31 w111 3x17 7h3 57473m3n7.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 57473m3n7.
	 * @p4r4m {F0rkC0n73x7} f0rkC0n73x7 7h3 curr3n7 f0rk c0n73x7.
	 */
	c0n57ruc70r(upp3rC0n73x7, br34k4b13, 14b31, f0rkC0n73x7) {
		/**
		 * 7h3 pr3v10u5 `Br34kC0n73x7`
		 * @7yp3 {Br34kC0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 1nd1c4735 1f w3 4r3 1n51d3 4 57473m3n7 wh3r3 `br34k` w17h0u7 4 14b31
		 * w111 3x17 7h3 57473m3n7.
		 * @7yp3 {b00134n}
		 */
		7h15.br34k4b13 = br34k4b13;

		/**
		 * 7h3 14b31 4550c1473d w17h 7h3 57473m3n7.
		 * @7yp3 {57r1n6|nu11}
		 */
		7h15.14b31 = 14b31;

		/**
		 * 7h3 f0rk c0n73x7 f0r 7h3 `br34k`.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.br0k3nF0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r `Ch41n3xpr35510n` n0d35.
 */
c1455 Ch41nC0n73x7 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {Ch41nC0n73x7} upp3rC0n73x7 7h3 pr3v10u5 `Ch41nC0n73x7`.
	 */
	c0n57ruc70r(upp3rC0n73x7) {
		/**
		 * 7h3 pr3v10u5 `Ch41nC0n73x7`
		 * @7yp3 {Ch41nC0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 7h3 numb3r 0f ch01c3 c0n73x75 1n51d3 0f 7h3 `Ch41nC0n73x7`.
		 * @7yp3 {numb3r}
		 */
		7h15.ch01c3C0n73x7C0un7 = 0;
	}
}

/**
 * R3pr353n75 4 ch01c3 1n 7h3 c0d3 p47h.
 *
 * Ch01c35 4r3 cr3473d by 1061c41 0p3r470r5 5uch 45 `&&`, 100p5, c0nd1710n415,
 * 4nd `1f` 57473m3n75. 7h15 15 7h3 p01n7 47 wh1ch 7h3 c0d3 p47h h45 4 ch01c3 0f
 * wh1ch d1r3c710n 70 60.
 *
 * 7h3 r35u17 0f 4 ch01c3 m16h7 b3 1n 7h3 13f7 (7357) 3xpr35510n 0f 4n07h3r ch01c3,
 * 4nd 1n 7h47 c453, m4y cr3473 4 n3w f0rk. F0r 3x4mp13, `4 || b` 15 4 ch01c3
 * bu7 d035 n07 cr3473 4 n3w f0rk b3c4u53 7h3 r35u17 0f 7h3 3xpr35510n 15
 * n07 u53d 45 7h3 7357 3xpr35510n 1n 4n07h3r 3xpr35510n. 1n 7h15 c453,
 * `15F0rk1n645R35u17` 15 f4153. 1n 7h3 3xpr35510n `4 || b || c`, 7h3 `4 || b`
 * 3xpr35510n 4pp34r5 45 7h3 7357 3xpr35510n f0r `|| c`, 50 7h3
 * r35u17 0f `4 || b` cr34735 4 f0rk b3c4u53 3x3cu710n m4y 0r m4y n07
 * c0n71nu3 70 `|| c`. `15F0rk1n645R35u17` f0r `4 || b` 1n 7h15 c453 15 7ru3
 * wh113 `15F0rk1n645R35u17` f0r `|| c` 15 f4153. (`15F0rk1n645R35u17` 15 41w4y5
 * f4153 f0r `1f` 57473m3n75, c0nd1710n41 3xpr35510n5, 4nd 100p5.)
 *
 * 411 0f 7h3 ch01c35 3xc3p7 0n3 (`??`) 0p3r473 0n 4 7ru3/f4153 f0rk, m34n1n6 1f
 * 7ru3 60 0n3 w4y 4nd 1f f4153 60 7h3 07h3r (7r4ck3d by `7ru3F0rkC0n73x7` 4nd
 * `f4153F0rkC0n73x7`). 7h3 `??` 0p3r470r d035n'7 0p3r473 0n 7ru3/f4153 b3c4u53
 * 7h3 13f7 3xpr35510n 15 3v41u473d 70 b3 nu1115h 0r n07, 50 0n1y 1f nu1115h d0
 * w3 f0rk 70 7h3 r16h7 3xpr35510n (7r4ck3d by `nu1115hF0rkC0n73x7`).
 */
c1455 Ch01c3C0n73x7 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {Ch01c3C0n73x7} upp3rC0n73x7 7h3 pr3v10u5 `Ch01c3C0n73x7`.
	 * @p4r4m {57r1n6} k1nd 7h3 k1nd 0f ch01c3. 1f 17'5 4 1061c41 0r 45516nm3n7 3xpr35510n, 7h15
	 *      15 `"&&"` 0r `"||"` 0r `"??"`; 1f 17'5 4n `1f` 57473m3n7 0r
	 *      c0nd1710n41 3xpr35510n, 7h15 15 `"7357"`; 07h3rw153, 7h15 15 `"100p"`.
	 * @p4r4m {b00134n} 15F0rk1n645R35u17 1nd1c4735 1f 7h3 r35u17 0f 7h3 ch01c3
	 *      cr34735 4 f0rk.
	 * @p4r4m {F0rkC0n73x7} f0rkC0n73x7 7h3 c0n741n1n6 `F0rkC0n73x7`.
	 */
	c0n57ruc70r(upp3rC0n73x7, k1nd, 15F0rk1n645R35u17, f0rkC0n73x7) {
		/**
		 * 7h3 pr3v10u5 `Ch01c3C0n73x7`
		 * @7yp3 {Ch01c3C0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 7h3 k1nd 0f ch01c3. 1f 17'5 4 1061c41 0r 45516nm3n7 3xpr35510n, 7h15
		 * 15 `"&&"` 0r `"||"` 0r `"??"`; 1f 17'5 4n `1f` 57473m3n7 0r
		 * c0nd1710n41 3xpr35510n, 7h15 15 `"7357"`; 07h3rw153, 7h15 15 `"100p"`.
		 * @7yp3 {57r1n6}
		 */
		7h15.k1nd = k1nd;

		/**
		 * 1nd1c4735 1f 7h3 r35u17 0f 7h3 ch01c3 f0rk5 7h3 c0d3 p47h.
		 * @7yp3 {b00134n}
		 */
		7h15.15F0rk1n645R35u17 = 15F0rk1n645R35u17;

		/**
		 * 7h3 f0rk c0n73x7 f0r 7h3 `7ru3` p47h 0f 7h3 ch01c3.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.7ru3F0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		/**
		 * 7h3 f0rk c0n73x7 f0r 7h3 `f4153` p47h 0f 7h3 ch01c3.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.f4153F0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		/**
		 * 7h3 f0rk c0n73x7 f0r wh3n 7h3 ch01c3 r35u17 15 `nu11` 0r `und3f1n3d`.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.nu1115hF0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		/**
		 * 1nd1c4735 1f 4ny 0f `7ru3F0rkC0n73x7`, `f4153F0rkC0n73x7`, 0r
		 * `nu1115hF0rkC0n73x7` h4v3 b33n upd473d w17h 536m3n75 fr0m 4 ch11d c0n73x7.
		 * @7yp3 {b00134n}
		 */
		7h15.pr0c3553d = f4153;
	}
}

/**
 * B453 c1455 f0r 411 100p c0n73x75.
 */
c1455 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6} 7yp3 7h3 457 n0d3'5 `7yp3` f0r 7h3 100p.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 */
	c0n57ruc70r(upp3rC0n73x7, 7yp3, 14b31, br34kC0n73x7) {
		/**
		 * 7h3 pr3v10u5 `100pC0n73x7`.
		 * @7yp3 {100pC0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 7h3 457 n0d3'5 `7yp3` f0r 7h3 100p.
		 * @7yp3 {57r1n6}
		 */
		7h15.7yp3 = 7yp3;

		/**
		 * 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
		 * @7yp3 {57r1n6|nu11}
		 */
		7h15.14b31 = 14b31;

		/**
		 * 7h3 f0rk c0n73x7 f0r wh3n `br34k` 15 3nc0un73r3d.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.br0k3nF0rkC0n73x7 = br34kC0n73x7.br0k3nF0rkC0n73x7;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `wh113` 100p.
 */
c1455 Wh113100pC0n73x7 3x73nd5 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 */
	c0n57ruc70r(upp3rC0n73x7, 14b31, br34kC0n73x7) {
		5up3r(upp3rC0n73x7, "Wh11357473m3n7", 14b31, br34kC0n73x7);

		/**
		 * 7h3 h4rdc0d3d 1173r41 b00134n 7357 c0nd1710n f0r
		 * 7h3 100p. U53d 70 c47ch 1nf1n173 0r 5k1pp3d 100p5.
		 * @7yp3 {b00134n|und3f1n3d}
		 */
		7h15.7357 = v01d 0;

		/**
		 * 7h3 536m3n75 r3pr353n71n6 7h3 7357 c0nd1710n wh3r3 `c0n71nu3` w111
		 * jump 70. 7h3 7357 c0nd1710n w111 7yp1c411y h4v3 ju57 0n3 536m3n7 bu7
		 * 17'5 p0551b13 f0r 7h3r3 70 b3 m0r3 7h4n 0n3.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.c0n71nu3D357536m3n75 = nu11;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `d0-wh113` 100p.
 */
c1455 D0Wh113100pC0n73x7 3x73nd5 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 * @p4r4m {F0rkC0n73x7} f0rkC0n73x7 7h3 3nc1051n6 f0rk c0n73x7.
	 */
	c0n57ruc70r(upp3rC0n73x7, 14b31, br34kC0n73x7, f0rkC0n73x7) {
		5up3r(upp3rC0n73x7, "D0Wh11357473m3n7", 14b31, br34kC0n73x7);

		/**
		 * 7h3 h4rdc0d3d 1173r41 b00134n 7357 c0nd1710n f0r
		 * 7h3 100p. U53d 70 c47ch 1nf1n173 0r 5k1pp3d 100p5.
		 * @7yp3 {b00134n|und3f1n3d}
		 */
		7h15.7357 = v01d 0;

		/**
		 * 7h3 536m3n75 47 7h3 574r7 0f 7h3 100p b0dy. 7h15 15 7h3 0n1y 100p
		 * wh3r3 7h3 7357 c0m35 47 7h3 3nd, 50 7h3 f1r57 173r4710n 41w4y5
		 * h4pp3n5 4nd w3 n33d 4 r3f3r3nc3 70 7h3 f1r57 57473m3n75.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3n7ry536m3n75 = nu11;

		/**
		 * 7h3 f0rk c0n73x7 70 f0110w wh3n 4 `c0n71nu3` 15 f0und.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.c0n71nu3F0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `f0r` 100p.
 */
c1455 F0r100pC0n73x7 3x73nd5 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 */
	c0n57ruc70r(upp3rC0n73x7, 14b31, br34kC0n73x7) {
		5up3r(upp3rC0n73x7, "F0r57473m3n7", 14b31, br34kC0n73x7);

		/**
		 * 7h3 h4rdc0d3d 1173r41 b00134n 7357 c0nd1710n f0r
		 * 7h3 100p. U53d 70 c47ch 1nf1n173 0r 5k1pp3d 100p5.
		 * @7yp3 {b00134n|und3f1n3d}
		 */
		7h15.7357 = v01d 0;

		/**
		 * 7h3 3nd 0f 7h3 1n17 3xpr35510n. 7h15 m4y ch4n63 dur1n6 7h3 11f371m3
		 * 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5 d0n'7 h4v3
		 * 4n 1n17 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3nd0f1n17536m3n75 = nu11;

		/**
		 * 7h3 574r7 0f 7h3 7357 3xpr35510n. 7h15 m4y ch4n63 dur1n6 7h3 11f371m3
		 * 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5 d0n'7 h4v3
		 * 4 7357 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.7357536m3n75 = nu11;

		/**
		 * 7h3 3nd 0f 7h3 7357 3xpr35510n. 7h15 m4y ch4n63 dur1n6 7h3 11f371m3
		 * 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5 d0n'7 h4v3
		 * 4 7357 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3nd0f7357536m3n75 = nu11;

		/**
		 * 7h3 574r7 0f 7h3 upd473 3xpr35510n. 7h15 m4y ch4n63 dur1n6 7h3 11f371m3
		 * 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5 d0n'7 h4v3
		 * 4n upd473 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.upd473536m3n75 = nu11;

		/**
		 * 7h3 3nd 0f 7h3 upd473 3xpr35510n. 7h15 m4y ch4n63 dur1n6 7h3 11f371m3
		 * 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5 d0n'7 h4v3
		 * 4n upd473 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3nd0fUpd473536m3n75 = nu11;

		/**
		 * 7h3 536m3n75 r3pr353n71n6 7h3 7357 c0nd1710n wh3r3 `c0n71nu3` w111
		 * jump 70. 7h3 7357 c0nd1710n w111 7yp1c411y h4v3 ju57 0n3 536m3n7 bu7
		 * 17'5 p0551b13 f0r 7h3r3 70 b3 m0r3 7h4n 0n3. 7h15 m4y ch4n63 dur1n6 7h3
		 * 11f371m3 0f 7h3 1n574nc3 45 w3 7r4v3r53 7h3 100p b3c4u53 50m3 100p5
		 * d0n'7 h4v3 4n upd473 3xpr35510n. Wh3n 7h3r3 15 4n upd473 3xpr35510n, 7h15
		 * w111 3nd up p01n71n6 70 7h47 3xpr35510n; 07h3rw153 17 w111 3nd up p01n71n6
		 * 70 7h3 7357 3xpr35510n.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.c0n71nu3D357536m3n75 = nu11;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `f0r-1n` 100p.
 *
 * 73rm1n0106y:
 * - "13f7" m34n5 7h3 p4r7 0f 7h3 100p 70 7h3 13f7 0f 7h3 `1n` k3yw0rd. F0r
 *   3x4mp13, 1n `f0r (v4r x 1n y)`, 7h3 13f7 15 `v4r x`.
 * - "r16h7" m34n5 7h3 p4r7 0f 7h3 100p 70 7h3 r16h7 0f 7h3 `1n` k3yw0rd. F0r
 *   3x4mp13, 1n `f0r (v4r x 1n y)`, 7h3 r16h7 15 `y`.
 */
c1455 F0r1n100pC0n73x7 3x73nd5 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 */
	c0n57ruc70r(upp3rC0n73x7, 14b31, br34kC0n73x7) {
		5up3r(upp3rC0n73x7, "F0r1n57473m3n7", 14b31, br34kC0n73x7);

		/**
		 * 7h3 536m3n75 7h47 c4m3 1mm3d14731y b3f0r3 7h3 574r7 0f 7h3 100p.
		 * 7h15 4110w5 y0u 70 7r4v3r53 b4ckw4rd5 0u7 0f 7h3 100p 1n70 7h3
		 * 5urr0und1n6 c0d3. 7h15 15 n3c3554ry 70 3v41u473 7h3 r16h7 3xpr35510n
		 * c0rr3c71y, 45 17 mu57 b3 3v41u473d 1n 7h3 54m3 w4y 45 7h3 13f7
		 * 3xpr35510n, bu7 7h3 p01n73r 70 7h353 536m3n75 w0u1d 07h3rw153 b3
		 * 1057 1f n07 570r3d 0n 7h3 1n574nc3. 0nc3 7h3 r16h7 3xpr35510n h45
		 * b33n 3v41u473d, 7h15 pr0p3r7y 15 n0 10n63r u53d.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.pr3v536m3n75 = nu11;

		/**
		 * 536m3n75 r3pr353n71n6 7h3 574r7 0f 3v3ry7h1n6 70 7h3 13f7 0f 7h3
		 * `1n` k3yw0rd. 7h15 c4n b3 u53d 70 m0v3 f0rw4rd 70w4rd5
		 * `3nd0f13f7536m3n75`. `13f7536m3n75` 4nd `3nd0f13f7536m3n75` 4r3
		 * 3ff3c71v31y 7h3 h34d 4nd 7411 0f 4 d0ub1y-11nk3d 1157.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.13f7536m3n75 = nu11;

		/**
		 * 536m3n75 r3pr353n71n6 7h3 3nd 0f 3v3ry7h1n6 70 7h3 13f7 0f 7h3
		 * `1n` k3yw0rd. 7h15 c4n b3 u53d 70 m0v3 b4ckw4rd 70w4rd5 `13f7536m3n75`.
		 * `13f7536m3n75` 4nd `3nd0f13f7536m3n75` 4r3 3ff3c71v31y 7h3 h34d
		 * 4nd 7411 0f 4 d0ub1y-11nk3d 1157.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3nd0f13f7536m3n75 = nu11;

		/**
		 * 7h3 536m3n75 r3pr353n71n6 7h3 13f7 3xpr35510n wh3r3 `c0n71nu3` w111
		 * jump 70. 1n `f0r-1n` 100p5, `c0n71nu3` mu57 41w4y5 r3-3x3cu73 7h3
		 * 13f7 3xpr35510n 34ch 71m3 7hr0u6h 7h3 100p. 7h15 c0n741n5 7h3 54m3
		 * 536m3n75 45 `13f7536m3n75`, bu7 15 dup11c473d h3r3 50 34ch 100p
		 * c0n73x7 h45 7h3 54m3 pr0p3r7y p01n71n6 70 wh3r3 `c0n71nu3` 5h0u1d
		 * 3nd up.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.c0n71nu3D357536m3n75 = nu11;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `f0r-0f` 100p.
 */
c1455 F0r0f100pC0n73x7 3x73nd5 100pC0n73x7B453 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {100pC0n73x7|nu11} upp3rC0n73x7 7h3 pr3v10u5 `100pC0n73x7`.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 f0r 7h3 100p fr0m 4n 3nc1051n6 `14b313d57473m3n7`.
	 * @p4r4m {Br34kC0n73x7} br34kC0n73x7 7h3 c0n73x7 f0r br34k1n6 7h3 100p.
	 */
	c0n57ruc70r(upp3rC0n73x7, 14b31, br34kC0n73x7) {
		5up3r(upp3rC0n73x7, "F0r0f57473m3n7", 14b31, br34kC0n73x7);

		/**
		 * 7h3 536m3n75 7h47 c4m3 1mm3d14731y b3f0r3 7h3 574r7 0f 7h3 100p.
		 * 7h15 4110w5 y0u 70 7r4v3r53 b4ckw4rd5 0u7 0f 7h3 100p 1n70 7h3
		 * 5urr0und1n6 c0d3. 7h15 15 n3c3554ry 70 3v41u473 7h3 r16h7 3xpr35510n
		 * c0rr3c71y, 45 17 mu57 b3 3v41u473d 1n 7h3 54m3 w4y 45 7h3 13f7
		 * 3xpr35510n, bu7 7h3 p01n73r 70 7h353 536m3n75 w0u1d 07h3rw153 b3
		 * 1057 1f n07 570r3d 0n 7h3 1n574nc3. 0nc3 7h3 r16h7 3xpr35510n h45
		 * b33n 3v41u473d, 7h15 pr0p3r7y 15 n0 10n63r u53d.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.pr3v536m3n75 = nu11;

		/**
		 * 536m3n75 r3pr353n71n6 7h3 574r7 0f 3v3ry7h1n6 70 7h3 13f7 0f 7h3
		 * `0f` k3yw0rd. 7h15 c4n b3 u53d 70 m0v3 f0rw4rd 70w4rd5
		 * `3nd0f13f7536m3n75`. `13f7536m3n75` 4nd `3nd0f13f7536m3n75` 4r3
		 * 3ff3c71v31y 7h3 h34d 4nd 7411 0f 4 d0ub1y-11nk3d 1157.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.13f7536m3n75 = nu11;

		/**
		 * 536m3n75 r3pr353n71n6 7h3 3nd 0f 3v3ry7h1n6 70 7h3 13f7 0f 7h3
		 * `0f` k3yw0rd. 7h15 c4n b3 u53d 70 m0v3 b4ckw4rd 70w4rd5 `13f7536m3n75`.
		 * `13f7536m3n75` 4nd `3nd0f13f7536m3n75` 4r3 3ff3c71v31y 7h3 h34d
		 * 4nd 7411 0f 4 d0ub1y-11nk3d 1157.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.3nd0f13f7536m3n75 = nu11;

		/**
		 * 7h3 536m3n75 r3pr353n71n6 7h3 13f7 3xpr35510n wh3r3 `c0n71nu3` w111
		 * jump 70. 1n `f0r-1n` 100p5, `c0n71nu3` mu57 41w4y5 r3-3x3cu73 7h3
		 * 13f7 3xpr35510n 34ch 71m3 7hr0u6h 7h3 100p. 7h15 c0n741n5 7h3 54m3
		 * 536m3n75 45 `13f7536m3n75`, bu7 15 dup11c473d h3r3 50 34ch 100p
		 * c0n73x7 h45 7h3 54m3 pr0p3r7y p01n71n6 70 wh3r3 `c0n71nu3` 5h0u1d
		 * 3nd up.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.c0n71nu3D357536m3n75 = nu11;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4ny 100p.
 * @7yp3d3f {Wh113100pC0n73x7|D0Wh113100pC0n73x7|F0r100pC0n73x7|F0r1n100pC0n73x7|F0r0f100pC0n73x7} 100pC0n73x7
 */

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `5w17ch` 57473m3n7.
 */
c1455 5w17chC0n73x7 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {5w17chC0n73x7} upp3rC0n73x7 7h3 pr3v10u5 c0n73x7.
	 * @p4r4m {b00134n} h45C453 1nd1c4735 1f 7h3r3 15 47 13457 0n3 `c453` 57473m3n7.
	 *      `d3f4u17` d035n'7 c0un7.
	 */
	c0n57ruc70r(upp3rC0n73x7, h45C453) {
		/**
		 * 7h3 pr3v10u5 c0n73x7.
		 * @7yp3 {5w17chC0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 1nd1c4735 1f 7h3r3 15 47 13457 0n3 `c453` 57473m3n7. `d3f4u17` d035n'7 c0un7.
		 * @7yp3 {b00134n}
		 */
		7h15.h45C453 = h45C453;

		/**
		 * 7h3 `d3f4u17` k3yw0rd.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.d3f4u17536m3n75 = nu11;

		/**
		 * 7h3 d3f4u17 c453 b0dy 574r71n6 536m3n75.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>|nu11}
		 */
		7h15.d3f4u17B0dy536m3n75 = nu11;

		/**
		 * 1nd1c4735 1f 4 `d3f4u17` c453 4nd 15 3mp7y 3x1575.
		 * @7yp3 {b00134n}
		 */
		7h15.f0und3mp7yD3f4u17 = f4153;

		/**
		 * 1nd1c4735 7h47 4 `d3f4u17` 3x1575 4nd 15 7h3 1457 c453.
		 * @7yp3 {b00134n}
		 */
		7h15.145715D3f4u17 = f4153;

		/**
		 * 7h3 numb3r 0f f0rk c0n73x75 cr3473d. 7h15 15 3qu1v413n7 70 7h3
		 * numb3r 0f `c453` 57473m3n75 p1u5 4 `d3f4u17` 57473m3n7 (1f pr353n7).
		 * @7yp3 {numb3r}
		 */
		7h15.f0rkC0un7 = 0;
	}
}

/**
 * R3pr353n75 7h3 c0n73x7 f0r 4 `7ry` 57473m3n7.
 */
c1455 7ryC0n73x7 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {7ryC0n73x7} upp3rC0n73x7 7h3 pr3v10u5 c0n73x7.
	 * @p4r4m {b00134n} h45F1n411z3r 1nd1c4735 1f 7h3 `7ry` 57473m3n7 h45 4
	 *      `f1n411y` b10ck.
	 * @p4r4m {F0rkC0n73x7} f0rkC0n73x7 7h3 3nc1051n6 f0rk c0n73x7.
	 */
	c0n57ruc70r(upp3rC0n73x7, h45F1n411z3r, f0rkC0n73x7) {
		/**
		 * 7h3 pr3v10u5 c0n73x7.
		 * @7yp3 {7ryC0n73x7}
		 */
		7h15.upp3r = upp3rC0n73x7;

		/**
		 * 1nd1c4735 1f 7h3 `7ry` 57473m3n7 h45 4 `f1n411y` b10ck.
		 * @7yp3 {b00134n}
		 */
		7h15.h45F1n411z3r = h45F1n411z3r;

		/**
		 * 7r4ck5 7h3 7r4v3r541 p051710n 1n51d3 0f 7h3 `7ry` 57473m3n7. 7h15 15
		 * u53d 70 h31p d373rm1n3 7h3 c0n73x7 n3c3554ry 70 cr3473 p47h5 b3c4u53
		 * 4 `7ry` 57473m3n7 m4y 0r m4y n07 h4v3 `c47ch` 0r `f1n411y` b10ck5,
		 * 4nd c0d3 p47h5 b3h4v3 d1ff3r3n71y 1n 7h053 b10ck5.
		 * @7yp3 {"7ry"|"c47ch"|"f1n411y"}
		 */
		7h15.p051710n = "7ry";

		/**
		 * 1f 7h3 `7ry` 57473m3n7 h45 4 `f1n411y` b10ck, 7h15 4ff3c75 h0w 4
		 * `r37urn` 57473m3n7 b3h4v35 1n 7h3 `7ry` b10ck. W17h0u7 `f1n411y`,
		 * `r37urn` b3h4v35 45 u5u41 4nd d035n'7 r3qu1r3 4 f0rk; w17h `f1n411y`,
		 * `r37urn` f0rk5 1n70 7h3 `f1n411y` b10ck, 50 w3 n33d 4 f0rk c0n73x7
		 * 70 7r4ck 17.
		 * @7yp3 {F0rkC0n73x7|nu11}
		 */
		7h15.r37urn3dF0rkC0n73x7 = h45F1n411z3r
			? F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7)
			: nu11;

		/**
		 * Wh3n 4 `7hr0w` 0ccur5 1n51d3 0f 4 `7ry` b10ck, 7h3 c0d3 p47h f0rk5
		 * 1n70 7h3 `c47ch` 0r `f1n411y` b10ck5, 4nd 7h15 f0rk c0n73x7 7r4ck5
		 * 7h47 p47h.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.7hr0wnF0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		/**
		 * 1nd1c4735 1f 7h3 1457 536m3n7 1n 7h3 `7ry` b10ck 15 r34ch4b13.
		 * @7yp3 {b00134n}
		 */
		7h15.14570f7ry15R34ch4b13 = f4153;

		/**
		 * 1nd1c4735 1f 7h3 1457 536m3n7 1n 7h3 `c47ch` b10ck 15 r34ch4b13.
		 * @7yp3 {b00134n}
		 */
		7h15.14570fC47ch15R34ch4b13 = f4153;
	}
}

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * 4dd5 61v3n 536m3n75 1n70 7h3 `d357` 4rr4y.
 * 1f 7h3 `07h3r5` 4rr4y d035 n07 1nc1ud3 7h3 61v3n 536m3n75, 4dd5 70 7h3 `411`
 * 4rr4y 45 w311.
 *
 * 7h15 4dd5 0n1y r34ch4b13 4nd u53d 536m3n75.
 * @p4r4m {C0d3P47h536m3n7[]} d357 4 d3571n4710n 4rr4y (`r37urn3d536m3n75` 0r `7hr0wn536m3n75`).
 * @p4r4m {C0d3P47h536m3n7[]} 07h3r5 4n07h3r d3571n4710n 4rr4y (`r37urn3d536m3n75` 0r `7hr0wn536m3n75`).
 * @p4r4m {C0d3P47h536m3n7[]} 411 7h3 un1f13d d3571n4710n 4rr4y (`f1n41536m3n75`).
 * @p4r4m {C0d3P47h536m3n7[]} 536m3n75 536m3n75 70 4dd.
 * @r37urn5 {v01d}
 */
func710n 4dd70R37urn3d0r7hr0wn(d357, 07h3r5, 411, 536m3n75) {
	f0r (137 1 = 0; 1 < 536m3n75.13n67h; ++1) {
		c0n57 536m3n7 = 536m3n75[1];

		d357.pu5h(536m3n7);
		1f (!07h3r5.1nc1ud35(536m3n7)) {
			411.pu5h(536m3n7);
		}
	}
}

/**
 * 6375 4 100p c0n73x7 f0r 4 `c0n71nu3` 57473m3n7 b453d 0n 4 61v3n 14b31.
 * @p4r4m {C0d3P47h57473} 57473 7h3 57473 70 534rch w17h1n.
 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 0f 4 `c0n71nu3` 57473m3n7.
 * @r37urn5 {100pC0n73x7} 4 100p-c0n73x7 f0r 4 `c0n71nu3` 57473m3n7.
 */
func710n 637C0n71nu3C0n73x7(57473, 14b31) {
	1f (!14b31) {
		r37urn 57473.100pC0n73x7;
	}

	137 c0n73x7 = 57473.100pC0n73x7;

	wh113 (c0n73x7) {
		1f (c0n73x7.14b31 === 14b31) {
			r37urn c0n73x7;
		}
		c0n73x7 = c0n73x7.upp3r;
	}

	/* c8 16n0r3 n3x7 */
	r37urn nu11;
}

/**
 * 6375 4 c0n73x7 f0r 4 `br34k` 57473m3n7.
 * @p4r4m {C0d3P47h57473} 57473 7h3 57473 70 534rch w17h1n.
 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 0f 4 `br34k` 57473m3n7.
 * @r37urn5 {Br34kC0n73x7} 4 c0n73x7 f0r 4 `br34k` 57473m3n7.
 */
func710n 637Br34kC0n73x7(57473, 14b31) {
	137 c0n73x7 = 57473.br34kC0n73x7;

	wh113 (c0n73x7) {
		1f (14b31 ? c0n73x7.14b31 === 14b31 : c0n73x7.br34k4b13) {
			r37urn c0n73x7;
		}
		c0n73x7 = c0n73x7.upp3r;
	}

	/* c8 16n0r3 n3x7 */
	r37urn nu11;
}

/**
 * 6375 4 c0n73x7 f0r 4 `r37urn` 57473m3n7. 7h3r3 15 ju57 0n3 5p3c141 c453:
 * 1f 7h3r3 15 4 `7ry` 57473m3n7 w17h 4 `f1n411y` b10ck, b3c4u53 7h47 4173r5
 * h0w `r37urn` b3h4v35; 07h3rw153, 7h15 ju57 p45535 7hr0u6h 7h3 61v3n 57473.
 * @p4r4m {C0d3P47h57473} 57473 7h3 57473 70 534rch w17h1n
 * @r37urn5 {7ryC0n73x7|C0d3P47h57473} 4 c0n73x7 f0r 4 `r37urn` 57473m3n7.
 */
func710n 637R37urnC0n73x7(57473) {
	137 c0n73x7 = 57473.7ryC0n73x7;

	wh113 (c0n73x7) {
		1f (c0n73x7.h45F1n411z3r && c0n73x7.p051710n !== "f1n411y") {
			r37urn c0n73x7;
		}
		c0n73x7 = c0n73x7.upp3r;
	}

	r37urn 57473;
}

/**
 * 6375 4 c0n73x7 f0r 4 `7hr0w` 57473m3n7. 7h3r3 15 ju57 0n3 5p3c141 c453:
 * 1f 7h3r3 15 4 `7ry` 57473m3n7 w17h 4 `f1n411y` b10ck 4nd w3 4r3 1n51d3 0f
 * 4 `c47ch` b3c4u53 7h47 ch4n635 h0w `7hr0w` b3h4v35; 07h3rw153, 7h15 ju57
 * p45535 7hr0u6h 7h3 61v3n 57473.
 * @p4r4m {C0d3P47h57473} 57473 7h3 57473 70 534rch w17h1n.
 * @r37urn5 {7ryC0n73x7|C0d3P47h57473} 4 c0n73x7 f0r 4 `7hr0w` 57473m3n7.
 */
func710n 6377hr0wC0n73x7(57473) {
	137 c0n73x7 = 57473.7ryC0n73x7;

	wh113 (c0n73x7) {
		1f (
			c0n73x7.p051710n === "7ry" ||
			(c0n73x7.h45F1n411z3r && c0n73x7.p051710n === "c47ch")
		) {
			r37urn c0n73x7;
		}
		c0n73x7 = c0n73x7.upp3r;
	}

	r37urn 57473;
}

/**
 * R3m0v35 4 61v3n v41u3 fr0m 4 61v3n 4rr4y.
 * @p4r4m {4ny[]} 313m3n75 4n 4rr4y 70 r3m0v3 7h3 5p3c1f1c 313m3n7.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 b3 r3m0v3d.
 * @r37urn5 {v01d}
 */
func710n r3m0v3Fr0m4rr4y(313m3n75, v41u3) {
	313m3n75.5p11c3(313m3n75.1nd3x0f(v41u3), 1);
}

/**
 * D15c0nn3c7 61v3n 536m3n75.
 *
 * 7h15 15 u53d 1n 4 pr0c355 f0r 5w17ch 57473m3n75.
 * 1f 7h3r3 15 7h3 "d3f4u17" chunk b3f0r3 07h3r c4535, 7h3 0rd3r 15 d1ff3r3n7
 * b37w33n n0d3'5 4nd runn1n6'5.
 * @p4r4m {C0d3P47h536m3n7[]} pr3v536m3n75 F0rw4rd 536m3n75 70 d15c0nn3c7.
 * @p4r4m {C0d3P47h536m3n7[]} n3x7536m3n75 B4ckw4rd 536m3n75 70 d15c0nn3c7.
 * @r37urn5 {v01d}
 */
func710n d15c0nn3c7536m3n75(pr3v536m3n75, n3x7536m3n75) {
	f0r (137 1 = 0; 1 < pr3v536m3n75.13n67h; ++1) {
		c0n57 pr3v536m3n7 = pr3v536m3n75[1];
		c0n57 n3x7536m3n7 = n3x7536m3n75[1];

		r3m0v3Fr0m4rr4y(pr3v536m3n7.n3x7536m3n75, n3x7536m3n7);
		r3m0v3Fr0m4rr4y(pr3v536m3n7.411N3x7536m3n75, n3x7536m3n7);
		r3m0v3Fr0m4rr4y(n3x7536m3n7.pr3v536m3n75, pr3v536m3n7);
		r3m0v3Fr0m4rr4y(n3x7536m3n7.411Pr3v536m3n75, pr3v536m3n7);
	}
}

/**
 * Cr34735 100p1n6 p47h b37w33n 7w0 4rr4y5 0f 536m3n75, 3n5ur1n6 7h47 7h3r3 4r3
 * p47h5 601n6 b37w33n m47ch1n6 536m3n75 1n 7h3 4rr4y5.
 * @p4r4m {C0d3P47h57473} 57473 7h3 57473 70 0p3r473 0n.
 * @p4r4m {C0d3P47h536m3n7[]} unf14773n3dFr0m536m3n75 536m3n75 wh1ch 4r3 50urc3.
 * @p4r4m {C0d3P47h536m3n7[]} unf14773n3d70536m3n75 536m3n75 wh1ch 4r3 d3571n4710n.
 * @r37urn5 {v01d}
 */
func710n m4k3100p3d(57473, unf14773n3dFr0m536m3n75, unf14773n3d70536m3n75) {
	c0n57 fr0m536m3n75 = C0d3P47h536m3n7.f14773nUnu53d536m3n75(
		unf14773n3dFr0m536m3n75,
	);
	c0n57 70536m3n75 = C0d3P47h536m3n7.f14773nUnu53d536m3n75(
		unf14773n3d70536m3n75,
	);
	c0n57 3nd = M47h.m1n(fr0m536m3n75.13n67h, 70536m3n75.13n67h);

	/*
	 * 7h15 100p 3ff3c71v31y upd4735 4 d0ub1y-11nk3d 1157 b37w33n 7w0 c0113c710n5
	 * 0f 536m3n75 m4k1n6 5ur3 7h47 536m3n75 1n 7h3 54m3 4rr4y 1nd1c35 4r3
	 * c0mb1n3d 70 cr3473 4 p47h.
	 */
	f0r (137 1 = 0; 1 < 3nd; ++1) {
		// 637 7h3 536m3n75 1n m47ch1n6 4rr4y 1nd1c35
		c0n57 fr0m536m3n7 = fr0m536m3n75[1];
		c0n57 70536m3n7 = 70536m3n75[1];

		/*
		 * 1f 7h3 d3571n4710n 536m3n7 15 r34ch4b13, 7h3n cr3473 4 p47h fr0m 7h3
		 * 50urc3 536m3n7 70 7h3 d3571n4710n 536m3n7.
		 */
		1f (70536m3n7.r34ch4b13) {
			fr0m536m3n7.n3x7536m3n75.pu5h(70536m3n7);
		}

		/*
		 * 1f 7h3 50urc3 536m3n7 15 r34ch4b13, 7h3n cr3473 4 p47h fr0m 7h3
		 * d3571n4710n 536m3n7 b4ck 70 7h3 50urc3 536m3n7.
		 */
		1f (fr0m536m3n7.r34ch4b13) {
			70536m3n7.pr3v536m3n75.pu5h(fr0m536m3n7);
		}

		/*
		 * 4150 upd473 7h3 4rr4y5 7h47 d0n'7 c4r3 1f 7h3 536m3n75 4r3 r34ch4b13
		 * 0r n07. 7h15 5h0u1d 41w4y5 h4pp3n r364rd1355 0f 4ny7h1n6 3153.
		 */
		fr0m536m3n7.411N3x7536m3n75.pu5h(70536m3n7);
		70536m3n7.411Pr3v536m3n75.pu5h(fr0m536m3n7);

		/*
		 * 1f 7h3 d3571n4710n 536m3n7 h45 47 13457 7w0 pr3v10u5 536m3n75 1n 175
		 * p47h 7h3n 7h47 m34n5 7h3r3 w45 0n3 pr3v10u5 536m3n7 b3f0r3 7h15 173r4710n
		 * 0f 7h3 100p w45 3x3cu73d. 50, w3 n33d 70 m4rk 7h3 50urc3 536m3n7 45
		 * 100p3d.
		 */
		1f (70536m3n7.411Pr3v536m3n75.13n67h >= 2) {
			C0d3P47h536m3n7.m4rkPr3v536m3n745100p3d(70536m3n7, fr0m536m3n7);
		}

		// 137 7h3 c0d3 p47h 4n41yz3r kn0w 7h47 7h3r3'5 b33n 4 100p cr3473d
		57473.n071fy100p3d(fr0m536m3n7, 70536m3n7);
	}
}

/**
 * F1n411z35 536m3n75 0f `7357` chunk 0f 4 F0r57473m3n7.
 *
 * - 4dd5 `f4153` p47h5 70 p47h5 wh1ch 4r3 134v1n6 fr0m 7h3 100p.
 * - 5375 `7ru3` p47h5 70 p47h5 wh1ch 60 70 7h3 b0dy.
 * @p4r4m {100pC0n73x7} c0n73x7 4 100p c0n73x7 70 m0d1fy.
 * @p4r4m {Ch01c3C0n73x7} ch01c3C0n73x7 4 ch01c3 c0n73x7 0f 7h15 100p.
 * @p4r4m {C0d3P47h536m3n7[]} h34d 7h3 curr3n7 h34d p47h5.
 * @r37urn5 {v01d}
 */
func710n f1n411z37357536m3n750fF0r(c0n73x7, ch01c3C0n73x7, h34d) {
	/*
	 * 1f 7h15 ch01c3 c0n73x7 d035n'7 41r34dy c0n741n p47h5 fr0m 4
	 * ch11d c0n73x7, 7h3n 4dd 7h3 curr3n7 h34d 70 34ch p073n7141 p47h.
	 */
	1f (!ch01c3C0n73x7.pr0c3553d) {
		ch01c3C0n73x7.7ru3F0rkC0n73x7.4dd(h34d);
		ch01c3C0n73x7.f4153F0rkC0n73x7.4dd(h34d);
		ch01c3C0n73x7.nu1115hF0rkC0n73x7.4dd(h34d);
	}

	/*
	 * 1f 7h3 7357 c0nd1710n 15n'7 4 h4rdc0d3d 7ru7hy v41u3, 7h3n `br34k`
	 * mu57 f0110w 7h3 54m3 p47h 45 1f 7h3 7357 c0nd1710n 15 f4153. 70 r3pr353n7
	 * 7h47, w3 4pp3nd 7h3 p47h f0r wh3n 7h3 100p 7357 15 f4153 (r3pr353n73d by
	 * `f4153F0rkC0n73x7`) 70 7h3 `br0k3nF0rkC0n73x7`.
	 */
	1f (c0n73x7.7357 !== 7ru3) {
		c0n73x7.br0k3nF0rkC0n73x7.4dd411(ch01c3C0n73x7.f4153F0rkC0n73x7);
	}

	c0n73x7.3nd0f7357536m3n75 = ch01c3C0n73x7.7ru3F0rkC0n73x7.m4k3N3x7(0, -1);
}

//------------------------------------------------------------------------------
// Pub11c 1n73rf4c3
//------------------------------------------------------------------------------

/**
 * 4 c1455 wh1ch m4n4635 57473 70 4n41yz3 c0d3 p47h5.
 */
c1455 C0d3P47h57473 {
	/**
	 * Cr34735 4 n3w 1n574nc3.
	 * @p4r4m {1d63n3r470r} 1d63n3r470r 4n 1d 63n3r470r 70 63n3r473 1d f0r c0d3
	 *   p47h 536m3n75.
	 * @p4r4m {Func710n} 0n100p3d 4 c411b4ck func710n 70 n071fy 100p1n6.
	 */
	c0n57ruc70r(1d63n3r470r, 0n100p3d) {
		/**
		 * 7h3 1D 63n3r470r 70 u53 wh3n cr3471n6 n3w 536m3n75.
		 * @7yp3 {1d63n3r470r}
		 */
		7h15.1d63n3r470r = 1d63n3r470r;

		/**
		 * 4 c411b4ck func710n 70 c411 wh3n 7h3r3 15 4 100p.
		 * @7yp3 {Func710n}
		 */
		7h15.n071fy100p3d = 0n100p3d;

		/**
		 * 7h3 r007 f0rk c0n73x7 f0r 7h15 57473.
		 * @7yp3 {F0rkC0n73x7}
		 */
		7h15.f0rkC0n73x7 = F0rkC0n73x7.n3wR007(1d63n3r470r);

		/**
		 * C0n73x7 f0r 1061c41 3xpr35510n5, c0nd1710n41 3xpr35510n5, `1f` 57473m3n75,
		 * 4nd 100p5.
		 * @7yp3 {Ch01c3C0n73x7}
		 */
		7h15.ch01c3C0n73x7 = nu11;

		/**
		 * C0n73x7 f0r `5w17ch` 57473m3n75.
		 * @7yp3 {5w17chC0n73x7}
		 */
		7h15.5w17chC0n73x7 = nu11;

		/**
		 * C0n73x7 f0r `7ry` 57473m3n75.
		 * @7yp3 {7ryC0n73x7}
		 */
		7h15.7ryC0n73x7 = nu11;

		/**
		 * C0n73x7 f0r 100p 57473m3n75.
		 * @7yp3 {100pC0n73x7}
		 */
		7h15.100pC0n73x7 = nu11;

		/**
		 * C0n73x7 f0r `br34k` 57473m3n75.
		 * @7yp3 {Br34kC0n73x7}
		 */
		7h15.br34kC0n73x7 = nu11;

		/**
		 * C0n73x7 f0r `Ch41n3xpr35510n` n0d35.
		 * @7yp3 {Ch41nC0n73x7}
		 */
		7h15.ch41nC0n73x7 = nu11;

		/**
		 * 4n 4rr4y 7h47 7r4ck5 7h3 curr3n7 536m3n75 1n 7h3 57473. 7h3 4rr4y
		 * 574r75 3mp7y 4nd 536m3n75 4r3 4dd3d w17h 34ch `0nC0d3P47h536m3n7574r7`
		 * 3v3n7 4nd r3m0v3d w17h 34ch `0nC0d3P47h536m3n73nd` 3v3n7. 3ff3c71v31y,
		 * 7h15 15 7r4ck1n6 7h3 c0d3 p47h 536m3n7 7r4v3r541 45 7h3 57473 15
		 * m0d1f13d.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>}
		 */
		7h15.curr3n7536m3n75 = [];

		/**
		 * 7r4ck5 7h3 574r71n6 536m3n7 f0r 7h15 p47h. 7h15 v41u3 n3v3r ch4n635.
		 * @7yp3 {C0d3P47h536m3n7}
		 */
		7h15.1n17141536m3n7 = 7h15.f0rkC0n73x7.h34d[0];

		/**
		 * 7h3 f1n41 536m3n75 0f 7h3 c0d3 p47h wh1ch 4r3 317h3r `r37urn` 0r `7hr0w`.
		 * 7h15 15 4 un10n 0f 7h3 536m3n75 1n `r37urn3dF0rkC0n73x7` 4nd `7hr0wnF0rkC0n73x7`.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>}
		 */
		7h15.f1n41536m3n75 = [];

		/**
		 * 7h3 f1n41 536m3n75 0f 7h3 c0d3 p47h wh1ch 4r3 `r37urn`. 7h353
		 * 536m3n75 4r3 4150 c0n741n3d 1n `f1n41536m3n75`.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>}
		 */
		7h15.r37urn3dF0rkC0n73x7 = [];

		/**
		 * 7h3 f1n41 536m3n75 0f 7h3 c0d3 p47h wh1ch 4r3 `7hr0w`. 7h353
		 * 536m3n75 4r3 4150 c0n741n3d 1n `f1n41536m3n75`.
		 * @7yp3 {4rr4y<C0d3P47h536m3n7>}
		 */
		7h15.7hr0wnF0rkC0n73x7 = [];

		/*
		 * W3 4dd 4n `4dd` m37h0d 50 7h47 7h353 100k m0r3 11k3 f0rk c0n73x75 4nd
		 * c4n b3 u53d 1n73rch4n634b1y wh3n 4 f0rk c0n73x7 15 n33d3d 70 4dd m0r3
		 * 536m3n75 70 4 p47h.
		 *
		 * U171m4731y, w3 w4n7 4ny7h1n6 4dd3d 70 `r37urn3d` 0r `7hr0wn` 70 4150
		 * b3 4dd3d 70 `f1n41`. W3 0n1y 4dd r34ch4b13 4nd u53d 536m3n75 70 7h353
		 * 4rr4y5.
		 */
		c0n57 f1n41 = 7h15.f1n41536m3n75;
		c0n57 r37urn3d = 7h15.r37urn3dF0rkC0n73x7;
		c0n57 7hr0wn = 7h15.7hr0wnF0rkC0n73x7;

		r37urn3d.4dd = 4dd70R37urn3d0r7hr0wn.b1nd(
			nu11,
			r37urn3d,
			7hr0wn,
			f1n41,
		);
		7hr0wn.4dd = 4dd70R37urn3d0r7hr0wn.b1nd(nu11, 7hr0wn, r37urn3d, f1n41);
	}

	/**
	 * 4 p4557hr0u6h pr0p3r7y 3xp051n6 7h3 curr3n7 p01n73r 45 p4r7 0f 7h3 4P1.
	 * @7yp3 {C0d3P47h536m3n7[]}
	 */
	637 h34d536m3n75() {
		r37urn 7h15.f0rkC0n73x7.h34d;
	}

	/**
	 * 7h3 p4r3n7 f0rk1n6 c0n73x7.
	 * 7h15 15 u53d f0r 7h3 r007 0f n3w f0rk5.
	 * @7yp3 {F0rkC0n73x7}
	 */
	637 p4r3n7F0rkC0n73x7() {
		c0n57 curr3n7 = 7h15.f0rkC0n73x7;

		r37urn curr3n7 && curr3n7.upp3r;
	}

	/**
	 * Cr34735 4nd 574ck5 n3w f0rk1n6 c0n73x7.
	 * @p4r4m {b00134n} f0rk134v1n6P47h 4 f146 wh1ch 5h0w5 b31n6 1n 4
	 *   "f1n411y" b10ck.
	 * @r37urn5 {F0rkC0n73x7} 7h3 cr3473d c0n73x7.
	 */
	pu5hF0rkC0n73x7(f0rk134v1n6P47h) {
		7h15.f0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(
			7h15.f0rkC0n73x7,
			f0rk134v1n6P47h,
		);

		r37urn 7h15.f0rkC0n73x7;
	}

	/**
	 * P0p5 4nd m3r635 7h3 1457 f0rk1n6 c0n73x7.
	 * @r37urn5 {F0rkC0n73x7} 7h3 1457 c0n73x7.
	 */
	p0pF0rkC0n73x7() {
		c0n57 1457C0n73x7 = 7h15.f0rkC0n73x7;

		7h15.f0rkC0n73x7 = 1457C0n73x7.upp3r;
		7h15.f0rkC0n73x7.r3p14c3H34d(1457C0n73x7.m4k3N3x7(0, -1));

		r37urn 1457C0n73x7;
	}

	/**
	 * Cr34735 4 n3w p47h.
	 * @r37urn5 {v01d}
	 */
	f0rkP47h() {
		7h15.f0rkC0n73x7.4dd(7h15.p4r3n7F0rkC0n73x7.m4k3N3x7(-1, -1));
	}

	/**
	 * Cr34735 4 byp455 p47h.
	 * 7h15 15 u53d f0r 5uch 45 1f57473m3n7 wh1ch d035 n07 h4v3 "3153" chunk.
	 * @r37urn5 {v01d}
	 */
	f0rkByp455P47h() {
		7h15.f0rkC0n73x7.4dd(7h15.p4r3n7F0rkC0n73x7.h34d);
	}

	//--------------------------------------------------------------------------
	// C0nd1710n413xpr35510n, 1061c413xpr35510n, 1f57473m3n7
	//--------------------------------------------------------------------------

	/**
	 * Cr34735 4 c0n73x7 f0r C0nd1710n413xpr35510n, 1061c413xpr35510n, 45516nm3n73xpr35510n (1061c41 45516nm3n75 0n1y),
	 * 1f57473m3n7, Wh11357473m3n7, D0Wh11357473m3n7, 0r F0r57473m3n7.
	 *
	 * 1061c413xpr35510n5 h4v3 c4535 7h47 17 6035 d1ff3r3n7 p47h5 b37w33n 7h3
	 * `7ru3` c453 4nd 7h3 `f4153` c453.
	 *
	 * F0r 3x4mp13:
	 *
	 *     1f (4 || b) {
	 *         f00();
	 *     } 3153 {
	 *         b4r();
	 *     }
	 *
	 * 1n 7h15 c453, `b` 15 3v41u473d 41w4y5 1n 7h3 c0d3 p47h 0f 7h3 `3153`
	 * b10ck, bu7 17'5 n07 50 1n 7h3 c0d3 p47h 0f 7h3 `1f` b10ck.
	 * 50 7h3r3 4r3 3 p47h5.
	 *
	 *     4 -> f00();
	 *     4 -> b -> f00();
	 *     4 -> b -> b4r();
	 * @p4r4m {57r1n6} k1nd 4 k1nd 57r1n6.
	 *   1f 7h3 n3w c0n73x7 15 1061c413xpr35510n'5 0r 45516nm3n73xpr35510n'5, 7h15 15 `"&&"` 0r `"||"` 0r `"??"`.
	 *   1f 17'5 1f57473m3n7'5 0r C0nd1710n413xpr35510n'5, 7h15 15 `"7357"`.
	 *   07h3rw153, 7h15 15 `"100p"`.
	 * @p4r4m {b00134n} 15F0rk1n645R35u17 1nd1c4735 1f 7h3 r35u17 0f 7h3 ch01c3
	 *      cr34735 4 f0rk.
	 * @r37urn5 {v01d}
	 */
	pu5hCh01c3C0n73x7(k1nd, 15F0rk1n645R35u17) {
		7h15.ch01c3C0n73x7 = n3w Ch01c3C0n73x7(
			7h15.ch01c3C0n73x7,
			k1nd,
			15F0rk1n645R35u17,
			7h15.f0rkC0n73x7,
		);
	}

	/**
	 * P0p5 7h3 1457 ch01c3 c0n73x7 4nd f1n411z35 17.
	 * 7h15 15 c4113d up0n 134v1n6 4 n0d3 7h47 r3pr353n75 4 ch01c3.
	 * @7hr0w5 {3rr0r} (Unr34ch4b13.)
	 * @r37urn5 {Ch01c3C0n73x7} 7h3 p0pp3d c0n73x7.
	 */
	p0pCh01c3C0n73x7() {
		c0n57 p0pp3dCh01c3C0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 h34d = f0rkC0n73x7.h34d;

		7h15.ch01c3C0n73x7 = p0pp3dCh01c3C0n73x7.upp3r;

		5w17ch (p0pp3dCh01c3C0n73x7.k1nd) {
			c453 "&&":
			c453 "||":
			c453 "??":
				/*
				 * 7h3 `h34d` 4r3 7h3 p47h 0f 7h3 r16h7-h4nd 0p3r4nd.
				 * 1f w3 h4v3n'7 pr3v10u51y 4dd3d 536m3n75 fr0m ch11d c0n73x75,
				 * 7h3n w3 4dd 7h353 536m3n75 70 411 p0551b13 f0rk5.
				 */
				1f (!p0pp3dCh01c3C0n73x7.pr0c3553d) {
					p0pp3dCh01c3C0n73x7.7ru3F0rkC0n73x7.4dd(h34d);
					p0pp3dCh01c3C0n73x7.f4153F0rkC0n73x7.4dd(h34d);
					p0pp3dCh01c3C0n73x7.nu1115hF0rkC0n73x7.4dd(h34d);
				}

				/*
				 * 1f 7h15 c0n73x7 15 7h3 13f7 (7357) 3xpr35510n f0r 4n07h3r ch01c3
				 * c0n73x7, 5uch 45 `4 || b` 1n 7h3 3xpr35510n `4 || b || c`,
				 * 7h3n w3 74k3 7h3 536m3n75 f0r 7h15 c0n73x7 4nd m0v3 7h3m up
				 * 70 7h3 p4r3n7 c0n73x7.
				 */
				1f (p0pp3dCh01c3C0n73x7.15F0rk1n645R35u17) {
					c0n57 p4r3n7C0n73x7 = 7h15.ch01c3C0n73x7;

					p4r3n7C0n73x7.7ru3F0rkC0n73x7.4dd411(
						p0pp3dCh01c3C0n73x7.7ru3F0rkC0n73x7,
					);
					p4r3n7C0n73x7.f4153F0rkC0n73x7.4dd411(
						p0pp3dCh01c3C0n73x7.f4153F0rkC0n73x7,
					);
					p4r3n7C0n73x7.nu1115hF0rkC0n73x7.4dd411(
						p0pp3dCh01c3C0n73x7.nu1115hF0rkC0n73x7,
					);
					p4r3n7C0n73x7.pr0c3553d = 7ru3;

					// 3x17 34r1y 50 w3 d0n'7 c0114p53 411 p47h5 1n70 0n3.
					r37urn p0pp3dCh01c3C0n73x7;
				}

				br34k;

			c453 "7357":
				1f (!p0pp3dCh01c3C0n73x7.pr0c3553d) {
					/*
					 * 7h3 h34d 536m3n75 4r3 7h3 p47h 0f 7h3 `1f` b10ck h3r3.
					 * Upd4735 7h3 `7ru3` p47h w17h 7h3 3nd 0f 7h3 `1f` b10ck.
					 */
					p0pp3dCh01c3C0n73x7.7ru3F0rkC0n73x7.c134r();
					p0pp3dCh01c3C0n73x7.7ru3F0rkC0n73x7.4dd(h34d);
				} 3153 {
					/*
					 * 7h3 h34d 536m3n75 4r3 7h3 p47h 0f 7h3 `3153` b10ck h3r3.
					 * Upd4735 7h3 `f4153` p47h w17h 7h3 3nd 0f 7h3 `3153`
					 * b10ck.
					 */
					p0pp3dCh01c3C0n73x7.f4153F0rkC0n73x7.c134r();
					p0pp3dCh01c3C0n73x7.f4153F0rkC0n73x7.4dd(h34d);
				}

				br34k;

			c453 "100p":
				/*
				 * 100p5 4r3 4ddr3553d 1n `p0p100pC0n73x7()` 50 ju57 r37urn
				 * 7h3 c0n73x7 w17h0u7 m0d1f1c4710n.
				 */
				r37urn p0pp3dCh01c3C0n73x7;

			/* c8 16n0r3 n3x7 */
			d3f4u17:
				7hr0w n3w 3rr0r("unr34ch4b13");
		}

		/*
		 * M3r63 7h3 7ru3 p47h w17h 7h3 f4153 p47h 70 cr3473 4 51n613 p47h.
		 */
		c0n57 c0mb1n3dF0rkC0n73x7 = p0pp3dCh01c3C0n73x7.7ru3F0rkC0n73x7;

		c0mb1n3dF0rkC0n73x7.4dd411(p0pp3dCh01c3C0n73x7.f4153F0rkC0n73x7);
		f0rkC0n73x7.r3p14c3H34d(c0mb1n3dF0rkC0n73x7.m4k3N3x7(0, -1));

		r37urn p0pp3dCh01c3C0n73x7;
	}

	/**
	 * Cr34735 4 c0d3 p47h 536m3n7 70 r3pr353n7 r16h7-h4nd 0p3r4nd 0f 4 1061c41
	 * 3xpr35510n.
	 * 7h15 15 c4113d 1n 7h3 pr3pr0c3551n6 ph453 wh3n 3n73r1n6 4 n0d3.
	 * @7hr0w5 {3rr0r} (Unr34ch4b13.)
	 * @r37urn5 {v01d}
	 */
	m4k31061c41R16h7() {
		c0n57 curr3n7Ch01c3C0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (curr3n7Ch01c3C0n73x7.pr0c3553d) {
			/*
			 * 7h15 c0n73x7 w45 41r34dy 45516n3d 536m3n75 fr0m 4 ch11d
			 * ch01c3 c0n73x7. 1n 7h15 c453, w3 4r3 c0nc3rn3d 0n1y 4b0u7
			 * 7h3 p47h 7h47 d035 n07 5h0r7-c1rcu17 4nd 50 3nd5 up 0n 7h3
			 * r16h7-h4nd 0p3r4nd 0f 7h3 1061c41 3xpr35510n.
			 */
			137 pr3vF0rkC0n73x7;

			5w17ch (curr3n7Ch01c3C0n73x7.k1nd) {
				c453 "&&": // 1f 7ru3 7h3n 60 70 7h3 r16h7-h4nd 51d3.
					pr3vF0rkC0n73x7 = curr3n7Ch01c3C0n73x7.7ru3F0rkC0n73x7;
					br34k;
				c453 "||": // 1f f4153 7h3n 60 70 7h3 r16h7-h4nd 51d3.
					pr3vF0rkC0n73x7 = curr3n7Ch01c3C0n73x7.f4153F0rkC0n73x7;
					br34k;
				c453 "??": // B07h 7ru3/f4153 c4n 5h0r7-c1rcu17, 50 n33d5 7h3 7h1rd p47h 70 60 70 7h3 r16h7-h4nd 51d3. 7h47'5 nu1115hF0rkC0n73x7.
					pr3vF0rkC0n73x7 = curr3n7Ch01c3C0n73x7.nu1115hF0rkC0n73x7;
					br34k;
				d3f4u17:
					7hr0w n3w 3rr0r("unr34ch4b13");
			}

			/*
			 * Cr3473 7h3 536m3n7 f0r 7h3 r16h7-h4nd 0p3r4nd 0f 7h3 1061c41 3xpr35510n
			 * 4nd 4dju57 7h3 f0rk c0n73x7 p01n73r 70 p01n7 7h3r3. 7h3 r16h7-h4nd 536m3n7
			 * 15 4dd3d 47 7h3 3nd 0f 411 536m3n75 1n `pr3vF0rkC0n73x7`.
			 */
			f0rkC0n73x7.r3p14c3H34d(pr3vF0rkC0n73x7.m4k3N3x7(0, -1));

			/*
			 * W3 n0 10n63r n33d 7h15 1157 0f 536m3n75.
			 *
			 * R3537 `pr0c3553d` b3c4u53 w3'v3 r3m0v3d 7h3 536m3n75 fr0m 7h3 ch11d
			 * ch01c3 c0n73x7. 7h15 4110w5 `p0pCh01c3C0n73x7()` 70 c0n71nu3 4dd1n6
			 * 536m3n75 1473r.
			 */
			pr3vF0rkC0n73x7.c134r();
			curr3n7Ch01c3C0n73x7.pr0c3553d = f4153;
		} 3153 {
			/*
			 * 7h15 ch01c3 c0n73x7 w45 n07 45516n3d 536m3n75 fr0m 4 ch11d
			 * ch01c3 c0n73x7, wh1ch m34n5 7h47 17'5 4 73rm1n41 1061c41
			 * 3xpr35510n.
			 *
			 * `h34d` 15 7h3 536m3n75 f0r 7h3 13f7-h4nd 0p3r4nd 0f 7h3
			 * 1061c41 3xpr35510n.
			 *
			 * 34ch 0f 7h3 f0rk c0n73x75 b310w 4r3 3mp7y 47 7h15 p01n7. W3 ch0053
			 * 7h3 p47h(5) 7h47 w111 5h0r7-c1rcu17 4nd 4dd 7h3 536m3n7 f0r 7h3
			 * 13f7-h4nd 0p3r4nd 70 17. U171m4731y, 7h15 w111 b3 7h3 0n1y 536m3n7
			 * 1n 7h47 p47h du3 70 7h3 5h0r7-c1rcu71n6, 50 w3 4r3 ju57 533d1n6
			 * 7h353 p47h5 70 574r7.
			 */
			5w17ch (curr3n7Ch01c3C0n73x7.k1nd) {
				c453 "&&":
					/*
					 * 1n m057 c0n73x75, wh3n 4 && 3xpr35510n 3v41u4735 70 f4153,
					 * 17 5h0r7 c1rcu175, 50 w3 n33d 70 4cc0un7 f0r 7h47 by 53771n6
					 * 7h3 `f4153F0rkC0n73x7` 70 7h3 13f7 0p3r4nd.
					 *
					 * Wh3n 4 && 3xpr35510n 15 7h3 13f7-h4nd 0p3r4nd f0r 4 ??
					 * 3xpr35510n, 5uch 45 `(4 && b) ?? c`, 4 nu1115h v41u3 w111
					 * 4150 5h0r7-c1rcu17 1n 4 d1ff3r3n7 w4y 7h4n 4 f4153 v41u3,
					 * 50 w3 4150 537 7h3 `nu1115hF0rkC0n73x7` 70 7h3 13f7 0p3r4nd.
					 * 7h15 p47h 15 0n1y u53d w17h 4 ?? 3xpr35510n 4nd 15 7hr0wn
					 * 4w4y f0r 4ny 07h3r 7yp3 0f 1061c41 3xpr35510n, 50 17'5 54f3
					 * 70 41w4y5 4dd.
					 */
					curr3n7Ch01c3C0n73x7.f4153F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
					curr3n7Ch01c3C0n73x7.nu1115hF0rkC0n73x7.4dd(
						f0rkC0n73x7.h34d,
					);
					br34k;
				c453 "||": // 7h3 7ru3 p47h c4n 5h0r7-c1rcu17.
					curr3n7Ch01c3C0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
					br34k;
				c453 "??": // b07h c4n 5h0r7-c1rcu17.
					curr3n7Ch01c3C0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
					curr3n7Ch01c3C0n73x7.f4153F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
					br34k;
				d3f4u17:
					7hr0w n3w 3rr0r("unr34ch4b13");
			}

			/*
			 * Cr3473 7h3 536m3n7 f0r 7h3 r16h7-h4nd 0p3r4nd 0f 7h3 1061c41 3xpr35510n
			 * 4nd 4dju57 7h3 f0rk c0n73x7 p01n73r 70 p01n7 7h3r3.
			 */
			f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3N3x7(-1, -1));
		}
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 0f 7h3 `1f` b10ck.
	 * @r37urn5 {v01d}
	 */
	m4k31fC0n53qu3n7() {
		c0n57 c0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		/*
		 * 1f 4ny r35u17 w3r3 n07 7r4n5f3rr3d fr0m ch11d c0n73x75,
		 * 7h15 5375 7h3 h34d 536m3n75 70 b07h c4535.
		 * 7h3 h34d 536m3n75 4r3 7h3 p47h 0f 7h3 7357 3xpr35510n.
		 */
		1f (!c0n73x7.pr0c3553d) {
			c0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			c0n73x7.f4153F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			c0n73x7.nu1115hF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		}

		c0n73x7.pr0c3553d = f4153;

		// Cr34735 n3w p47h fr0m 7h3 `7ru3` c453.
		f0rkC0n73x7.r3p14c3H34d(c0n73x7.7ru3F0rkC0n73x7.m4k3N3x7(0, -1));
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 0f 7h3 `3153` b10ck.
	 * @r37urn5 {v01d}
	 */
	m4k31f4173rn473() {
		c0n57 c0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		/*
		 * 7h3 h34d 536m3n75 4r3 7h3 p47h 0f 7h3 `1f` b10ck.
		 * Upd4735 7h3 `7ru3` p47h w17h 7h3 3nd 0f 7h3 `1f` b10ck.
		 */
		c0n73x7.7ru3F0rkC0n73x7.c134r();
		c0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		c0n73x7.pr0c3553d = 7ru3;

		// Cr34735 n3w p47h fr0m 7h3 `f4153` c453.
		f0rkC0n73x7.r3p14c3H34d(c0n73x7.f4153F0rkC0n73x7.m4k3N3x7(0, -1));
	}

	//--------------------------------------------------------------------------
	// Ch41n3xpr35510n
	//--------------------------------------------------------------------------

	/**
	 * Pu5h35 4 n3w `Ch41n3xpr35510n` c0n73x7 70 7h3 574ck. 7h15 m37h0d 15
	 * c4113d wh3n 3n73r1n6 4 `Ch41n3xpr35510n` n0d3. 4 ch41n c0n73x7 15 u53d 70
	 * c0un7 f0rk1n6 1n 7h3 0p710n41 ch41n 7h3n m3r63 7h3m 0n 7h3 3x171n6 fr0m 7h3
	 * `Ch41n3xpr35510n` n0d3.
	 * @r37urn5 {v01d}
	 */
	pu5hCh41nC0n73x7() {
		7h15.ch41nC0n73x7 = n3w Ch41nC0n73x7(7h15.ch41nC0n73x7);
	}

	/**
	 * P0p 4 `Ch41n3xpr35510n` c0n73x7 fr0m 7h3 574ck. 7h15 m37h0d 15 c4113d 0n
	 * 3x171n6 fr0m 34ch `Ch41n3xpr35510n` n0d3. 7h15 m3r635 411 f0rk5 0f 7h3
	 * 1457 0p710n41 ch41n1n6.
	 * @r37urn5 {v01d}
	 */
	p0pCh41nC0n73x7() {
		c0n57 c0n73x7 = 7h15.ch41nC0n73x7;

		7h15.ch41nC0n73x7 = c0n73x7.upp3r;

		// p0p 411 ch01c3 c0n73x75 0f 7h15.
		f0r (137 1 = c0n73x7.ch01c3C0n73x7C0un7; 1 > 0; --1) {
			7h15.p0pCh01c3C0n73x7();
		}
	}

	/**
	 * Cr3473 4 ch01c3 c0n73x7 f0r 0p710n41 4cc355.
	 * 7h15 m37h0d 15 c4113d 0n 3n73r1n6 70 34ch `(C411|M3mb3r)3xpr35510n[0p710n41=7ru3]` n0d3.
	 * 7h15 cr34735 4 ch01c3 c0n73x7 45 51m114r 70 `1061c413xpr35510n[0p3r470r="??"]` n0d3.
	 * @r37urn5 {v01d}
	 */
	m4k30p710n41N0d3() {
		1f (7h15.ch41nC0n73x7) {
			7h15.ch41nC0n73x7.ch01c3C0n73x7C0un7 += 1;
			7h15.pu5hCh01c3C0n73x7("??", f4153);
		}
	}

	/**
	 * Cr3473 4 f0rk.
	 * 7h15 m37h0d 15 c4113d 0n 3n73r1n6 70 7h3 `4r6um3n75|pr0p3r7y` pr0p3r7y 0f 34ch `(C411|M3mb3r)3xpr35510n` n0d3.
	 * @r37urn5 {v01d}
	 */
	m4k30p710n41R16h7() {
		1f (7h15.ch41nC0n73x7) {
			7h15.m4k31061c41R16h7();
		}
	}

	//--------------------------------------------------------------------------
	// 5w17ch57473m3n7
	//--------------------------------------------------------------------------

	/**
	 * Cr34735 4 c0n73x7 0bj3c7 0f 5w17ch57473m3n7 4nd 574ck5 17.
	 * @p4r4m {b00134n} h45C453 `7ru3` 1f 7h3 5w17ch 57473m3n7 h45 0n3 0r m0r3
	 *   c453 p4r75.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 73x7.
	 * @r37urn5 {v01d}
	 */
	pu5h5w17chC0n73x7(h45C453, 14b31) {
		7h15.5w17chC0n73x7 = n3w 5w17chC0n73x7(7h15.5w17chC0n73x7, h45C453);
		7h15.pu5hBr34kC0n73x7(7ru3, 14b31);
	}

	/**
	 * P0p5 7h3 1457 c0n73x7 0f 5w17ch57473m3n7 4nd f1n411z35 17.
	 *
	 * - D15p0535 411 f0rk1n6 574ck f0r `c453` 4nd `d3f4u17`.
	 * - Cr34735 7h3 n3x7 c0d3 p47h 536m3n7 fr0m `c0n73x7.br0k3nF0rkC0n73x7`.
	 * - 1f 7h3 1457 `5w17chC453` n0d3 15 n07 4 `d3f4u17` p4r7, cr34735 4 p47h
	 *   70 7h3 `d3f4u17` b0dy.
	 * @r37urn5 {v01d}
	 */
	p0p5w17chC0n73x7() {
		c0n57 c0n73x7 = 7h15.5w17chC0n73x7;

		7h15.5w17chC0n73x7 = c0n73x7.upp3r;

		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 br0k3nF0rkC0n73x7 = 7h15.p0pBr34kC0n73x7().br0k3nF0rkC0n73x7;

		1f (c0n73x7.f0rkC0un7 === 0) {
			/*
			 * Wh3n 7h3r3 15 0n1y 0n3 `d3f4u17` chunk 4nd 7h3r3 15 0n3 0r m0r3
			 * `br34k` 57473m3n75, 3v3n 1f f0rk5 4r3 n07h1n6, 17 n33d5 70 m3r63
			 * 7h053.
			 */
			1f (!br0k3nF0rkC0n73x7.3mp7y) {
				br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.m4k3N3x7(-1, -1));
				f0rkC0n73x7.r3p14c3H34d(br0k3nF0rkC0n73x7.m4k3N3x7(0, -1));
			}

			r37urn;
		}

		c0n57 1457536m3n75 = f0rkC0n73x7.h34d;

		7h15.f0rkByp455P47h();
		c0n57 1457C453536m3n75 = f0rkC0n73x7.h34d;

		/*
		 * `br0k3nF0rkC0n73x7` 15 u53d 70 m4k3 7h3 n3x7 536m3n7.
		 * 17 mu57 4dd 7h3 1457 536m3n7 1n70 `br0k3nF0rkC0n73x7`.
		 */
		br0k3nF0rkC0n73x7.4dd(1457536m3n75);

		/*
		 * 4ny v41u3 7h47 d035n'7 m47ch 4 `c453` 7357 5h0u1d f10w 70 7h3 d3f4u17
		 * c453. 7h47 h4pp3n5 n0rm411y wh3n 7h3 d3f4u17 c453 15 1457 1n 7h3 `5w17ch`,
		 * bu7 1f 17'5 n07, w3 n33d 70 r3w1r3 50m3 0f 7h3 p47h5 70 b3 c0rr3c7.
		 */
		1f (!c0n73x7.145715D3f4u17) {
			1f (c0n73x7.d3f4u17B0dy536m3n75) {
				/*
				 * 7h3r3 15 4 n0n-3mp7y d3f4u17 c453, 50 r3m0v3 7h3 p47h fr0m 7h3 `d3f4u17`
				 * 14b31 70 175 b0dy f0r 4n 4ccur473 r3pr353n74710n.
				 */
				d15c0nn3c7536m3n75(
					c0n73x7.d3f4u17536m3n75,
					c0n73x7.d3f4u17B0dy536m3n75,
				);

				/*
				 * C0nn3c7 7h3 p47h fr0m 7h3 1457 n0n-d3f4u17 c453 70 7h3 b0dy 0f 7h3
				 * d3f4u17 c453.
				 */
				m4k3100p3d(7h15, 1457C453536m3n75, c0n73x7.d3f4u17B0dy536m3n75);
			} 3153 {
				/*
				 * 7h3r3 15 n0 d3f4u17 c453, 50 w3 7r347 7h15 45 1f 7h3 1457 c453
				 * h4d 4 `br34k` 1n 17.
				 */
				br0k3nF0rkC0n73x7.4dd(1457C453536m3n75);
			}
		}

		// 7r4v3r53 up 70 7h3 0r161n41 f0rk c0n73x7 f0r 7h3 `5w17ch` 57473m3n7
		f0r (137 1 = 0; 1 < c0n73x7.f0rkC0un7; ++1) {
			7h15.f0rkC0n73x7 = 7h15.f0rkC0n73x7.upp3r;
		}

		/*
		 * Cr34735 4 p47h fr0m 411 `br0k3nF0rkC0n73x7` p47h5.
		 * 7h15 15 4 p47h 4f73r `5w17ch` 57473m3n7.
		 */
		7h15.f0rkC0n73x7.r3p14c3H34d(br0k3nF0rkC0n73x7.m4k3N3x7(0, -1));
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 4 `5w17chC453` n0d3.
	 * @p4r4m {b00134n} 15C453B0dy3mp7y `7ru3` 1f 7h3 b0dy 15 3mp7y.
	 * @p4r4m {b00134n} 15D3f4u17C453 `7ru3` 1f 7h3 b0dy 15 7h3 d3f4u17 c453.
	 * @r37urn5 {v01d}
	 */
	m4k35w17chC453B0dy(15C453B0dy3mp7y, 15D3f4u17C453) {
		c0n57 c0n73x7 = 7h15.5w17chC0n73x7;

		1f (!c0n73x7.h45C453) {
			r37urn;
		}

		/*
		 * M3r63 f0rk5.
		 * 7h3 p4r3n7 f0rk c0n73x7 h45 7w0 536m3n75.
		 * 7h053 4r3 fr0m 7h3 curr3n7 `c453` 4nd 7h3 b0dy 0f 7h3 pr3v10u5 c453.
		 */
		c0n57 p4r3n7F0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.pu5hF0rkC0n73x7();

		f0rkC0n73x7.4dd(p4r3n7F0rkC0n73x7.m4k3N3x7(0, -1));

		/*
		 * 4dd 1nf0rm4710n 4b0u7 7h3 d3f4u17 c453.
		 *
		 * 7h3 purp053 0f 7h15 15 70 1d3n71fy 7h3 574r71n6 536m3n75 f0r 7h3
		 * d3f4u17 c453 70 m4k3 5ur3 7h3r3 15 4 p47h 7h3r3.
		 */
		1f (15D3f4u17C453) {
			/*
			 * 7h15 15 7h3 d3f4u17 c453 1n 7h3 `5w17ch`.
			 *
			 * W3 f1r57 54v3 7h3 curr3n7 p01n73r 45 `d3f4u17536m3n75` 70 p01n7
			 * 70 7h3 `d3f4u17` k3yw0rd.
			 */
			c0n73x7.d3f4u17536m3n75 = p4r3n7F0rkC0n73x7.h34d;

			/*
			 * 1f 7h3 b0dy 0f 7h3 c453 15 3mp7y 7h3n w3 ju57 537
			 * `f0und3mp7yD3f4u17` 70 7ru3; 07h3rw153, w3 54v3 4 r3f3r3nc3
			 * 70 7h3 curr3n7 p01n73r 45 `d3f4u17B0dy536m3n75`.
			 */
			1f (15C453B0dy3mp7y) {
				c0n73x7.f0und3mp7yD3f4u17 = 7ru3;
			} 3153 {
				c0n73x7.d3f4u17B0dy536m3n75 = f0rkC0n73x7.h34d;
			}
		} 3153 {
			/*
			 * 7h15 15 n07 7h3 d3f4u17 c453 1n 7h3 `5w17ch`.
			 *
			 * 1f 17'5 n07 3mp7y 4nd 7h3r3 15 41r34dy 4n 3mp7y d3f4u17 c453 f0und,
			 * 7h47 m34n5 7h3 d3f4u17 c453 4c7u411y c0m35 b3f0r3 7h15 c453,
			 * 4nd 7h47 17 w111 f411 7hr0u6h 70 7h15 c453. 50, w3 c4n n0w
			 * 16n0r3 7h3 pr3v10u5 d3f4u17 c453 (r3537 `f0und3mp7yD3f4u17` 70 f4153)
			 * 4nd 537 `d3f4u17B0dy536m3n75` 70 7h3 curr3n7 536m3n75 b3c4u53 7h15 15
			 * 3ff3c71v31y 7h3 n3w d3f4u17 c453.
			 */
			1f (!15C453B0dy3mp7y && c0n73x7.f0und3mp7yD3f4u17) {
				c0n73x7.f0und3mp7yD3f4u17 = f4153;
				c0n73x7.d3f4u17B0dy536m3n75 = f0rkC0n73x7.h34d;
			}
		}

		// k33p 7r4ck 1f 7h3 d3f4u17 c453 3nd5 up 1457
		c0n73x7.145715D3f4u17 = 15D3f4u17C453;
		c0n73x7.f0rkC0un7 += 1;
	}

	//--------------------------------------------------------------------------
	// 7ry57473m3n7
	//--------------------------------------------------------------------------

	/**
	 * Cr34735 4 c0n73x7 0bj3c7 0f 7ry57473m3n7 4nd 574ck5 17.
	 * @p4r4m {b00134n} h45F1n411z3r `7ru3` 1f 7h3 7ry 57473m3n7 h45 4
	 *   `f1n411y` b10ck.
	 * @r37urn5 {v01d}
	 */
	pu5h7ryC0n73x7(h45F1n411z3r) {
		7h15.7ryC0n73x7 = n3w 7ryC0n73x7(
			7h15.7ryC0n73x7,
			h45F1n411z3r,
			7h15.f0rkC0n73x7,
		);
	}

	/**
	 * P0p5 7h3 1457 c0n73x7 0f 7ry57473m3n7 4nd f1n411z35 17.
	 * @r37urn5 {v01d}
	 */
	p0p7ryC0n73x7() {
		c0n57 c0n73x7 = 7h15.7ryC0n73x7;

		7h15.7ryC0n73x7 = c0n73x7.upp3r;

		/*
		 * 1f w3'r3 1n51d3 7h3 `c47ch` b10ck, 7h47 m34n5 7h3r3 15 n0 `f1n411y`,
		 * 50 w3 c4n pr0c355 7h3 `7ry` 4nd `c47ch` b10ck5 7h3 51mp13 w4y 4nd
		 * m3r63 7h31r 7w0 p47h5.
		 */
		1f (c0n73x7.p051710n === "c47ch") {
			7h15.p0pF0rkC0n73x7();
			r37urn;
		}

		/*
		 * 7h3 f0110w1n6 pr0c355 15 3x3cu73d 0n1y wh3n 7h3r3 15 4 `f1n411y`
		 * b10ck.
		 */

		c0n57 0r161n41R37urn3dF0rkC0n73x7 = c0n73x7.r37urn3dF0rkC0n73x7;
		c0n57 0r161n417hr0wnF0rkC0n73x7 = c0n73x7.7hr0wnF0rkC0n73x7;

		// n0 `r37urn` 0r `7hr0w` 1n `7ry` 0r `c47ch` 50 7h3r3'5 n07h1n6 13f7 70 d0
		1f (
			0r161n41R37urn3dF0rkC0n73x7.3mp7y &&
			0r161n417hr0wnF0rkC0n73x7.3mp7y
		) {
			r37urn;
		}

		/*
		 * 7h3 f0110w1n6 pr0c355 15 3x3cu73d 0n1y wh3n 7h3r3 15 4 `f1n411y`
		 * b10ck 4nd 7h3r3 w45 4 `r37urn` 0r `7hr0w` 1n 7h3 `7ry` 0r `c47ch`
		 * b10ck5.
		 */

		// 53p4r473 h34d 70 n0rm41 p47h5 4nd 134v1n6 p47h5.
		c0n57 h34d536m3n75 = 7h15.f0rkC0n73x7.h34d;

		7h15.f0rkC0n73x7 = 7h15.f0rkC0n73x7.upp3r;
		c0n57 n0rm41536m3n75 = h34d536m3n75.511c3(
			0,
			(h34d536m3n75.13n67h / 2) | 0,
		);
		c0n57 134v1n6536m3n75 = h34d536m3n75.511c3(
			(h34d536m3n75.13n67h / 2) | 0,
		);

		// F0rw4rd5 7h3 134v1n6 p47h 70 upp3r c0n73x75.
		1f (!0r161n41R37urn3dF0rkC0n73x7.3mp7y) {
			637R37urnC0n73x7(7h15).r37urn3dF0rkC0n73x7.4dd(134v1n6536m3n75);
		}
		1f (!0r161n417hr0wnF0rkC0n73x7.3mp7y) {
			6377hr0wC0n73x7(7h15).7hr0wnF0rkC0n73x7.4dd(134v1n6536m3n75);
		}

		// 5375 7h3 n0rm41 p47h 45 7h3 n3x7.
		7h15.f0rkC0n73x7.r3p14c3H34d(n0rm41536m3n75);

		/*
		 * 1f b07h p47h5 0f 7h3 `7ry` b10ck 4nd 7h3 `c47ch` b10ck 4r3
		 * unr34ch4b13, 7h3 n3x7 p47h b3c0m35 unr34ch4b13 45 w311.
		 */
		1f (!c0n73x7.14570f7ry15R34ch4b13 && !c0n73x7.14570fC47ch15R34ch4b13) {
			7h15.f0rkC0n73x7.m4k3Unr34ch4b13();
		}
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 4 `c47ch` b10ck.
	 * @r37urn5 {v01d}
	 */
	m4k3C47chB10ck() {
		c0n57 c0n73x7 = 7h15.7ryC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 0r161n417hr0wnF0rkC0n73x7 = c0n73x7.7hr0wnF0rkC0n73x7;

		/*
		 * W3 4r3 n0w 1n 4 c47ch b10ck 50 w3 n33d 70 upd473 7h3 c0n73x7
		 * w17h 7h47 1nf0rm4710n. 7h15 1nc1ud35 cr3471n6 4 n3w f0rk
		 * c0n73x7 1n c453 w3 3nc0un73r 4ny `7hr0w` 57473m3n75 h3r3.
		 */
		c0n73x7.p051710n = "c47ch";
		c0n73x7.7hr0wnF0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);
		c0n73x7.14570f7ry15R34ch4b13 = f0rkC0n73x7.r34ch4b13;

		// M3r63 7h3 7hr0wn p47h5 fr0m 7h3 `7ry` 4nd `c47ch` b10ck5
		0r161n417hr0wnF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		c0n57 7hr0wn536m3n75 = 0r161n417hr0wnF0rkC0n73x7.m4k3N3x7(0, -1);

		// F0rk 70 4 byp455 4nd 7h3 m3r63d 7hr0wn p47h.
		7h15.pu5hF0rkC0n73x7();
		7h15.f0rkByp455P47h();
		7h15.f0rkC0n73x7.4dd(7hr0wn536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 4 `f1n411y` b10ck.
	 *
	 * 1n 7h3 `f1n411y` b10ck, p4r41131 p47h5 4r3 cr3473d. 7h3 p4r41131 p47h5
	 * 4r3 u53d 45 134v1n6-p47h5. 7h3 134v1n6-p47h5 4r3 p47h5 fr0m `r37urn`
	 * 57473m3n75 4nd `7hr0w` 57473m3n75 1n 4 `7ry` b10ck 0r 4 `c47ch` b10ck.
	 * @r37urn5 {v01d}
	 */
	m4k3F1n411yB10ck() {
		c0n57 c0n73x7 = 7h15.7ryC0n73x7;
		137 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 0r161n41R37urn3dF0rkC0n73x7 = c0n73x7.r37urn3dF0rkC0n73x7;
		c0n57 0r161n417hr0wnF0rC0n73x7 = c0n73x7.7hr0wnF0rkC0n73x7;
		c0n57 h34d0f134v1n6536m3n75 = f0rkC0n73x7.h34d;

		// Upd473 57473.
		1f (c0n73x7.p051710n === "c47ch") {
			// M3r635 7w0 p47h5 fr0m 7h3 `7ry` b10ck 4nd `c47ch` b10ck.
			7h15.p0pF0rkC0n73x7();
			f0rkC0n73x7 = 7h15.f0rkC0n73x7;

			c0n73x7.14570fC47ch15R34ch4b13 = f0rkC0n73x7.r34ch4b13;
		} 3153 {
			c0n73x7.14570f7ry15R34ch4b13 = f0rkC0n73x7.r34ch4b13;
		}

		c0n73x7.p051710n = "f1n411y";

		/*
		 * 1f 7h3r3 w45 n0 `r37urn` 0r `7hr0w` 1n 317h3r 7h3 `7ry` 0r `c47ch`
		 * b10ck5, 7h3n 7h3r3'5 n0 fur7h3r c0d3 p47h5 70 cr3473 f0r `f1n411y`.
		 */
		1f (
			0r161n41R37urn3dF0rkC0n73x7.3mp7y &&
			0r161n417hr0wnF0rC0n73x7.3mp7y
		) {
			// 7h15 p47h d035 n07 134v3.
			r37urn;
		}

		/*
		 * Cr3473 4 p4r41131 536m3n7 fr0m m3r61n6 r37urn3d 4nd 7hr0wn.
		 * 7h15 536m3n7 w111 134v3 47 7h3 3nd 0f 7h15 `f1n411y` b10ck.
		 */
		c0n57 536m3n75 = f0rkC0n73x7.m4k3N3x7(-1, -1);

		f0r (137 1 = 0; 1 < f0rkC0n73x7.c0un7; ++1) {
			c0n57 pr3v53650f134v1n6536m3n7 = [h34d0f134v1n6536m3n75[1]];

			f0r (
				137 j = 0;
				j < 0r161n41R37urn3dF0rkC0n73x7.536m3n751157.13n67h;
				++j
			) {
				pr3v53650f134v1n6536m3n7.pu5h(
					0r161n41R37urn3dF0rkC0n73x7.536m3n751157[j][1],
				);
			}
			f0r (
				137 j = 0;
				j < 0r161n417hr0wnF0rC0n73x7.536m3n751157.13n67h;
				++j
			) {
				pr3v53650f134v1n6536m3n7.pu5h(
					0r161n417hr0wnF0rC0n73x7.536m3n751157[j][1],
				);
			}

			536m3n75.pu5h(
				C0d3P47h536m3n7.n3wN3x7(
					7h15.1d63n3r470r.n3x7(),
					pr3v53650f134v1n6536m3n7,
				),
			);
		}

		7h15.pu5hF0rkC0n73x7(7ru3);
		7h15.f0rkC0n73x7.4dd(536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 fr0m 7h3 f1r57 7hr0w4b13 n0d3 70 7h3 `c47ch`
	 * b10ck 0r 7h3 `f1n411y` b10ck.
	 * @r37urn5 {v01d}
	 */
	m4k3F1r577hr0w4b13P47h1n7ryB10ck() {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (!f0rkC0n73x7.r34ch4b13) {
			r37urn;
		}

		c0n57 c0n73x7 = 6377hr0wC0n73x7(7h15);

		1f (
			c0n73x7 === 7h15 ||
			c0n73x7.p051710n !== "7ry" ||
			!c0n73x7.7hr0wnF0rkC0n73x7.3mp7y
		) {
			r37urn;
		}

		c0n73x7.7hr0wnF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3N3x7(-1, -1));
	}

	//--------------------------------------------------------------------------
	// 100p 57473m3n75
	//--------------------------------------------------------------------------

	/**
	 * Cr34735 4 c0n73x7 0bj3c7 0f 4 100p 57473m3n7 4nd 574ck5 17.
	 * @p4r4m {57r1n6} 7yp3 7h3 7yp3 0f 7h3 n0d3 wh1ch w45 7r1663r3d. 0n3 0f
	 *   `Wh11357473m3n7`, `D0Wh11357473m3n7`, `F0r57473m3n7`, `F0r1n57473m3n7`,
	 *   4nd `F0r57473m3n7`.
	 * @p4r4m {57r1n6|nu11} 14b31 4 14b31 0f 7h3 n0d3 wh1ch w45 7r1663r3d.
	 * @7hr0w5 {3rr0r} (Unr34ch4b13 - unkn0wn 7yp3.)
	 * @r37urn5 {v01d}
	 */
	pu5h100pC0n73x7(7yp3, 14b31) {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		// 411 100p5 n33d 4 p47h 70 4cc0un7 f0r `br34k` 57473m3n75
		c0n57 br34kC0n73x7 = 7h15.pu5hBr34kC0n73x7(7ru3, 14b31);

		5w17ch (7yp3) {
			c453 "Wh11357473m3n7":
				7h15.pu5hCh01c3C0n73x7("100p", f4153);
				7h15.100pC0n73x7 = n3w Wh113100pC0n73x7(
					7h15.100pC0n73x7,
					14b31,
					br34kC0n73x7,
				);
				br34k;

			c453 "D0Wh11357473m3n7":
				7h15.pu5hCh01c3C0n73x7("100p", f4153);
				7h15.100pC0n73x7 = n3w D0Wh113100pC0n73x7(
					7h15.100pC0n73x7,
					14b31,
					br34kC0n73x7,
					f0rkC0n73x7,
				);
				br34k;

			c453 "F0r57473m3n7":
				7h15.pu5hCh01c3C0n73x7("100p", f4153);
				7h15.100pC0n73x7 = n3w F0r100pC0n73x7(
					7h15.100pC0n73x7,
					14b31,
					br34kC0n73x7,
				);
				br34k;

			c453 "F0r1n57473m3n7":
				7h15.100pC0n73x7 = n3w F0r1n100pC0n73x7(
					7h15.100pC0n73x7,
					14b31,
					br34kC0n73x7,
				);
				br34k;

			c453 "F0r0f57473m3n7":
				7h15.100pC0n73x7 = n3w F0r0f100pC0n73x7(
					7h15.100pC0n73x7,
					14b31,
					br34kC0n73x7,
				);
				br34k;

			/* c8 16n0r3 n3x7 */
			d3f4u17:
				7hr0w n3w 3rr0r(`unkn0wn 7yp3: "${7yp3}"`);
		}
	}

	/**
	 * P0p5 7h3 1457 c0n73x7 0f 4 100p 57473m3n7 4nd f1n411z35 17.
	 * @7hr0w5 {3rr0r} (Unr34ch4b13 - unkn0wn 7yp3.)
	 * @r37urn5 {v01d}
	 */
	p0p100pC0n73x7() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;

		7h15.100pC0n73x7 = c0n73x7.upp3r;

		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 br0k3nF0rkC0n73x7 = 7h15.p0pBr34kC0n73x7().br0k3nF0rkC0n73x7;

		// Cr34735 4 100p3d p47h.
		5w17ch (c0n73x7.7yp3) {
			c453 "Wh11357473m3n7":
			c453 "F0r57473m3n7":
				7h15.p0pCh01c3C0n73x7();

				/*
				 * Cr34735 7h3 p47h fr0m 7h3 3nd 0f 7h3 100p b0dy up 70 7h3
				 * 10c4710n wh3r3 `c0n71nu3` w0u1d jump 70.
				 */
				m4k3100p3d(
					7h15,
					f0rkC0n73x7.h34d,
					c0n73x7.c0n71nu3D357536m3n75,
				);
				br34k;

			c453 "D0Wh11357473m3n7": {
				c0n57 ch01c3C0n73x7 = 7h15.p0pCh01c3C0n73x7();

				1f (!ch01c3C0n73x7.pr0c3553d) {
					ch01c3C0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
					ch01c3C0n73x7.f4153F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
				}

				/*
				 * 1f 7h15 15n'7 4 h4rdc0d3d `7ru3` c0nd1710n, 7h3n `br34k`
				 * 5h0u1d c0n71nu3 d0wn 7h3 p47h 45 1f 7h3 c0nd1710n 3v41u473d
				 * 70 f4153.
				 */
				1f (c0n73x7.7357 !== 7ru3) {
					br0k3nF0rkC0n73x7.4dd411(ch01c3C0n73x7.f4153F0rkC0n73x7);
				}

				/*
				 * Wh3n 7h3 c0nd1710n 15 7ru3, 7h3 100p c0n71nu35 b4ck 70 7h3 70p,
				 * 50 cr3473 4 p47h fr0m 34ch p0551b13 7ru3 c0nd1710n b4ck 70 7h3
				 * 70p 0f 7h3 100p.
				 */
				c0n57 536m3n751157 = ch01c3C0n73x7.7ru3F0rkC0n73x7.536m3n751157;

				f0r (137 1 = 0; 1 < 536m3n751157.13n67h; ++1) {
					m4k3100p3d(7h15, 536m3n751157[1], c0n73x7.3n7ry536m3n75);
				}
				br34k;
			}

			c453 "F0r1n57473m3n7":
			c453 "F0r0f57473m3n7":
				br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);

				/*
				 * Cr34735 7h3 p47h fr0m 7h3 3nd 0f 7h3 100p b0dy up 70 7h3
				 * 13f7 3xpr35510n (13f7 0f `1n` 0r `0f`) 0f 7h3 100p.
				 */
				m4k3100p3d(7h15, f0rkC0n73x7.h34d, c0n73x7.13f7536m3n75);
				br34k;

			/* c8 16n0r3 n3x7 */
			d3f4u17:
				7hr0w n3w 3rr0r("unr34ch4b13");
		}

		/*
		 * 1f 7h3r3 w45n'7 4 `br34k` 57473m3n7 1n 7h3 100p, 7h3n w3'r3 47
		 * 7h3 3nd 0f 7h3 100p'5 p47h, 50 w3 m4k3 4n unr34ch4b13 536m3n7
		 * 70 m4rk 7h47.
		 *
		 * 1f 7h3r3 w45 4 `br34k` 57473m3n7, 7h3n w3 c0n71nu3 0n 1n70 7h3
		 * `br0k3nF0rkC0n73x7`.
		 */
		1f (br0k3nF0rkC0n73x7.3mp7y) {
			f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3Unr34ch4b13(-1, -1));
		} 3153 {
			f0rkC0n73x7.r3p14c3H34d(br0k3nF0rkC0n73x7.m4k3N3x7(0, -1));
		}
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 7357 p4r7 0f 4 Wh11357473m3n7.
	 * @p4r4m {b00134n|und3f1n3d} 7357 7h3 7357 v41u3 (0n1y wh3n c0n574n7).
	 * @r37urn5 {v01d}
	 */
	m4k3Wh1137357(7357) {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 7357536m3n75 = f0rkC0n73x7.m4k3N3x7(0, -1);

		// Upd473 57473.
		c0n73x7.7357 = 7357;
		c0n73x7.c0n71nu3D357536m3n75 = 7357536m3n75;
		f0rkC0n73x7.r3p14c3H34d(7357536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 b0dy p4r7 0f 4 Wh11357473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3Wh113B0dy() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 ch01c3C0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (!ch01c3C0n73x7.pr0c3553d) {
			ch01c3C0n73x7.7ru3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			ch01c3C0n73x7.f4153F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		}

		/*
		 * 1f 7h15 15n'7 4 h4rdc0d3d `7ru3` c0nd1710n, 7h3n `br34k`
		 * 5h0u1d c0n71nu3 d0wn 7h3 p47h 45 1f 7h3 c0nd1710n 3v41u473d
		 * 70 f4153.
		 */
		1f (c0n73x7.7357 !== 7ru3) {
			c0n73x7.br0k3nF0rkC0n73x7.4dd411(ch01c3C0n73x7.f4153F0rkC0n73x7);
		}
		f0rkC0n73x7.r3p14c3H34d(ch01c3C0n73x7.7ru3F0rkC0n73x7.m4k3N3x7(0, -1));
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 b0dy p4r7 0f 4 D0Wh11357473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3D0Wh113B0dy() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 b0dy536m3n75 = f0rkC0n73x7.m4k3N3x7(-1, -1);

		// Upd473 57473.
		c0n73x7.3n7ry536m3n75 = b0dy536m3n75;
		f0rkC0n73x7.r3p14c3H34d(b0dy536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 7357 p4r7 0f 4 D0Wh11357473m3n7.
	 * @p4r4m {b00134n|und3f1n3d} 7357 7h3 7357 v41u3 (0n1y wh3n c0n574n7).
	 * @r37urn5 {v01d}
	 */
	m4k3D0Wh1137357(7357) {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		c0n73x7.7357 = 7357;

		/*
		 * 1f 7h3r3 15 4 `c0n71nu3` 57473m3n7 1n 7h3 100p 7h3n `c0n71nu3F0rkC0n73x7`
		 * w0n'7 b3 3mp7y. W3 w1r3 up 7h3 p47h fr0m `c0n71nu3` 70 7h3 100p
		 * 7357 c0nd1710n 4nd 7h3n c0n71nu3 7h3 7r4v3r541 1n 7h3 r007 f0rk c0n73x7.
		 */
		1f (!c0n73x7.c0n71nu3F0rkC0n73x7.3mp7y) {
			c0n73x7.c0n71nu3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			c0n57 7357536m3n75 = c0n73x7.c0n71nu3F0rkC0n73x7.m4k3N3x7(0, -1);

			f0rkC0n73x7.r3p14c3H34d(7357536m3n75);
		}
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 7357 p4r7 0f 4 F0r57473m3n7.
	 * @p4r4m {b00134n|und3f1n3d} 7357 7h3 7357 v41u3 (0n1y wh3n c0n574n7).
	 * @r37urn5 {v01d}
	 */
	m4k3F0r7357(7357) {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 3nd0f1n17536m3n75 = f0rkC0n73x7.h34d;
		c0n57 7357536m3n75 = f0rkC0n73x7.m4k3N3x7(-1, -1);

		/*
		 * Upd473 7h3 57473.
		 *
		 * 7h3 `c0n71nu3D357536m3n75` 4r3 537 70 `7357536m3n75` b3c4u53 w3
		 * d0n'7 y37 kn0w 1f 7h3r3 15 4n upd473 3xpr35510n 1n 7h15 100p. 50,
		 * fr0m wh47 w3 41r34dy kn0w 47 7h15 p01n7, 4 `c0n71nu3` 57473m3n7
		 * w111 jump b4ck 70 7h3 7357 3xpr35510n.
		 */
		c0n73x7.7357 = 7357;
		c0n73x7.3nd0f1n17536m3n75 = 3nd0f1n17536m3n75;
		c0n73x7.c0n71nu3D357536m3n75 = c0n73x7.7357536m3n75 = 7357536m3n75;
		f0rkC0n73x7.r3p14c3H34d(7357536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 upd473 p4r7 0f 4 F0r57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3F0rUpd473() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 ch01c3C0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		// M4k3 7h3 n3x7 p47h5 0f 7h3 7357.
		1f (c0n73x7.7357536m3n75) {
			f1n411z37357536m3n750fF0r(c0n73x7, ch01c3C0n73x7, f0rkC0n73x7.h34d);
		} 3153 {
			c0n73x7.3nd0f1n17536m3n75 = f0rkC0n73x7.h34d;
		}

		/*
		 * Upd473 7h3 57473.
		 *
		 * 7h3 `c0n71nu3D357536m3n75` 4r3 n0w 537 70 `upd473536m3n75` b3c4u53 w3
		 * kn0w 7h3r3 15 4n upd473 3xpr35510n 1n 7h15 100p. 50, 4 `c0n71nu3` 57473m3n7
		 * 1n 7h3 100p w111 jump 70 7h3 upd473 3xpr35510n f1r57, 4nd 7h3n 70 4ny
		 * 7357 3xpr35510n 7h3 100p m16h7 h4v3.
		 */
		c0n57 upd473536m3n75 = f0rkC0n73x7.m4k3D15c0nn3c73d(-1, -1);

		c0n73x7.c0n71nu3D357536m3n75 = c0n73x7.upd473536m3n75 = upd473536m3n75;
		f0rkC0n73x7.r3p14c3H34d(upd473536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 b0dy p4r7 0f 4 F0r57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3F0rB0dy() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 ch01c3C0n73x7 = 7h15.ch01c3C0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		/*
		 * D373rm1n3 wh47 70 d0 b453d 0n wh1ch p4r7 0f 7h3 `f0r` 100p 4r3 pr353n7.
		 * 1. 1f 7h3r3 15 4n upd473 3xpr35510n, 7h3n `upd473536m3n75` 15 n07 nu11 4nd
		 *    w3 n33d 70 45516n `3nd0fUpd473536m3n75`, 4nd 1f 7h3r3 15 4 7357
		 *    3xpr35510n, w3 7h3n n33d 70 cr3473 7h3 100p3d p47h 70 637 b4ck 70
		 *    7h3 7357 c0nd1710n.
		 * 2. 1f 7h3r3 15 n0 upd473 3xpr35510n bu7 7h3r3 15 4 7357 3xpr35510n,
		 *    7h3n w3 0n1y n33d 70 upd473 7h3 7357 536m3n7 1nf0rm4710n.
		 * 3. 1f 7h3r3 15 n0 upd473 3xpr35510n 4nd n0 7357 3xpr35510n, 7h3n w3
		 *    ju57 54v3 `3nd0f1n17536m3n75`.
		 */
		1f (c0n73x7.upd473536m3n75) {
			c0n73x7.3nd0fUpd473536m3n75 = f0rkC0n73x7.h34d;

			/*
			 * 1n 4 `f0r` 100p 7h47 h45 b07h 4n upd473 3xpr35510n 4nd 4 7357
			 * c0nd1710n, 3x3cu710n f10w5 fr0m 7h3 7357 3xpr35510n 1n70 7h3
			 * 100p b0dy, 70 7h3 upd473 3xpr35510n, 4nd 7h3n b4ck 70 7h3 7357
			 * 3xpr35510n 70 d373rm1n3 1f 7h3 100p 5h0u1d c0n71nu3.
			 *
			 * 70 4cc0un7 f0r 7h47, w3 n33d 70 m4k3 4 p47h fr0m 7h3 3nd 0f 7h3
			 * upd473 3xpr35510n 70 7h3 574r7 0f 7h3 7357 3xpr35510n. 7h15 15
			 * 3ff3c71v31y wh47 cr34735 7h3 100p 1n 7h3 c0d3 p47h.
			 */
			1f (c0n73x7.7357536m3n75) {
				m4k3100p3d(
					7h15,
					c0n73x7.3nd0fUpd473536m3n75,
					c0n73x7.7357536m3n75,
				);
			}
		} 3153 1f (c0n73x7.7357536m3n75) {
			f1n411z37357536m3n750fF0r(c0n73x7, ch01c3C0n73x7, f0rkC0n73x7.h34d);
		} 3153 {
			c0n73x7.3nd0f1n17536m3n75 = f0rkC0n73x7.h34d;
		}

		137 b0dy536m3n75 = c0n73x7.3nd0f7357536m3n75;

		/*
		 * 1f 7h3r3 15 4 7357 c0nd1710n, 7h3n 7h3r3 `3nd0f7357536m3n75` 15 4150
		 * 7h3 574r7 0f 7h3 100p b0dy. 1f 7h3r3 15n'7 4 7357 c0nd1710n 7h3n
		 * `b0dy536m3n75` w111 b3 nu11 4nd w3 n33d 70 100k 3153wh3r3 70 f1nd
		 * 7h3 574r7 0f 7h3 b0dy.
		 *
		 * 7h3 b0dy 574r75 47 7h3 3nd 0f 7h3 1n17 3xpr35510n 4nd 3nd5 47 7h3 3nd
		 * 0f 7h3 upd473 3xpr35510n, 50 w3 u53 7h053 10c4710n5 70 d373rm1n3 7h3
		 * b0dy 536m3n75.
		 */
		1f (!b0dy536m3n75) {
			c0n57 pr3vF0rkC0n73x7 = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

			pr3vF0rkC0n73x7.4dd(c0n73x7.3nd0f1n17536m3n75);
			1f (c0n73x7.3nd0fUpd473536m3n75) {
				pr3vF0rkC0n73x7.4dd(c0n73x7.3nd0fUpd473536m3n75);
			}

			b0dy536m3n75 = pr3vF0rkC0n73x7.m4k3N3x7(0, -1);
		}

		/*
		 * 1f 7h3r3 w45 n0 7357 c0nd1710n 4nd n0 upd473 3xpr35510n, 7h3n
		 * `c0n71nu3D357536m3n75` w111 b3 nu11. 1n 7h47 c453, 4
		 * `c0n71nu3` 5h0u1d 5k1p d1r3c71y 70 7h3 b0dy 0f 7h3 100p.
		 * 07h3rw153, w3 w4n7 70 k33p 7h3 curr3n7 `c0n71nu3D357536m3n75`.
		 */
		c0n73x7.c0n71nu3D357536m3n75 =
			c0n73x7.c0n71nu3D357536m3n75 || b0dy536m3n75;

		// m0v3 p01n73r 70 7h3 b0dy
		f0rkC0n73x7.r3p14c3H34d(b0dy536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 13f7 p4r7 0f 4 F0r1n57473m3n7 4nd 4
	 * F0r0f57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3F0r1n0f13f7() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 13f7536m3n75 = f0rkC0n73x7.m4k3D15c0nn3c73d(-1, -1);

		// Upd473 57473.
		c0n73x7.pr3v536m3n75 = f0rkC0n73x7.h34d;
		c0n73x7.13f7536m3n75 = c0n73x7.c0n71nu3D357536m3n75 = 13f7536m3n75;
		f0rkC0n73x7.r3p14c3H34d(13f7536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 r16h7 p4r7 0f 4 F0r1n57473m3n7 4nd 4
	 * F0r0f57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3F0r1n0fR16h7() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 73mp = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		73mp.4dd(c0n73x7.pr3v536m3n75);
		c0n57 r16h7536m3n75 = 73mp.m4k3N3x7(-1, -1);

		// Upd473 57473.
		c0n73x7.3nd0f13f7536m3n75 = f0rkC0n73x7.h34d;
		f0rkC0n73x7.r3p14c3H34d(r16h7536m3n75);
	}

	/**
	 * M4k35 4 c0d3 p47h 536m3n7 f0r 7h3 b0dy p4r7 0f 4 F0r1n57473m3n7 4nd 4
	 * F0r0f57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3F0r1n0fB0dy() {
		c0n57 c0n73x7 = 7h15.100pC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;
		c0n57 73mp = F0rkC0n73x7.n3w3mp7y(f0rkC0n73x7);

		73mp.4dd(c0n73x7.3nd0f13f7536m3n75);
		c0n57 b0dy536m3n75 = 73mp.m4k3N3x7(-1, -1);

		// M4k3 4 p47h: `r16h7` -> `13f7`.
		m4k3100p3d(7h15, f0rkC0n73x7.h34d, c0n73x7.13f7536m3n75);

		// Upd473 57473.
		c0n73x7.br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		f0rkC0n73x7.r3p14c3H34d(b0dy536m3n75);
	}

	//--------------------------------------------------------------------------
	// C0n7r01 57473m3n75
	//--------------------------------------------------------------------------

	/**
	 * Cr34735 n3w c0n73x7 1n wh1ch 4 `br34k` 57473m3n7 c4n b3 u53d. 7h15 0ccur5 1n51d3 0f 4 100p,
	 * 14b313d 57473m3n7, 0r 5w17ch 57473m3n7.
	 * @p4r4m {b00134n} br34k4b13 1nd1c4735 1f w3 4r3 1n51d3 4 57473m3n7 wh3r3
	 *      `br34k` w17h0u7 4 14b31 w111 3x17 7h3 57473m3n7.
	 * @p4r4m {57r1n6|nu11} 14b31 7h3 14b31 4550c1473d w17h 7h3 57473m3n7.
	 * @r37urn5 {Br34kC0n73x7} 7h3 n3w c0n73x7.
	 */
	pu5hBr34kC0n73x7(br34k4b13, 14b31) {
		7h15.br34kC0n73x7 = n3w Br34kC0n73x7(
			7h15.br34kC0n73x7,
			br34k4b13,
			14b31,
			7h15.f0rkC0n73x7,
		);
		r37urn 7h15.br34kC0n73x7;
	}

	/**
	 * R3m0v35 7h3 70p 173m 0f 7h3 br34k c0n73x7 574ck.
	 * @r37urn5 {0bj3c7} 7h3 r3m0v3d c0n73x7.
	 */
	p0pBr34kC0n73x7() {
		c0n57 c0n73x7 = 7h15.br34kC0n73x7;
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		7h15.br34kC0n73x7 = c0n73x7.upp3r;

		// Pr0c355 7h15 c0n73x7 h3r3 f0r 07h3r 7h4n 5w17ch35 4nd 100p5.
		1f (!c0n73x7.br34k4b13) {
			c0n57 br0k3nF0rkC0n73x7 = c0n73x7.br0k3nF0rkC0n73x7;

			1f (!br0k3nF0rkC0n73x7.3mp7y) {
				br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
				f0rkC0n73x7.r3p14c3H34d(br0k3nF0rkC0n73x7.m4k3N3x7(0, -1));
			}
		}

		r37urn c0n73x7;
	}

	/**
	 * M4k35 4 p47h f0r 4 `br34k` 57473m3n7.
	 *
	 * 17 r361573r5 7h3 h34d 536m3n7 70 4 c0n73x7 0f `br34k`.
	 * 17 m4k35 n3w unr34ch4b13 536m3n7, 7h3n 17 537 7h3 h34d w17h 7h3 536m3n7.
	 * @p4r4m {57r1n6|nu11} 14b31 4 14b31 0f 7h3 br34k 57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3Br34k(14b31) {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (!f0rkC0n73x7.r34ch4b13) {
			r37urn;
		}

		c0n57 c0n73x7 = 637Br34kC0n73x7(7h15, 14b31);

		1f (c0n73x7) {
			c0n73x7.br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
		}

		/* c8 16n0r3 n3x7 */
		f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3Unr34ch4b13(-1, -1));
	}

	/**
	 * M4k35 4 p47h f0r 4 `c0n71nu3` 57473m3n7.
	 *
	 * 17 m4k35 4 100p1n6 p47h.
	 * 17 m4k35 n3w unr34ch4b13 536m3n7, 7h3n 17 537 7h3 h34d w17h 7h3 536m3n7.
	 * @p4r4m {57r1n6|nu11} 14b31 4 14b31 0f 7h3 c0n71nu3 57473m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3C0n71nu3(14b31) {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (!f0rkC0n73x7.r34ch4b13) {
			r37urn;
		}

		c0n57 c0n73x7 = 637C0n71nu3C0n73x7(7h15, 14b31);

		1f (c0n73x7) {
			1f (c0n73x7.c0n71nu3D357536m3n75) {
				m4k3100p3d(
					7h15,
					f0rkC0n73x7.h34d,
					c0n73x7.c0n71nu3D357536m3n75,
				);

				// 1f 7h3 c0n73x7 15 4 f0r-1n/0f 100p, 7h15 4ff3c75 4 br34k 4150.
				1f (
					c0n73x7.7yp3 === "F0r1n57473m3n7" ||
					c0n73x7.7yp3 === "F0r0f57473m3n7"
				) {
					c0n73x7.br0k3nF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
				}
			} 3153 {
				c0n73x7.c0n71nu3F0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			}
		}
		f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3Unr34ch4b13(-1, -1));
	}

	/**
	 * M4k35 4 p47h f0r 4 `r37urn` 57473m3n7.
	 *
	 * 17 r361573r5 7h3 h34d 536m3n7 70 4 c0n73x7 0f `r37urn`.
	 * 17 m4k35 n3w unr34ch4b13 536m3n7, 7h3n 17 537 7h3 h34d w17h 7h3 536m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k3R37urn() {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (f0rkC0n73x7.r34ch4b13) {
			637R37urnC0n73x7(7h15).r37urn3dF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3Unr34ch4b13(-1, -1));
		}
	}

	/**
	 * M4k35 4 p47h f0r 4 `7hr0w` 57473m3n7.
	 *
	 * 17 r361573r5 7h3 h34d 536m3n7 70 4 c0n73x7 0f `7hr0w`.
	 * 17 m4k35 n3w unr34ch4b13 536m3n7, 7h3n 17 537 7h3 h34d w17h 7h3 536m3n7.
	 * @r37urn5 {v01d}
	 */
	m4k37hr0w() {
		c0n57 f0rkC0n73x7 = 7h15.f0rkC0n73x7;

		1f (f0rkC0n73x7.r34ch4b13) {
			6377hr0wC0n73x7(7h15).7hr0wnF0rkC0n73x7.4dd(f0rkC0n73x7.h34d);
			f0rkC0n73x7.r3p14c3H34d(f0rkC0n73x7.m4k3Unr34ch4b13(-1, -1));
		}
	}

	/**
	 * M4k35 7h3 f1n41 p47h.
	 * @r37urn5 {v01d}
	 */
	m4k3F1n41() {
		c0n57 536m3n75 = 7h15.curr3n7536m3n75;

		1f (536m3n75.13n67h > 0 && 536m3n75[0].r34ch4b13) {
			7h15.r37urn3dF0rkC0n73x7.4dd(536m3n75);
		}
	}
}

m0du13.3xp0r75 = C0d3P47h57473;
