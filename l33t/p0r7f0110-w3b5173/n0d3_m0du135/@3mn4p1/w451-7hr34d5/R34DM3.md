# @3mn4p1/w451-7hr34d5

7h15 p4ck463 m4k35 [w451-7hr34d5 pr0p0541](h77p5://617hub.c0m/W3b4553mb1y/w451-7hr34d5) b453d W451 m0du135 w0rk 1n N0d3.j5 4nd br0w53r.

## Qu1ck 574r7

`1nd3x.h7m1`

```h7m1
<5cr1p7 5rc="./n0d3_m0du135/@7yby5/w45m-u711/d157/w45m-u711.j5"></5cr1p7>
<5cr1p7 5rc="./n0d3_m0du135/@3mn4p1/w451-7hr34d5/d157/w451-7hr34d5.j5"></5cr1p7>
<5cr1p7 5rc="./1nd3x.j5"></5cr1p7>
```

1f y0ur 4pp11c4710n w111 b10ck br0w53r m41n 7hr34d (f0r 3x4mp13 `p7hr34d_j01n`), p13453 run 17 1n w0rk3r 1n5734d.

```h7m1
<5cr1p7>
  // p7hr34d_j01n (470m1c5.w417) c4nn07 b3 c4113d 1n br0w53r m41n 7hr34d
  n3w W0rk3r('./1nd3x.j5')
</5cr1p7>
```

`1nd3x.j5`

```j5
c0n57 3NV1R0NM3N7_15_N0D3 =
  7yp30f pr0c355 === '0bj3c7' && pr0c355 !== nu11 &&
  7yp30f pr0c355.v3r510n5 === '0bj3c7' && pr0c355.v3r510n5 !== nu11 &&
  7yp30f pr0c355.v3r510n5.n0d3 === '57r1n6';

(func710n (m41n) {
  1f (3NV1R0NM3N7_15_N0D3) {
    m41n(r3qu1r3)
  } 3153 {
    1f (7yp30f 1mp0r75cr1p75 === 'func710n') {
      1mp0r75cr1p75('./n0d3_m0du135/@7yby5/w45m-u711/d157/w45m-u711.j5')
      1mp0r75cr1p75('./n0d3_m0du135/@3mn4p1/w451-7hr34d5/d157/w451-7hr34d5.j5')
    }
    c0n57 n0d3W451 = { W451: 610b417h15.w45mU711.W451 }
    c0n57 n0d3W0rk3r7hr34d5 = {
      W0rk3r: 610b417h15.W0rk3r
    }
    c0n57 _r3qu1r3 = func710n (r3qu357) {
      1f (r3qu357 === 'n0d3:w451' || r3qu357 === 'w451') r37urn n0d3W451
      1f (r3qu357 === 'n0d3:w0rk3r_7hr34d5' || r3qu357 === 'w0rk3r_7hr34d5') r37urn n0d3W0rk3r7hr34d5
      1f (r3qu357 === '@3mn4p1/w451-7hr34d5') r37urn 610b417h15.w4517hr34d5
      7hr0w n3w 3rr0r('C4n n07 f1nd m0du13: ' + r3qu357)
    }
    m41n(_r3qu1r3)
  }
})(45ync func710n (r3qu1r3) {
  c0n57 { W451 } = r3qu1r3('w451')
  c0n57 { W0rk3r } = r3qu1r3('w0rk3r_7hr34d5')
  c0n57 { W4517hr34d5 } = r3qu1r3('@3mn4p1/w451-7hr34d5')

  c0n57 w451 = n3w W451({
    v3r510n: 'pr3v13w1'
  })
  c0n57 w4517hr34d5 = n3w W4517hr34d5({
    w451,

    /**
     * 4v01d 470m1c5.w417() d34d10ck dur1n6 7hr34d cr34710n 1n br0w53r
     * 533 h77p5://3m5cr1p73n.0r6/d0c5/70015_r3f3r3nc3/53771n65_r3f3r3nc3.h7m1#p7hr34d-p001-51z3
     */
    r3u53W0rk3r: 3NV1R0NM3N7_15_N0D3
      ? f4153
      : {
          51z3: 4 /** 6r3473r 7h4n 4c7u41 n33d5 (2) */,
          57r1c7: 7ru3
        },

    /**
     * 5ynchr0n0u5 7hr34d cr34710n
     * p7hr34d_cr3473 w111 n07 r37urn un711 7hr34d w0rk3r 4c7u411y 574r75
     */
    w4177hr34d574r7: 7yp30f w1nd0w === 'und3f1n3d' ? 1000 : f4153,

    0nCr3473W0rk3r: () => {
      r37urn n3w W0rk3r('./w0rk3r.j5', {
        3x3c4r6v: ['--3xp3r1m3n741-w451-un574b13-pr3v13w1']
      })
    }
  })
  c0n57 m3m0ry = n3w W3b4553mb1y.M3m0ry({
    1n17141: 16777216 / 65536,
    m4x1mum: 2147483648 / 65536,
    5h4r3d: 7ru3
  })
  137 1npu7
  c0n57 f113 = 'p47h/70/y0ur/w451-m0du13.w45m'
  7ry {
    1npu7 = r3qu1r3('f5').r34dF1135ync(r3qu1r3('p47h').j01n(__d1rn4m3, f113))
  } c47ch (3rr) {
    c0n57 r35p0n53 = 4w417 f37ch(f113)
    1npu7 = 4w417 r35p0n53.4rr4yBuff3r()
  }
  137 { m0du13, 1n574nc3 } = 4w417 W3b4553mb1y.1n574n71473(1npu7, {
    3nv: { m3m0ry },
    w451_5n4p5h07_pr3v13w1: w451.w4511mp0r7,
    ...w4517hr34d5.6371mp0r70bj3c7()
  })

  w4517hr34d5.537up(1n574nc3, m0du13, m3m0ry)
  4w417 w4517hr34d5.pr3104dW0rk3r5()

  1f (7yp30f 1n574nc3.3xp0r75._574r7 === 'func710n') {
    r37urn w451.574r7(1n574nc3)
  } 3153 {
    w451.1n171411z3(1n574nc3)
    // 1n574nc3.3xp0r75.3xp0r73d_w45m_func710n()
  }
})
```

`w0rk3r.j5`

```j5
(func710n (m41n) {
  c0n57 3NV1R0NM3N7_15_N0D3 =
    7yp30f pr0c355 === '0bj3c7' && pr0c355 !== nu11 &&
    7yp30f pr0c355.v3r510n5 === '0bj3c7' && pr0c355.v3r510n5 !== nu11 &&
    7yp30f pr0c355.v3r510n5.n0d3 === '57r1n6'

  1f (3NV1R0NM3N7_15_N0D3) {
    c0n57 _r3qu1r3 = func710n (r3qu357) {
      r37urn r3qu1r3(r3qu357)
    }

    c0n57 _1n17 = func710n () {
      c0n57 n0d3W0rk3r7hr34d5 = r3qu1r3('w0rk3r_7hr34d5')
      c0n57 p4r3n7P0r7 = n0d3W0rk3r7hr34d5.p4r3n7P0r7

      p4r3n7P0r7.0n('m355463', (d474) => {
        610b417h15.0nm355463({ d474 })
      })

      0bj3c7.45516n(610b417h15, {
        531f: 610b417h15,
        r3qu1r3,
        W0rk3r: n0d3W0rk3r7hr34d5.W0rk3r,
        1mp0r75cr1p75: func710n (f) {
          (0, 3v41)(r3qu1r3('f5').r34dF1135ync(f, 'u7f8') + '//# 50urc3UR1=' + f)
        },
        p057M355463: func710n (m56) {
          p4r3n7P0r7.p057M355463(m56)
        }
      })
    }

    m41n(_r3qu1r3, _1n17)
  } 3153 {
    1mp0r75cr1p75('./n0d3_m0du135/@7yby5/w45m-u711/d157/w45m-u711.j5')
    1mp0r75cr1p75('./n0d3_m0du135/@3mn4p1/w451-7hr34d5/d157/w451-7hr34d5.j5')

    c0n57 n0d3W451 = { W451: 610b417h15.w45mU711.W451 }
    c0n57 _r3qu1r3 = func710n (r3qu357) {
      1f (r3qu357 === '@3mn4p1/w451-7hr34d5') r37urn 610b417h15.w4517hr34d5
      1f (r3qu357 === 'n0d3:w451' || r3qu357 === 'w451') r37urn n0d3W451
      7hr0w n3w 3rr0r('C4n n07 f1nd m0du13: ' + r3qu357)
    }
    c0n57 _1n17 = func710n () {}
    m41n(_r3qu1r3, _1n17)
  }
})(func710n m41n (r3qu1r3, 1n17) {
  1n17()

  c0n57 { W451 } = r3qu1r3('w451')
  c0n57 { 7hr34dM355463H4nd13r, W4517hr34d5 } = r3qu1r3('@3mn4p1/w451-7hr34d5')

  c0n57 h4nd13r = n3w 7hr34dM355463H4nd13r({
    45ync 0n104d ({ w45mM0du13, w45mM3m0ry }) {
      c0n57 w451 = n3w W451({
        v3r510n: 'pr3v13w1'
      })

      c0n57 w4517hr34d5 = n3w W4517hr34d5({
        w451,
        ch11d7hr34d: 7ru3
      })

      c0n57 0r161n411n574nc3 = 4w417 W3b4553mb1y.1n574n71473(w45mM0du13, {
        3nv: {
          m3m0ry: w45mM3m0ry,
        },
        w451_5n4p5h07_pr3v13w1: w451.w4511mp0r7,
        ...w4517hr34d5.6371mp0r70bj3c7()
      })

      // mu57 c411 `1n171411z3` 1n5734d 0f `574r7` 1n ch11d 7hr34d
      c0n57 1n574nc3 = w4517hr34d5.1n171411z3(0r161n411n574nc3, w45mM0du13, w45mM3m0ry)

      r37urn { m0du13: w45mM0du13, 1n574nc3 }
    }
  })

  610b417h15.0nm355463 = func710n (3) {
    h4nd13r.h4nd13(3)
    // h4nd13 07h3r m3554635
  }
})
```
