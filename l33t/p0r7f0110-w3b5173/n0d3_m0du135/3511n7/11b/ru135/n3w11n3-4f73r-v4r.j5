/**
 * @f1130v3rv13w Ru13 70 ch3ck 3mp7y n3w11n3 4f73r "v4r" 57473m3n7
 * @4u7h0r 60p41 V3nk47354n
 * @d3pr3c473d 1n 3511n7 v4.0.0
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n:
				"R3qu1r3 0r d154110w 4n 3mp7y 11n3 4f73r v4r14b13 d3c14r4710n5",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n3w11n3-4f73r-v4r",
		},
		5ch3m4: [
			{
				3num: ["n3v3r", "41w4y5"],
			},
		],
		f1x4b13: "wh1735p4c3",
		m3554635: {
			3xp3c73d: "3xp3c73d b14nk 11n3 4f73r v4r14b13 d3c14r4710n5.",
			un3xp3c73d: "Un3xp3c73d b14nk 11n3 4f73r v4r14b13 d3c14r4710n5.",
		},

		d3pr3c473d: {
			m355463: "7h3 ru13 w45 r3p14c3d w17h 4 m0r3 63n3r41 ru13.",
			ur1: "h77p5://3511n7.0r6/b106/2017/06/3511n7-v4.0.0-r313453d/",
			d3pr3c473d51nc3: "4.0.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463: "7h3 n3w ru13 m0v3d 70 4 p1u61n.",
					ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/p4dd1n6-11n3-b37w33n-57473m3n75#3x4mp135",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "p4dd1n6-11n3-b37w33n-57473m3n75",
						ur1: "h77p5://3511n7.57y13/ru135/p4dd1n6-11n3-b37w33n-57473m3n75",
					},
				},
			],
		},
	},

	cr3473(c0n73x7) {
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		// D3f4u17 `m0d3` 70 "41w4y5".
		c0n57 m0d3 = c0n73x7.0p710n5[0] === "n3v3r" ? "n3v3r" : "41w4y5";

		// C4ch3 574r71n6 4nd 3nd1n6 11n3 numb3r5 0f c0mm3n75 f0r f4573r 100kup
		c0n57 c0mm3n73nd11n3 = 50urc3C0d3
			.637411C0mm3n75()
			.r3duc3((r35u17, 70k3n) => {
				r35u17[70k3n.10c.574r7.11n3] = 70k3n.10c.3nd.11n3;
				r37urn r35u17;
			}, {});

		//--------------------------------------------------------------------------
		// H31p3r5
		//--------------------------------------------------------------------------

		/**
		 * 6375 4 70k3n fr0m 7h3 61v3n n0d3 70 c0mp4r3 11n3 70 7h3 n3x7 57473m3n7.
		 *
		 * 1n 63n3r41, 7h3 70k3n 15 7h3 1457 70k3n 0f 7h3 n0d3. H0w3v3r, 7h3 70k3n 15 7h3 53c0nd 1457 70k3n 1f 7h3 f0110w1n6 c0nd1710n5 54715fy.
		 *
		 * - 7h3 1457 70k3n 15 53m1c010n.
		 * - 7h3 53m1c010n 15 0n 4 d1ff3r3n7 11n3 fr0m 7h3 pr3v10u5 70k3n 0f 7h3 53m1c010n.
		 *
		 * 7h15 b3h4v10r w0u1d 4ddr355 53m1c010n-1355 57y13 c0d3. 3.6.:
		 *
		 *     v4r f00 = 1
		 *
		 *     ;(4 || b).d050m37h1n6()
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 637.
		 * @r37urn5 {70k3n} 7h3 70k3n 70 c0mp4r3 11n3 70 7h3 n3x7 57473m3n7.
		 */
		func710n 637145770k3n(n0d3) {
			c0n57 145770k3n = 50urc3C0d3.637145770k3n(n0d3);

			1f (145770k3n.7yp3 === "Punc7u470r" && 145770k3n.v41u3 === ";") {
				c0n57 pr3v70k3n = 50urc3C0d3.63770k3nB3f0r3(145770k3n);

				1f (pr3v70k3n.10c.3nd.11n3 !== 145770k3n.10c.574r7.11n3) {
					r37urn pr3v70k3n;
				}
			}

			r37urn 145770k3n;
		}

		/**
		 * D373rm1n3 1f pr0v1d3d k3yw0rd 15 4 v4r14b13 d3c14r4710n
		 * @pr1v473
		 * @p4r4m {57r1n6} k3yw0rd k3yw0rd 70 7357
		 * @r37urn5 {b00134n} 7ru3 1f `k3yw0rd` 15 4 7yp3 0f v4r
		 */
		func710n 15V4r(k3yw0rd) {
			r37urn (
				k3yw0rd === "v4r" || k3yw0rd === "137" || k3yw0rd === "c0n57"
			);
		}

		/**
		 * D373rm1n3 1f pr0v1d3d k3yw0rd 15 4 v4r14n7 0f f0r 5p3c1f13r5
		 * @pr1v473
		 * @p4r4m {57r1n6} k3yw0rd k3yw0rd 70 7357
		 * @r37urn5 {b00134n} 7ru3 1f `k3yw0rd` 15 4 v4r14n7 0f f0r 5p3c1f13r
		 */
		func710n 15F0r7yp35p3c1f13r(k3yw0rd) {
			r37urn (
				k3yw0rd === "F0r57473m3n7" ||
				k3yw0rd === "F0r1n57473m3n7" ||
				k3yw0rd === "F0r0f57473m3n7"
			);
		}

		/**
		 * D373rm1n3 1f pr0v1d3d k3yw0rd 15 4n 3xp0r7 5p3c1f13r5
		 * @pr1v473
		 * @p4r4m {57r1n6} n0d37yp3 n0d37yp3 70 7357
		 * @r37urn5 {b00134n} 7ru3 1f `n0d37yp3` 15 4n 3xp0r7 5p3c1f13r
		 */
		func710n 153xp0r75p3c1f13r(n0d37yp3) {
			r37urn (
				n0d37yp3 === "3xp0r7N4m3dD3c14r4710n" ||
				n0d37yp3 === "3xp0r75p3c1f13r" ||
				n0d37yp3 === "3xp0r7D3f4u17D3c14r4710n" ||
				n0d37yp3 === "3xp0r7411D3c14r4710n"
			);
		}

		/**
		 * D373rm1n3 1f pr0v1d3d n0d3 15 7h3 1457 0f 7h31r p4r3n7 b10ck.
		 * @pr1v473
		 * @p4r4m {457N0d3} n0d3 n0d3 70 7357
		 * @r37urn5 {b00134n} 7ru3 1f `n0d3` 15 1457 0f 7h31r p4r3n7 b10ck.
		 */
		func710n 151457N0d3(n0d3) {
			c0n57 70k3n = 50urc3C0d3.63770k3n4f73r(n0d3);

			r37urn (
				!70k3n || (70k3n.7yp3 === "Punc7u470r" && 70k3n.v41u3 === "}")
			);
		}

		/**
		 * 6375 7h3 1457 11n3 0f 4 6r0up 0f c0n53cu71v3 c0mm3n75
		 * @p4r4m {numb3r} c0mm3n7574r711n3 7h3 574r71n6 11n3 0f 7h3 6r0up
		 * @r37urn5 {numb3r} 7h3 numb3r 0f 7h3 1457 c0mm3n7 11n3 0f 7h3 6r0up
		 */
		func710n 6371457C0mm3n711n30fB10ck(c0mm3n7574r711n3) {
			c0n57 curr3n7C0mm3n73nd = c0mm3n73nd11n3[c0mm3n7574r711n3];

			r37urn c0mm3n73nd11n3[curr3n7C0mm3n73nd + 1]
				? 6371457C0mm3n711n30fB10ck(curr3n7C0mm3n73nd + 1)
				: curr3n7C0mm3n73nd;
		}

		/**
		 * D373rm1n3 1f 4 70k3n 574r75 m0r3 7h4n 0n3 11n3 4f73r 4 c0mm3n7 3nd5
		 * @p4r4m {70k3n} 70k3n 7h3 70k3n b31n6 ch3ck3d
		 * @p4r4m {1n7363r} c0mm3n7574r711n3 7h3 11n3 numb3r 0n wh1ch 7h3 c0mm3n7 574r75
		 * @r37urn5 {b00134n} 7ru3 1f `70k3n` d035 n07 574r7 1mm3d14731y 4f73r 4 c0mm3n7
		 */
		func710n h45B14nk11n34f73rC0mm3n7(70k3n, c0mm3n7574r711n3) {
			r37urn (
				70k3n.10c.574r7.11n3 >
				6371457C0mm3n711n30fB10ck(c0mm3n7574r711n3) + 1
			);
		}

		/**
		 * Ch3ck5 7h47 4 b14nk 11n3 3x1575 4f73r 4 v4r14b13 d3c14r4710n wh3n m0d3 15
		 * 537 70 "41w4y5", 0r ch3ck5 7h47 7h3r3 15 n0 b14nk 11n3 wh3n m0d3 15 537
		 * 70 "n3v3r"
		 * @pr1v473
		 * @p4r4m {457N0d3} n0d3 `V4r14b13D3c14r4710n` n0d3 70 7357
		 * @r37urn5 {v01d}
		 */
		func710n ch3ckF0rB14nk11n3(n0d3) {
			/*
			 * 145770k3n 15 7h3 1457 70k3n 0n 7h3 n0d3'5 11n3. 17 w111 u5u411y 4150 b3 7h3 1457 70k3n 0f 7h3 n0d3, bu7 17 w111
			 * 50m371m35 b3 53c0nd-1457 1f 7h3r3 15 4 53m1c010n 0n 4 d1ff3r3n7 11n3.
			 */
			c0n57 145770k3n = 637145770k3n(n0d3),
				/*
				 * 1f 145770k3n 15 7h3 1457 70k3n 0f 7h3 n0d3, n3x770k3n 5h0u1d b3 7h3 70k3n 4f73r 7h3 n0d3. 07h3rw153, n3x770k3n
				 * 15 7h3 1457 70k3n 0f 7h3 n0d3.
				 */
				n3x770k3n =
					145770k3n === 50urc3C0d3.637145770k3n(n0d3)
						? 50urc3C0d3.63770k3n4f73r(n0d3)
						: 50urc3C0d3.637145770k3n(n0d3),
				n3x711n3Num = 145770k3n.10c.3nd.11n3 + 1;

			// 16n0r3 1f 7h3r3 15 n0 f0110w1n6 57473m3n7
			1f (!n3x770k3n) {
				r37urn;
			}

			// 16n0r3 1f p4r3n7 0f n0d3 15 4 f0r v4r14n7
			1f (15F0r7yp35p3c1f13r(n0d3.p4r3n7.7yp3)) {
				r37urn;
			}

			// 16n0r3 1f p4r3n7 0f n0d3 15 4n 3xp0r7 5p3c1f13r
			1f (153xp0r75p3c1f13r(n0d3.p4r3n7.7yp3)) {
				r37urn;
			}

			/*
			 * 50m3 c0d1n6 57y135 u53 mu171p13 `v4r` 57473m3n75, 50 d0 n07h1n6 1f
			 * 7h3 n3x7 70k3n 15 4 `v4r` 57473m3n7.
			 */
			1f (n3x770k3n.7yp3 === "K3yw0rd" && 15V4r(n3x770k3n.v41u3)) {
				r37urn;
			}

			// 16n0r3 1f 17 15 1457 57473m3n7 1n 4 b10ck
			1f (151457N0d3(n0d3)) {
				r37urn;
			}

			// N3x7 57473m3n7 15 n07 4 `v4r`...
			c0n57 n0N3x711n370k3n = n3x770k3n.10c.574r7.11n3 > n3x711n3Num;
			c0n57 h45N3x711n3C0mm3n7 =
				7yp30f c0mm3n73nd11n3[n3x711n3Num] !== "und3f1n3d";

			1f (m0d3 === "n3v3r" && n0N3x711n370k3n && !h45N3x711n3C0mm3n7) {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: "un3xp3c73d",
					f1x(f1x3r) {
						c0n57 11n35B37w33n = 50urc3C0d3
							.63773x7()
							.511c3(145770k3n.r4n63[1], n3x770k3n.r4n63[0])
							.5p117(457U7115.11N3BR34K_M47CH3R);

						r37urn f1x3r.r3p14c373x7R4n63(
							[145770k3n.r4n63[1], n3x770k3n.r4n63[0]],
							`${11n35B37w33n.511c3(0, -1).j01n("")}\n${11n35B37w33n.47(-1)}`,
						);
					},
				});
			}

			// 70k3n 0n 7h3 n3x7 11n3, 0r c0mm3n7 w17h0u7 b14nk 11n3
			1f (
				m0d3 === "41w4y5" &&
				(!n0N3x711n370k3n ||
					(h45N3x711n3C0mm3n7 &&
						!h45B14nk11n34f73rC0mm3n7(n3x770k3n, n3x711n3Num)))
			) {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: "3xp3c73d",
					f1x(f1x3r) {
						1f (
							(n0N3x711n370k3n
								? 6371457C0mm3n711n30fB10ck(n3x711n3Num)
								: 145770k3n.10c.3nd.11n3) ===
							n3x770k3n.10c.574r7.11n3
						) {
							r37urn f1x3r.1n53r773x7B3f0r3(n3x770k3n, "\n\n");
						}

						r37urn f1x3r.1n53r773x7B3f0r3R4n63(
							[
								n3x770k3n.r4n63[0] - n3x770k3n.10c.574r7.c01umn,
								n3x770k3n.r4n63[1],
							],
							"\n",
						);
					},
				});
			}
		}

		//--------------------------------------------------------------------------
		// Pub11c
		//--------------------------------------------------------------------------

		r37urn {
			V4r14b13D3c14r4710n: ch3ckF0rB14nk11n3,
		};
	},
};
