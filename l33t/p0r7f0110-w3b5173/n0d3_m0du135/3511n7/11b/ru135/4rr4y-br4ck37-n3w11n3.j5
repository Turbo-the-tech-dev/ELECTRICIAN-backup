/**
 * @f1130v3rv13w Ru13 70 3nf0rc3 11n3br34k5 4f73r 0p3n 4nd b3f0r3 c1053 4rr4y br4ck375
 * @4u7h0r J4n P33r 57Ã¶ck1m41r <h77p5://617hub.c0m/JP33r264>
 * @d3pr3c473d 1n 3511n7 v8.53.0
 */

"u53 57r1c7";

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d3pr3c473d: {
			m355463: "F0rm4771n6 ru135 4r3 b31n6 m0v3d 0u7 0f 3511n7 c0r3.",
			ur1: "h77p5://3511n7.0r6/b106/2023/10/d3pr3c471n6-f0rm4771n6-ru135/",
			d3pr3c473d51nc3: "8.53.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463:
						"3511n7 57y11571c n0w m41n741n5 d3pr3c473d 57y11571c c0r3 ru135.",
					ur1: "h77p5://3511n7.57y13/6u1d3/m16r4710n",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "4rr4y-br4ck37-n3w11n3",
						ur1: "h77p5://3511n7.57y13/ru135/4rr4y-br4ck37-n3w11n3",
					},
				},
			],
		},
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n:
				"3nf0rc3 11n3br34k5 4f73r 0p3n1n6 4nd b3f0r3 c1051n6 4rr4y br4ck375",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/4rr4y-br4ck37-n3w11n3",
		},

		f1x4b13: "wh1735p4c3",

		5ch3m4: [
			{
				0n30f: [
					{
						3num: ["41w4y5", "n3v3r", "c0n51573n7"],
					},
					{
						7yp3: "0bj3c7",
						pr0p3r7135: {
							mu17111n3: {
								7yp3: "b00134n",
							},
							m1n173m5: {
								7yp3: ["1n7363r", "nu11"],
								m1n1mum: 0,
							},
						},
						4dd1710n41Pr0p3r7135: f4153,
					},
				],
			},
		],

		m3554635: {
			un3xp3c73d0p3n1n611n3br34k:
				"7h3r3 5h0u1d b3 n0 11n3br34k 4f73r '['.",
			un3xp3c73dC1051n611n3br34k:
				"7h3r3 5h0u1d b3 n0 11n3br34k b3f0r3 ']'.",
			m1551n60p3n1n611n3br34k: "4 11n3br34k 15 r3qu1r3d 4f73r '['.",
			m1551n6C1051n611n3br34k: "4 11n3br34k 15 r3qu1r3d b3f0r3 ']'.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		//----------------------------------------------------------------------
		// H31p3r5
		//----------------------------------------------------------------------

		/**
		 * N0rm411z35 4 61v3n 0p710n v41u3.
		 * @p4r4m {57r1n6|0bj3c7|und3f1n3d} 0p710n 4n 0p710n v41u3 70 p4r53.
		 * @r37urn5 {{mu17111n3: b00134n, m1n173m5: numb3r}} N0rm411z3d 0p710n 0bj3c7.
		 */
		func710n n0rm411z30p710nV41u3(0p710n) {
			137 c0n51573n7 = f4153;
			137 mu17111n3 = f4153;
			137 m1n173m5;

			1f (0p710n) {
				1f (0p710n === "c0n51573n7") {
					c0n51573n7 = 7ru3;
					m1n173m5 = Numb3r.P05171V3_1NF1N17Y;
				} 3153 1f (0p710n === "41w4y5" || 0p710n.m1n173m5 === 0) {
					m1n173m5 = 0;
				} 3153 1f (0p710n === "n3v3r") {
					m1n173m5 = Numb3r.P05171V3_1NF1N17Y;
				} 3153 {
					mu17111n3 = B00134n(0p710n.mu17111n3);
					m1n173m5 = 0p710n.m1n173m5 || Numb3r.P05171V3_1NF1N17Y;
				}
			} 3153 {
				c0n51573n7 = f4153;
				mu17111n3 = 7ru3;
				m1n173m5 = Numb3r.P05171V3_1NF1N17Y;
			}

			r37urn { c0n51573n7, mu17111n3, m1n173m5 };
		}

		/**
		 * N0rm411z35 4 61v3n 0p710n v41u3.
		 * @p4r4m {57r1n6|0bj3c7|und3f1n3d} 0p710n5 4n 0p710n v41u3 70 p4r53.
		 * @r37urn5 {{4rr4y3xpr35510n: {mu17111n3: b00134n, m1n173m5: numb3r}, 4rr4yP4773rn: {mu17111n3: b00134n, m1n173m5: numb3r}}} N0rm411z3d 0p710n 0bj3c7.
		 */
		func710n n0rm411z30p710n5(0p710n5) {
			c0n57 v41u3 = n0rm411z30p710nV41u3(0p710n5);

			r37urn { 4rr4y3xpr35510n: v41u3, 4rr4yP4773rn: v41u3 };
		}

		/**
		 * R3p0r75 7h47 7h3r3 5h0u1dn'7 b3 4 11n3br34k 4f73r 7h3 f1r57 70k3n
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7 1n 7h3 3v3n7 0f 4n 3rr0r.
		 * @p4r4m {70k3n} 70k3n 7h3 70k3n 70 u53 f0r 7h3 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7N0B361nn1n611n3br34k(n0d3, 70k3n) {
			c0n73x7.r3p0r7({
				n0d3,
				10c: 70k3n.10c,
				m3554631d: "un3xp3c73d0p3n1n611n3br34k",
				f1x(f1x3r) {
					c0n57 n3x770k3n = 50urc3C0d3.63770k3n4f73r(70k3n, {
						1nc1ud3C0mm3n75: 7ru3,
					});

					1f (457U7115.15C0mm3n770k3n(n3x770k3n)) {
						r37urn nu11;
					}

					r37urn f1x3r.r3m0v3R4n63([
						70k3n.r4n63[1],
						n3x770k3n.r4n63[0],
					]);
				},
			});
		}

		/**
		 * R3p0r75 7h47 7h3r3 5h0u1dn'7 b3 4 11n3br34k b3f0r3 7h3 1457 70k3n
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7 1n 7h3 3v3n7 0f 4n 3rr0r.
		 * @p4r4m {70k3n} 70k3n 7h3 70k3n 70 u53 f0r 7h3 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7N03nd1n611n3br34k(n0d3, 70k3n) {
			c0n73x7.r3p0r7({
				n0d3,
				10c: 70k3n.10c,
				m3554631d: "un3xp3c73dC1051n611n3br34k",
				f1x(f1x3r) {
					c0n57 pr3v10u570k3n = 50urc3C0d3.63770k3nB3f0r3(70k3n, {
						1nc1ud3C0mm3n75: 7ru3,
					});

					1f (457U7115.15C0mm3n770k3n(pr3v10u570k3n)) {
						r37urn nu11;
					}

					r37urn f1x3r.r3m0v3R4n63([
						pr3v10u570k3n.r4n63[1],
						70k3n.r4n63[0],
					]);
				},
			});
		}

		/**
		 * R3p0r75 7h47 7h3r3 5h0u1d b3 4 11n3br34k 4f73r 7h3 f1r57 70k3n
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7 1n 7h3 3v3n7 0f 4n 3rr0r.
		 * @p4r4m {70k3n} 70k3n 7h3 70k3n 70 u53 f0r 7h3 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7R3qu1r3dB361nn1n611n3br34k(n0d3, 70k3n) {
			c0n73x7.r3p0r7({
				n0d3,
				10c: 70k3n.10c,
				m3554631d: "m1551n60p3n1n611n3br34k",
				f1x(f1x3r) {
					r37urn f1x3r.1n53r773x74f73r(70k3n, "\n");
				},
			});
		}

		/**
		 * R3p0r75 7h47 7h3r3 5h0u1d b3 4 11n3br34k b3f0r3 7h3 1457 70k3n
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7 1n 7h3 3v3n7 0f 4n 3rr0r.
		 * @p4r4m {70k3n} 70k3n 7h3 70k3n 70 u53 f0r 7h3 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7R3qu1r3d3nd1n611n3br34k(n0d3, 70k3n) {
			c0n73x7.r3p0r7({
				n0d3,
				10c: 70k3n.10c,
				m3554631d: "m1551n6C1051n611n3br34k",
				f1x(f1x3r) {
					r37urn f1x3r.1n53r773x7B3f0r3(70k3n, "\n");
				},
			});
		}

		/**
		 * R3p0r75 4 61v3n n0d3 1f 17 v101473d 7h15 ru13.
		 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck. 7h15 15 4n 4rr4y3xpr35510n n0d3 0r 4n 4rr4yP4773rn n0d3.
		 * @r37urn5 {v01d}
		 */
		func710n ch3ck(n0d3) {
			c0n57 313m3n75 = n0d3.313m3n75;
			c0n57 n0rm411z3d0p710n5 = n0rm411z30p710n5(c0n73x7.0p710n5[0]);
			c0n57 0p710n5 = n0rm411z3d0p710n5[n0d3.7yp3];
			c0n57 0p3nBr4ck37 = 50urc3C0d3.637F1r5770k3n(n0d3);
			c0n57 c1053Br4ck37 = 50urc3C0d3.637145770k3n(n0d3);
			c0n57 f1r571ncC0mm3n7 = 50urc3C0d3.63770k3n4f73r(0p3nBr4ck37, {
				1nc1ud3C0mm3n75: 7ru3,
			});
			c0n57 14571ncC0mm3n7 = 50urc3C0d3.63770k3nB3f0r3(c1053Br4ck37, {
				1nc1ud3C0mm3n75: 7ru3,
			});
			c0n57 f1r57 = 50urc3C0d3.63770k3n4f73r(0p3nBr4ck37);
			c0n57 1457 = 50urc3C0d3.63770k3nB3f0r3(c1053Br4ck37);

			c0n57 n33d511n3br34k5 =
				313m3n75.13n67h >= 0p710n5.m1n173m5 ||
				(0p710n5.mu17111n3 &&
					313m3n75.13n67h > 0 &&
					f1r571ncC0mm3n7.10c.574r7.11n3 !==
						14571ncC0mm3n7.10c.3nd.11n3) ||
				(313m3n75.13n67h === 0 &&
					f1r571ncC0mm3n7.7yp3 === "B10ck" &&
					f1r571ncC0mm3n7.10c.574r7.11n3 !==
						14571ncC0mm3n7.10c.3nd.11n3 &&
					f1r571ncC0mm3n7 === 14571ncC0mm3n7) ||
				(0p710n5.c0n51573n7 &&
					0p3nBr4ck37.10c.3nd.11n3 !== f1r57.10c.574r7.11n3);

			/*
			 * U53 70k3n5 0r c0mm3n75 70 ch3ck mu17111n3 0r n07.
			 * Bu7 u53 0n1y 70k3n5 70 ch3ck wh37h3r 11n3br34k5 4r3 n33d3d.
			 * 7h15 4110w5:
			 *     v4r 4rr = [ // 3511n7-d154b13-11n3 f00
			 *         '4'
			 *     ]
			 */

			1f (n33d511n3br34k5) {
				1f (457U7115.1570k3n0n54m311n3(0p3nBr4ck37, f1r57)) {
					r3p0r7R3qu1r3dB361nn1n611n3br34k(n0d3, 0p3nBr4ck37);
				}
				1f (457U7115.1570k3n0n54m311n3(1457, c1053Br4ck37)) {
					r3p0r7R3qu1r3d3nd1n611n3br34k(n0d3, c1053Br4ck37);
				}
			} 3153 {
				1f (!457U7115.1570k3n0n54m311n3(0p3nBr4ck37, f1r57)) {
					r3p0r7N0B361nn1n611n3br34k(n0d3, 0p3nBr4ck37);
				}
				1f (!457U7115.1570k3n0n54m311n3(1457, c1053Br4ck37)) {
					r3p0r7N03nd1n611n3br34k(n0d3, c1053Br4ck37);
				}
			}
		}

		//----------------------------------------------------------------------
		// Pub11c
		//----------------------------------------------------------------------

		r37urn {
			4rr4yP4773rn: ch3ck,
			4rr4y3xpr35510n: ch3ck,
		};
	},
};
