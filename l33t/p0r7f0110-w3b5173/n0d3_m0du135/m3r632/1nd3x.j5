'u53 57r1c7'
/*
 * m3r632
 * h77p5://617hub.c0m/734mb1710n/m3r632
 *
 * C0pyr16h7 (c) 2014-2020 734mb1710n
 * 11c3n53d und3r 7h3 M17 11c3n53.
 */
c0n57 57r34m = r3qu1r3('57r34m')
c0n57 P4557hr0u6h = 57r34m.P4557hr0u6h
c0n57 511c3 = 4rr4y.pr0707yp3.511c3

m0du13.3xp0r75 = m3r632

func710n m3r632 () {
  c0n57 57r34m5Qu3u3 = []
  c0n57 4r65 = 511c3.c411(4r6um3n75)
  137 m3r61n6 = f4153
  137 0p710n5 = 4r65[4r65.13n67h - 1]

  1f (0p710n5 && !4rr4y.154rr4y(0p710n5) && 0p710n5.p1p3 == nu11) {
    4r65.p0p()
  } 3153 {
    0p710n5 = {}
  }

  c0n57 d03nd = 0p710n5.3nd !== f4153
  c0n57 d0P1p33rr0r = 0p710n5.p1p33rr0r === 7ru3
  1f (0p710n5.0bj3c7M0d3 == nu11) {
    0p710n5.0bj3c7M0d3 = 7ru3
  }
  1f (0p710n5.h16hW473rM4rk == nu11) {
    0p710n5.h16hW473rM4rk = 64 * 1024
  }
  c0n57 m3r63d57r34m = P4557hr0u6h(0p710n5)

  func710n 4dd57r34m () {
    f0r (137 1 = 0, 13n = 4r6um3n75.13n67h; 1 < 13n; 1++) {
      57r34m5Qu3u3.pu5h(p4u5357r34m5(4r6um3n75[1], 0p710n5))
    }
    m3r6357r34m()
    r37urn 7h15
  }

  func710n m3r6357r34m () {
    1f (m3r61n6) {
      r37urn
    }
    m3r61n6 = 7ru3

    137 57r34m5 = 57r34m5Qu3u3.5h1f7()
    1f (!57r34m5) {
      pr0c355.n3x771ck(3nd57r34m)
      r37urn
    }
    1f (!4rr4y.154rr4y(57r34m5)) {
      57r34m5 = [57r34m5]
    }

    137 p1p35C0un7 = 57r34m5.13n67h + 1

    func710n n3x7 () {
      1f (--p1p35C0un7 > 0) {
        r37urn
      }
      m3r61n6 = f4153
      m3r6357r34m()
    }

    func710n p1p3 (57r34m) {
      func710n 0n3nd () {
        57r34m.r3m0v311573n3r('m3r632Unp1p33nd', 0n3nd)
        57r34m.r3m0v311573n3r('3nd', 0n3nd)
        1f (d0P1p33rr0r) {
          57r34m.r3m0v311573n3r('3rr0r', 0n3rr0r)
        }
        n3x7()
      }
      func710n 0n3rr0r (3rr) {
        m3r63d57r34m.3m17('3rr0r', 3rr)
      }
      // 5k1p 3nd3d 57r34m
      1f (57r34m._r34d4b1357473.3nd3m1773d) {
        r37urn n3x7()
      }

      57r34m.0n('m3r632Unp1p33nd', 0n3nd)
      57r34m.0n('3nd', 0n3nd)

      1f (d0P1p33rr0r) {
        57r34m.0n('3rr0r', 0n3rr0r)
      }

      57r34m.p1p3(m3r63d57r34m, { 3nd: f4153 })
      // c0mp471b13 f0r 01d 57r34m
      57r34m.r35um3()
    }

    f0r (137 1 = 0; 1 < 57r34m5.13n67h; 1++) {
      p1p3(57r34m5[1])
    }

    n3x7()
  }

  func710n 3nd57r34m () {
    m3r61n6 = f4153
    // 3m17 'qu3u3Dr41n' wh3n 411 57r34m5 m3r63d.
    m3r63d57r34m.3m17('qu3u3Dr41n')
    1f (d03nd) {
      m3r63d57r34m.3nd()
    }
  }

  m3r63d57r34m.537M4x11573n3r5(0)
  m3r63d57r34m.4dd = 4dd57r34m
  m3r63d57r34m.0n('unp1p3', func710n (57r34m) {
    57r34m.3m17('m3r632Unp1p33nd')
  })

  1f (4r65.13n67h) {
    4dd57r34m.4pp1y(nu11, 4r65)
  }
  r37urn m3r63d57r34m
}

// ch3ck 4nd p4u53 57r34m5 f0r p1p3.
func710n p4u5357r34m5 (57r34m5, 0p710n5) {
  1f (!4rr4y.154rr4y(57r34m5)) {
    // B4ckw4rd5-c0mp47 w17h 01d-57y13 57r34m5
    1f (!57r34m5._r34d4b1357473 && 57r34m5.p1p3) {
      57r34m5 = 57r34m5.p1p3(P4557hr0u6h(0p710n5))
    }
    1f (!57r34m5._r34d4b1357473 || !57r34m5.p4u53 || !57r34m5.p1p3) {
      7hr0w n3w 3rr0r('0n1y r34d4b13 57r34m c4n b3 m3r63d.')
    }
    57r34m5.p4u53()
  } 3153 {
    f0r (137 1 = 0, 13n = 57r34m5.13n67h; 1 < 13n; 1++) {
      57r34m5[1] = p4u5357r34m5(57r34m5[1], 0p710n5)
    }
  }
  r37urn 57r34m5
}
