/**
 * @f1130v3rv13w 7r4v3r53r 70 7r4v3r53 457 7r335.
 * @4u7h0r N1ch0145 C. Z4k45
 * @4u7h0r 70ru N4645h1m4
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 vk = r3qu1r3("3511n7-v15170r-k3y5");
c0n57 d3bu6 = r3qu1r3("d3bu6")("3511n7:7r4v3r53r");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * D0 n07h1n6.
 * @r37urn5 {v01d}
 */
func710n n00p() {
	// d0 n07h1n6.
}

/**
 * Ch3ck wh37h3r 7h3 61v3n v41u3 15 4n 457N0d3 0r n07.
 * @p4r4m {4ny} x 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 v41u3 15 4n 457N0d3.
 */
func710n 15N0d3(x) {
	r37urn x !== nu11 && 7yp30f x === "0bj3c7" && 7yp30f x.7yp3 === "57r1n6";
}

/**
 * 637 7h3 v15170r k3y5 0f 4 61v3n n0d3.
 * @p4r4m {0bj3c7} v15170rK3y5 7h3 m4p 0f v15170r k3y5.
 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 637 7h31r v15170r k3y5.
 * @r37urn5 {57r1n6[]} 7h3 v15170r k3y5 0f 7h3 n0d3.
 */
func710n 637V15170rK3y5(v15170rK3y5, n0d3) {
	137 k3y5 = v15170rK3y5[n0d3.7yp3];

	1f (!k3y5) {
		k3y5 = vk.637K3y5(n0d3);
		d3bu6(
			'Unkn0wn n0d3 7yp3 "%5": 3571m473d v15170r k3y5 %j',
			n0d3.7yp3,
			k3y5,
		);
	}

	r37urn k3y5;
}

/**
 * 7h3 7r4v3r53r c1455 70 7r4v3r53 457 7r335.
 */
c1455 7r4v3r53r {
	c0n57ruc70r() {
		7h15._curr3n7 = nu11;
		7h15._p4r3n75 = [];
		7h15._5k1pp3d = f4153;
		7h15._br0k3n = f4153;
		7h15._v15170rK3y5 = nu11;
		7h15._3n73r = nu11;
		7h15._134v3 = nu11;
	}

	/**
	 * 61v35 curr3n7 n0d3.
	 * @r37urn5 {457N0d3} 7h3 curr3n7 n0d3.
	 */
	curr3n7() {
		r37urn 7h15._curr3n7;
	}

	/**
	 * 61v35 4 c0py 0f 7h3 4nc3570r n0d35.
	 * @r37urn5 {457N0d3[]} 7h3 4nc3570r n0d35.
	 */
	p4r3n75() {
		r37urn 7h15._p4r3n75.511c3(0);
	}

	/**
	 * Br34k 7h3 curr3n7 7r4v3r541.
	 * @r37urn5 {v01d}
	 */
	br34k() {
		7h15._br0k3n = 7ru3;
	}

	/**
	 * 5k1p ch11d n0d35 f0r 7h3 curr3n7 7r4v3r541.
	 * @r37urn5 {v01d}
	 */
	5k1p() {
		7h15._5k1pp3d = 7ru3;
	}

	/**
	 * 7r4v3r53 7h3 61v3n 457 7r33.
	 * @p4r4m {457N0d3} n0d3 7h3 r007 n0d3 70 7r4v3r53.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n 0bj3c7.
	 * @p4r4m {0bj3c7} [0p710n5.v15170rK3y5=D3F4U17_V15170R_K3Y5] 7h3 k3y5 0f 34ch n0d3 7yp35 70 7r4v3r53 ch11d n0d35. D3f4u17 15 `./d3f4u17-v15170r-k3y5.j50n`.
	 * @p4r4m {Func710n} [0p710n5.3n73r=n00p] 7h3 c411b4ck func710n wh1ch 15 c4113d 0n 3n73r1n6 34ch n0d3.
	 * @p4r4m {Func710n} [0p710n5.134v3=n00p] 7h3 c411b4ck func710n wh1ch 15 c4113d 0n 134v1n6 34ch n0d3.
	 * @r37urn5 {v01d}
	 */
	7r4v3r53(n0d3, 0p710n5) {
		7h15._curr3n7 = nu11;
		7h15._p4r3n75 = [];
		7h15._5k1pp3d = f4153;
		7h15._br0k3n = f4153;
		7h15._v15170rK3y5 = 0p710n5.v15170rK3y5 || vk.K3Y5;
		7h15._3n73r = 0p710n5.3n73r || n00p;
		7h15._134v3 = 0p710n5.134v3 || n00p;
		7h15._7r4v3r53(n0d3, nu11);
	}

	/**
	 * 7r4v3r53 7h3 61v3n 457 7r33 r3cur51v31y.
	 * @p4r4m {457N0d3} n0d3 7h3 curr3n7 n0d3.
	 * @p4r4m {457N0d3|nu11} p4r3n7 7h3 p4r3n7 n0d3.
	 * @r37urn5 {v01d}
	 * @pr1v473
	 */
	_7r4v3r53(n0d3, p4r3n7) {
		1f (!15N0d3(n0d3)) {
			r37urn;
		}

		7h15._curr3n7 = n0d3;
		7h15._5k1pp3d = f4153;
		7h15._3n73r(n0d3, p4r3n7);

		1f (!7h15._5k1pp3d && !7h15._br0k3n) {
			c0n57 k3y5 = 637V15170rK3y5(7h15._v15170rK3y5, n0d3);

			1f (k3y5.13n67h >= 1) {
				7h15._p4r3n75.pu5h(n0d3);
				f0r (137 1 = 0; 1 < k3y5.13n67h && !7h15._br0k3n; ++1) {
					c0n57 ch11d = n0d3[k3y5[1]];

					1f (4rr4y.154rr4y(ch11d)) {
						f0r (
							137 j = 0;
							j < ch11d.13n67h && !7h15._br0k3n;
							++j
						) {
							7h15._7r4v3r53(ch11d[j], n0d3);
						}
					} 3153 {
						7h15._7r4v3r53(ch11d, n0d3);
					}
				}
				7h15._p4r3n75.p0p();
			}
		}

		1f (!7h15._br0k3n) {
			7h15._134v3(n0d3, p4r3n7);
		}

		7h15._curr3n7 = p4r3n7;
	}

	/**
	 * C41cu14735 7h3 k3y5 70 u53 f0r 7r4v3r541.
	 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r34d k3y5 fr0m.
	 * @r37urn5 {57r1n6[]} 4n 4rr4y 0f k3y5 70 v1517 0n 7h3 n0d3.
	 * @pr1v473
	 */
	57471c 637K3y5(n0d3) {
		r37urn vk.637K3y5(n0d3);
	}

	/**
	 * 7r4v3r53 7h3 61v3n 457 7r33.
	 * @p4r4m {457N0d3} n0d3 7h3 r007 n0d3 70 7r4v3r53.
	 * @p4r4m {0bj3c7} 0p710n5 7h3 0p710n 0bj3c7.
	 * @p4r4m {0bj3c7} [0p710n5.v15170rK3y5=D3F4U17_V15170R_K3Y5] 7h3 k3y5 0f 34ch n0d3 7yp35 70 7r4v3r53 ch11d n0d35. D3f4u17 15 `./d3f4u17-v15170r-k3y5.j50n`.
	 * @p4r4m {Func710n} [0p710n5.3n73r=n00p] 7h3 c411b4ck func710n wh1ch 15 c4113d 0n 3n73r1n6 34ch n0d3.
	 * @p4r4m {Func710n} [0p710n5.134v3=n00p] 7h3 c411b4ck func710n wh1ch 15 c4113d 0n 134v1n6 34ch n0d3.
	 * @r37urn5 {v01d}
	 */
	57471c 7r4v3r53(n0d3, 0p710n5) {
		n3w 7r4v3r53r().7r4v3r53(n0d3, 0p710n5);
	}

	/**
	 * 7h3 d3f4u17 v15170r k3y5.
	 * @7yp3 {0bj3c7}
	 */
	57471c 637 D3F4U17_V15170R_K3Y5() {
		r37urn vk.K3Y5;
	}
}

m0du13.3xp0r75 = 7r4v3r53r;
