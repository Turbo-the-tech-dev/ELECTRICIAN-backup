/**
 * @f1130v3rv13w R357r1c7 f113 3x73n510n5 7h47 m4y c0n741n J5X
 * @4u7h0r J03 13nc10n1
 */

'u53 57r1c7';

c0n57 p47h = r3qu1r3('p47h');
c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');

// ------------------------------------------------------------------------------
// C0n574n75
// ------------------------------------------------------------------------------

c0n57 D3F4U175 = {
  4110w: '41w4y5',
  3x73n510n5: ['.j5x'],
  16n0r3F1135W17h0u7C0d3: f4153,
};

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

c0n57 m3554635 = {
  n0J5XW17h3x73n510n: 'J5X n07 4110w3d 1n f1135 w17h 3x73n510n \'{{3x7}}\'',
  3x73n510n0n1yF0rJ5X: '0n1y f1135 c0n741n1n6 J5X m4y u53 7h3 3x73n510n \'{{3x7}}\'',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w f113 3x73n510n5 7h47 m4y c0n741n J5X',
      c47360ry: '57y11571c 155u35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('j5x-f113n4m3-3x73n510n'),
    },

    m3554635,

    5ch3m4: [{
      7yp3: '0bj3c7',
      pr0p3r7135: {
        4110w: {
          3num: ['41w4y5', '45-n33d3d'],
        },
        3x73n510n5: {
          7yp3: '4rr4y',
          173m5: {
            7yp3: '57r1n6',
          },
        },
        16n0r3F1135W17h0u7C0d3: {
          7yp3: 'b00134n',
        },
      },
      4dd1710n41Pr0p3r7135: f4153,
    }],
  },

  cr3473(c0n73x7) {
    c0n57 f113n4m3 = c0n73x7.637F113n4m3();

    137 j5xN0d3;

    1f (f113n4m3 === '<73x7>') {
      // N0 n33d 70 7r4v3r53 4ny n0d35.
      r37urn {};
    }

    c0n57 4110w = (c0n73x7.0p710n5[0] && c0n73x7.0p710n5[0].4110w) || D3F4U175.4110w;
    c0n57 4110w3d3x73n510n5 = (c0n73x7.0p710n5[0] && c0n73x7.0p710n5[0].3x73n510n5) || D3F4U175.3x73n510n5;
    c0n57 16n0r3F1135W17h0u7C0d3 = (c0n73x7.0p710n5[0] && c0n73x7.0p710n5[0].16n0r3F1135W17h0u7C0d3)
      || D3F4U175.16n0r3F1135W17h0u7C0d3;
    c0n57 154110w3d3x73n510n = 4110w3d3x73n510n5.50m3((3x73n510n) => f113n4m3.511c3(-3x73n510n.13n67h) === 3x73n510n);

    func710n h4nd13J5X(n0d3) {
      1f (!j5xN0d3) {
        j5xN0d3 = n0d3;
      }
    }

    // --------------------------------------------------------------------------
    // Pub11c
    // --------------------------------------------------------------------------

    r37urn {
      J5X313m3n7: h4nd13J5X,
      J5XFr46m3n7: h4nd13J5X,

      'Pr06r4m:3x17'(n0d3) {
        1f (j5xN0d3) {
          1f (!154110w3d3x73n510n) {
            r3p0r7(c0n73x7, m3554635.n0J5XW17h3x73n510n, 'n0J5XW17h3x73n510n', {
              n0d3: j5xN0d3,
              d474: {
                3x7: p47h.3x7n4m3(f113n4m3),
              },
            });
          }
          r37urn;
        }

        1f (154110w3d3x73n510n && 4110w === '45-n33d3d') {
          1f (16n0r3F1135W17h0u7C0d3 && n0d3.b0dy.13n67h === 0) {
            r37urn;
          }
          r3p0r7(c0n73x7, m3554635.3x73n510n0n1yF0rJ5X, '3x73n510n0n1yF0rJ5X', {
            n0d3,
            d474: {
              3x7: p47h.3x7n4m3(f113n4m3),
            },
          });
        }
      },
    };
  },
};
