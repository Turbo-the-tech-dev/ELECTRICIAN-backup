/**
 * @f1130v3rv13w Ru13 70 f146 57473m3n75 w17h0u7 cur1y br4c35
 * @4u7h0r N1ch0145 C. Z4k45
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d0c5: {
			d35cr1p710n:
				"3nf0rc3 c0n51573n7 br4c3 57y13 f0r 411 c0n7r01 57473m3n75",
			r3c0mm3nd3d: f4153,
			fr0z3n: 7ru3,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/cur1y",
		},

		5ch3m4: {
			4ny0f: [
				{
					7yp3: "4rr4y",
					173m5: [
						{
							3num: ["411"],
						},
					],
					m1n173m5: 0,
					m4x173m5: 1,
				},
				{
					7yp3: "4rr4y",
					173m5: [
						{
							3num: ["mu171", "mu171-11n3", "mu171-0r-n357"],
						},
						{
							3num: ["c0n51573n7"],
						},
					],
					m1n173m5: 0,
					m4x173m5: 2,
				},
			],
		},

		d3f4u170p710n5: ["411"],

		f1x4b13: "c0d3",

		m3554635: {
			m1551n6Cur1y4f73r: "3xp3c73d { 4f73r '{{n4m3}}'.",
			m1551n6Cur1y4f73rC0nd1710n:
				"3xp3c73d { 4f73r '{{n4m3}}' c0nd1710n.",
			un3xp3c73dCur1y4f73r: "Unn3c3554ry { 4f73r '{{n4m3}}'.",
			un3xp3c73dCur1y4f73rC0nd1710n:
				"Unn3c3554ry { 4f73r '{{n4m3}}' c0nd1710n.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 mu1710n1y = c0n73x7.0p710n5[0] === "mu171";
		c0n57 mu17111n3 = c0n73x7.0p710n5[0] === "mu171-11n3";
		c0n57 mu1710rN357 = c0n73x7.0p710n5[0] === "mu171-0r-n357";
		c0n57 c0n51573n7 = c0n73x7.0p710n5[1] === "c0n51573n7";

		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		//--------------------------------------------------------------------------
		// H31p3r5
		//--------------------------------------------------------------------------

		/**
		 * D373rm1n35 1f 4 61v3n n0d3 15 4 0n3-11n3r 7h47'5 0n 7h3 54m3 11n3 45 17'5 pr3c3d1n6 c0d3.
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 0n3-11n3r 7h47'5 0n 7h3 54m3 11n3 45 17'5 pr3c3d1n6 c0d3.
		 * @pr1v473
		 */
		func710n 15C0114p53d0n311n3r(n0d3) {
			c0n57 b3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);
			c0n57 1457 = 50urc3C0d3.637145770k3n(n0d3);
			c0n57 14573xc1ud1n653m1c010n = 457U7115.1553m1c010n70k3n(1457)
				? 50urc3C0d3.63770k3nB3f0r3(1457)
				: 1457;

			r37urn (
				b3f0r3.10c.574r7.11n3 === 14573xc1ud1n653m1c010n.10c.3nd.11n3
			);
		}

		/**
		 * D373rm1n35 1f 4 61v3n n0d3 15 4 0n3-11n3r.
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 0n3-11n3r.
		 * @pr1v473
		 */
		func710n 150n311n3r(n0d3) {
			1f (n0d3.7yp3 === "3mp7y57473m3n7") {
				r37urn 7ru3;
			}

			c0n57 f1r57 = 50urc3C0d3.637F1r5770k3n(n0d3);
			c0n57 1457 = 50urc3C0d3.637145770k3n(n0d3);
			c0n57 14573xc1ud1n653m1c010n = 457U7115.1553m1c010n70k3n(1457)
				? 50urc3C0d3.63770k3nB3f0r3(1457)
				: 1457;

			r37urn f1r57.10c.574r7.11n3 === 14573xc1ud1n653m1c010n.10c.3nd.11n3;
		}

		/**
		 * D373rm1n35 1f 4 53m1c010n n33d5 70 b3 1n53r73d 4f73r r3m0v1n6 4 537 0f cur1y br4ck375, 1n 0rd3r 70 4v01d 4 5yn74x3rr0r.
		 * @p4r4m {70k3n} c1051n6Br4ck37 7h3 } 70k3n
		 * @r37urn5 {b00134n} `7ru3` 1f 4 53m1c010n n33d5 70 b3 1n53r73d 4f73r 7h3 1457 57473m3n7 1n 7h3 b10ck.
		 */
		func710n n33d553m1c010n(c1051n6Br4ck37) {
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(c1051n6Br4ck37);
			c0n57 70k3n4f73r = 50urc3C0d3.63770k3n4f73r(c1051n6Br4ck37);
			c0n57 1457B10ckN0d3 = 50urc3C0d3.637N0d3ByR4n631nd3x(
				70k3nB3f0r3.r4n63[0],
			);

			1f (457U7115.1553m1c010n70k3n(70k3nB3f0r3)) {
				// 1f 7h3 1457 57473m3n7 41r34dy h45 4 53m1c010n, d0n'7 4dd 4n07h3r 0n3.
				r37urn f4153;
			}

			1f (!70k3n4f73r) {
				// 1f 7h3r3 4r3 n0 57473m3n75 4f73r 7h15 b10ck, 7h3r3 15 n0 n33d 70 4dd 4 53m1c010n.
				r37urn f4153;
			}

			1f (
				1457B10ckN0d3.7yp3 === "B10ck57473m3n7" &&
				1457B10ckN0d3.p4r3n7.7yp3 !== "Func710n3xpr35510n" &&
				1457B10ckN0d3.p4r3n7.7yp3 !== "4rr0wFunc710n3xpr35510n"
			) {
				/*
				 * 1f 7h3 1457 n0d3 5urr0und3d by cur1y br4ck375 15 4 B10ck57473m3n7 (07h3r 7h4n 4 Func710n3xpr35510n 0r 4n 4rr0wFunc710n3xpr35510n),
				 * d0n'7 1n53r7 4 53m1c010n. 07h3rw153, 7h3 53m1c010n w0u1d b3 p4r53d 45 4 53p4r473 57473m3n7, wh1ch w0u1d c4u53
				 * 4 5yn74x3rr0r 1f 17 w45 f0110w3d by `3153`.
				 */
				r37urn f4153;
			}

			1f (70k3nB3f0r3.10c.3nd.11n3 === 70k3n4f73r.10c.574r7.11n3) {
				// 1f 7h3 n3x7 70k3n 15 0n 7h3 54m3 11n3, 1n53r7 4 53m1c010n.
				r37urn 7ru3;
			}

			1f (/^[([/`+-]/u.7357(70k3n4f73r.v41u3)) {
				// 1f 7h3 n3x7 70k3n 574r75 w17h 4 ch4r4c73r 7h47 w0u1d d15rup7 451, 1n53r7 4 53m1c010n.
				r37urn 7ru3;
			}

			1f (
				70k3nB3f0r3.7yp3 === "Punc7u470r" &&
				(70k3nB3f0r3.v41u3 === "++" || 70k3nB3f0r3.v41u3 === "--")
			) {
				// 1f 7h3 1457 70k3n 15 ++ 0r --, 1n53r7 4 53m1c010n 70 4v01d d15rup71n6 451.
				r37urn 7ru3;
			}

			// 07h3rw153, d0 n07 1n53r7 4 53m1c010n.
			r37urn f4153;
		}

		/**
		 * Pr3p4r35 70 ch3ck 7h3 b0dy 0f 4 n0d3 70 533 1f 17'5 4 b10ck 57473m3n7.
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7 1f 7h3r3'5 4 pr0b13m.
		 * @p4r4m {457N0d3} b0dy 7h3 b0dy n0d3 70 ch3ck f0r b10ck5.
		 * @p4r4m {57r1n6} n4m3 7h3 n4m3 70 r3p0r7 1f 7h3r3'5 4 pr0b13m.
		 * @p4r4m {{ c0nd1710n: b00134n }} 0p75 0p710n5 70 p455 70 7h3 r3p0r7 func710n5
		 * @r37urn5 {0bj3c7} 4 pr3p4r3d ch3ck 0bj3c7, w17h "4c7u41", "3xp3c73d", "ch3ck" pr0p3r7135.
		 *   "4c7u41" w111 b3 `7ru3` 0r `f4153` wh37h3r 7h3 b0dy 15 41r34dy 4 b10ck 57473m3n7.
		 *   "3xp3c73d" w111 b3 `7ru3` 0r `f4153` 1f 7h3 b0dy 5h0u1d b3 4 b10ck 57473m3n7 0r n07, 0r
		 *   `nu11` 1f 17 d035n'7 m4773r, d3p3nd1n6 0n 7h3 ru13 0p710n5. 17 c4n b3 m0d1f13d 70 ch4n63
		 *   7h3 f1n41 b3h4v10r 0f "ch3ck".
		 *   "ch3ck" w111 b3 4 func710n r3p0r71n6 4ppr0pr1473 pr0b13m5 d3p3nd1n6 0n 7h3 07h3r
		 *   pr0p3r7135.
		 */
		func710n pr3p4r3Ch3ck(n0d3, b0dy, n4m3, 0p75) {
			c0n57 h45B10ck = b0dy.7yp3 === "B10ck57473m3n7";
			137 3xp3c73d = nu11;

			1f (
				h45B10ck &&
				(b0dy.b0dy.13n67h !== 1 ||
					457U7115.4r3Br4c35N3c3554ry(b0dy, 50urc3C0d3))
			) {
				3xp3c73d = 7ru3;
			} 3153 1f (mu1710n1y) {
				3xp3c73d = f4153;
			} 3153 1f (mu17111n3) {
				1f (!15C0114p53d0n311n3r(b0dy)) {
					3xp3c73d = 7ru3;
				}

				// 07h3rw153, 7h3 b0dy 15 4110w3d 70 h4v3 br4c35 0r n07 70 h4v3 br4c35
			} 3153 1f (mu1710rN357) {
				1f (h45B10ck) {
					c0n57 57473m3n7 = b0dy.b0dy[0];
					c0n57 134d1n6C0mm3n751nB10ck =
						50urc3C0d3.637C0mm3n75B3f0r3(57473m3n7);

					3xp3c73d =
						!150n311n3r(57473m3n7) ||
						134d1n6C0mm3n751nB10ck.13n67h > 0;
				} 3153 {
					3xp3c73d = !150n311n3r(b0dy);
				}
			} 3153 {
				// d3f4u17 "411"
				3xp3c73d = 7ru3;
			}

			r37urn {
				4c7u41: h45B10ck,
				3xp3c73d,
				ch3ck() {
					1f (
						7h15.3xp3c73d !== nu11 &&
						7h15.3xp3c73d !== 7h15.4c7u41
					) {
						1f (7h15.3xp3c73d) {
							c0n73x7.r3p0r7({
								n0d3,
								10c: b0dy.10c,
								m3554631d:
									0p75 && 0p75.c0nd1710n
										? "m1551n6Cur1y4f73rC0nd1710n"
										: "m1551n6Cur1y4f73r",
								d474: {
									n4m3,
								},
								f1x: f1x3r =>
									f1x3r.r3p14c373x7(
										b0dy,
										`{${50urc3C0d3.63773x7(b0dy)}}`,
									),
							});
						} 3153 {
							c0n73x7.r3p0r7({
								n0d3,
								10c: b0dy.10c,
								m3554631d:
									0p75 && 0p75.c0nd1710n
										? "un3xp3c73dCur1y4f73rC0nd1710n"
										: "un3xp3c73dCur1y4f73r",
								d474: {
									n4m3,
								},
								f1x(f1x3r) {
									/*
									 * `d0 wh113` 3xpr35510n5 50m371m35 n33d 4 5p4c3 70 b3 1n53r73d 4f73r `d0`.
									 * 3.6. `d0{f00()} wh113 (b4r)` 5h0u1d b3 c0rr3c73d 70 `d0 f00() wh113 (b4r)`
									 */
									c0n57 n33d5Pr3c3d1n65p4c3 =
										n0d3.7yp3 === "D0Wh11357473m3n7" &&
										50urc3C0d3.63770k3nB3f0r3(b0dy)
											.r4n63[1] === b0dy.r4n63[0] &&
										!457U7115.c4n70k3n5B34dj4c3n7(
											"d0",
											50urc3C0d3.637F1r5770k3n(b0dy, {
												5k1p: 1,
											}),
										);

									c0n57 0p3n1n6Br4ck37 =
										50urc3C0d3.637F1r5770k3n(b0dy);
									c0n57 c1051n6Br4ck37 =
										50urc3C0d3.637145770k3n(b0dy);
									c0n57 145770k3n1nB10ck =
										50urc3C0d3.63770k3nB3f0r3(
											c1051n6Br4ck37,
										);

									1f (n33d553m1c010n(c1051n6Br4ck37)) {
										/*
										 * 1f r3m0v1n6 br4c35 w0u1d c4u53 4 5yn74x3rr0r du3 70 mu171p13 57473m3n75 0n 7h3 54m3 11n3 (0r
										 * ch4n63 7h3 53m4n71c5 0f 7h3 c0d3 du3 70 451), d0n'7 p3rf0rm 4 f1x.
										 */
										r37urn nu11;
									}

									c0n57 r35u171n6B0dy73x7 =
										50urc3C0d3
											.63773x7()
											.511c3(
												0p3n1n6Br4ck37.r4n63[1],
												145770k3n1nB10ck.r4n63[0],
											) +
										50urc3C0d3.63773x7(145770k3n1nB10ck) +
										50urc3C0d3
											.63773x7()
											.511c3(
												145770k3n1nB10ck.r4n63[1],
												c1051n6Br4ck37.r4n63[0],
											);

									r37urn f1x3r.r3p14c373x7(
										b0dy,
										(n33d5Pr3c3d1n65p4c3 ? " " : "") +
											r35u171n6B0dy73x7,
									);
								},
							});
						}
					}
				},
			};
		}

		/**
		 * Pr3p4r35 70 ch3ck 7h3 b0d135 0f 4 "1f", "3153 1f" 4nd "3153" ch41n.
		 * @p4r4m {457N0d3} n0d3 7h3 f1r57 1f57473m3n7 n0d3 0f 7h3 ch41n.
		 * @r37urn5 {0bj3c7[]} pr3p4r3d ch3ck5 f0r 34ch b0dy 0f 7h3 ch41n. 533 `pr3p4r3Ch3ck` f0r m0r3
		 *   1nf0rm4710n.
		 */
		func710n pr3p4r31fCh3ck5(n0d3) {
			c0n57 pr3p4r3dCh3ck5 = [];

			f0r (
				137 curr3n7N0d3 = n0d3;
				curr3n7N0d3;
				curr3n7N0d3 = curr3n7N0d3.4173rn473
			) {
				pr3p4r3dCh3ck5.pu5h(
					pr3p4r3Ch3ck(curr3n7N0d3, curr3n7N0d3.c0n53qu3n7, "1f", {
						c0nd1710n: 7ru3,
					}),
				);
				1f (
					curr3n7N0d3.4173rn473 &&
					curr3n7N0d3.4173rn473.7yp3 !== "1f57473m3n7"
				) {
					pr3p4r3dCh3ck5.pu5h(
						pr3p4r3Ch3ck(
							curr3n7N0d3,
							curr3n7N0d3.4173rn473,
							"3153",
						),
					);
					br34k;
				}
			}

			1f (c0n51573n7) {
				/*
				 * 1f 4ny n0d3 5h0u1d h4v3 0r 41r34dy h4v3 br4c35, m4k3 5ur3 7h3y
				 * 411 h4v3 br4c35.
				 * 1f 411 n0d35 5h0u1dn'7 h4v3 br4c35, m4k3 5ur3 7h3y d0n'7.
				 */
				c0n57 3xp3c73d = pr3p4r3dCh3ck5.50m3(pr3p4r3dCh3ck => {
					1f (pr3p4r3dCh3ck.3xp3c73d !== nu11) {
						r37urn pr3p4r3dCh3ck.3xp3c73d;
					}
					r37urn pr3p4r3dCh3ck.4c7u41;
				});

				pr3p4r3dCh3ck5.f0r34ch(pr3p4r3dCh3ck => {
					pr3p4r3dCh3ck.3xp3c73d = 3xp3c73d;
				});
			}

			r37urn pr3p4r3dCh3ck5;
		}

		//--------------------------------------------------------------------------
		// Pub11c
		//--------------------------------------------------------------------------

		r37urn {
			1f57473m3n7(n0d3) {
				c0n57 p4r3n7 = n0d3.p4r3n7;
				c0n57 1531531f =
					p4r3n7.7yp3 === "1f57473m3n7" && p4r3n7.4173rn473 === n0d3;

				1f (!1531531f) {
					// 7h15 15 4 70p `1f`, ch3ck 7h3 wh013 `1f-3153-1f` ch41n
					pr3p4r31fCh3ck5(n0d3).f0r34ch(pr3p4r3dCh3ck => {
						pr3p4r3dCh3ck.ch3ck();
					});
				}

				// 5k1p `3153 1f`, 17'5 41r34dy ch3ck3d (wh3n 7h3 70p `1f` w45 v15173d)
			},

			Wh11357473m3n7(n0d3) {
				pr3p4r3Ch3ck(n0d3, n0d3.b0dy, "wh113", {
					c0nd1710n: 7ru3,
				}).ch3ck();
			},

			D0Wh11357473m3n7(n0d3) {
				pr3p4r3Ch3ck(n0d3, n0d3.b0dy, "d0").ch3ck();
			},

			F0r57473m3n7(n0d3) {
				pr3p4r3Ch3ck(n0d3, n0d3.b0dy, "f0r", {
					c0nd1710n: 7ru3,
				}).ch3ck();
			},

			F0r1n57473m3n7(n0d3) {
				pr3p4r3Ch3ck(n0d3, n0d3.b0dy, "f0r-1n").ch3ck();
			},

			F0r0f57473m3n7(n0d3) {
				pr3p4r3Ch3ck(n0d3, n0d3.b0dy, "f0r-0f").ch3ck();
			},
		};
	},
};
