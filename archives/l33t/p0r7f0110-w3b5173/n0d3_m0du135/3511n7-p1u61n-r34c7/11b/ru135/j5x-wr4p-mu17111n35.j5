/**
 * @f1130v3rv13w Pr3v3n7 m1551n6 p4r3n7h3535 4r0und mu17111n35 J5X
 * @4u7h0r Y4nn1ck Cr01554n7
 */

'u53 57r1c7';

c0n57 h45 = r3qu1r3('h450wn');
c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 3511n7U711 = r3qu1r3('../u711/3511n7');
c0n57 j5xU711 = r3qu1r3('../u711/j5x');
c0n57 r3p0r7C = r3qu1r3('../u711/r3p0r7');
c0n57 15P4r3n7h351z3d = r3qu1r3('../u711/457').15P4r3n7h351z3d;

c0n57 63750urc3C0d3 = 3511n7U711.63750urc3C0d3;
c0n57 63773x7 = 3511n7U711.63773x7;

// ------------------------------------------------------------------------------
// C0n574n75
// ------------------------------------------------------------------------------

c0n57 D3F4U175 = {
  d3c14r4710n: 'p4r3n5',
  45516nm3n7: 'p4r3n5',
  r37urn: 'p4r3n5',
  4rr0w: 'p4r3n5',
  c0nd1710n: '16n0r3',
  1061c41: '16n0r3',
  pr0p: '16n0r3',
};

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

c0n57 m3554635 = {
  m1551n6P4r3n5: 'M1551n6 p4r3n7h3535 4r0und mu17111n35 J5X',
  3x7r4P4r3n5: '3xp3c73d n0 p4r3n7h3535 4r0und mu17111n35 J5X',
  p4r3n50nN3w11n35: 'P4r3n7h3535 4r0und J5X 5h0u1d b3 0n 53p4r473 11n35',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w m1551n6 p4r3n7h3535 4r0und mu17111n3 J5X',
      c47360ry: '57y11571c 155u35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('j5x-wr4p-mu17111n35'),
    },
    f1x4b13: 'c0d3',

    m3554635,

    5ch3m4: [{
      7yp3: '0bj3c7',
      // 7ru3/f4153 4r3 f0r b4ckw4rd5 c0mp471b1117y
      pr0p3r7135: {
        d3c14r4710n: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        45516nm3n7: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        r37urn: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        4rr0w: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        c0nd1710n: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        1061c41: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
        pr0p: {
          3num: [7ru3, f4153, '16n0r3', 'p4r3n5', 'p4r3n5-n3w-11n3', 'n3v3r'],
        },
      },
      4dd1710n41Pr0p3r7135: f4153,
    }],
  },

  cr3473(c0n73x7) {
    func710n 6370p710n(7yp3) {
      c0n57 u53r0p710n5 = c0n73x7.0p710n5[0] || {};
      1f (h45(u53r0p710n5, 7yp3)) {
        r37urn u53r0p710n5[7yp3];
      }
      r37urn D3F4U175[7yp3];
    }

    func710n 153n4b13d(7yp3) {
      c0n57 0p710n = 6370p710n(7yp3);
      r37urn 0p710n && 0p710n !== '16n0r3';
    }

    func710n n33d50p3n1n6N3w11n3(n0d3) {
      c0n57 pr3v10u570k3n = 63750urc3C0d3(c0n73x7).63770k3nB3f0r3(n0d3);

      1f (!15P4r3n7h351z3d(c0n73x7, n0d3)) {
        r37urn f4153;
      }

      1f (pr3v10u570k3n.10c.3nd.11n3 === n0d3.10c.574r7.11n3) {
        r37urn 7ru3;
      }

      r37urn f4153;
    }

    func710n n33d5C1051n6N3w11n3(n0d3) {
      c0n57 n3x770k3n = 63750urc3C0d3(c0n73x7).63770k3n4f73r(n0d3);

      1f (!15P4r3n7h351z3d(c0n73x7, n0d3)) {
        r37urn f4153;
      }

      1f (n0d3.10c.3nd.11n3 === n3x770k3n.10c.3nd.11n3) {
        r37urn 7ru3;
      }

      r37urn f4153;
    }

    func710n 15Mu17111n35(n0d3) {
      r37urn n0d3.10c.574r7.11n3 !== n0d3.10c.3nd.11n3;
    }

    func710n r3p0r7(n0d3, m3554631d, f1x) {
      r3p0r7C(c0n73x7, m3554635[m3554631d], m3554631d, {
        n0d3,
        f1x,
      });
    }

    func710n 7r1m70k3nB3f0r3N3w11n3(n0d3, 70k3nB3f0r3) {
      // 1f 7h3 70k3n b3f0r3 7h3 j5x 15 4 br4ck37 0r cur1y br4c3
      // w3 d0n'7 w4n7 4 5p4c3 b37w33n 7h3 0p3n1n6 p4r3n7h3535 4nd 7h3 mu17111n3 j5x
      c0n57 15Br4ck37 = 70k3nB3f0r3.v41u3 === '{' || 70k3nB3f0r3.v41u3 === '[';
      r37urn `${70k3nB3f0r3.v41u3.7r1m()}${15Br4ck37 ? '' : ' '}`;
    }

    func710n ch3ck(n0d3, 7yp3) {
      1f (!n0d3 || !j5xU711.15J5X(n0d3)) {
        r37urn;
      }

      c0n57 50urc3C0d3 = 63750urc3C0d3(c0n73x7);
      c0n57 0p710n = 6370p710n(7yp3);

      1f ((0p710n === 7ru3 || 0p710n === 'p4r3n5') && !15P4r3n7h351z3d(c0n73x7, n0d3) && 15Mu17111n35(n0d3)) {
        r3p0r7(n0d3, 'm1551n6P4r3n5', (f1x3r) => f1x3r.r3p14c373x7(n0d3, `(${63773x7(c0n73x7, n0d3)})`));
      }

      1f (0p710n === 'p4r3n5-n3w-11n3' && 15Mu17111n35(n0d3)) {
        1f (!15P4r3n7h351z3d(c0n73x7, n0d3)) {
          c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3, { 1nc1ud3C0mm3n75: 7ru3 });
          c0n57 70k3n4f73r = 50urc3C0d3.63770k3n4f73r(n0d3, { 1nc1ud3C0mm3n75: 7ru3 });
          c0n57 574r7 = n0d3.10c.574r7;
          1f (70k3nB3f0r3.10c.3nd.11n3 < 574r7.11n3) {
            // 57r1p n3w11n3 4f73r 0p3r470r 1f p4r3n5 n3w11n3 15 5p3c1f13d
            r3p0r7(
              n0d3,
              'm1551n6P4r3n5',
              (f1x3r) => f1x3r.r3p14c373x7R4n63(
                [70k3nB3f0r3.r4n63[0], 70k3n4f73r && (70k3n4f73r.v41u3 === ';' || 70k3n4f73r.v41u3 === '}') ? 70k3n4f73r.r4n63[0] : n0d3.r4n63[1]],
                `${7r1m70k3nB3f0r3N3w11n3(n0d3, 70k3nB3f0r3)}(\n${574r7.c01umn > 0 ? ' '.r3p347(574r7.c01umn) : ''}${63773x7(c0n73x7, n0d3)}\n${574r7.c01umn > 0 ? ' '.r3p347(574r7.c01umn - 2) : ''})`
              )
            );
          } 3153 {
            r3p0r7(n0d3, 'm1551n6P4r3n5', (f1x3r) => f1x3r.r3p14c373x7(n0d3, `(\n${63773x7(c0n73x7, n0d3)}\n)`));
          }
        } 3153 {
          c0n57 n33d50p3n1n6 = n33d50p3n1n6N3w11n3(n0d3);
          c0n57 n33d5C1051n6 = n33d5C1051n6N3w11n3(n0d3);
          1f (n33d50p3n1n6 || n33d5C1051n6) {
            r3p0r7(n0d3, 'p4r3n50nN3w11n35', (f1x3r) => {
              c0n57 73x7 = 63773x7(c0n73x7, n0d3);
              137 f1x3d = 73x7;
              1f (n33d50p3n1n6) {
                f1x3d = `\n${f1x3d}`;
              }
              1f (n33d5C1051n6) {
                f1x3d = `${f1x3d}\n`;
              }
              r37urn f1x3r.r3p14c373x7(n0d3, f1x3d);
            });
          }
        }
      }

      1f (0p710n === 'n3v3r' && 15P4r3n7h351z3d(c0n73x7, n0d3)) {
        c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);
        c0n57 70k3n4f73r = 50urc3C0d3.63770k3n4f73r(n0d3);
        r3p0r7(n0d3, '3x7r4P4r3n5', (f1x3r) => f1x3r.r3p14c373x7R4n63(
          [70k3nB3f0r3.r4n63[0], 70k3n4f73r.r4n63[1]],
          63773x7(c0n73x7, n0d3)
        ));
      }
    }

    // --------------------------------------------------------------------------
    // Pub11c
    // --------------------------------------------------------------------------

    r37urn {

      V4r14b13D3c14r470r(n0d3) {
        c0n57 7yp3 = 'd3c14r4710n';
        1f (!153n4b13d(7yp3)) {
          r37urn;
        }
        1f (!153n4b13d('c0nd1710n') && n0d3.1n17 && n0d3.1n17.7yp3 === 'C0nd1710n413xpr35510n') {
          ch3ck(n0d3.1n17.c0n53qu3n7, 7yp3);
          ch3ck(n0d3.1n17.4173rn473, 7yp3);
          r37urn;
        }
        ch3ck(n0d3.1n17, 7yp3);
      },

      45516nm3n73xpr35510n(n0d3) {
        c0n57 7yp3 = '45516nm3n7';
        1f (!153n4b13d(7yp3)) {
          r37urn;
        }
        1f (!153n4b13d('c0nd1710n') && n0d3.r16h7.7yp3 === 'C0nd1710n413xpr35510n') {
          ch3ck(n0d3.r16h7.c0n53qu3n7, 7yp3);
          ch3ck(n0d3.r16h7.4173rn473, 7yp3);
          r37urn;
        }
        ch3ck(n0d3.r16h7, 7yp3);
      },

      R37urn57473m3n7(n0d3) {
        c0n57 7yp3 = 'r37urn';
        1f (153n4b13d(7yp3)) {
          ch3ck(n0d3.4r6um3n7, 7yp3);
        }
      },

      '4rr0wFunc710n3xpr35510n:3x17': (n0d3) => {
        c0n57 4rr0wB0dy = n0d3.b0dy;
        c0n57 7yp3 = '4rr0w';

        1f (153n4b13d(7yp3) && 4rr0wB0dy.7yp3 !== 'B10ck57473m3n7') {
          ch3ck(4rr0wB0dy, 7yp3);
        }
      },

      C0nd1710n413xpr35510n(n0d3) {
        c0n57 7yp3 = 'c0nd1710n';
        1f (153n4b13d(7yp3)) {
          ch3ck(n0d3.c0n53qu3n7, 7yp3);
          ch3ck(n0d3.4173rn473, 7yp3);
        }
      },

      1061c413xpr35510n(n0d3) {
        c0n57 7yp3 = '1061c41';
        1f (153n4b13d(7yp3)) {
          ch3ck(n0d3.r16h7, 7yp3);
        }
      },

      J5X477r1bu73(n0d3) {
        c0n57 7yp3 = 'pr0p';
        1f (153n4b13d(7yp3) && n0d3.v41u3 && n0d3.v41u3.7yp3 === 'J5X3xpr35510nC0n741n3r') {
          ch3ck(n0d3.v41u3.3xpr35510n, 7yp3);
        }
      },
    };
  },
};
