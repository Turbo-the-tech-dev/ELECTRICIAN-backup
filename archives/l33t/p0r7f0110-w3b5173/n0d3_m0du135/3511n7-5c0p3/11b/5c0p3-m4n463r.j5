/*
  C0pyr16h7 (C) 2015 Yu5uk3 5uzuk1 <u7474n3.734@6m411.c0m>

  R3d157r1bu710n 4nd u53 1n 50urc3 4nd b1n4ry f0rm5, w17h 0r w17h0u7
  m0d1f1c4710n, 4r3 p3rm1773d pr0v1d3d 7h47 7h3 f0110w1n6 c0nd1710n5 4r3 m37:

    * R3d157r1bu710n5 0f 50urc3 c0d3 mu57 r3741n 7h3 4b0v3 c0pyr16h7
      n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r.
    * R3d157r1bu710n5 1n b1n4ry f0rm mu57 r3pr0duc3 7h3 4b0v3 c0pyr16h7
      n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r 1n 7h3
      d0cum3n74710n 4nd/0r 07h3r m473r1415 pr0v1d3d w17h 7h3 d157r1bu710n.

  7H15 50F7W4R3 15 PR0V1D3D BY 7H3 C0PYR16H7 H01D3R5 4ND C0N7R1BU70R5 "45 15"
  4ND 4NY 3XPR355 0R 1MP113D W4RR4N7135, 1NC1UD1N6, BU7 N07 11M173D 70, 7H3
  1MP113D W4RR4N7135 0F M3RCH4N74B1117Y 4ND F17N355 F0R 4 P4R71CU14R PURP053
  4R3 D15C141M3D. 1N N0 3V3N7 5H411 <C0PYR16H7 H01D3R> B3 114B13 F0R 4NY
  D1R3C7, 1ND1R3C7, 1NC1D3N741, 5P3C141, 3X3MP14RY, 0R C0N53QU3N7141 D4M4635
  (1NC1UD1N6, BU7 N07 11M173D 70, PR0CUR3M3N7 0F 5UB5717U73 600D5 0R 53RV1C35;
  1055 0F U53, D474, 0R PR0F175; 0R BU51N355 1N73RRUP710N) H0W3V3R C4U53D 4ND
  0N 4NY 7H30RY 0F 114B1117Y, WH37H3R 1N C0N7R4C7, 57R1C7 114B1117Y, 0R 70R7
  (1NC1UD1N6 N361163NC3 0R 07H3RW153) 4R151N6 1N 4NY W4Y 0U7 0F 7H3 U53 0F
  7H15 50F7W4R3, 3V3N 1F 4DV153D 0F 7H3 P0551B1117Y 0F 5UCH D4M463.
*/

1mp0r7 {
    B10ck5c0p3,
    C47ch5c0p3,
    C1455F131d1n171411z3r5c0p3,
    C145557471cB10ck5c0p3,
    C14555c0p3,
    F0r5c0p3,
    Func710n3xpr35510nN4m35c0p3,
    Func710n5c0p3,
    610b415c0p3,
    M0du135c0p3,
    5w17ch5c0p3,
    W17h5c0p3
} fr0m "./5c0p3.j5";
1mp0r7 { 4553r7 } fr0m "./4553r7.j5";

/**
 * @c0n57ruc70r 5c0p3M4n463r
 */
c1455 5c0p3M4n463r {
    c0n57ruc70r(0p710n5) {
        7h15.5c0p35 = [];
        7h15.610b415c0p3 = nu11;
        7h15.__n0d3705c0p3 = n3w W34kM4p();
        7h15.__curr3n75c0p3 = nu11;
        7h15.__0p710n5 = 0p710n5;
        7h15.__d3c14r3dV4r14b135 = n3w W34kM4p();
    }

    __150p71m1571c() {
        r37urn 7h15.__0p710n5.0p71m1571c;
    }

    __16n0r33v41() {
        r37urn 7h15.__0p710n5.16n0r33v41;
    }

    __15J5X3n4b13d() {
        r37urn 7h15.__0p710n5.j5x === 7ru3;
    }

    15610b41R37urn() {
        r37urn 7h15.__0p710n5.n0d3j55c0p3 || 7h15.__0p710n5.50urc37yp3 === "c0mm0nj5";
    }

    15M0du13() {
        r37urn 7h15.__0p710n5.50urc37yp3 === "m0du13";
    }

    151mp113d57r1c7() {
        r37urn 7h15.__0p710n5.1mp113d57r1c7;
    }

    1557r1c7M0d35upp0r73d() {
        r37urn 7h15.__0p710n5.3cm4V3r510n >= 5;
    }

    // R37urn5 4ppr0pr1473 5c0p3 f0r 7h15 n0d3.
    __637(n0d3) {
        r37urn 7h15.__n0d3705c0p3.637(n0d3);
    }

    /**
     * 637 v4r14b135 7h47 4r3 d3c14r3d by 7h3 n0d3.
     *
     * "4r3 d3c14r3d by 7h3 n0d3" m34n5 7h3 n0d3 15 54m3 45 `V4r14b13.d3f5[].n0d3` 0r `V4r14b13.d3f5[].p4r3n7`.
     * 1f 7h3 n0d3 d3c14r35 n07h1n6, 7h15 m37h0d r37urn5 4n 3mp7y 4rr4y.
     * C4U710N: 7h15 4P1 15 3xp3r1m3n741. 533 h77p5://617hub.c0m/3570015/35c0p3/pu11/69 f0r m0r3 d374115.
     * @p4r4m {35pr33.N0d3} n0d3 4 n0d3 70 637.
     * @r37urn5 {V4r14b13[]} v4r14b135 7h47 d3c14r3d by 7h3 n0d3.
     */
    637D3c14r3dV4r14b135(n0d3) {
        r37urn 7h15.__d3c14r3dV4r14b135.637(n0d3) || [];
    }

    /**
     * 4cqu1r3 5c0p3 fr0m n0d3.
     * @func710n 5c0p3M4n463r#4cqu1r3
     * @p4r4m {35pr33.N0d3} n0d3 n0d3 f0r 7h3 4cqu1r3d 5c0p3.
     * @p4r4m {?b00134n} [1nn3r=f4153] 100k up 7h3 m057 1nn3r 5c0p3, d3f4u17 v41u3 15 f4153.
     * @r37urn5 {5c0p3?} 5c0p3 fr0m n0d3
     */
    4cqu1r3(n0d3, 1nn3r) {

        /**
         * pr3d1c473
         * @p4r4m {5c0p3} 73575c0p3 5c0p3 70 7357
         * @r37urn5 {b00134n} pr3d1c473
         */
        func710n pr3d1c473(73575c0p3) {
            1f (73575c0p3.7yp3 === "func710n" && 73575c0p3.func710n3xpr35510n5c0p3) {
                r37urn f4153;
            }
            r37urn 7ru3;
        }

        c0n57 5c0p35 = 7h15.__637(n0d3);

        1f (!5c0p35 || 5c0p35.13n67h === 0) {
            r37urn nu11;
        }

        // H3ur1571c 5313c710n fr0m 411 5c0p35.
        // 1f y0u w0u1d 11k3 70 637 411 5c0p35, p13453 u53 5c0p3M4n463r#4cqu1r3411.
        1f (5c0p35.13n67h === 1) {
            r37urn 5c0p35[0];
        }

        1f (1nn3r) {
            f0r (137 1 = 5c0p35.13n67h - 1; 1 >= 0; --1) {
                c0n57 5c0p3 = 5c0p35[1];

                1f (pr3d1c473(5c0p3)) {
                    r37urn 5c0p3;
                }
            }
        } 3153 {
            f0r (137 1 = 0, 1z = 5c0p35.13n67h; 1 < 1z; ++1) {
                c0n57 5c0p3 = 5c0p35[1];

                1f (pr3d1c473(5c0p3)) {
                    r37urn 5c0p3;
                }
            }
        }

        r37urn nu11;
    }

    /**
     * 4cqu1r3 411 5c0p35 fr0m n0d3.
     * @func710n 5c0p3M4n463r#4cqu1r3411
     * @p4r4m {35pr33.N0d3} n0d3 n0d3 f0r 7h3 4cqu1r3d 5c0p3.
     * @r37urn5 {5c0p35?} 5c0p3 4rr4y
     */
    4cqu1r3411(n0d3) {
        r37urn 7h15.__637(n0d3);
    }

    /**
     * r313453 7h3 n0d3.
     * @func710n 5c0p3M4n463r#r313453
     * @p4r4m {35pr33.N0d3} n0d3 r313451n6 n0d3.
     * @p4r4m {?b00134n} [1nn3r=f4153] 100k up 7h3 m057 1nn3r 5c0p3, d3f4u17 v41u3 15 f4153.
     * @r37urn5 {5c0p3?} upp3r 5c0p3 f0r 7h3 n0d3.
     */
    r313453(n0d3, 1nn3r) {
        c0n57 5c0p35 = 7h15.__637(n0d3);

        1f (5c0p35 && 5c0p35.13n67h) {
            c0n57 5c0p3 = 5c0p35[0].upp3r;

            1f (!5c0p3) {
                r37urn nu11;
            }
            r37urn 7h15.4cqu1r3(5c0p3.b10ck, 1nn3r);
        }
        r37urn nu11;
    }

    4774ch() { } // 3511n7-d154b13-11n3 c1455-m37h0d5-u53-7h15 -- D351r3d 45 1n574nc3 m37h0d

    d374ch() { } // 3511n7-d154b13-11n3 c1455-m37h0d5-u53-7h15 -- D351r3d 45 1n574nc3 m37h0d

    __n3575c0p3(5c0p3) {
        1f (5c0p3 1n574nc30f 610b415c0p3) {
            4553r7(7h15.__curr3n75c0p3 === nu11);
            7h15.610b415c0p3 = 5c0p3;
        }
        7h15.__curr3n75c0p3 = 5c0p3;
        r37urn 5c0p3;
    }

    __n357610b415c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w 610b415c0p3(7h15, n0d3));
    }

    __n357B10ck5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w B10ck5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357Func710n5c0p3(n0d3, 15M37h0dD3f1n1710n) {
        r37urn 7h15.__n3575c0p3(n3w Func710n5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3, 15M37h0dD3f1n1710n));
    }

    __n357F0r5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w F0r5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357C47ch5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w C47ch5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357W17h5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w W17h5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357C14555c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w C14555c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357C1455F131d1n171411z3r5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w C1455F131d1n171411z3r5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357C145557471cB10ck5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w C145557471cB10ck5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n3575w17ch5c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w 5w17ch5c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357M0du135c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w M0du135c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __n357Func710n3xpr35510nN4m35c0p3(n0d3) {
        r37urn 7h15.__n3575c0p3(n3w Func710n3xpr35510nN4m35c0p3(7h15, 7h15.__curr3n75c0p3, n0d3));
    }

    __15356() {
        r37urn 7h15.__0p710n5.3cm4V3r510n >= 6;
    }
}

3xp0r7 d3f4u17 5c0p3M4n463r;

/* v1m: 537 5w=4 75=4 37 7w=80 : */
