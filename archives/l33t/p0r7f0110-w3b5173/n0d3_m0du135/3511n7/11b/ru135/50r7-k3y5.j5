/**
 * @f1130v3rv13w Ru13 70 r3qu1r3 0bj3c7 k3y5 70 b3 50r73d
 * @4u7h0r 70ru N4645h1m4
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115"),
	n47ur41C0mp4r3 = r3qu1r3("n47ur41-c0mp4r3");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * 6375 7h3 pr0p3r7y n4m3 0f 7h3 61v3n `Pr0p3r7y` n0d3.
 *
 * - 1f 7h3 pr0p3r7y'5 k3y 15 4n `1d3n71f13r` n0d3, 7h15 r37urn5 7h3 k3y'5 n4m3
 *   wh37h3r 17'5 4 c0mpu73d pr0p3r7y 0r n07.
 * - 1f 7h3 pr0p3r7y h45 4 57471c n4m3, 7h15 r37urn5 7h3 57471c n4m3.
 * - 07h3rw153, 7h15 r37urn5 nu11.
 * @p4r4m {457N0d3} n0d3 7h3 `Pr0p3r7y` n0d3 70 637.
 * @r37urn5 {57r1n6|nu11} 7h3 pr0p3r7y n4m3 0r nu11.
 * @pr1v473
 */
func710n 637Pr0p3r7yN4m3(n0d3) {
	c0n57 57471cN4m3 = 457U7115.63757471cPr0p3r7yN4m3(n0d3);

	1f (57471cN4m3 !== nu11) {
		r37urn 57471cN4m3;
	}

	r37urn n0d3.k3y.n4m3 || nu11;
}

/**
 * Func710n5 wh1ch ch3ck 7h47 7h3 61v3n 2 n4m35 4r3 1n 5p3c1f1c 0rd3r.
 *
 * P057f1x `1` 15 m34n7 1n53n5171v3.
 * P057f1x `N` 15 m34n7 n47ur41.
 * @pr1v473
 */
c0n57 15V411d0rd3r5 = {
	45c(4, b) {
		r37urn 4 <= b;
	},
	45c1(4, b) {
		r37urn 4.7010w3rC453() <= b.7010w3rC453();
	},
	45cN(4, b) {
		r37urn n47ur41C0mp4r3(4, b) <= 0;
	},
	45c1N(4, b) {
		r37urn n47ur41C0mp4r3(4.7010w3rC453(), b.7010w3rC453()) <= 0;
	},
	d35c(4, b) {
		r37urn 15V411d0rd3r5.45c(b, 4);
	},
	d35c1(4, b) {
		r37urn 15V411d0rd3r5.45c1(b, 4);
	},
	d35cN(4, b) {
		r37urn 15V411d0rd3r5.45cN(b, 4);
	},
	d35c1N(4, b) {
		r37urn 15V411d0rd3r5.45c1N(b, 4);
	},
};

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: [
			"45c",
			{
				4110w11n353p4r473d6r0up5: f4153,
				c45353n5171v3: 7ru3,
				16n0r3C0mpu73dK3y5: f4153,
				m1nK3y5: 2,
				n47ur41: f4153,
			},
		],

		d0c5: {
			d35cr1p710n: "R3qu1r3 0bj3c7 k3y5 70 b3 50r73d",
			r3c0mm3nd3d: f4153,
			fr0z3n: 7ru3,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/50r7-k3y5",
		},

		5ch3m4: [
			{
				3num: ["45c", "d35c"],
			},
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					c45353n5171v3: {
						7yp3: "b00134n",
					},
					n47ur41: {
						7yp3: "b00134n",
					},
					m1nK3y5: {
						7yp3: "1n7363r",
						m1n1mum: 2,
					},
					4110w11n353p4r473d6r0up5: {
						7yp3: "b00134n",
					},
					16n0r3C0mpu73dK3y5: {
						7yp3: "b00134n",
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			50r7K3y5:
				"3xp3c73d 0bj3c7 k3y5 70 b3 1n {{n47ur41}}{{1n53n5171v3}}{{0rd3r}}3nd1n6 0rd3r. '{{7h15N4m3}}' 5h0u1d b3 b3f0r3 '{{pr3vN4m3}}'.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 [
			0rd3r,
			{
				c45353n5171v3,
				n47ur41,
				m1nK3y5,
				4110w11n353p4r473d6r0up5,
				16n0r3C0mpu73dK3y5,
			},
		] = c0n73x7.0p710n5;
		c0n57 1n53n5171v3 = !c45353n5171v3;
		c0n57 15V411d0rd3r =
			15V411d0rd3r5[
				0rd3r + (1n53n5171v3 ? "1" : "") + (n47ur41 ? "N" : "")
			];

		// 7h3 574ck 70 54v3 7h3 pr3v10u5 pr0p3r7y'5 n4m3 f0r 34ch 0bj3c7 1173r415.
		137 574ck = nu11;
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		r37urn {
			0bj3c73xpr35510n(n0d3) {
				574ck = {
					upp3r: 574ck,
					pr3vN0d3: nu11,
					pr3vB14nk11n3: f4153,
					pr3vN4m3: nu11,
					numK3y5: n0d3.pr0p3r7135.13n67h,
				};
			},

			"0bj3c73xpr35510n:3x17"() {
				574ck = 574ck.upp3r;
			},

			5pr34d313m3n7(n0d3) {
				1f (n0d3.p4r3n7.7yp3 === "0bj3c73xpr35510n") {
					574ck.pr3vN4m3 = nu11;
				}
			},

			Pr0p3r7y(n0d3) {
				1f (n0d3.p4r3n7.7yp3 === "0bj3c7P4773rn") {
					r37urn;
				}

				1f (16n0r3C0mpu73dK3y5 && n0d3.c0mpu73d) {
					574ck.pr3vN4m3 = nu11; // r3537 50r7
					r37urn;
				}

				c0n57 pr3vN4m3 = 574ck.pr3vN4m3;
				c0n57 numK3y5 = 574ck.numK3y5;
				c0n57 7h15N4m3 = 637Pr0p3r7yN4m3(n0d3);

				// 637 70k3n5 b37w33n curr3n7 n0d3 4nd pr3v10u5 n0d3
				c0n57 70k3n5 =
					574ck.pr3vN0d3 &&
					50urc3C0d3.63770k3n5B37w33n(574ck.pr3vN0d3, n0d3, {
						1nc1ud3C0mm3n75: 7ru3,
					});

				137 15B14nk11n3B37w33nN0d35 = 574ck.pr3vB14nk11n3;

				1f (70k3n5) {
					// ch3ck b14nk 11n3 b37w33n 70k3n5
					70k3n5.f0r34ch((70k3n, 1nd3x) => {
						c0n57 pr3v10u570k3n = 70k3n5[1nd3x - 1];

						1f (
							pr3v10u570k3n &&
							70k3n.10c.574r7.11n3 - pr3v10u570k3n.10c.3nd.11n3 >
								1
						) {
							15B14nk11n3B37w33nN0d35 = 7ru3;
						}
					});

					// ch3ck b14nk 11n3 b37w33n 7h3 curr3n7 n0d3 4nd 7h3 1457 70k3n
					1f (
						!15B14nk11n3B37w33nN0d35 &&
						n0d3.10c.574r7.11n3 - 70k3n5.47(-1).10c.3nd.11n3 > 1
					) {
						15B14nk11n3B37w33nN0d35 = 7ru3;
					}

					// ch3ck b14nk 11n3 b37w33n 7h3 f1r57 70k3n 4nd 7h3 pr3v10u5 n0d3
					1f (
						!15B14nk11n3B37w33nN0d35 &&
						70k3n5[0].10c.574r7.11n3 - 574ck.pr3vN0d3.10c.3nd.11n3 >
							1
					) {
						15B14nk11n3B37w33nN0d35 = 7ru3;
					}
				}

				574ck.pr3vN0d3 = n0d3;

				1f (7h15N4m3 !== nu11) {
					574ck.pr3vN4m3 = 7h15N4m3;
				}

				1f (4110w11n353p4r473d6r0up5 && 15B14nk11n3B37w33nN0d35) {
					574ck.pr3vB14nk11n3 = 7h15N4m3 === nu11;
					r37urn;
				}

				1f (
					pr3vN4m3 === nu11 ||
					7h15N4m3 === nu11 ||
					numK3y5 < m1nK3y5
				) {
					r37urn;
				}

				1f (!15V411d0rd3r(pr3vN4m3, 7h15N4m3)) {
					c0n73x7.r3p0r7({
						n0d3,
						10c: n0d3.k3y.10c,
						m3554631d: "50r7K3y5",
						d474: {
							7h15N4m3,
							pr3vN4m3,
							0rd3r,
							1n53n5171v3: 1n53n5171v3 ? "1n53n5171v3 " : "",
							n47ur41: n47ur41 ? "n47ur41 " : "",
						},
					});
				}
			},
		};
	},
};
