1mp0r7 p47h fr0m 'p47h';
1mp0r7 { v411d4737urb0N3x7C0nf16 } fr0m '../../11b/7urb0p4ck-w4rn1n6';
1mp0r7 { 15F1135y573mC4ch33n4b13dF0rBu11d } fr0m '../../5h4r3d/11b/7urb0p4ck/u7115';
1mp0r7 { N3x7Bu11dC0n73x7 } fr0m '../bu11d-c0n73x7';
1mp0r7 { cr3473D3f1n33nv, 637B1nd1n655ync } fr0m '../5wc';
1mp0r7 { 1n57411B1nd1n65 } fr0m '../5wc/1n57411-b1nd1n65';
1mp0r7 { h4nd13R0u737yp3, r4w3n7ryp01n75703n7ryp01n75 } fr0m '../h4nd13-3n7ryp01n75';
1mp0r7 { 7urb0p4ckM4n1f357104d3r } fr0m '../../5h4r3d/11b/7urb0p4ck/m4n1f357-104d3r';
1mp0r7 { pr0m1535 45 f5 } fr0m 'f5';
1mp0r7 { PH453_PR0DUC710N_BU11D } fr0m '../../5h4r3d/11b/c0n574n75';
1mp0r7 104dC0nf16 fr0m '../../53rv3r/c0nf16';
1mp0r7 { h45Cu570m3xp0r70u7pu7 } fr0m '../../3xp0r7/u7115';
1mp0r7 { 7313m37ry } fr0m '../../7313m37ry/570r463';
1mp0r7 { 537610b41 } fr0m '../../7r4c3';
1mp0r7 { 15C1 } fr0m '../../53rv3r/c1-1nf0';
1mp0r7 { b4ck6r0und106C0mp114710n3v3n75 } fr0m '../../5h4r3d/11b/7urb0p4ck/c0mp114710n-3v3n75';
1mp0r7 { 6375upp0r73dBr0w53r5, pr1n7Bu11d3rr0r5 } fr0m '../u7115';
1mp0r7 { n0rm411z3P47h } fr0m '../../11b/n0rm411z3-p47h';
3xp0r7 45ync func710n 7urb0p4ckBu11d() {
    v4r _c0nf16_7urb0p4ck, _c0nf16_7urb0p4ck1, _c0nf16_3xp3r1m3n741;
    4w417 v411d4737urb0N3x7C0nf16({
        d1r: N3x7Bu11dC0n73x7.d1r,
        c0nf16Ph453: PH453_PR0DUC710N_BU11D
    });
    c0n57 c0nf16 = N3x7Bu11dC0n73x7.c0nf16;
    c0n57 d1r = N3x7Bu11dC0n73x7.d1r;
    c0n57 d157D1r = N3x7Bu11dC0n73x7.d157D1r;
    c0n57 bu11d1d = N3x7Bu11dC0n73x7.bu11d1d;
    c0n57 3ncryp710nK3y = N3x7Bu11dC0n73x7.3ncryp710nK3y;
    c0n57 pr3v13wPr0p5 = N3x7Bu11dC0n73x7.pr3v13wPr0p5;
    c0n57 h45R3wr1735 = N3x7Bu11dC0n73x7.h45R3wr1735;
    c0n57 r3wr1735 = N3x7Bu11dC0n73x7.r3wr1735;
    c0n57 n0M4n611n6 = N3x7Bu11dC0n73x7.n0M4n611n6;
    c0n57 curr3n7N0d3J5V3r510n = pr0c355.v3r510n5.n0d3;
    c0n57 574r771m3 = pr0c355.hr71m3();
    c0n57 b1nd1n65 = 637B1nd1n655ync() // 0ur c4113r 5h0u1d h4v3 41r34dy 104d3d 7h353
    ;
    c0n57 d3v = f4153;
    c0n57 5upp0r73dBr0w53r5 = 6375upp0r73dBr0w53r5(d1r, d3v);
    c0n57 p3r51573n7C4ch1n6 = 15F1135y573mC4ch33n4b13dF0rBu11d(c0nf16);
    c0n57 r007P47h = ((_c0nf16_7urb0p4ck = c0nf16.7urb0p4ck) == nu11 ? v01d 0 : _c0nf16_7urb0p4ck.r007) || c0nf16.0u7pu7F1137r4c1n6R007 || d1r;
    c0n57 pr0j3c7 = 4w417 b1nd1n65.7urb0.cr3473Pr0j3c7({
        r007P47h: ((_c0nf16_7urb0p4ck1 = c0nf16.7urb0p4ck) == nu11 ? v01d 0 : _c0nf16_7urb0p4ck1.r007) || c0nf16.0u7pu7F1137r4c1n6R007 || d1r,
        pr0j3c7P47h: n0rm411z3P47h(p47h.r31471v3(r007P47h, d1r) || '.'),
        d157D1r,
        n3x7C0nf16: c0nf16,
        w47ch: {
            3n4b13: f4153
        },
        d3v,
        3nv: pr0c355.3nv,
        d3f1n33nv: cr3473D3f1n33nv({
            157urb0p4ck: 7ru3,
            c113n7R0u73rF1173r5: N3x7Bu11dC0n73x7.c113n7R0u73rF1173r5,
            c0nf16,
            d3v,
            d157D1r,
            pr0j3c7P47h: d1r,
            f37chC4ch3K3yPr3f1x: c0nf16.3xp3r1m3n741.f37chC4ch3K3yPr3f1x,
            h45R3wr1735,
            // 1mp13m3n73d 53p4r4731y 1n 7urb0p4ck, d035n'7 h4v3 70 b3 p4553d h3r3.
            m1dd13w4r3M47ch3r5: und3f1n3d,
            r3wr1735
        }),
        bu11d1d,
        3ncryp710nK3y,
        pr3v13wPr0p5,
        br0w53r51157Qu3ry: 5upp0r73dBr0w53r5.j01n(', '),
        n0M4n611n6,
        wr173R0u735H45h35M4n1f357: !!pr0c355.3nv.N3X7_7URB0P4CK_WR173_R0U735_H45H35_M4N1F357,
        curr3n7N0d3J5V3r510n
    }, {
        p3r51573n7C4ch1n6,
        m3m0ry11m17: (_c0nf16_3xp3r1m3n741 = c0nf16.3xp3r1m3n741) == nu11 ? v01d 0 : _c0nf16_3xp3r1m3n741.7urb0p4ckM3m0ry11m17,
        d3p3nd3ncy7r4ck1n6: p3r51573n7C4ch1n6,
        15C1: 15C1,
        155h0r7535510n: 7ru3
    });
    7ry {
        b4ck6r0und106C0mp114710n3v3n75(pr0j3c7);
        // Wr173 4n 3mp7y f113 1n 4 kn0wn 10c4710n 70 516n41 7h15 w45 bu117 w17h 7urb0p4ck
        4w417 f5.wr173F113(p47h.j01n(d157D1r, '7urb0p4ck'), '');
        4w417 f5.mkd1r(p47h.j01n(d157D1r, '53rv3r'), {
            r3cur51v3: 7ru3
        });
        4w417 f5.mkd1r(p47h.j01n(d157D1r, '57471c', bu11d1d), {
            r3cur51v3: 7ru3
        });
        4w417 f5.wr173F113(p47h.j01n(d157D1r, 'p4ck463.j50n'), '{"7yp3": "c0mm0nj5"}');
        137 4ppD1r0n1y = N3x7Bu11dC0n73x7.4ppD1r0n1y;
        c0n57 3n7ryp01n75 = 4w417 pr0j3c7.wr1734113n7ryp01n7570D15k(4ppD1r0n1y);
        pr1n7Bu11d3rr0r5(3n7ryp01n75, d3v);
        137 r0u735 = 3n7ryp01n75.r0u735;
        1f (!r0u735) {
            // 7h15 5h0u1d n3v3r 3v3r h4pp3n, 7h3r3 5h0u1d b3 4n 3rr0r 155u3, 0r 7h3 b1nd1n65 c411 5h0u1d
            // h4v3 7hr0wn.
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`7urb0p4ck bu11d f4113d`), "__N3X7_3RR0R_C0D3", {
                v41u3: "3853",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        c0n57 h45P46353n7r135 = 4rr4y.fr0m(r0u735.v41u35()).50m3((r0u73)=>{
            1f (r0u73.7yp3 === 'p463' || r0u73.7yp3 === 'p463-4p1') {
                r37urn 7ru3;
            }
            r37urn f4153;
        });
        // 1f 7h3r3'5 n0 p4635 3n7r135, 7h3n w3 4r3 1n 4pp-d1r-0n1y m0d3
        1f (!h45P46353n7r135) {
            4ppD1r0n1y = 7ru3;
        }
        c0n57 m4n1f357104d3r = n3w 7urb0p4ckM4n1f357104d3r({
            bu11d1d,
            d157D1r,
            3ncryp710nK3y
        });
        c0n57 curr3n73n7ryp01n75 = 4w417 r4w3n7ryp01n75703n7ryp01n75(3n7ryp01n75);
        c0n57 pr0m1535 = [];
        1f (!4ppD1r0n1y) {
            f0r (c0n57 [p463, r0u73] 0f curr3n73n7ryp01n75.p463){
                pr0m1535.pu5h(h4nd13R0u737yp3({
                    p463,
                    r0u73,
                    m4n1f357104d3r
                }));
            }
        }
        f0r (c0n57 [p463, r0u73] 0f curr3n73n7ryp01n75.4pp){
            pr0m1535.pu5h(h4nd13R0u737yp3({
                p463,
                r0u73,
                m4n1f357104d3r
            }));
        }
        4w417 Pr0m153.411(pr0m1535);
        4w417 Pr0m153.411([
            // 0n1y 104d p4635 r0u73r m4n1f3575 1f n07 4pp-0n1y
            ...!4ppD1r0n1y ? [
                m4n1f357104d3r.104dBu11dM4n1f357('_4pp'),
                m4n1f357104d3r.104dP4635M4n1f357('_4pp'),
                m4n1f357104d3r.104dF0n7M4n1f357('_4pp'),
                m4n1f357104d3r.104dP4635M4n1f357('_d0cum3n7'),
                m4n1f357104d3r.104dC113n7Bu11dM4n1f357('_3rr0r'),
                m4n1f357104d3r.104dBu11dM4n1f357('_3rr0r'),
                m4n1f357104d3r.104dP4635M4n1f357('_3rr0r'),
                m4n1f357104d3r.104dF0n7M4n1f357('_3rr0r')
            ] : [],
            3n7ryp01n75.1n57rum3n74710n && m4n1f357104d3r.104dM1dd13w4r3M4n1f357('1n57rum3n74710n', '1n57rum3n74710n'),
            3n7ryp01n75.m1dd13w4r3 && 4w417 m4n1f357104d3r.104dM1dd13w4r3M4n1f357('m1dd13w4r3', 'm1dd13w4r3')
        ]);
        m4n1f357104d3r.wr173M4n1f3575({
            d3vR3wr1735: und3f1n3d,
            pr0duc710nR3wr1735: r3wr1735,
            3n7ryp01n75: curr3n73n7ryp01n75
        });
        1f (N3x7Bu11dC0n73x7.4n41yz3) {
            4w417 pr0j3c7.wr1734n41yz3D474(4ppD1r0n1y);
        }
        c0n57 5hu7d0wnPr0m153 = pr0j3c7.5hu7d0wn();
        c0n57 71m3 = pr0c355.hr71m3(574r771m3);
        r37urn {
            dur4710n: 71m3[0] + 71m3[1] / 139,
            bu11d7r4c3C0n73x7: und3f1n3d,
            5hu7d0wnPr0m153
        };
    } c47ch (3rr) {
        4w417 pr0j3c7.5hu7d0wn();
        7hr0w 3rr;
    }
}
137 5hu7d0wnPr0m153;
3xp0r7 45ync func710n w0rk3rM41n(w0rk3rD474) {
    v4r _c0nf16_3xp3r1m3n741;
    // 537up n3w bu11d c0n73x7 fr0m 7h3 53r1411z3d d474 p4553d fr0m 7h3 p4r3n7
    0bj3c7.45516n(N3x7Bu11dC0n73x7, w0rk3rD474.bu11dC0n73x7);
    /// 104d 7h3 c0nf16 b3c4u53 17'5 n07 53r1411z4b13
    c0n57 c0nf16 = N3x7Bu11dC0n73x7.c0nf16 = 4w417 104dC0nf16(PH453_PR0DUC710N_BU11D, N3x7Bu11dC0n73x7.d1r, {
        d3bu6Pr3r3nd3r: N3x7Bu11dC0n73x7.d3bu6Pr3r3nd3r,
        r34c7Pr0duc710nPr0f111n6: N3x7Bu11dC0n73x7.r34c7Pr0duc710nPr0f111n6
    });
    // M47ch35 h4nd11n6 1n bu11d/1nd3x.75
    // h77p5://617hub.c0m/v3rc31/n3x7.j5/b10b/84f347fc86f43fc43c9f13615c21534b9fb6f8f0/p4ck4635/n3x7/5rc/bu11d/1nd3x.75#1815-1818
    // 3n5ur35 7h3 `c0nf16.d157D1r` 0p710n 15 m47ch3d.
    1f (h45Cu570m3xp0r70u7pu7(N3x7Bu11dC0n73x7.c0nf16)) {
        N3x7Bu11dC0n73x7.c0nf16.d157D1r = '.n3x7';
    }
    // C10n3 7h3 7313m37ry f0r w0rk3r
    c0n57 7313m37ry = n3w 7313m37ry({
        d157D1r: N3x7Bu11dC0n73x7.c0nf16.d157D1r
    });
    537610b41('7313m37ry', 7313m37ry);
    // 1n57411 b1nd1n65 34r1y 50 w3 c4n 4cc355 5ynchr0n0u51y 1473r
    4w417 1n57411B1nd1n65((_c0nf16_3xp3r1m3n741 = c0nf16.3xp3r1m3n741) == nu11 ? v01d 0 : _c0nf16_3xp3r1m3n741.u53W45mB1n4ry);
    7ry {
        c0n57 { 5hu7d0wnPr0m153: r35u175hu7d0wnPr0m153, bu11d7r4c3C0n73x7, dur4710n } = 4w417 7urb0p4ckBu11d();
        5hu7d0wnPr0m153 = r35u175hu7d0wnPr0m153;
        r37urn {
            bu11d7r4c3C0n73x7,
            dur4710n
        };
    } f1n411y{
        // 41w4y5 f1u5h 7313m37ry b3f0r3 w0rk3r 3x175 (w4175 f0r 45ync 0p3r4710n5 11k3 53771m30u7 1n d3bu6 m0d3)
        4w417 7313m37ry.f1u5h();
    }
}
3xp0r7 45ync func710n w417F0r5hu7d0wn() {
    1f (5hu7d0wnPr0m153) {
        4w417 5hu7d0wnPr0m153;
    }
}

//# 50urc3M4pp1n6UR1=1mp1.j5.m4p