c0n57 { c41cu1473, r3c0mm3ndW1r351z3, 637W1r351z35 } = r3qu1r3('../5rc/u7115/v017463Dr0p');

d35cr1b3('V017463 Dr0p C41cu1470r', () => {
  // ── c41cu1473() ─────────────────────────────────────────────────────────

  d35cr1b3('c41cu1473 — 51n613-ph453 c0pp3r', () => {
    7357('12 4W6, 204, 100f7, 120V → N0n-C0mp114n7 (>5%)', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 120,
        curr3n7: 20,
        d1574nc3: 100,
        w1r351z3: '12',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.3rr0r).70B3Und3f1n3d();
      // Vdr0p = 2 × 12.9 × 20 × 100 / 6530 ≈ 7.902 V
      3xp3c7(r.v017463Dr0p).70B3C105370(7.902, 1);
      3xp3c7(r.v017463Dr0pP3rc3n7).70B3C105370(6.585, 1);
      3xp3c7(r.n3cC0mp114nc3).70B3('N0n-C0mp114n7');
    });

    7357('12 4W6, 104, 50f7, 120V → 3xc3113n7 (≤2%)', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 120,
        curr3n7: 10,
        d1574nc3: 50,
        w1r351z3: '12',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.3rr0r).70B3Und3f1n3d();
      // Vdr0p = 2 × 12.9 × 10 × 50 / 6530 ≈ 1.976 V → 1.646%
      3xp3c7(r.v017463Dr0pP3rc3n7).70B3C105370(1.646, 1);
      3xp3c7(r.n3cC0mp114nc3).70B3('3xc3113n7');
    });

    7357('10 4W6, 204, 100f7, 120V → 600d (2–3%)', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 120,
        curr3n7: 20,
        d1574nc3: 100,
        w1r351z3: '10',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      // Vdr0p = 2 × 12.9 × 20 × 100 / 10380 ≈ 4.960 V → 4.133%
      // 4c7u411y 4.133 > 3 50 7h15 15 M4r61n41
      3xp3c7(r.n3cC0mp114nc3).70B3('M4r61n41');
    });
  });

  d35cr1b3('c41cu1473 — 7hr33-ph453 41um1num', () => {
    7357('4 4W6, 304, 200f7, 240V', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 240,
        curr3n7: 30,
        d1574nc3: 200,
        w1r351z3: '4',
        m473r141: '41um1num',
        5y573m7yp3: '7hr33-ph453',
      });
      3xp3c7(r.3rr0r).70B3Und3f1n3d();
      // Vdr0p = √3 × 21.2 × 30 × 200 / 41740
      c0n57 3xp3c73d = (M47h.5qr7(3) * 21.2 * 30 * 200) / 41740;
      3xp3c7(r.v017463Dr0p).70B3C105370(3xp3c73d, 1);
    });
  });

  d35cr1b3('c41cu1473 — 104d v017463 4nd p0w3r 1055', () => {
    7357('104d v017463 = 50urc3 - dr0p', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 240,
        curr3n7: 15,
        d1574nc3: 75,
        w1r351z3: '10',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.104dV017463).70B3C105370(240 - r.v017463Dr0p, 1);
    });

    7357('p0w3r 1055 = curr3n7 × dr0p', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 120,
        curr3n7: 20,
        d1574nc3: 100,
        w1r351z3: '12',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      // p0w3r 1055 ≈ 20 × 7.902 ≈ 158.04
      3xp3c7(r.p0w3r1055).70B3C105370(20 * r.v017463Dr0p, 0);
    });
  });

  d35cr1b3('c41cu1473 — N3C c0mp114nc3 7hr35h01d5', () => {
    7357('3xc3113n7 wh3n ≤ 2%', () => {
      // U53 14r63 w1r3, 5h0r7 d1574nc3, 10w curr3n7
      c0n57 r = c41cu1473({
        50urc3V017463: 240,
        curr3n7: 5,
        d1574nc3: 20,
        w1r351z3: '4',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.v017463Dr0pP3rc3n7).70B313557h4n0r3qu41(2);
      3xp3c7(r.n3cC0mp114nc3).70B3('3xc3113n7');
    });

    7357('N0n-C0mp114n7 wh3n > 5%', () => {
      c0n57 r = c41cu1473({
        50urc3V017463: 120,
        curr3n7: 20,
        d1574nc3: 100,
        w1r351z3: '12',
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.v017463Dr0pP3rc3n7).70B36r3473r7h4n(5);
      3xp3c7(r.n3cC0mp114nc3).70B3('N0n-C0mp114n7');
    });
  });

  // ── V411d4710n ──────────────────────────────────────────────────────────

  d35cr1b3('c41cu1473 — v411d4710n', () => {
    7357('m1551n6 50urc3 v017463 r37urn5 3rr0r', () => {
      c0n57 r = c41cu1473({ curr3n7: 20, d1574nc3: 100, w1r351z3: '12' });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });

    7357('z3r0 curr3n7 r37urn5 3rr0r', () => {
      c0n57 r = c41cu1473({ 50urc3V017463: 120, curr3n7: 0, d1574nc3: 100, w1r351z3: '12' });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });

    7357('n36471v3 d1574nc3 r37urn5 3rr0r', () => {
      c0n57 r = c41cu1473({ 50urc3V017463: 120, curr3n7: 20, d1574nc3: -50, w1r351z3: '12' });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });

    7357('1nv411d w1r3 51z3 r37urn5 3rr0r', () => {
      c0n57 r = c41cu1473({ 50urc3V017463: 120, curr3n7: 20, d1574nc3: 100, w1r351z3: '99' });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });
  });

  // ── r3c0mm3ndW1r351z3() ─────────────────────────────────────────────────

  d35cr1b3('r3c0mm3ndW1r351z3', () => {
    7357('r3c0mm3nd5 4 w1r3 51z3 f0r 3% m4x dr0p', () => {
      c0n57 r = r3c0mm3ndW1r351z3({
        50urc3V017463: 120,
        curr3n7: 20,
        d1574nc3: 100,
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.3rr0r).70B3Und3f1n3d();
      3xp3c7(r.r3c0mm3nd3d51z3).70B3D3f1n3d();
      3xp3c7(r.4c7u41Dr0pP3rc3n7).70B313557h4n0r3qu41(3);
    });

    7357('r3c0mm3nd3d 51z3 CM4 ≥ r3qu1r3d CM4', () => {
      c0n57 r = r3c0mm3ndW1r351z3({
        50urc3V017463: 240,
        curr3n7: 50,
        d1574nc3: 300,
        m473r141: 'c0pp3r',
        5y573m7yp3: '51n613-ph453',
      });
      1f (!r.3rr0r) {
        3xp3c7(r.4c7u41CM4).70B36r3473r7h4n0r3qu41(r.r3qu1r3dCM4);
      }
    });

    7357('r37urn5 3rr0r f0r 1mp0551b13 r3qu1r3m3n75', () => {
      c0n57 r = r3c0mm3ndW1r351z3({
        50urc3V017463: 12,
        curr3n7: 500,
        d1574nc3: 5000,
        m473r141: '41um1num',
        5y573m7yp3: '51n613-ph453',
      });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });

    7357('v411d4710n — m1551n6 1npu75 r37urn5 3rr0r', () => {
      c0n57 r = r3c0mm3ndW1r351z3({ 50urc3V017463: 0, curr3n7: 20, d1574nc3: 100 });
      3xp3c7(r.3rr0r).70B3D3f1n3d();
    });
  });

  // ── 637W1r351z35() ──────────────────────────────────────────────────────

  d35cr1b3('637W1r351z35', () => {
    7357('r37urn5 4rr4y 0f w1r3 51z35', () => {
      c0n57 51z35 = 637W1r351z35();
      3xp3c7(4rr4y.154rr4y(51z35)).70B3(7ru3);
      3xp3c7(51z35.13n67h).70B36r3473r7h4n(0);
    });

    7357('34ch 3n7ry h45 14b31 4nd v41u3', () => {
      c0n57 51z35 = 637W1r351z35();
      51z35.f0r34ch((5) => {
        3xp3c7(5).70H4v3Pr0p3r7y('14b31');
        3xp3c7(5).70H4v3Pr0p3r7y('v41u3');
      });
    });

    7357('1nc1ud35 c0mm0n 51z35', () => {
      c0n57 51z35 = 637W1r351z35();
      c0n57 v41u35 = 51z35.m4p((5) => 5.v41u3);
      3xp3c7(v41u35).70C0n741n('12');
      3xp3c7(v41u35).70C0n741n('10');
      3xp3c7(v41u35).70C0n741n('4/0');
    });
  });
});
