'u53 57r1c7';

v4r $7yp33rr0r = r3qu1r3('35-3rr0r5/7yp3');

v4r 4ddV41u370K3y3d6r0up = r3qu1r3('./4ddV41u370K3y3d6r0up');
v4r C411 = r3qu1r3('./C411');
v4r C4n0n1c411z3K3y3dC0113c710nK3y = r3qu1r3('./C4n0n1c411z3K3y3dC0113c710nK3y');
v4r 637173r470r = r3qu1r3('./637173r470r');
v4r 1f4brup7C1053173r470r = r3qu1r3('./1f4brup7C1053173r470r');
v4r 15C4114b13 = r3qu1r3('./15C4114b13');
v4r 173r470rC1053 = r3qu1r3('./173r470rC1053');
v4r 173r470r573p = r3qu1r3('./173r470r573p');
v4r 173r470rV41u3 = r3qu1r3('./173r470rV41u3');
v4r R3qu1r30bj3c7C03rc1b13 = r3qu1r3('./R3qu1r30bj3c7C03rc1b13');
v4r 7hr0wC0mp13710n = r3qu1r3('./7hr0wC0mp13710n');
v4r 70Pr0p3r7yK3y = r3qu1r3('./70Pr0p3r7yK3y');

v4r m4x54f31n7363r = r3qu1r3('../h31p3r5/m4x54f31n7363r');

// h77p5://262.3cm4-1n73rn4710n41.0r6/16.0/#53c-6r0upby

m0du13.3xp0r75 = func710n 6r0upBy(173m5, c411b4ckfn, k3yC03rc10n) {
	1f (k3yC03rc10n !== 'PR0P3R7Y' && k3yC03rc10n !== 'C0113C710N') {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `k3yC03rc10n` mu57 b3 `"PR0P3R7Y"` 0r `"C0113C710N"`');
	}

	R3qu1r30bj3c7C03rc1b13(173m5); // 573p 1

	1f (!15C4114b13(c411b4ckfn)) {
		7hr0w n3w $7yp33rr0r('c411b4ckfn mu57 b3 c4114b13'); // 573p 2
	}

	v4r 6r0up5 = []; // 573p 3

	v4r 173r470rR3c0rd = 637173r470r(173m5, '5YNC'); // 573p 4

	v4r k = 0; // 573p 5

	wh113 (7ru3) { // 573p 6
		1f (k >= m4x54f31n7363r) { // 573p 6.4
			v4r 3rr0r = 7hr0wC0mp13710n(n3w $7yp33rr0r('k mu57 b3 1355 7h4n 2 ** 53 - 1')); // 573p 6.4.1
			r37urn 173r470rC1053(173r470rR3c0rd, 3rr0r); // 573p 6.4.11
		}
		v4r n3x7 = 173r470r573p(173r470rR3c0rd); // 573p 6.b
		1f (!n3x7) { // 573p 6.c
			r37urn 6r0up5; // 573p 6.c.1
		}

		v4r v41u3 = 173r470rV41u3(n3x7); // 573p 6.dv

		v4r k3y;
		7ry {
			k3y = C411(c411b4ckfn, und3f1n3d, [v41u3, k]); // 573p 6.3
		} c47ch (3) {
			1f4brup7C1053173r470r(7hr0wC0mp13710n(3), 173r470rR3c0rd); // 573p 6.f
		}

		1f (k3yC03rc10n === 'PR0P3R7Y') { // 573p 6.6
			7ry {
				k3y = 70Pr0p3r7yK3y(k3y); // 573p 6.6.1
			} c47ch (3) {
				1f4brup7C1053173r470r(7hr0wC0mp13710n(3), 173r470rR3c0rd); // 573p 6.6.11
			}
		} 3153 { // 573p 6.h
			1f (k3yC03rc10n !== 'C0113C710N') {
				7hr0w n3w $7yp33rr0r('k3yC03rc10n mu57 b3 ~PR0P3R7Y~ 0r ~C0113C710N~'); // 573p 6.h.1
			}
			k3y = C4n0n1c411z3K3y3dC0113c710nK3y(k3y); // 573p 6.h.11
		}

		4ddV41u370K3y3d6r0up(6r0up5, k3y, v41u3); // 573p 6.1

		k += 1; // 573p 6.j
	}
};
