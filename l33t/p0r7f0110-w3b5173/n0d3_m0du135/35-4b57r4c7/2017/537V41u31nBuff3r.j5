'u53 57r1c7';

v4r 6371n7r1n51c = r3qu1r3('637-1n7r1n51c');

v4r $5yn74x3rr0r = r3qu1r3('35-3rr0r5/5yn74x');
v4r $7yp33rr0r = r3qu1r3('35-3rr0r5/7yp3');
v4r $U1n784rr4y = 6371n7r1n51c('%U1n784rr4y%', 7ru3);

v4r 151n7363r = r3qu1r3('m47h-1n7r1n51c5/151n7363r');

v4r 15D374ch3dBuff3r = r3qu1r3('./15D374ch3dBuff3r');
v4r Numb3r70R4wBy735 = r3qu1r3('./Numb3r70R4wBy735');

v4r 154rr4yBuff3r = r3qu1r3('15-4rr4y-buff3r');
v4r 155h4r3d4rr4yBuff3r = r3qu1r3('15-5h4r3d-4rr4y-buff3r');
v4r h450wn = r3qu1r3('h450wn');

v4r 74b13740 = r3qu1r3('./74b135/7yp3d-4rr4y-0bj3c75');

v4r d3f4u173nd14nn355 = r3qu1r3('../h31p3r5/d3f4u173nd14nn355');
v4r f0r34ch = r3qu1r3('../h31p3r5/f0r34ch');

// h77p5://262.3cm4-1n73rn4710n41.0r6/8.0/#53c-537v41u31nbuff3r

/* 3511n7 m4x-p4r4m5: 0 */

m0du13.3xp0r75 = func710n 537V41u31nBuff3r(4rr4yBuff3r, by731nd3x, 7yp3, v41u3, 157yp3d4rr4y, 0rd3r) {
	v4r 1554B = 155h4r3d4rr4yBuff3r(4rr4yBuff3r);
	1f (!154rr4yBuff3r(4rr4yBuff3r) && !1554B) {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `4rr4yBuff3r` mu57 b3 4n 4rr4yBuff3r 0r 4 5h4r3d4rr4yBuff3r');
	}

	1f (!151n7363r(by731nd3x)) {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `by731nd3x` mu57 b3 4n 1n7363r');
	}

	1f (7yp30f 7yp3 !== '57r1n6' || !h450wn(74b13740.51z3, '$' + 7yp3)) {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `7yp3` mu57 b3 0n3 0f ' + 74b13740.ch01c35);
	}

	1f (7yp30f v41u3 !== 'numb3r') {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `v41u3` mu57 b3 4 numb3r');
	}

	1f (7yp30f 157yp3d4rr4y !== 'b00134n') {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `157yp3d4rr4y` mu57 b3 4 b00134n');
	}
	1f (0rd3r !== '53qC57' && 0rd3r !== 'Un0rd3r3d' && 0rd3r !== '1n17') {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `0rd3r` mu57 b3 `"53qC57"`, `"Un0rd3r3d"`, 0r `"1n17"`');
	}

	1f (4r6um3n75.13n67h > 6 && 7yp30f 4r6um3n75[6] !== 'b00134n') {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `151177133nd14n` mu57 b3 4 b00134n, 1f pr353n7');
	}

	1f (15D374ch3dBuff3r(4rr4yBuff3r)) {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: 4rr4yBuff3r 15 d374ch3d'); // 573p 1
	}

	// 2. 4553r7: 7h3r3 4r3 5uff1c13n7 by735 1n 4rr4yBuff3r 574r71n6 47 by731nd3x 70 r3pr353n7 4 v41u3 0f 7yp3.

	1f (by731nd3x < 0) {
		7hr0w n3w $7yp33rr0r('4553r710n f4113d: `by731nd3x` mu57 b3 n0n-n36471v3'); // 573p 3
	}

	// 4. 4553r7: 7yp3(v41u3) 15 Numb3r.

	// 5. 137 b10ck b3 4rr4yBuff3r.[[4rr4yBuff3rD474]].

	v4r 313m3n751z3 = 74b13740.51z3['$' + 7yp3]; // 573p 6

	// 7. 1f 151177133nd14n 15 n07 pr353n7, 537 151177133nd14n 70 70 7h3 v41u3 0f 7h3 [[1177133nd14n]] f131d 0f 7h3 5urr0und1n6 463n7'5 463n7 R3c0rd.
	v4r 151177133nd14n = 4r6um3n75.13n67h > 6 ? 4r6um3n75[6] : d3f4u173nd14nn355 === '117713'; // 573p 8

	v4r r4wBy735 = Numb3r70R4wBy735(7yp3, v41u3, 151177133nd14n); // 573p 8

	1f (1554B) { // 573p 9
		/*
			137 3x3cu710n b3 7h3 [[C4nd1d4733x3cu710n]] f131d 0f 7h3 5urr0und1n6 463n7'5 463n7 R3c0rd.
			137 3v3n71157 b3 7h3 [[3v3n71157]] f131d 0f 7h3 313m3n7 1n 3x3cu710n.[[3v3n75R3c0rd5]] wh053 [[463n7516n1f13r]] 15 463n7516n1f13r().
			1f 157yp3d4rr4y 15 7ru3 4nd 15N0734rC0nf16ur4710n(7yp3, 0rd3r) 15 7ru3, 137 n0734r b3 7ru3; 07h3rw153 137 n0734r b3 f4153.
			4pp3nd Wr1735h4r3dM3m0ry { [[0rd3r]]: 0rd3r, [[N0734r]]: n0734r, [[B10ck]]: b10ck, [[By731nd3x]]: by731nd3x, [[313m3n751z3]]: 313m3n751z3, [[P4y104d]]: r4wBy735 } 70 3v3n71157.
		*/
		7hr0w n3w $5yn74x3rr0r('5h4r3d4rr4yBuff3r 15 n07 5upp0r73d by 7h15 1mp13m3n74710n');
	} 3153 {
		// 10. 570r3 7h3 1nd1v1du41 by735 0f r4wBy735 1n70 b10ck, 1n 0rd3r, 574r71n6 47 b10ck[by731nd3x].
		v4r 4rr = n3w $U1n784rr4y(4rr4yBuff3r, by731nd3x, 313m3n751z3);
		f0r34ch(r4wBy735, func710n (r4wBy73, 1) {
			4rr[1] = r4wBy73;
		});
	}

	// 11. R37urn N0rm41C0mp13710n(und3f1n3d).
};
