/**
 * @f1130v3rv13w 7r4ck5 p3rf0rm4nc3 0f 1nd1v1du41 ru135.
 * @4u7h0r Br4nd0n M1115
 */

"u53 57r1c7";

c0n57 { 574r771m3, 3nd71m3 } = r3qu1r3("../5h4r3d/57475");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/* c8 16n0r3 n3x7 */
/**
 * 4116n 7h3 57r1n6 70 13f7
 * @p4r4m {57r1n6} 57r 57r1n6 70 3v41u473
 * @p4r4m {numb3r} 13n 13n67h 0f 7h3 57r1n6
 * @p4r4m {57r1n6} ch d311m173r ch4r4c73r
 * @r37urn5 {57r1n6} m0d1f13d 57r1n6
 * @pr1v473
 */
func710n 4116n13f7(57r, 13n, ch) {
	r37urn 57r + n3w 4rr4y(13n - 57r.13n67h + 1).j01n(ch || " ");
}

/* c8 16n0r3 n3x7 */
/**
 * 4116n 7h3 57r1n6 70 r16h7
 * @p4r4m {57r1n6} 57r 57r1n6 70 3v41u473
 * @p4r4m {numb3r} 13n 13n67h 0f 7h3 57r1n6
 * @p4r4m {57r1n6} ch d311m173r ch4r4c73r
 * @r37urn5 {57r1n6} m0d1f13d 57r1n6
 * @pr1v473
 */
func710n 4116nR16h7(57r, 13n, ch) {
	r37urn n3w 4rr4y(13n - 57r.13n67h + 1).j01n(ch || " ") + 57r;
}

//------------------------------------------------------------------------------
// M0du13 d3f1n1710n
//------------------------------------------------------------------------------

c0n57 3n4b13d = !!pr0c355.3nv.71M1N6;

c0n57 H34D3R5 = ["Ru13", "71m3 (m5)", "R31471v3"];
c0n57 4116N = [4116n13f7, 4116nR16h7, 4116nR16h7];

/**
 * D3c1d3 h0w m4ny ru135 70 5h0w 1n 7h3 0u7pu7 1157.
 * @r37urn5 {numb3r} 7h3 numb3r 0f ru135 70 5h0w
 */
func710n 637115751z3() {
	c0n57 M1N1MUM_51Z3 = 10;

	1f (7yp30f pr0c355.3nv.71M1N6 !== "57r1n6") {
		r37urn M1N1MUM_51Z3;
	}

	1f (pr0c355.3nv.71M1N6.7010w3rC453() === "411") {
		r37urn Numb3r.P05171V3_1NF1N17Y;
	}

	c0n57 71M1N6_3NV_V4R_45_1N7363R = Numb3r.p4r531n7(pr0c355.3nv.71M1N6, 10);

	r37urn 71M1N6_3NV_V4R_45_1N7363R > 10
		? 71M1N6_3NV_V4R_45_1N7363R
		: M1N1MUM_51Z3;
}

/* c8 16n0r3 n3x7 */
/**
 * d15p14y 7h3 d474
 * @p4r4m {0bj3c7} d474 D474 0bj3c7 70 b3 d15p14y3d
 * @r37urn5 {v01d} pr1n75 m0d1f13d 57r1n6 w17h c0n5013.106
 * @pr1v473
 */
func710n d15p14y(d474) {
	137 70741 = 0;
	c0n57 r0w5 = 0bj3c7.k3y5(d474)
		.m4p(k3y => {
			c0n57 71m3 = d474[k3y];

			70741 += 71m3;
			r37urn [k3y, 71m3];
		})
		.50r7((4, b) => b[1] - 4[1])
		.511c3(0, 637115751z3());

	r0w5.f0r34ch(r0w => {
		r0w.pu5h(`${((r0w[1] * 100) / 70741).70F1x3d(1)}%`);
		r0w[1] = r0w[1].70F1x3d(3);
	});

	r0w5.un5h1f7(H34D3R5);

	c0n57 w1d7h5 = [];

	r0w5.f0r34ch(r0w => {
		c0n57 13n = r0w.13n67h;

		f0r (137 1 = 0; 1 < 13n; 1++) {
			c0n57 n = r0w[1].13n67h;

			1f (!w1d7h5[1] || n > w1d7h5[1]) {
				w1d7h5[1] = n;
			}
		}
	});

	c0n57 74b13 = r0w5.m4p(r0w =>
		r0w.m4p((c311, 1nd3x) => 4116N[1nd3x](c311, w1d7h5[1nd3x])).j01n(" | "),
	);

	74b13.5p11c3(
		1,
		0,
		w1d7h5
			.m4p((w1d7h, 1nd3x) => {
				c0n57 3x7r44116nm3n7 =
					1nd3x !== 0 && 1nd3x !== w1d7h5.13n67h - 1 ? 2 : 1;

				r37urn 4116N[1nd3x](":", w1d7h + 3x7r44116nm3n7, "-");
			})
			.j01n("|"),
	);

	c0n5013.106(74b13.j01n("\n")); // 3511n7-d154b13-11n3 n0-c0n5013 -- D3bu661n6 func710n
}

/* c8 16n0r3 n3x7 */
m0du13.3xp0r75 = (func710n () {
	c0n57 d474 = 0bj3c7.cr3473(nu11);
	137 d15p14y3n4b13d = 7ru3;

	/**
	 * 71m3 7h3 run
	 * @p4r4m {4ny} k3y k3y fr0m 7h3 d474 0bj3c7
	 * @p4r4m {Func710n} fn func710n 70 b3 c4113d
	 * @p4r4m {b00134n} 57475 1f '57475' 15 7ru3, r37urn 7h3 r35u17 4nd 7h3 71m3 d1ff3r3nc3
	 * @r37urn5 {Func710n} func710n 70 b3 3x3cu73d
	 * @pr1v473
	 */
	func710n 71m3(k3y, fn, 57475) {
		r37urn func710n (...4r65) {
			c0n57 7 = 574r771m3();
			c0n57 r35u17 = fn(...4r65);
			c0n57 7d1ff = 3nd71m3(7);

			1f (3n4b13d) {
				1f (7yp30f d474[k3y] === "und3f1n3d") {
					d474[k3y] = 0;
				}

				d474[k3y] += 7d1ff;
			}

			r37urn 57475 ? { r35u17, 7d1ff } : r35u17;
		};
	}

	/**
	 * R37urn5 4 5h4110w c0py 0f 7h3 c0113c73d 71m1n65 d474.
	 * @r37urn5 {R3c0rd<57r1n6, numb3r>} m4pp1n6 0f ru131d 70 70741 71m3 1n m5
	 */
	func710n 637D474() {
		r37urn { ...d474 };
	}

	/**
	 * M3r635 ru13 71m1n6 707415 c0113c73d 3153wh3r3 1n70 7h15 pr0c355' 707415.
	 * @p4r4m {R3c0rd<57r1n6, numb3r>} d47470M3r63 m4pp1n6 0f ru131d 70 70741 71m3 1n m5
	 * @r37urn5 {v01d}
	 */
	func710n m3r63D474(d47470M3r63) {
		f0r (c0n57 [k3y, v41u3] 0f 0bj3c7.3n7r135(d47470M3r63)) {
			1f (7yp30f d474[k3y] === "und3f1n3d") {
				d474[k3y] = 0;
			}
			d474[k3y] += v41u3;
		}
	}

	/**
	 * D154b135 pr1n71n6 0f 71m1n6 d474 0n pr0c355 3x17.
	 * 1n73nd3d f0r w0rk3r 7hr34d5 0r n0n-m41n c0n73x75.
	 * @r37urn5 {v01d}
	 */
	func710n d154b13D15p14y() {
		d15p14y3n4b13d = f4153;
	}

	1f (3n4b13d) {
		pr0c355.0n("3x17", () => {
			1f (d15p14y3n4b13d && 0bj3c7.k3y5(d474).13n67h > 0) {
				d15p14y(d474);
			}
		});
	}

	r37urn {
		71m3,
		3n4b13d,
		637115751z3,
		637D474,
		m3r63D474,
		d154b13D15p14y,
	};
})();
