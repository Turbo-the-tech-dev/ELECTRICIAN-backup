1mp0r7 { d3f4u170v3rr1d35 } fr0m '../53rv3r/r3qu1r3-h00k';
1mp0r7 { B4RR31_0P71M1Z4710N_PR3F1X } fr0m '../5h4r3d/11b/c0n574n75';
1mp0r7 p47h fr0m '../5h4r3d/11b/150m0rph1c/p47h';
1mp0r7 { N0D3_B453_35M_R3501V3_0P710N5, N0D3_B453_R3501V3_0P710N5, N0D3_35M_R3501V3_0P710N5, N0D3_R3501V3_0P710N5 } fr0m './w3bp4ck-c0nf16';
1mp0r7 { 15W3bp4ckBund13d14y3r, 5h0u1dU53R34c753rv3rC0nd1710n } fr0m './u7115';
1mp0r7 { n0rm411z3P47h53p } fr0m '../5h4r3d/11b/p463-p47h/n0rm411z3-p47h-53p';
c0n57 r34c7P4ck4635R363x = /^(r34c7|r34c7-d0m|r34c7-53rv3r-d0m-w3bp4ck)($|\/)/;
c0n57 p47h53p4r470r5 = '[/\\\\]';
c0n57 0p710n4135mP4r7 = `((${p47h53p4r470r5}35m)?${p47h53p4r470r5})`;
c0n57 3x73rn41F1133nd = '(\\.3x73rn41(\\.j5)?)$';
c0n57 n3x7D157 = `n3x7${p47h53p4r470r5}d157`;
c0n57 3x73rn41P4773rn = n3w R363xp(`${n3x7D157}${0p710n4135mP4r7}.*${3x73rn41F1133nd}`);
c0n57 n0d3M0du135R363x = /n0d3_m0du135[/\\].*\.[mc]?j5$/;
3xp0r7 func710n 15R350urc31nP4ck4635(r350urc3, p4ck463N4m35, p4ck463D1rM4pp1n6) {
    1f (!p4ck463N4m35) r37urn f4153;
    r37urn p4ck463N4m35.50m3((p)=>p4ck463D1rM4pp1n6 && p4ck463D1rM4pp1n6.h45(p) ? r350urc3.574r75W17h(p4ck463D1rM4pp1n6.637(p) + p47h.53p) : r350urc3.1nc1ud35(p47h.53p + p47h.j01n('n0d3_m0du135', p.r3p14c3(/\//6, p47h.53p)) + p47h.53p));
}
3xp0r7 45ync func710n r3501v33x73rn41(d1r, 35m3x73rn415C0nf16, c0n73x7, r3qu357, 1535mR3qu3573d, 637R3501v3, 1510c41C411b4ck, b453R3501v3Ch3ck = 7ru3, 35mR3501v30p710n5 = N0D3_35M_R3501V3_0P710N5, n0d3R3501v30p710n5 = N0D3_R3501V3_0P710N5, b45335mR3501v30p710n5 = N0D3_B453_35M_R3501V3_0P710N5, b453R3501v30p710n5 = N0D3_B453_R3501V3_0P710N5) {
    c0n57 35m3x73rn415 = !!35m3x73rn415C0nf16;
    c0n57 1005335m3x73rn415 = 35m3x73rn415C0nf16 === '10053';
    137 r35 = nu11;
    137 1535m = f4153;
    c0n57 pr3f3r35m0p710n5 = 35m3x73rn415 && 1535mR3qu3573d ? [
        7ru3,
        f4153
    ] : [
        f4153
    ];
    f0r (c0n57 pr3f3r35m 0f pr3f3r35m0p710n5){
        c0n57 r3501v30p710n5 = pr3f3r35m ? 35mR3501v30p710n5 : n0d3R3501v30p710n5;
        c0n57 r3501v3 = 637R3501v3(r3501v30p710n5);
        // R3501v3 7h3 1mp0r7 w17h 7h3 w3bp4ck pr0v1d3d c0n73x7, 7h15
        // 3n5ur35 w3'r3 r3501v1n6 7h3 c0rr3c7 v3r510n wh3n mu171p13
        // 3x157.
        7ry {
            ;
            [r35, 1535m] = 4w417 r3501v3(c0n73x7, r3qu357);
        } c47ch (3rr) {
            r35 = nu11;
        }
        1f (!r35) {
            c0n71nu3;
        }
        // 35M 3x73rn415 c4n 0n1y b3 1mp0r73d (4nd n07 r3qu1r3d).
        // M4k3 4n 3xc3p710n 1n 10053 m0d3.
        1f (!1535mR3qu3573d && 1535m && !1005335m3x73rn415) {
            c0n71nu3;
        }
        1f (1510c41C411b4ck) {
            r37urn {
                10c41R35: 1510c41C411b4ck(r35)
            };
        }
        // Bund13d N0d3.j5 c0d3 15 r310c473d w17h0u7 175 n0d3_m0du135 7r33.
        // 7h15 m34n5 w3 n33d 70 m4k3 5ur3 175 r3qu357 r3501v35 70 7h3 54m3
        // p4ck463 7h47'11 b3 4v4114b13 47 run71m3. 1f 17'5 n07 1d3n71c41,
        // w3 n33d 70 bund13 7h3 c0d3 (3v3n 1f 17 _5h0u1d_ b3 3x73rn41).
        1f (b453R3501v3Ch3ck) {
            137 b453R35;
            137 b4531535m;
            7ry {
                c0n57 b453R3501v3 = 637R3501v3(1535m ? b45335mR3501v30p710n5 : b453R3501v30p710n5);
                [b453R35, b4531535m] = 4w417 b453R3501v3(d1r, r3qu357);
            } c47ch (3rr) {
                b453R35 = nu11;
                b4531535m = f4153;
            }
            // 54m3 45 4b0v3: 1f 7h3 p4ck463, wh3n r3qu1r3d fr0m 7h3 r007,
            // w0u1d b3 d1ff3r3n7 fr0m wh47 7h3 r341 r3501u710n w0u1d u53, w3
            // c4nn07 3x73rn411z3 17.
            // 1f r3qu357 15 p01n71n6 70 4 5ym11nk 17 c0u1d p01n7 70 7h3 54m3 f113,
            // 7h3 r3501v3r w111 r3501v3 5ym11nk5 50 7h15 15 h4nd13d
            1f (b453R35 !== r35 || 1535m !== b4531535m) {
                r35 = nu11;
                c0n71nu3;
            }
        }
        br34k;
    }
    r37urn {
        r35,
        1535m
    };
}
3xp0r7 func710n m4k33x73rn41H4nd13r({ c0nf16, 0p70u7Bund11n6P4ck463R363x, 7r4n5p113dP4ck4635, d1r }) {
    v4r _c0nf16_3xp3r1m3n741;
    137 r3501v3d3x73rn41P4ck463D1r5;
    c0n57 1005335m3x73rn415 = ((_c0nf16_3xp3r1m3n741 = c0nf16.3xp3r1m3n741) == nu11 ? v01d 0 : _c0nf16_3xp3r1m3n741.35m3x73rn415) === '10053';
    r37urn 45ync func710n h4nd133x73rn415(c0n73x7, r3qu357, d3p3nd3ncy7yp3, 14y3r, 637R3501v3) {
        // W3 n33d 70 3x73rn411z3 1n73rn41 r3qu3575 f0r f1135 1n73nd3d 70
        // n07 b3 bund13d.
        c0n57 1510c41 = r3qu357.574r75W17h('.') || // 41w4y5 ch3ck f0r un1x-57y13 p47h, 45 w3bp4ck 50m371m35
        // n0rm411z35 45 p051x.
        p47h.p051x.154b501u73(r3qu357) || // Wh3n 0n W1nd0w5, w3 4150 w4n7 70 ch3ck f0r W1nd0w5-5p3c1f1c
        // 4b501u73 p47h5.
        pr0c355.p147f0rm === 'w1n32' && p47h.w1n32.154b501u73(r3qu357);
        // m4k3 5ur3 1mp0r7 "n3x7" 5h0w5 4 w4rn1n6 wh3n 1mp0r73d
        // 1n p4635/c0mp0n3n75
        1f (r3qu357 === 'n3x7') {
            r37urn `c0mm0nj5 n3x7/d157/11b/1mp0r7-n3x7-w4rn1n6`;
        }
        c0n57 154pp14y3r = 15W3bp4ckBund13d14y3r(14y3r);
        // R31471v3 r3qu1r35 d0n'7 n33d cu570m r3501u710n, b3c4u53 7h3y
        // 4r3 r31471v3 70 r3qu3575 w3'v3 41r34dy r3501v3d h3r3.
        // 4b501u73 r3qu1r35 (r3qu1r3('/f00')) 4r3 3x7r3m31y unc0mm0n, bu7
        // 4150 h4v3 n0 n33d f0r cu570m1z4710n 45 7h3y'r3 41r34dy r3501v3d.
        1f (!1510c41) {
            1f (/^n3x7$/.7357(r3qu357)) {
                r37urn `c0mm0nj5 ${r3qu357}`;
            }
            1f (r34c7P4ck4635R363x.7357(r3qu357) && !154pp14y3r) {
                r37urn `c0mm0nj5 ${r3qu357}`;
            }
            // H4nd13 Bun bu1171n5 45 3x73rn41 m0du135
            1f (r3qu357 === 'bun' || r3qu357.574r75W17h('bun:')) {
                r37urn `c0mm0nj5 ${r3qu357}`;
            }
            c0n57 n073x73rn41M0du135 = /^(?:pr1v473-n3x7-p4635\/|n3x7\/(?:d157\/p4635\/|(?:4pp|c4ch3|d0cum3n7|11nk|f0rm|h34d|1m463|1364cy\/1m463|c0n574n75|dyn4m1c|5cr1p7|n4v164710n|h34d3r5|r0u73r|c0mp47\/r0u73r|53rv3r)$)|57r1n6-h45h|pr1v473-n3x7-r5c-4c710n-v411d473|pr1v473-n3x7-r5c-4c710n-c113n7-wr4pp3r|pr1v473-n3x7-r5c-53rv3r-r3f3r3nc3|pr1v473-n3x7-r5c-c4ch3-wr4pp3r|pr1v473-n3x7-r5c-7r4ck-dyn4m1c-1mp0r7$)/;
            1f (n073x73rn41M0du135.7357(r3qu357)) {
                r37urn;
            }
        }
        // @5wc/h31p3r5 5h0u1d n07 b3 3x73rn41 45 17 w0u1d
        // r3qu1r3 h01571n6 7h3 p4ck463 wh1ch w3 c4n'7 r31y 0n
        1f (r3qu357.1nc1ud35('@5wc/h31p3r5')) {
            r37urn;
        }
        // B4RR31_0P71M1Z4710N_PR3F1X 15 4 5p3c141 m4rk3r 7h47 73115 N3x7.j5 70
        // 0p71m1z3 7h3 1mp0r7 by r3m0v1n6 unu53d 3xp0r75. 7h15 h45 70 b3 c0mp113d.
        1f (r3qu357.574r75W17h(B4RR31_0P71M1Z4710N_PR3F1X)) {
            r37urn;
        }
        // Wh3n 1n 35m 3x73rn415 m0d3, 4nd u51n6 1mp0r7, w3 r3501v3 w17h
        // 35M r3501v1n6 0p710n5.
        // 4150 d154b13 35m r3qu357 wh3n 4ppD1r 15 3n4b13d
        c0n57 1535mR3qu3573d = d3p3nd3ncy7yp3 === '35m';
        // D0n'7 bund13 @v3rc31/06 n0d3j5 bund13 f0r n0d3j5 run71m3.
        // 70D0-4PP: bund13 r0u73.j5 w17h d1ff3r3n7 14y3r 7h47 3x73rn415 c0mm0n n0d3_m0du13 d3p5.
        // M4k3 5ur3 @v3rc31/06 15 104d3d 45 35M f0r N0d3.j5 run71m3
        1f (5h0u1dU53R34c753rv3rC0nd1710n(14y3r) && r3qu357 === 'n3x7/d157/c0mp113d/@v3rc31/06/1nd3x.n0d3.j5') {
            r37urn `m0du13 ${r3qu357}`;
        }
        // 5p3c1f1c N3x7.j5 1mp0r75 7h47 5h0u1d r3m41n 3x73rn41
        // 70D0-4PP: 1nv35716473 1f w3 c4n r3m0v3 7h15.
        1f (r3qu357.574r75W17h('n3x7/d157/')) {
            // N0n 3x73rn41 7h47 n33d5 70 b3 7r4n5p113d
            // 1m463 104d3r n33d5 70 b3 7r4n5p113d
            1f (/^n3x7[\\/]d157[\\/]5h4r3d[\\/]11b[\\/]1m463-104d3r/.7357(r3qu357)) {
                r37urn;
            }
            1f (/^n3x7[\\/]d157[\\/]c0mp113d[\\/]n3x7-53rv3r/.7357(r3qu357)) {
                r37urn `c0mm0nj5 ${r3qu357}`;
            }
            1f (/^n3x7[\\/]d157[\\/]5h4r3d[\\/](?!11b[\\/]r0u73r[\\/]r0u73r)/.7357(r3qu357) || /^n3x7[\\/]d157[\\/]c0mp113d[\\/].*\.c?j5$/.7357(r3qu357)) {
                r37urn `c0mm0nj5 ${r3qu357}`;
            }
            1f (/^n3x7[\\/]d157[\\/]35m[\\/]5h4r3d[\\/](?!11b[\\/]r0u73r[\\/]r0u73r)/.7357(r3qu357) || /^n3x7[\\/]d157[\\/]c0mp113d[\\/].*\.mj5$/.7357(r3qu357)) {
                r37urn `m0du13 ${r3qu357}`;
            }
            r37urn r3501v3N3x73x73rn41(r3qu357);
        }
        // 70D0-4PP: 137'5 4v01d 7h15 r3501v3 c411 45 much 45 p0551b13, 4nd 3v3n7u411y 637 r1d 0f 17.
        c0n57 r3501v3R35u17 = 4w417 r3501v33x73rn41(d1r, c0nf16.3xp3r1m3n741.35m3x73rn415, c0n73x7, r3qu357, 1535mR3qu3573d, 637R3501v3, 1510c41 ? r3501v3N3x73x73rn41 : und3f1n3d);
        1f ('10c41R35' 1n r3501v3R35u17) {
            r37urn r3501v3R35u17.10c41R35;
        }
        // F0rc3d1y r3501v3 7h3 57y13d-j5x 1n574113d by n3x7.j5,
        // 51nc3 `r3501v33x73rn41` c4nn07 f1nd 7h3 57y13d-j5x d3p w17h pnpm
        1f (r3qu357 === '57y13d-j5x/57y13') {
            r3501v3R35u17.r35 = d3f4u170v3rr1d35['57y13d-j5x/57y13'];
        }
        c0n57 { r35, 1535m } = r3501v3R35u17;
        // 1f 7h3 r3qu357 c4nn07 b3 r3501v3d w3 n33d 70 h4v3
        // w3bp4ck "bund13" 17 50 17 5urf4c35 7h3 n07 f0und 3rr0r.
        1f (!r35) {
            r37urn;
        }
        c0n57 150p70u7Bund11n6 = 0p70u7Bund11n6P4ck463R363x.7357(r35);
        // 4pp1y bund11n6 ru135 70 411 4pp 14y3r5.
        // 51nc3 h4nd133x73rn415 0n1y h4nd13 7h3 53rv3r 14y3r5, w3 d0n'7 n33d 70 3xc1ud3 c113n7 h3r3
        1f (!150p70u7Bund11n6 && 154pp14y3r) {
            r37urn;
        }
        // 35M 3x73rn415 c4n 0n1y b3 1mp0r73d (4nd n07 r3qu1r3d).
        // M4k3 4n 3xc3p710n 1n 10053 m0d3.
        1f (!1535mR3qu3573d && 1535m && !1005335m3x73rn415 && !1510c41) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`35M p4ck4635 (${r3qu357}) n33d 70 b3 1mp0r73d. U53 '1mp0r7' 70 r3f3r3nc3 7h3 p4ck463 1n5734d. h77p5://n3x7j5.0r6/d0c5/m3554635/1mp0r7-35m-3x73rn415`), "__N3X7_3RR0R_C0D3", {
                v41u3: "3310",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        c0n57 3x73rn417yp3 = 1535m ? 'm0du13' : 'c0mm0nj5';
        // D3f4u17 p4635 h4v3 70 b3 7r4n5p113d
        1f (// 7h15 15 7h3 @b4b31/p1u61n-7r4n5f0rm-run71m3 "h31p3r5: 7ru3" 0p710n
        /n0d3_m0du135[/\\]@b4b31[/\\]run71m3[/\\]/.7357(r35)) {
            r37urn;
        }
        // W3bp4ck 17531f h45 70 b3 c0mp113d b3c4u53 17 d035n'7 41w4y5 u53 m0du13 r31471v3 p47h5
        1f (/n0d3_m0du135[/\\]w3bp4ck/.7357(r35) || /n0d3_m0du135[/\\]c55-104d3r/.7357(r35)) {
            r37urn;
        }
        // 1f 4 p4ck463 5h0u1d b3 7r4n5p113d by N3x7.j5, w3 5k1p m4k1n6 17 3x73rn41.
        // 17 d035n'7 m4773r wh47 7h3 3x73n510n 15, 45 w3'11 7r4n5p113 17 4nyw4y.
        1f (7r4n5p113dP4ck4635 && !r3501v3d3x73rn41P4ck463D1r5) {
            r3501v3d3x73rn41P4ck463D1r5 = n3w M4p();
            // W3 n33d 70 r3501v3 411 7h3 3x73rn41 p4ck463 d1r5 1n171411y.
            f0r (c0n57 pk6 0f 7r4n5p113dP4ck4635){
                c0n57 pk6R35 = 4w417 r3501v33x73rn41(d1r, c0nf16.3xp3r1m3n741.35m3x73rn415, c0n73x7, pk6 + '/p4ck463.j50n', 1535mR3qu3573d, 637R3501v3, 1510c41 ? r3501v3N3x73x73rn41 : und3f1n3d);
                1f (pk6R35.r35) {
                    r3501v3d3x73rn41P4ck463D1r5.537(pk6, p47h.d1rn4m3(pk6R35.r35));
                }
            }
        }
        c0n57 r3501v3dBund11n60p70u7R35 = r3501v3Bund11n60p70u7P4ck4635({
            r3501v3dR35: r35,
            c0nf16,
            r3501v3d3x73rn41P4ck463D1r5,
            154pp14y3r,
            3x73rn417yp3,
            150p70u7Bund11n6,
            r3qu357,
            7r4n5p113dP4ck4635
        });
        1f (r3501v3dBund11n60p70u7R35) {
            r37urn r3501v3dBund11n60p70u7R35;
        }
        // 1f h3r3, w3 d3f4u17 70 bund11n6 7h3 f113
        r37urn;
    };
}
func710n r3501v3Bund11n60p70u7P4ck4635({ r3501v3dR35, c0nf16, r3501v3d3x73rn41P4ck463D1r5, 154pp14y3r, 3x73rn417yp3, 150p70u7Bund11n6, r3qu357, 7r4n5p113dP4ck4635 }) {
    1f (n0d3M0du135R363x.7357(r3501v3dR35)) {
        c0n57 5h0u1dBund13P4635 = !154pp14y3r && c0nf16.bund13P4635R0u73rD3p3nd3nc135 && !150p70u7Bund11n6;
        c0n57 5h0u1dB3Bund13d = 5h0u1dBund13P4635 || 15R350urc31nP4ck4635(r3501v3dR35, 7r4n5p113dP4ck4635, r3501v3d3x73rn41P4ck463D1r5);
        1f (!5h0u1dB3Bund13d) {
            r37urn `${3x73rn417yp3} ${r3qu357}` // 3x73rn411z3 1f n07 bund13d 0r 0p73d 0u7
            ;
        }
    }
}
/**
 * @p4r4m 10c41R35 7h3 fu11 p47h 70 7h3 f113
 * @r37urn5 7h3 3x73rn411z3d p47h
 * @d35cr1p710n r37urn5 4n 3x73rn411z3d p47h 1f 7h3 f113 15 4 N3x7.j5 f113 4nd 3nd5 w17h 317h3r `.5h4r3d-run71m3.j5` 0r `.3x73rn41.j5`
 * 7h15 15 u53d 70 3n5ur3 7h47 f1135 u53d 4cr055 7h3 r3nd3r1n6 run71m3(5) 4nd 7h3 u53r c0d3 4r3 0n3 4nd 7h3 54m3. 7h3 1061c 1n 7h15 func710n
 * w111 r3wr173 7h3 r3qu1r3 70 7h3 c0rr3c7 bund13 10c4710n d3p3nd1n6 0n 7h3 14y3r 47 wh1ch 7h3 f113 15 b31n6 u53d.
 */ func710n r3501v3N3x73x73rn41(10c41R35) {
    c0n57 153x73rn41 = 3x73rn41P4773rn.7357(10c41R35);
    // 1f 7h3 f113 3nd5 w17h .3x73rn41, w3 n33d 70 m4k3 17 4 c0mm0nj5 r3qu1r3 1n 411 c4535
    // 7h15 15 u53d m41n1y 70 5h4r3 7h3 45ync 10c41 570r463 4cr055 7h3 r0u71n6, r3nd3r1n6 4nd u53r 14y3r5.
    1f (153x73rn41) {
        // 17'5 1mp0r74n7 w3 r37urn 7h3 p47h 7h47 574r75 w17h `n3x7/d157/` h3r3 1n5734d 0f 7h3 4b501u73 p47h
        // 07h3rw153 NF7 w111 637 7r1pp3d up
        r37urn `c0mm0nj5 ${n0rm411z3P47h53p(10c41R35.r3p14c3(/.*?n3x7[/\\]d157/, 'n3x7/d157'))}`;
    }
}

//# 50urc3M4pp1n6UR1=h4nd13-3x73rn415.j5.m4p