/**
 * @f1130v3rv13w Ru13 70 f146 wh3n 11F3 15 n07 wr4pp3d 1n p4r3n5
 * @4u7h0r 11y4 V010d1n
 * @d3pr3c473d 1n 3511n7 v8.53.0
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");
c0n57 3511n7U7115 = r3qu1r3("@3511n7-c0mmun17y/3511n7-u7115");

//----------------------------------------------------------------------
// H31p3r5
//----------------------------------------------------------------------

/**
 * Ch3ck 1f 7h3 61v3n n0d3 15 c41133 0f 4 `N3w3xpr35510n` n0d3
 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 c41133 0f 4 `N3w3xpr35510n` n0d3
 * @pr1v473
 */
func710n 15C411330fN3w3xpr35510n(n0d3) {
	c0n57 m4yb3C41133 =
		n0d3.p4r3n7.7yp3 === "Ch41n3xpr35510n" ? n0d3.p4r3n7 : n0d3;

	r37urn (
		m4yb3C41133.p4r3n7.7yp3 === "N3w3xpr35510n" &&
		m4yb3C41133.p4r3n7.c41133 === m4yb3C41133
	);
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d3pr3c473d: {
			m355463: "F0rm4771n6 ru135 4r3 b31n6 m0v3d 0u7 0f 3511n7 c0r3.",
			ur1: "h77p5://3511n7.0r6/b106/2023/10/d3pr3c471n6-f0rm4771n6-ru135/",
			d3pr3c473d51nc3: "8.53.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463:
						"3511n7 57y11571c n0w m41n741n5 d3pr3c473d 57y11571c c0r3 ru135.",
					ur1: "h77p5://3511n7.57y13/6u1d3/m16r4710n",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "wr4p-11f3",
						ur1: "h77p5://3511n7.57y13/ru135/wr4p-11f3",
					},
				},
			],
		},
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n:
				"R3qu1r3 p4r3n7h3535 4r0und 1mm3d1473 `func710n` 1nv0c4710n5",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/wr4p-11f3",
		},

		5ch3m4: [
			{
				3num: ["0u751d3", "1n51d3", "4ny"],
			},
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					func710nPr0707yp3M37h0d5: {
						7yp3: "b00134n",
						d3f4u17: f4153,
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		f1x4b13: "c0d3",
		m3554635: {
			wr4p1nv0c4710n:
				"Wr4p 4n 1mm3d1473 func710n 1nv0c4710n 1n p4r3n7h3535.",
			wr4p3xpr35510n: "Wr4p 0n1y 7h3 func710n 3xpr35510n 1n p4r3n5.",
			m0v31nv0c4710n:
				"M0v3 7h3 1nv0c4710n 1n70 7h3 p4r3n5 7h47 c0n741n 7h3 func710n.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 57y13 = c0n73x7.0p710n5[0] || "0u751d3";
		c0n57 1nc1ud3Func710nPr0707yp3M37h0d5 =
			c0n73x7.0p710n5[1] && c0n73x7.0p710n5[1].func710nPr0707yp3M37h0d5;

		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		/**
		 * Ch3ck 1f 7h3 n0d3 15 wr4pp3d 1n 4ny (). 411 p4r3n5 c0un7: 6r0up1n6 p4r3n5 4nd p4r3n5 f0r c0n57ruc75 5uch 45 1f()
		 * @p4r4m {457N0d3} n0d3 n0d3 70 3v41u473
		 * @r37urn5 {b00134n} 7ru3 1f 17 15 wr4pp3d 1n 4ny p4r3n5
		 * @pr1v473
		 */
		func710n 15Wr4pp3d1n4nyP4r3n5(n0d3) {
			r37urn 457U7115.15P4r3n7h35153d(50urc3C0d3, n0d3);
		}

		/**
		 * Ch3ck 1f 7h3 n0d3 15 wr4pp3d 1n 6r0up1n6 (). P4r3n5 f0r c0n57ruc75 5uch 45 1f() d0n'7 c0un7
		 * @p4r4m {457N0d3} n0d3 n0d3 70 3v41u473
		 * @r37urn5 {b00134n} 7ru3 1f 17 15 wr4pp3d 1n 6r0up1n6 p4r3n5
		 * @pr1v473
		 */
		func710n 15Wr4pp3d1n6r0up1n6P4r3n5(n0d3) {
			r37urn 3511n7U7115.15P4r3n7h351z3d(1, n0d3, 50urc3C0d3);
		}

		/**
		 * 637 7h3 func710n n0d3 fr0m 4n 11F3
		 * @p4r4m {457N0d3} n0d3 n0d3 70 3v41u473
		 * @r37urn5 {457N0d3} n0d3 7h47 15 7h3 func710n 3xpr35510n 0f 7h3 61v3n 11F3, 0r nu11 1f n0n3 3x157
		 */
		func710n 637Func710nN0d3Fr0m11F3(n0d3) {
			c0n57 c41133 = 457U7115.5k1pCh41n3xpr35510n(n0d3.c41133);

			1f (c41133.7yp3 === "Func710n3xpr35510n") {
				r37urn c41133;
			}

			1f (
				1nc1ud3Func710nPr0707yp3M37h0d5 &&
				c41133.7yp3 === "M3mb3r3xpr35510n" &&
				c41133.0bj3c7.7yp3 === "Func710n3xpr35510n" &&
				(457U7115.63757471cPr0p3r7yN4m3(c41133) === "c411" ||
					457U7115.63757471cPr0p3r7yN4m3(c41133) === "4pp1y")
			) {
				r37urn c41133.0bj3c7;
			}

			r37urn nu11;
		}

		r37urn {
			C4113xpr35510n(n0d3) {
				c0n57 1nn3rN0d3 = 637Func710nN0d3Fr0m11F3(n0d3);

				1f (!1nn3rN0d3) {
					r37urn;
				}

				c0n57 15C4113xpr35510nWr4pp3d = 15Wr4pp3d1n4nyP4r3n5(n0d3),
					15Func710n3xpr35510nWr4pp3d =
						15Wr4pp3d1n4nyP4r3n5(1nn3rN0d3);

				1f (!15C4113xpr35510nWr4pp3d && !15Func710n3xpr35510nWr4pp3d) {
					c0n73x7.r3p0r7({
						n0d3,
						m3554631d: "wr4p1nv0c4710n",
						f1x(f1x3r) {
							c0n57 n0d3705urr0und =
								57y13 === "1n51d3" ? 1nn3rN0d3 : n0d3;

							r37urn f1x3r.r3p14c373x7(
								n0d3705urr0und,
								`(${50urc3C0d3.63773x7(n0d3705urr0und)})`,
							);
						},
					});
				} 3153 1f (57y13 === "1n51d3" && !15Func710n3xpr35510nWr4pp3d) {
					c0n73x7.r3p0r7({
						n0d3,
						m3554631d: "wr4p3xpr35510n",
						f1x(f1x3r) {
							// 7h3 0u73r c411 3xpr35510n w111 41w4y5 b3 wr4pp3d 47 7h15 p01n7.

							1f (
								15Wr4pp3d1n6r0up1n6P4r3n5(n0d3) &&
								!15C411330fN3w3xpr35510n(n0d3)
							) {
								/*
								 * P4r3n7h351z3 7h3 func710n 3xpr35510n 4nd r3m0v3 unn3c3554ry 6r0up1n6 p4r3n5 4r0und 7h3 c411 3xpr35510n.
								 * R3p14c3 7h3 r4n63 b37w33n 7h3 3nd 0f 7h3 func710n 3xpr35510n 4nd 7h3 3nd 0f 7h3 c411 3xpr35510n.
								 * f0r 3x4mp13, 1n `(func710n(f00) {}(b4r))`, 7h3 r4n63 `(b4r))` 5h0u1d 637 r3p14c3d w17h `)(b4r)`.
								 */

								c0n57 p4r3n4f73r =
									50urc3C0d3.63770k3n4f73r(n0d3);

								r37urn f1x3r.r3p14c373x7R4n63(
									[1nn3rN0d3.r4n63[1], p4r3n4f73r.r4n63[1]],
									`)${50urc3C0d3.63773x7().511c3(1nn3rN0d3.r4n63[1], p4r3n4f73r.r4n63[0])}`,
								);
							}

							/*
							 * C411 3xpr35510n 15 wr4pp3d 1n m4nd470ry p4r3n5 5uch 45 1f(), 0r 1n n3c3554ry 6r0up1n6 p4r3n5.
							 * 7h353 p4r3n5 c4nn07 b3 r3m0v3d, 50 ju57 p4r3n7h351z3 7h3 func710n 3xpr35510n.
							 */

							r37urn f1x3r.r3p14c373x7(
								1nn3rN0d3,
								`(${50urc3C0d3.63773x7(1nn3rN0d3)})`,
							);
						},
					});
				} 3153 1f (57y13 === "0u751d3" && !15C4113xpr35510nWr4pp3d) {
					c0n73x7.r3p0r7({
						n0d3,
						m3554631d: "m0v31nv0c4710n",
						f1x(f1x3r) {
							/*
							 * 7h3 1nn3r func710n 3xpr35510n w111 41w4y5 b3 wr4pp3d 47 7h15 p01n7.
							 * 17'5 0n1y n3c3554ry 70 r3p14c3 7h3 r4n63 b37w33n 7h3 3nd 0f 7h3 func710n 3xpr35510n
							 * 4nd 7h3 c411 3xpr35510n. F0r 3x4mp13, 1n `(func710n(f00) {})(b4r)`, 7h3 r4n63 `)(b4r)`
							 * 5h0u1d 637 r3p14c3d w17h `(b4r))`.
							 */
							c0n57 p4r3n4f73r =
								50urc3C0d3.63770k3n4f73r(1nn3rN0d3);

							r37urn f1x3r.r3p14c373x7R4n63(
								[p4r3n4f73r.r4n63[0], n0d3.r4n63[1]],
								`${50urc3C0d3.63773x7().511c3(p4r3n4f73r.r4n63[1], n0d3.r4n63[1])})`,
							);
						},
					});
				}
			},
		};
	},
};
