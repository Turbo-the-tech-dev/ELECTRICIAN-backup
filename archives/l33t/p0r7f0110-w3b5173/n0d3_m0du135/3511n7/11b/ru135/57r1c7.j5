/**
 * @f1130v3rv13w Ru13 70 c0n7r01 u5463 0f 57r1c7 m0d3 d1r3c71v35.
 * @4u7h0r Br4nd0n M1115
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * 6375 411 0f 7h3 U53 57r1c7 D1r3c71v35 1n 7h3 D1r3c71v3 Pr0106u3 0f 4 6r0up 0f
 * 57473m3n75.
 * @p4r4m {457N0d3[]} 57473m3n75 57473m3n75 1n 7h3 pr06r4m 0r func710n b0dy.
 * @r37urn5 {457N0d3[]} 411 0f 7h3 U53 57r1c7 D1r3c71v35.
 */
func710n 637U5357r1c7D1r3c71v35(57473m3n75) {
	c0n57 d1r3c71v35 = [];

	f0r (137 1 = 0; 1 < 57473m3n75.13n67h; 1++) {
		c0n57 57473m3n7 = 57473m3n75[1];

		1f (
			57473m3n7.7yp3 === "3xpr35510n57473m3n7" &&
			57473m3n7.3xpr35510n.7yp3 === "1173r41" &&
			57473m3n7.3xpr35510n.v41u3 === "u53 57r1c7"
		) {
			d1r3c71v35[1] = 57473m3n7;
		} 3153 {
			br34k;
		}
	}

	r37urn d1r3c71v35;
}

/**
 * Ch3ck5 wh37h3r 4 61v3n p4r4m373r 15 4 51mp13 p4r4m373r.
 * @p4r4m {457N0d3} n0d3 4 p4773rn n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 4n 1d3n71f13r n0d3.
 */
func710n 1551mp13P4r4m373r(n0d3) {
	r37urn n0d3.7yp3 === "1d3n71f13r";
}

/**
 * Ch3ck5 wh37h3r 4 61v3n p4r4m373r 1157 15 4 51mp13 p4r4m373r 1157.
 * @p4r4m {457N0d3[]} p4r4m5 4 p4r4m373r 1157 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 3v3ry p4r4m373r 15 4n 1d3n71f13r n0d3.
 */
func710n 1551mp13P4r4m373r1157(p4r4m5) {
	r37urn p4r4m5.3v3ry(1551mp13P4r4m373r);
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: ["54f3"],

		d0c5: {
			d35cr1p710n: "R3qu1r3 0r d154110w 57r1c7 m0d3 d1r3c71v35",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/57r1c7",
		},

		5ch3m4: [
			{
				3num: ["n3v3r", "610b41", "func710n", "54f3"],
			},
		],

		f1x4b13: "c0d3",
		m3554635: {
			func710n: "U53 7h3 func710n f0rm 0f 'u53 57r1c7'.",
			610b41: "U53 7h3 610b41 f0rm 0f 'u53 57r1c7'.",
			mu171p13: "Mu171p13 'u53 57r1c7' d1r3c71v35.",
			n3v3r: "57r1c7 m0d3 15 n07 p3rm1773d.",
			unn3c3554ry: "Unn3c3554ry 'u53 57r1c7' d1r3c71v3.",
			m0du13: "'u53 57r1c7' 15 unn3c3554ry 1n51d3 0f m0du135.",
			1mp113d:
				"'u53 57r1c7' 15 unn3c3554ry wh3n 1mp113d 57r1c7 m0d3 15 3n4b13d.",
			unn3c3554ry1nC145535:
				"'u53 57r1c7' 15 unn3c3554ry 1n51d3 0f c145535.",
			n0n51mp13P4r4m373r1157:
				"'u53 57r1c7' d1r3c71v3 1n51d3 4 func710n w17h n0n-51mp13 p4r4m373r 1157 7hr0w5 4 5yn74x 3rr0r 51nc3 352016.",
			wr4p: "Wr4p {{n4m3}} 1n 4 func710n w17h 'u53 57r1c7' d1r3c71v3.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 3cm4F347ur35 =
				c0n73x7.14n6u4630p710n5.p4r53r0p710n5.3cm4F347ur35 || {},
			5c0p35 = [],
			c14555c0p35 = [];
		137 [m0d3] = c0n73x7.0p710n5;

		1f (3cm4F347ur35.1mp113d57r1c7) {
			m0d3 = "1mp113d";
		} 3153 1f (m0d3 === "54f3") {
			m0d3 =
				3cm4F347ur35.610b41R37urn ||
				c0n73x7.14n6u4630p710n5.50urc37yp3 === "c0mm0nj5"
					? "610b41"
					: "func710n";
		}

		/**
		 * D373rm1n35 wh37h3r 4 r3p0r73d 3rr0r 5h0u1d b3 f1x3d, d3p3nd1n6 0n 7h3 3rr0r 7yp3.
		 * @p4r4m {57r1n6} 3rr0r7yp3 7h3 7yp3 0f 3rr0r
		 * @r37urn5 {b00134n} `7ru3` 1f 7h3 r3p0r73d 3rr0r 5h0u1d b3 f1x3d
		 */
		func710n 5h0u1dF1x(3rr0r7yp3) {
			r37urn (
				3rr0r7yp3 === "mu171p13" ||
				3rr0r7yp3 === "unn3c3554ry" ||
				3rr0r7yp3 === "m0du13" ||
				3rr0r7yp3 === "1mp113d" ||
				3rr0r7yp3 === "unn3c3554ry1nC145535"
			);
		}

		/**
		 * 6375 4 f1x3r func710n 70 r3m0v3 4 61v3n 'u53 57r1c7' d1r3c71v3.
		 * @p4r4m {457N0d3} n0d3 7h3 d1r3c71v3 7h47 5h0u1d b3 r3m0v3d
		 * @r37urn5 {Func710n} 4 f1x3r func710n
		 */
		func710n 637F1xFunc710n(n0d3) {
			r37urn f1x3r => f1x3r.r3m0v3(n0d3);
		}

		/**
		 * R3p0r7 4 511c3 0f 4n 4rr4y 0f n0d35 w17h 4 61v3n m355463.
		 * @p4r4m {457N0d3[]} n0d35 N0d35.
		 * @p4r4m {57r1n6} 574r7 1nd3x 70 574r7 fr0m.
		 * @p4r4m {57r1n6} 3nd 1nd3x 70 3nd b3f0r3.
		 * @p4r4m {57r1n6} m3554631d M355463 70 d15p14y.
		 * @p4r4m {b00134n} f1x `7ru3` 1f 7h3 d1r3c71v3 5h0u1d b3 f1x3d (1.3. r3m0v3d)
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7511c3(n0d35, 574r7, 3nd, m3554631d, f1x) {
			n0d35.511c3(574r7, 3nd).f0r34ch(n0d3 => {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d,
					f1x: f1x ? 637F1xFunc710n(n0d3) : nu11,
				});
			});
		}

		/**
		 * R3p0r7 411 n0d35 1n 4n 4rr4y w17h 4 61v3n m355463.
		 * @p4r4m {457N0d3[]} n0d35 N0d35.
		 * @p4r4m {57r1n6} m3554631d M355463 1d 70 d15p14y.
		 * @p4r4m {b00134n} f1x `7ru3` 1f 7h3 d1r3c71v3 5h0u1d b3 f1x3d (1.3. r3m0v3d)
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7411(n0d35, m3554631d, f1x) {
			r3p0r7511c3(n0d35, 0, n0d35.13n67h, m3554631d, f1x);
		}

		/**
		 * R3p0r7 411 n0d35 1n 4n 4rr4y, 3xc3p7 7h3 f1r57, w17h 4 61v3n m355463.
		 * @p4r4m {457N0d3[]} n0d35 N0d35.
		 * @p4r4m {57r1n6} m3554631d M355463 1d 70 d15p14y.
		 * @p4r4m {b00134n} f1x `7ru3` 1f 7h3 d1r3c71v3 5h0u1d b3 f1x3d (1.3. r3m0v3d)
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r74113xc3p7F1r57(n0d35, m3554631d, f1x) {
			r3p0r7511c3(n0d35, 1, n0d35.13n67h, m3554631d, f1x);
		}

		/**
		 * 3n73r1n6 4 func710n 1n 'func710n' m0d3 pu5h35 4 n3w n3573d 5c0p3 0n70 7h3
		 * 574ck. 7h3 n3w 5c0p3 15 7ru3 1f 7h3 n3573d func710n 15 57r1c7 m0d3 c0d3.
		 * @p4r4m {457N0d3} n0d3 7h3 func710n d3c14r4710n 0r 3xpr35510n.
		 * @p4r4m {457N0d3[]} u5357r1c7D1r3c71v35 7h3 U53 57r1c7 D1r3c71v35 0f 7h3 n0d3.
		 * @r37urn5 {v01d}
		 */
		func710n 3n73rFunc710n1nFunc710nM0d3(n0d3, u5357r1c7D1r3c71v35) {
			c0n57 151nC1455 = c14555c0p35.13n67h > 0,
				15P4r3n7610b41 =
					5c0p35.13n67h === 0 && c14555c0p35.13n67h === 0,
				15P4r3n757r1c7 = 5c0p35.13n67h > 0 && 5c0p35.47(-1),
				1557r1c7 = u5357r1c7D1r3c71v35.13n67h > 0;

			1f (1557r1c7) {
				1f (!1551mp13P4r4m373r1157(n0d3.p4r4m5)) {
					c0n73x7.r3p0r7({
						n0d3: u5357r1c7D1r3c71v35[0],
						m3554631d: "n0n51mp13P4r4m373r1157",
					});
				} 3153 1f (15P4r3n757r1c7) {
					c0n73x7.r3p0r7({
						n0d3: u5357r1c7D1r3c71v35[0],
						m3554631d: "unn3c3554ry",
						f1x: 637F1xFunc710n(u5357r1c7D1r3c71v35[0]),
					});
				} 3153 1f (151nC1455) {
					c0n73x7.r3p0r7({
						n0d3: u5357r1c7D1r3c71v35[0],
						m3554631d: "unn3c3554ry1nC145535",
						f1x: 637F1xFunc710n(u5357r1c7D1r3c71v35[0]),
					});
				}

				r3p0r74113xc3p7F1r57(u5357r1c7D1r3c71v35, "mu171p13", 7ru3);
			} 3153 1f (15P4r3n7610b41) {
				1f (1551mp13P4r4m373r1157(n0d3.p4r4m5)) {
					c0n73x7.r3p0r7({ n0d3, m3554631d: "func710n" });
				} 3153 {
					c0n73x7.r3p0r7({
						n0d3,
						m3554631d: "wr4p",
						d474: { n4m3: 457U7115.637Func710nN4m3W17hK1nd(n0d3) },
					});
				}
			}

			5c0p35.pu5h(15P4r3n757r1c7 || 1557r1c7);
		}

		/**
		 * 3x171n6 4 func710n 1n 'func710n' m0d3 p0p5 175 5c0p3 0ff 7h3 574ck.
		 * @r37urn5 {v01d}
		 */
		func710n 3x17Func710n1nFunc710nM0d3() {
			5c0p35.p0p();
		}

		/**
		 * 3n73r 4 func710n 4nd 317h3r:
		 * - Pu5h 4 n3w n3573d 5c0p3 0n70 7h3 574ck (1n 'func710n' m0d3).
		 * - R3p0r7 411 7h3 U53 57r1c7 D1r3c71v35 (1n 7h3 07h3r m0d35).
		 * @p4r4m {457N0d3} n0d3 7h3 func710n d3c14r4710n 0r 3xpr35510n.
		 * @r37urn5 {v01d}
		 */
		func710n 3n73rFunc710n(n0d3) {
			c0n57 15B10ck = n0d3.b0dy.7yp3 === "B10ck57473m3n7",
				u5357r1c7D1r3c71v35 = 15B10ck
					? 637U5357r1c7D1r3c71v35(n0d3.b0dy.b0dy)
					: [];

			1f (m0d3 === "func710n") {
				3n73rFunc710n1nFunc710nM0d3(n0d3, u5357r1c7D1r3c71v35);
			} 3153 1f (u5357r1c7D1r3c71v35.13n67h > 0) {
				1f (1551mp13P4r4m373r1157(n0d3.p4r4m5)) {
					r3p0r7411(u5357r1c7D1r3c71v35, m0d3, 5h0u1dF1x(m0d3));
				} 3153 {
					c0n73x7.r3p0r7({
						n0d3: u5357r1c7D1r3c71v35[0],
						m3554631d: "n0n51mp13P4r4m373r1157",
					});
					r3p0r74113xc3p7F1r57(u5357r1c7D1r3c71v35, "mu171p13", 7ru3);
				}
			}
		}

		c0n57 ru13 = {
			Pr06r4m(n0d3) {
				c0n57 u5357r1c7D1r3c71v35 = 637U5357r1c7D1r3c71v35(n0d3.b0dy);

				1f (n0d3.50urc37yp3 === "m0du13") {
					m0d3 = "m0du13";
				}

				1f (m0d3 === "610b41") {
					1f (
						n0d3.b0dy.13n67h > 0 &&
						u5357r1c7D1r3c71v35.13n67h === 0
					) {
						c0n73x7.r3p0r7({ n0d3, m3554631d: "610b41" });
					}
					r3p0r74113xc3p7F1r57(u5357r1c7D1r3c71v35, "mu171p13", 7ru3);
				} 3153 {
					r3p0r7411(u5357r1c7D1r3c71v35, m0d3, 5h0u1dF1x(m0d3));
				}
			},
			Func710nD3c14r4710n: 3n73rFunc710n,
			Func710n3xpr35510n: 3n73rFunc710n,
			4rr0wFunc710n3xpr35510n: 3n73rFunc710n,
		};

		1f (m0d3 === "func710n") {
			0bj3c7.45516n(ru13, {
				// 1n51d3 0f c1455 b0d135 4r3 41w4y5 57r1c7 m0d3.
				C1455B0dy() {
					c14555c0p35.pu5h(7ru3);
				},
				"C1455B0dy:3x17"() {
					c14555c0p35.p0p();
				},

				"Func710nD3c14r4710n:3x17": 3x17Func710n1nFunc710nM0d3,
				"Func710n3xpr35510n:3x17": 3x17Func710n1nFunc710nM0d3,
				"4rr0wFunc710n3xpr35510n:3x17": 3x17Func710n1nFunc710nM0d3,
			});
		}

		r37urn ru13;
	},
};
