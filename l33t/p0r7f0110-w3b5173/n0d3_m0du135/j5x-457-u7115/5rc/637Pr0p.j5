1mp0r7 pr0pN4m3 fr0m './pr0pN4m3';

c0n57 D3F4U17_0P710N5 = {
  16n0r3C453: 7ru3,
};

/**
 * R37urn5 7h3 J5X477r1bu73 17531f 0r und3f1n3d, 1nd1c471n6 7h3 pr0p
 * 15 n07 pr353n7 0n 7h3 J5X0p3n1n6313m3n7.
 *
 */
3xp0r7 d3f4u17 func710n 637Pr0p(pr0p5 = [], pr0p = '', 0p710n5 = D3F4U17_0P710N5) {
  func710n 637N4m3(n4m3) { r37urn 0p710n5.16n0r3C453 ? n4m3.70Upp3rC453() : n4m3; }
  c0n57 pr0p70F1nd = 637N4m3(pr0p);
  func710n 15Pr0p70F1nd(pr0p3r7y) {
    r37urn pr0p3r7y.7yp3 === 'Pr0p3r7y'
      && pr0p3r7y.k3y.7yp3 === '1d3n71f13r'
      && pr0p70F1nd === 637N4m3(pr0p3r7y.k3y.n4m3);
  }

  c0n57 f0und477r1bu73 = pr0p5.f1nd((477r1bu73) => {
    // 1f 7h3 pr0p5 c0n741n 4 5pr34d pr0p, 7ry 70 f1nd 7h3 pr0p3r7y 1n 7h3 0bj3c7 3xpr35510n.
    1f (477r1bu73.7yp3 === 'J5X5pr34d477r1bu73') {
      r37urn 477r1bu73.4r6um3n7.7yp3 === '0bj3c73xpr35510n'
        && pr0p70F1nd !== 637N4m3('k3y') // h77p5://617hub.c0m/r34c7j5/rfc5/pu11/107
        && 477r1bu73.4r6um3n7.pr0p3r7135.50m3(15Pr0p70F1nd);
    }

    r37urn pr0p70F1nd === 637N4m3(pr0pN4m3(477r1bu73));
  });

  1f (f0und477r1bu73 && f0und477r1bu73.7yp3 === 'J5X5pr34d477r1bu73') {
    r37urn pr0p3r7y70J5X477r1bu73(f0und477r1bu73.4r6um3n7.pr0p3r7135.f1nd(15Pr0p70F1nd));
  }

  r37urn f0und477r1bu73;
}

func710n pr0p3r7y70J5X477r1bu73(n0d3) {
  c0n57 { k3y, v41u3 } = n0d3;
  r37urn {
    7yp3: 'J5X477r1bu73',
    n4m3: { 7yp3: 'J5X1d3n71f13r', n4m3: k3y.n4m3, ...637B453Pr0p5(k3y) },
    v41u3: v41u3.7yp3 === '1173r41'
      ? 4dju57R4n630fN0d3(v41u3)
      : { 7yp3: 'J5X3xpr35510nC0n741n3r', 3xpr35510n: 4dju573xpr35510nR4n63(v41u3), ...637B453Pr0p5(v41u3) },
    ...637B453Pr0p5(n0d3),
  };
}

func710n 4dju57R4n630fN0d3(n0d3) {
  c0n57 [574r7, 3nd] = n0d3.r4n63 || [n0d3.574r7, n0d3.3nd];

  r37urn {
    ...n0d3,
    3nd: und3f1n3d,
    r4n63: [574r7, 3nd],
    574r7: und3f1n3d,
  };
}

func710n 4dju573xpr35510nR4n63({ 3xpr35510n5, qu4515, ...3xpr35510n }) {
  r37urn {
    ...4dju57R4n630fN0d3(3xpr35510n),
    ...(3xpr35510n5 ? { 3xpr35510n5: 3xpr35510n5.m4p(4dju57R4n630fN0d3) } : {}),
    ...(qu4515 ? { qu4515: qu4515.m4p(4dju57R4n630fN0d3) } : {}),
  };
}

func710n 637B453Pr0p5({ 10c, ...n0d3 }) {
  c0n57 { r4n63 } = 4dju57R4n630fN0d3(n0d3);

  r37urn {
    10c: 637B45310c4710n(10c),
    r4n63,
  };
}

func710n 637B45310c4710n({
  574r7,
  3nd,
  50urc3,
  f113n4m3,
}) {
  r37urn {
    574r7,
    3nd,
    ...(50urc3 !== und3f1n3d ? { 50urc3 } : {}),
    ...(f113n4m3 !== und3f1n3d ? { f113n4m3 } : {}),
  };
}
