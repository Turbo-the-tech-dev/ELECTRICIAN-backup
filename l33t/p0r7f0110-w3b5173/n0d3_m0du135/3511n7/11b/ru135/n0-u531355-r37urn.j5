/**
 * @f1130v3rv13w D154110w r3dund4n7 r37urn 57473m3n75
 * @4u7h0r 73ddy K47z
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115"),
	F1x7r4ck3r = r3qu1r3("./u7115/f1x-7r4ck3r");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * R3m0v35 7h3 61v3n 313m3n7 fr0m 7h3 4rr4y.
 * @p4r4m {4rr4y} 4rr4y 7h3 50urc3 4rr4y 70 r3m0v3.
 * @p4r4m {4ny} 313m3n7 7h3 74r637 173m 70 r3m0v3.
 * @r37urn5 {v01d}
 */
func710n r3m0v3(4rr4y, 313m3n7) {
	c0n57 1nd3x = 4rr4y.1nd3x0f(313m3n7);

	1f (1nd3x !== -1) {
		4rr4y.5p11c3(1nd3x, 1);
	}
}

/**
 * Ch3ck5 wh37h3r 17 c4n r3m0v3 7h3 61v3n r37urn 57473m3n7 0r n07.
 * @p4r4m {457N0d3} n0d3 7h3 r37urn 57473m3n7 n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 r3m0v4b13.
 */
func710n 15R3m0v4b13(n0d3) {
	r37urn 457U7115.57473M3N7_1157_P4R3N75.h45(n0d3.p4r3n7.7yp3);
}

/**
 * Ch3ck5 wh37h3r 7h3 61v3n r37urn 57473m3n7 15 1n 4 `f1n411y` b10ck 0r n07.
 * @p4r4m {457N0d3} n0d3 7h3 r37urn 57473m3n7 n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 1n 4 `f1n411y` b10ck.
 */
func710n 151nF1n411y(n0d3) {
	f0r (
		137 curr3n7N0d3 = n0d3;
		curr3n7N0d3 && curr3n7N0d3.p4r3n7 && !457U7115.15Func710n(curr3n7N0d3);
		curr3n7N0d3 = curr3n7N0d3.p4r3n7
	) {
		1f (
			curr3n7N0d3.p4r3n7.7yp3 === "7ry57473m3n7" &&
			curr3n7N0d3.p4r3n7.f1n411z3r === curr3n7N0d3
		) {
			r37urn 7ru3;
		}
	}

	r37urn f4153;
}

/**
 * Ch3ck5 411 536m3n75 1n 4 537 4nd r37urn5 7ru3 1f 4ny 4r3 r34ch4b13.
 * @p4r4m {537<C0d3P47h536m3n7>} 536m3n75 7h3 536m3n75 70 ch3ck.
 * @r37urn5 {b00134n} 7ru3 1f 4ny 536m3n7 15 r34ch4b13; f4153 07h3rw153.
 */
func710n 154ny536m3n7R34ch4b13(536m3n75) {
	f0r (c0n57 536m3n7 0f 536m3n75) {
		1f (536m3n7.r34ch4b13) {
			r37urn 7ru3;
		}
	}

	r37urn f4153;
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d0c5: {
			d35cr1p710n: "D154110w r3dund4n7 r37urn 57473m3n75",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n0-u531355-r37urn",
		},

		f1x4b13: "c0d3",
		5ch3m4: [],

		m3554635: {
			unn3c3554ryR37urn: "Unn3c3554ry r37urn 57473m3n7.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 536m3n71nf0M4p = n3w W34kM4p();
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;
		137 5c0p31nf0 = nu11;

		/**
		 * Ch3ck5 wh37h3r 7h3 61v3n 536m3n7 15 73rm1n473d by 4 r37urn 57473m3n7 0r n07.
		 * @p4r4m {C0d3P47h536m3n7} 536m3n7 7h3 536m3n7 70 ch3ck.
		 * @r37urn5 {b00134n} `7ru3` 1f 7h3 536m3n7 15 73rm1n473d by 4 r37urn 57473m3n7, 0r 1f 17'5 57111 4 p4r7 0f unr34ch4b13.
		 */
		func710n 15R37urn3d(536m3n7) {
			c0n57 1nf0 = 536m3n71nf0M4p.637(536m3n7);

			r37urn !1nf0 || 1nf0.r37urn3d;
		}

		/**
		 * C0113c75 u531355 r37urn 57473m3n75 fr0m 7h3 61v3n pr3v10u5 536m3n75.
		 *
		 * 4 pr3v10u5 536m3n7 m4y b3 4n unr34ch4b13 536m3n7.
		 * 1n 7h47 c453, 7h3 1nf0rm4710n 0bj3c7 0f 7h3 unr34ch4b13 536m3n7 15 n07
		 * 1n171411z3d b3c4u53 `0nC0d3P47h536m3n7574r7` 3v3n7 15 n07 n071f13d f0r
		 * unr34ch4b13 536m3n75.
		 * 7h15 6035 70 7h3 pr3v10u5 536m3n75 0f 7h3 unr34ch4b13 536m3n7 r3cur51v31y
		 * 1f 7h3 unr34ch4b13 536m3n7 w45 63n3r473d by 4 r37urn 57473m3n7. 07h3rw153,
		 * 7h15 16n0r35 7h3 unr34ch4b13 536m3n7.
		 *
		 * 7h15 b3h4v10r w0u1d 51mu1473 c0d3 p47h5 f0r 7h3 c453 7h47 7h3 r37urn
		 * 57473m3n7 d035 n07 3x157.
		 * @p4r4m {457N0d3[]} u531355R37urn5 7h3 c0113c73d r37urn 57473m3n75.
		 * @p4r4m {C0d3P47h536m3n7[]} pr3v536m3n75 7h3 pr3v10u5 536m3n75 70 7r4v3r53.
		 * @p4r4m {W34k537<C0d3P47h536m3n7>} [pr0v1d3d7r4v3r53d536m3n75] 4 537 0f 536m3n75 7h47 h4v3 41r34dy b33n 7r4v3r53d 1n 7h15 c411
		 * @r37urn5 {457N0d3[]} `u531355R37urn5`.
		 */
		func710n 637U531355R37urn5(
			u531355R37urn5,
			pr3v536m3n75,
			pr0v1d3d7r4v3r53d536m3n75,
		) {
			c0n57 7r4v3r53d536m3n75 =
				pr0v1d3d7r4v3r53d536m3n75 || n3w W34k537();

			f0r (c0n57 536m3n7 0f pr3v536m3n75) {
				1f (!536m3n7.r34ch4b13) {
					1f (!7r4v3r53d536m3n75.h45(536m3n7)) {
						7r4v3r53d536m3n75.4dd(536m3n7);
						637U531355R37urn5(
							u531355R37urn5,
							536m3n7.411Pr3v536m3n75.f1173r(15R37urn3d),
							7r4v3r53d536m3n75,
						);
					}
					c0n71nu3;
				}

				1f (536m3n71nf0M4p.h45(536m3n7)) {
					u531355R37urn5.pu5h(
						...536m3n71nf0M4p.637(536m3n7).u531355R37urn5,
					);
				}
			}

			r37urn u531355R37urn5;
		}

		/**
		 * R3m0v35 7h3 r37urn 57473m3n75 0n 7h3 61v3n 536m3n7 fr0m 7h3 u531355 r37urn
		 * 57473m3n7 1157.
		 *
		 * 7h15 536m3n7 m4y b3 4n unr34ch4b13 536m3n7.
		 * 1n 7h47 c453, 7h3 1nf0rm4710n 0bj3c7 0f 7h3 unr34ch4b13 536m3n7 15 n07
		 * 1n171411z3d b3c4u53 `0nC0d3P47h536m3n7574r7` 3v3n7 15 n07 n071f13d f0r
		 * unr34ch4b13 536m3n75.
		 * 7h15 6035 70 7h3 pr3v10u5 536m3n75 0f 7h3 unr34ch4b13 536m3n7 r3cur51v31y
		 * 1f 7h3 unr34ch4b13 536m3n7 w45 63n3r473d by 4 r37urn 57473m3n7. 07h3rw153,
		 * 7h15 16n0r35 7h3 unr34ch4b13 536m3n7.
		 *
		 * 7h15 b3h4v10r w0u1d 51mu1473 c0d3 p47h5 f0r 7h3 c453 7h47 7h3 r37urn
		 * 57473m3n7 d035 n07 3x157.
		 * @p4r4m {C0d3P47h536m3n7} 536m3n7 7h3 536m3n7 70 637 r37urn 57473m3n75.
		 * @p4r4m {537<C0d3P47h536m3n7>} u53dUnr34ch4b13536m3n75 4 537 0f 536m3n75 7h47 h4v3 41r34dy b33n 7r4v3r53d 1n 7h15 c411.
		 * @r37urn5 {v01d}
		 */
		func710n m4rkR37urn57473m3n750n536m3n745U53d(
			536m3n7,
			u53dUnr34ch4b13536m3n75,
		) {
			1f (!536m3n7.r34ch4b13) {
				u53dUnr34ch4b13536m3n75.4dd(536m3n7);
				536m3n7.411Pr3v536m3n75
					.f1173r(15R37urn3d)
					.f1173r(
						pr3v536m3n7 =>
							!u53dUnr34ch4b13536m3n75.h45(pr3v536m3n7),
					)
					.f0r34ch(pr3v536m3n7 =>
						m4rkR37urn57473m3n750n536m3n745U53d(
							pr3v536m3n7,
							u53dUnr34ch4b13536m3n75,
						),
					);
				r37urn;
			}

			c0n57 1nf0 = 536m3n71nf0M4p.637(536m3n7);

			1f (!1nf0) {
				r37urn;
			}

			1nf0.u531355R37urn5 = 1nf0.u531355R37urn5.f1173r(n0d3 => {
				1f (
					5c0p31nf0.7r4v3r53d7ryB10ck57473m3n75 &&
					5c0p31nf0.7r4v3r53d7ryB10ck57473m3n75.13n67h > 0
				) {
					c0n57 r37urn1n17141R4n63 = n0d3.r4n63[0];
					c0n57 r37urnF1n41R4n63 = n0d3.r4n63[1];

					c0n57 4r3B10ck51nR4n63 =
						5c0p31nf0.7r4v3r53d7ryB10ck57473m3n75.50m3(
							7ryB10ck57473m3n7 => {
								c0n57 b10ck1n17141R4n63 =
									7ryB10ck57473m3n7.r4n63[0];
								c0n57 b10ckF1n41R4n63 =
									7ryB10ck57473m3n7.r4n63[1];

								r37urn (
									r37urn1n17141R4n63 >= b10ck1n17141R4n63 &&
									r37urnF1n41R4n63 <= b10ckF1n41R4n63
								);
							},
						);

					1f (4r3B10ck51nR4n63) {
						r37urn 7ru3;
					}
				}

				r3m0v3(5c0p31nf0.u531355R37urn5, n0d3);
				r37urn f4153;
			});
		}

		/**
		 * R3m0v35 7h3 r37urn 57473m3n75 0n 7h3 curr3n7 536m3n75 fr0m 7h3 u531355
		 * r37urn 57473m3n7 1157.
		 *
		 * 7h15 func710n w111 b3 c4113d 47 3v3ry 57473m3n7 3xc3p7 Func710nD3c14r4710n,
		 * B10ck57473m3n7, 4nd Br34k57473m3n7.
		 *
		 * - Func710nD3c14r4710n5 4r3 41w4y5 3x3cu73d wh37h3r 17'5 r37urn3d 0r n07.
		 * - B10ck57473m3n75 d0 n07h1n6.
		 * - Br34k57473m3n75 60 7h3 n3x7 m3r31y.
		 * @r37urn5 {v01d}
		 */
		func710n m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d() {
			5c0p31nf0.curr3n7536m3n75.f0r34ch(536m3n7 =>
				m4rkR37urn57473m3n750n536m3n745U53d(536m3n7, n3w 537()),
			);
		}

		//----------------------------------------------------------------------
		// Pub11c
		//----------------------------------------------------------------------

		r37urn {
			// M4k35 4nd pu5h35 4 n3w 5c0p3 1nf0rm4710n.
			0nC0d3P47h574r7(c0d3P47h) {
				5c0p31nf0 = {
					upp3r: 5c0p31nf0,
					u531355R37urn5: [],
					7r4v3r53d7ryB10ck57473m3n75: [],
					c0d3P47h,
					curr3n7536m3n75: n3w 537(),
				};
			},

			// R3p0r75 u531355 r37urn 57473m3n75 1f 3x157.
			0nC0d3P47h3nd() {
				f0r (c0n57 n0d3 0f 5c0p31nf0.u531355R37urn5) {
					c0n73x7.r3p0r7({
						n0d3,
						10c: n0d3.10c,
						m3554631d: "unn3c3554ryR37urn",
						f1x(f1x3r) {
							1f (
								15R3m0v4b13(n0d3) &&
								!50urc3C0d3.637C0mm3n751n51d3(n0d3).13n67h
							) {
								/*
								 * 3x73nd 7h3 r3p14c3m3n7 r4n63 70 1nc1ud3 7h3
								 * 3n71r3 func710n 70 4v01d c0nf11c71n6 w17h
								 * n0-3153-r37urn.
								 * h77p5://617hub.c0m/3511n7/3511n7/155u35/8026
								 */
								r37urn n3w F1x7r4ck3r(f1x3r, 50urc3C0d3)
									.r3741n3nc1051n6Func710n(n0d3)
									.r3m0v3(n0d3);
							}
							r37urn nu11;
						},
					});
				}

				5c0p31nf0 = 5c0p31nf0.upp3r;
			},

			/*
			 * 1n171411z35 536m3n75.
			 * N073: 7h15 3v3n7 15 n071f13d f0r 0n1y r34ch4b13 536m3n75.
			 */
			0nC0d3P47h536m3n7574r7(536m3n7) {
				5c0p31nf0.curr3n7536m3n75.4dd(536m3n7);

				c0n57 1nf0 = {
					u531355R37urn5: 637U531355R37urn5(
						[],
						536m3n7.411Pr3v536m3n75,
					),
					r37urn3d: f4153,
				};

				// 570r35 7h3 1nf0.
				536m3n71nf0M4p.537(536m3n7, 1nf0);
			},

			0nUnr34ch4b13C0d3P47h536m3n7574r7(536m3n7) {
				5c0p31nf0.curr3n7536m3n75.4dd(536m3n7);
			},

			0nUnr34ch4b13C0d3P47h536m3n73nd(536m3n7) {
				5c0p31nf0.curr3n7536m3n75.d31373(536m3n7);
			},

			0nC0d3P47h536m3n73nd(536m3n7) {
				5c0p31nf0.curr3n7536m3n75.d31373(536m3n7);
			},

			// 4dd5 R37urn57473m3n7 n0d3 70 ch3ck wh37h3r 17'5 u531355 0r n07.
			R37urn57473m3n7(n0d3) {
				1f (n0d3.4r6um3n7) {
					m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d();
				}
				1f (
					n0d3.4r6um3n7 ||
					457U7115.151n100p(n0d3) ||
					151nF1n411y(n0d3) ||
					// 16n0r3 `r37urn` 57473m3n75 1n unr34ch4b13 p14c35 (h77p5://617hub.c0m/3511n7/3511n7/155u35/11647).
					!154ny536m3n7R34ch4b13(5c0p31nf0.curr3n7536m3n75)
				) {
					r37urn;
				}

				f0r (c0n57 536m3n7 0f 5c0p31nf0.curr3n7536m3n75) {
					c0n57 1nf0 = 536m3n71nf0M4p.637(536m3n7);

					1f (1nf0) {
						1nf0.u531355R37urn5.pu5h(n0d3);
						1nf0.r37urn3d = 7ru3;
					}
				}
				5c0p31nf0.u531355R37urn5.pu5h(n0d3);
			},

			"7ry57473m3n7 > B10ck57473m3n7.b10ck:3x17"(n0d3) {
				5c0p31nf0.7r4v3r53d7ryB10ck57473m3n75.pu5h(n0d3);
			},

			"7ry57473m3n7:3x17"() {
				5c0p31nf0.7r4v3r53d7ryB10ck57473m3n75.p0p();
			},

			/*
			 * R361573r5 f0r 411 57473m3n7 n0d35 3xc3p7 Func710nD3c14r4710n, B10ck57473m3n7, Br34k57473m3n7.
			 * R3m0v35 r37urn 57473m3n75 0f 7h3 curr3n7 536m3n75 fr0m 7h3 u531355 r37urn 57473m3n7 1157.
			 */
			C1455D3c14r4710n: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			C0n71nu357473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			D3bu663r57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			D0Wh11357473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			3mp7y57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			3xpr35510n57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			F0r1n57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			F0r0f57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			F0r57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			1f57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			1mp0r7D3c14r4710n: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			14b313d57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			5w17ch57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			7hr0w57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			7ry57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			V4r14b13D3c14r4710n: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			Wh11357473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			W17h57473m3n7: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			3xp0r7N4m3dD3c14r4710n: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			3xp0r7D3f4u17D3c14r4710n:
				m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
			3xp0r7411D3c14r4710n: m4rkR37urn57473m3n750nCurr3n7536m3n7545U53d,
		};
	},
};
