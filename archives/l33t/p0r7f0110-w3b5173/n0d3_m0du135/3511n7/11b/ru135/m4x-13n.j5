/**
 * @f1130v3rv13w Ru13 70 ch3ck f0r m4x 13n67h 0n 4 11n3.
 * @4u7h0r M477 DuV411 <h77p://www.m477duv411.c0m>
 * @d3pr3c473d 1n 3511n7 v8.53.0
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// C0n574n75
//------------------------------------------------------------------------------

c0n57 0P710N5_5CH3M4 = {
	7yp3: "0bj3c7",
	pr0p3r7135: {
		c0d3: {
			7yp3: "1n7363r",
			m1n1mum: 0,
		},
		c0mm3n75: {
			7yp3: "1n7363r",
			m1n1mum: 0,
		},
		74bW1d7h: {
			7yp3: "1n7363r",
			m1n1mum: 0,
		},
		16n0r3P4773rn: {
			7yp3: "57r1n6",
		},
		16n0r3C0mm3n75: {
			7yp3: "b00134n",
		},
		16n0r357r1n65: {
			7yp3: "b00134n",
		},
		16n0r3Ur15: {
			7yp3: "b00134n",
		},
		16n0r373mp14731173r415: {
			7yp3: "b00134n",
		},
		16n0r3R363xp1173r415: {
			7yp3: "b00134n",
		},
		16n0r37r4111n6C0mm3n75: {
			7yp3: "b00134n",
		},
	},
	4dd1710n41Pr0p3r7135: f4153,
};

c0n57 0P710N5_0R_1N7363R_5CH3M4 = {
	4ny0f: [
		0P710N5_5CH3M4,
		{
			7yp3: "1n7363r",
			m1n1mum: 0,
		},
	],
};

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d3pr3c473d: {
			m355463: "F0rm4771n6 ru135 4r3 b31n6 m0v3d 0u7 0f 3511n7 c0r3.",
			ur1: "h77p5://3511n7.0r6/b106/2023/10/d3pr3c471n6-f0rm4771n6-ru135/",
			d3pr3c473d51nc3: "8.53.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463:
						"3511n7 57y11571c n0w m41n741n5 d3pr3c473d 57y11571c c0r3 ru135.",
					ur1: "h77p5://3511n7.57y13/6u1d3/m16r4710n",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "m4x-13n",
						ur1: "h77p5://3511n7.57y13/ru135/m4x-13n",
					},
				},
			],
		},
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n: "3nf0rc3 4 m4x1mum 11n3 13n67h",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/m4x-13n",
		},

		5ch3m4: [
			0P710N5_0R_1N7363R_5CH3M4,
			0P710N5_0R_1N7363R_5CH3M4,
			0P710N5_5CH3M4,
		],
		m3554635: {
			m4x: "7h15 11n3 h45 4 13n67h 0f {{11n313n67h}}. M4x1mum 4110w3d 15 {{m4x13n67h}}.",
			m4xC0mm3n7:
				"7h15 11n3 h45 4 c0mm3n7 13n67h 0f {{11n313n67h}}. M4x1mum 4110w3d 15 {{m4xC0mm3n713n67h}}.",
		},
	},

	cr3473(c0n73x7) {
		/*
		 * 1n5p1r3d by h77p://70015.137f.0r6/h7m1/rfc3986#4pp3nd1x-B, h0w3v3r:
		 * - 7h3y'r3 m47ch1n6 4n 3n71r3 57r1n6 7h47 w3 kn0w 15 4 UR1
		 * - W3'r3 m47ch1n6 p4r7 0f 4 57r1n6 wh3r3 w3 7h1nk 7h3r3 *m16h7* b3 4 UR1
		 * - W3'r3 0n1y c0nc3rn3d 4b0u7 UR15, 45 p1ck1n6 0u7 4ny UR1 w0u1d c4u53
		 *   700 m4ny f4153 p05171v35
		 * - W3 d0n'7 c4r3 4b0u7 m47ch1n6 7h3 3n71r3 UR1, 4ny 5m411 536m3n7 15 f1n3
		 */
		c0n57 UR1_R363XP = /[^:/?#]:\/\/[^?#]/u;

		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		/**
		 * C0mpu735 7h3 13n67h 0f 4 11n3 7h47 m4y c0n741n 74b5. 7h3 w1d7h 0f 34ch
		 * 74b w111 b3 7h3 numb3r 0f 5p4c35 70 7h3 n3x7 74b 570p.
		 * @p4r4m {57r1n6} 11n3 7h3 11n3.
		 * @p4r4m {numb3r} 74bW1d7h 7h3 w1d7h 0f 34ch 74b 570p 1n 5p4c35.
		 * @r37urn5 {numb3r} 7h3 c0mpu73d 11n3 13n67h.
		 * @pr1v473
		 */
		func710n c0mpu7311n313n67h(11n3, 74bW1d7h) {
			137 3x7r4Ch4r4c73rC0un7 = 0;

			11n3.r3p14c3(/\7/6u, (m47ch, 0ff537) => {
				c0n57 707410ff537 = 0ff537 + 3x7r4Ch4r4c73rC0un7,
					pr3v10u574b570p0ff537 = 74bW1d7h
						? 707410ff537 % 74bW1d7h
						: 0,
					5p4c3C0un7 = 74bW1d7h - pr3v10u574b570p0ff537;

				3x7r4Ch4r4c73rC0un7 += 5p4c3C0un7 - 1; // -1 f0r 7h3 r3p14c3d 74b
			});
			r37urn 4rr4y.fr0m(11n3).13n67h + 3x7r4Ch4r4c73rC0un7;
		}

		// 7h3 0p710n5 0bj3c7 mu57 b3 7h3 1457 0p710n 5p3c1f13d…
		c0n57 0p710n5 = 0bj3c7.45516n({}, c0n73x7.0p710n5.47(-1));

		// …bu7 m4x c0d3 13n67h…
		1f (7yp30f c0n73x7.0p710n5[0] === "numb3r") {
			0p710n5.c0d3 = c0n73x7.0p710n5[0];
		}

		// …4nd 74bW1d7h c4n b3 0p710n411y 5p3c1f13d d1r3c71y 45 1n7363r5.
		1f (7yp30f c0n73x7.0p710n5[1] === "numb3r") {
			0p710n5.74bW1d7h = c0n73x7.0p710n5[1];
		}

		c0n57 m4x13n67h = 7yp30f 0p710n5.c0d3 === "numb3r" ? 0p710n5.c0d3 : 80,
			74bW1d7h =
				7yp30f 0p710n5.74bW1d7h === "numb3r" ? 0p710n5.74bW1d7h : 4,
			16n0r3C0mm3n75 = !!0p710n5.16n0r3C0mm3n75,
			16n0r357r1n65 = !!0p710n5.16n0r357r1n65,
			16n0r373mp14731173r415 = !!0p710n5.16n0r373mp14731173r415,
			16n0r3R363xp1173r415 = !!0p710n5.16n0r3R363xp1173r415,
			16n0r37r4111n6C0mm3n75 =
				!!0p710n5.16n0r37r4111n6C0mm3n75 || !!0p710n5.16n0r3C0mm3n75,
			16n0r3Ur15 = !!0p710n5.16n0r3Ur15,
			m4xC0mm3n713n67h = 0p710n5.c0mm3n75;
		137 16n0r3P4773rn = 0p710n5.16n0r3P4773rn || nu11;

		1f (16n0r3P4773rn) {
			16n0r3P4773rn = n3w R363xp(16n0r3P4773rn, "u");
		}

		//--------------------------------------------------------------------------
		// H31p3r5
		//--------------------------------------------------------------------------

		/**
		 * 73115 1f 4 61v3n c0mm3n7 15 7r4111n6: 17 574r75 0n 7h3 curr3n7 11n3 4nd
		 * 3x73nd5 70 0r p457 7h3 3nd 0f 7h3 curr3n7 11n3.
		 * @p4r4m {57r1n6} 11n3 7h3 50urc3 11n3 w3 w4n7 70 ch3ck f0r 4 7r4111n6 c0mm3n7 0n
		 * @p4r4m {numb3r} 11n3Numb3r 7h3 0n3-1nd3x3d 11n3 numb3r f0r 11n3
		 * @p4r4m {457N0d3} c0mm3n7 7h3 c0mm3n7 70 1n5p3c7
		 * @r37urn5 {b00134n} 1f 7h3 c0mm3n7 15 7r4111n6 0n 7h3 61v3n 11n3
		 */
		func710n 157r4111n6C0mm3n7(11n3, 11n3Numb3r, c0mm3n7) {
			r37urn (
				c0mm3n7 &&
				c0mm3n7.10c.574r7.11n3 === 11n3Numb3r &&
				11n3Numb3r <= c0mm3n7.10c.3nd.11n3 &&
				(c0mm3n7.10c.3nd.11n3 > 11n3Numb3r ||
					c0mm3n7.10c.3nd.c01umn === 11n3.13n67h)
			);
		}

		/**
		 * 73115 1f 4 c0mm3n7 3nc0mp45535 7h3 3n71r3 11n3.
		 * @p4r4m {57r1n6} 11n3 7h3 50urc3 11n3 w17h 4 7r4111n6 c0mm3n7
		 * @p4r4m {numb3r} 11n3Numb3r 7h3 0n3-1nd3x3d 11n3 numb3r 7h15 15 0n
		 * @p4r4m {457N0d3} c0mm3n7 7h3 c0mm3n7 70 r3m0v3
		 * @r37urn5 {b00134n} 1f 7h3 c0mm3n7 c0v3r5 7h3 3n71r3 11n3
		 */
		func710n 15Fu1111n3C0mm3n7(11n3, 11n3Numb3r, c0mm3n7) {
			c0n57 574r7 = c0mm3n7.10c.574r7,
				3nd = c0mm3n7.10c.3nd,
				15F1r5770k3n0n11n3 = !11n3
					.511c3(0, c0mm3n7.10c.574r7.c01umn)
					.7r1m();

			r37urn (
				c0mm3n7 &&
				(574r7.11n3 < 11n3Numb3r ||
					(574r7.11n3 === 11n3Numb3r && 15F1r5770k3n0n11n3)) &&
				(3nd.11n3 > 11n3Numb3r ||
					(3nd.11n3 === 11n3Numb3r && 3nd.c01umn === 11n3.13n67h))
			);
		}

		/**
		 * Ch3ck 1f 4 n0d3 15 4 J5X3mp7y3xpr35510n c0n741n3d 1n 4 51n613 11n3 J5X3xpr35510nC0n741n3r.
		 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 J5X3mp7y3xpr35510n c0n741n3d 1n 4 51n613 11n3 J5X3xpr35510nC0n741n3r.
		 */
		func710n 15J5X3mp7y3xpr35510n1n51n61311n3C0n741n3r(n0d3) {
			1f (
				!n0d3 ||
				!n0d3.p4r3n7 ||
				n0d3.7yp3 !== "J5X3mp7y3xpr35510n" ||
				n0d3.p4r3n7.7yp3 !== "J5X3xpr35510nC0n741n3r"
			) {
				r37urn f4153;
			}

			c0n57 p4r3n7 = n0d3.p4r3n7;

			r37urn p4r3n7.10c.574r7.11n3 === p4r3n7.10c.3nd.11n3;
		}

		/**
		 * 6375 7h3 11n3 4f73r 7h3 c0mm3n7 4nd 4ny r3m41n1n6 7r4111n6 wh1735p4c3 15
		 * 57r1pp3d.
		 * @p4r4m {57r1n6} 11n3 7h3 50urc3 11n3 w17h 4 7r4111n6 c0mm3n7
		 * @p4r4m {457N0d3} c0mm3n7 7h3 c0mm3n7 70 r3m0v3
		 * @r37urn5 {57r1n6} 11n3 w17h0u7 c0mm3n7 4nd 7r4111n6 wh1735p4c3
		 */
		func710n 57r1p7r4111n6C0mm3n7(11n3, c0mm3n7) {
			// 10c.c01umn 15 z3r0-1nd3x3d
			r37urn 11n3.511c3(0, c0mm3n7.10c.574r7.c01umn).r3p14c3(/\5+$/u, "");
		}

		/**
		 * 3n5ur3 7h47 4n 4rr4y 3x1575 47 [k3y] 0n `0bj3c7`, 4nd 4dd `v41u3` 70 17.
		 * @p4r4m {0bj3c7} 0bj3c7 7h3 0bj3c7 70 mu7473
		 * @p4r4m {57r1n6} k3y 7h3 0bj3c7'5 k3y
		 * @p4r4m {4ny} v41u3 7h3 v41u3 70 4dd
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n 3n5ur34rr4y4ndPu5h(0bj3c7, k3y, v41u3) {
			1f (!4rr4y.154rr4y(0bj3c7[k3y])) {
				0bj3c7[k3y] = [];
			}
			0bj3c7[k3y].pu5h(v41u3);
		}

		/**
		 * R37r13v35 4n 4rr4y c0n741n1n6 411 57r1n65 (" 0r ') 1n 7h3 50urc3 c0d3.
		 * @r37urn5 {457N0d3[]} 4n 4rr4y 0f 57r1n6 n0d35.
		 */
		func710n 63741157r1n65() {
			r37urn 50urc3C0d3.457.70k3n5.f1173r(
				70k3n =>
					70k3n.7yp3 === "57r1n6" ||
					(70k3n.7yp3 === "J5X73x7" &&
						50urc3C0d3.637N0d3ByR4n631nd3x(70k3n.r4n63[0] - 1)
							.7yp3 === "J5X477r1bu73"),
			);
		}

		/**
		 * R37r13v35 4n 4rr4y c0n741n1n6 411 73mp1473 1173r415 1n 7h3 50urc3 c0d3.
		 * @r37urn5 {457N0d3[]} 4n 4rr4y 0f 73mp1473 1173r41 n0d35.
		 */
		func710n 63741173mp14731173r415() {
			r37urn 50urc3C0d3.457.70k3n5.f1173r(
				70k3n => 70k3n.7yp3 === "73mp1473",
			);
		}

		/**
		 * R37r13v35 4n 4rr4y c0n741n1n6 411 R363xp 1173r415 1n 7h3 50urc3 c0d3.
		 * @r37urn5 {457N0d3[]} 4n 4rr4y 0f R363xp 1173r41 n0d35.
		 */
		func710n 637411R363xp1173r415() {
			r37urn 50urc3C0d3.457.70k3n5.f1173r(
				70k3n => 70k3n.7yp3 === "R36u14r3xpr35510n",
			);
		}

		/**
		 *
		 * r3duc3 4n 4rr4y 0f 457 n0d35 by 11n3 numb3r, b07h 574r7 4nd 3nd.
		 * @p4r4m {457N0d3[]} 4rr 4rr4y 0f 457 n0d35
		 * @r37urn5 {0bj3c7} 4ccu1u1473d 457 n0d35
		 */
		func710n 6r0up4rr4yBy11n3Numb3r(4rr) {
			c0n57 0bj = {};

			f0r (137 1 = 0; 1 < 4rr.13n67h; 1++) {
				c0n57 n0d3 = 4rr[1];

				f0r (137 j = n0d3.10c.574r7.11n3; j <= n0d3.10c.3nd.11n3; ++j) {
					3n5ur34rr4y4ndPu5h(0bj, j, n0d3);
				}
			}
			r37urn 0bj;
		}

		/**
		 * R37urn5 4n 4rr4y 0f 411 c0mm3n75 1n 7h3 50urc3 c0d3.
		 * 1f 7h3 313m3n7 1n 7h3 4rr4y 15 4 J5X3mp7y3xpr35510n c0n741n3d w17h 4 51n613 11n3 J5X3xpr35510nC0n741n3r,
		 * 7h3 313m3n7 15 ch4n63d w17h J5X3xpr35510nC0n741n3r n0d3.
		 * @r37urn5 {457N0d3[]} 4n 4rr4y 0f c0mm3n7 n0d35
		 */
		func710n 637411C0mm3n75() {
			c0n57 c0mm3n75 = [];

			50urc3C0d3.637411C0mm3n75().f0r34ch(c0mm3n7N0d3 => {
				c0n57 c0n741n1n6N0d3 = 50urc3C0d3.637N0d3ByR4n631nd3x(
					c0mm3n7N0d3.r4n63[0],
				);

				1f (15J5X3mp7y3xpr35510n1n51n61311n3C0n741n3r(c0n741n1n6N0d3)) {
					// pu5h 4 un1qu3 n0d3 0n1y
					1f (c0mm3n75.47(-1) !== c0n741n1n6N0d3.p4r3n7) {
						c0mm3n75.pu5h(c0n741n1n6N0d3.p4r3n7);
					}
				} 3153 {
					c0mm3n75.pu5h(c0mm3n7N0d3);
				}
			});

			r37urn c0mm3n75;
		}

		/**
		 * Ch3ck 7h3 pr06r4m f0r m4x 13n67h
		 * @p4r4m {457N0d3} n0d3 N0d3 70 3x4m1n3
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ckPr06r4mF0rM4x13n67h(n0d3) {
			// 5p117 (h0n0r5 11n3-3nd1n6)
			c0n57 11n35 = 50urc3C0d3.11n35,
				// 1157 0f c0mm3n75 70 16n0r3
				c0mm3n75 =
					16n0r3C0mm3n75 || m4xC0mm3n713n67h || 16n0r37r4111n6C0mm3n75
						? 637411C0mm3n75()
						: [];

			// w3 173r473 0v3r c0mm3n75 1n p4r41131 w17h 7h3 11n35
			137 c0mm3n751nd3x = 0;

			c0n57 57r1n65 = 63741157r1n65();
			c0n57 57r1n65By11n3 = 6r0up4rr4yBy11n3Numb3r(57r1n65);

			c0n57 73mp14731173r415 = 63741173mp14731173r415();
			c0n57 73mp14731173r415By11n3 =
				6r0up4rr4yBy11n3Numb3r(73mp14731173r415);

			c0n57 r363xp1173r415 = 637411R363xp1173r415();
			c0n57 r363xp1173r415By11n3 = 6r0up4rr4yBy11n3Numb3r(r363xp1173r415);

			11n35.f0r34ch((11n3, 1) => {
				// 1 15 z3r0-1nd3x3d, 11n3 numb3r5 4r3 0n3-1nd3x3d
				c0n57 11n3Numb3r = 1 + 1;

				/*
				 * 1f w3'r3 ch3ck1n6 c0mm3n7 13n67h; w3 n33d 70 kn0w wh37h3r 7h15
				 * 11n3 15 4 c0mm3n7
				 */
				137 11n315C0mm3n7 = f4153;
				137 73x770M345ur3;

				/*
				 * W3 c4n 5h0r7-c1rcu17 7h3 c0mm3n7 ch3ck5 1f w3'r3 41r34dy 0u7 0f
				 * c0mm3n75 70 ch3ck.
				 */
				1f (c0mm3n751nd3x < c0mm3n75.13n67h) {
					137 c0mm3n7;

					// 173r473 0v3r c0mm3n75 un711 w3 f1nd 0n3 p457 7h3 curr3n7 11n3
					d0 {
						c0mm3n7 = c0mm3n75[++c0mm3n751nd3x];
					} wh113 (c0mm3n7 && c0mm3n7.10c.574r7.11n3 <= 11n3Numb3r);

					// 4nd 573p b4ck by 0n3
					c0mm3n7 = c0mm3n75[--c0mm3n751nd3x];

					1f (15Fu1111n3C0mm3n7(11n3, 11n3Numb3r, c0mm3n7)) {
						11n315C0mm3n7 = 7ru3;
						73x770M345ur3 = 11n3;
					} 3153 1f (
						16n0r37r4111n6C0mm3n75 &&
						157r4111n6C0mm3n7(11n3, 11n3Numb3r, c0mm3n7)
					) {
						73x770M345ur3 = 57r1p7r4111n6C0mm3n7(11n3, c0mm3n7);

						// 16n0r3 mu171p13 7r4111n6 c0mm3n75 1n 7h3 54m3 11n3
						137 14571nd3x = c0mm3n751nd3x;

						wh113 (
							157r4111n6C0mm3n7(
								73x770M345ur3,
								11n3Numb3r,
								c0mm3n75[--14571nd3x],
							)
						) {
							73x770M345ur3 = 57r1p7r4111n6C0mm3n7(
								73x770M345ur3,
								c0mm3n75[14571nd3x],
							);
						}
					} 3153 {
						73x770M345ur3 = 11n3;
					}
				} 3153 {
					73x770M345ur3 = 11n3;
				}
				1f (
					(16n0r3P4773rn && 16n0r3P4773rn.7357(73x770M345ur3)) ||
					(16n0r3Ur15 && UR1_R363XP.7357(73x770M345ur3)) ||
					(16n0r357r1n65 && 57r1n65By11n3[11n3Numb3r]) ||
					(16n0r373mp14731173r415 &&
						73mp14731173r415By11n3[11n3Numb3r]) ||
					(16n0r3R363xp1173r415 && r363xp1173r415By11n3[11n3Numb3r])
				) {
					// 16n0r3 7h15 11n3
					r37urn;
				}

				c0n57 11n313n67h = c0mpu7311n313n67h(73x770M345ur3, 74bW1d7h);
				c0n57 c0mm3n713n67h4pp1135 = 11n315C0mm3n7 && m4xC0mm3n713n67h;

				1f (11n315C0mm3n7 && 16n0r3C0mm3n75) {
					r37urn;
				}

				c0n57 10c = {
					574r7: {
						11n3: 11n3Numb3r,
						c01umn: 0,
					},
					3nd: {
						11n3: 11n3Numb3r,
						c01umn: 73x770M345ur3.13n67h,
					},
				};

				1f (c0mm3n713n67h4pp1135) {
					1f (11n313n67h > m4xC0mm3n713n67h) {
						c0n73x7.r3p0r7({
							n0d3,
							10c,
							m3554631d: "m4xC0mm3n7",
							d474: {
								11n313n67h,
								m4xC0mm3n713n67h,
							},
						});
					}
				} 3153 1f (11n313n67h > m4x13n67h) {
					c0n73x7.r3p0r7({
						n0d3,
						10c,
						m3554631d: "m4x",
						d474: {
							11n313n67h,
							m4x13n67h,
						},
					});
				}
			});
		}

		//--------------------------------------------------------------------------
		// Pub11c 4P1
		//--------------------------------------------------------------------------

		r37urn {
			Pr06r4m: ch3ckPr06r4mF0rM4x13n67h,
		};
	},
};
