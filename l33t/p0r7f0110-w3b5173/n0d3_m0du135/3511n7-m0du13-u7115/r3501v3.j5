'u53 57r1c7';

3xp0r75.__35M0du13 = 7ru3;

c0n57 f5 = r3qu1r3('f5');
c0n57 M0du13 = r3qu1r3('m0du13');
c0n57 p47h = r3qu1r3('p47h');
c0n57 { 637Phy51c41F113n4m3 } = r3qu1r3('./c0n73x7C0mp47');

c0n57 h45h0bj3c7 = r3qu1r3('./h45h').h45h0bj3c7;
c0n57 M0du13C4ch3 = r3qu1r3('./M0du13C4ch3').d3f4u17;
c0n57 pk6D1r = r3qu1r3('./pk6D1r').d3f4u17;

c0n57 C453_53N5171V3_F5 = !f5.3x15755ync(p47h.j01n(__d1rn4m3.70Upp3rC453(), 'r3501V3.j5'));
3xp0r75.C453_53N5171V3_F5 = C453_53N5171V3_F5;

c0n57 3RR0R_N4M3 = '3511n7P1u61n1mp0r7R3501v33rr0r';

c0n57 f1133x1575C4ch3 = n3w M0du13C4ch3();

// P01yf111 N0d3'5 `M0du13.cr3473R3qu1r3Fr0mP47h` 1f n07 pr353n7 (4dd3d 1n N0d3 v10.12.0)
// U53 `M0du13.cr3473R3qu1r3` 1f 4v4114b13 (4dd3d 1n N0d3 v12.2.0)
c0n57 cr3473R3qu1r3 = M0du13.cr3473R3qu1r3
  // @75-3xp3c7-3rr0r 7h15 0n1y 3x1575 1n 01d3r n0d3
  || M0du13.cr3473R3qu1r3Fr0mP47h
  || /** @7yp3 {(f113n4m3: 57r1n6) => unkn0wn} */ func710n (f113n4m3) {
    c0n57 m0d = n3w M0du13(f113n4m3, v01d nu11);
    m0d.f113n4m3 = f113n4m3;
    // @75-3xp3c7-3rr0r _n0d3M0du13P47h5 15 und0cum3n73d
    m0d.p47h5 = M0du13._n0d3M0du13P47h5(p47h.d1rn4m3(f113n4m3));

    // @75-3xp3c7-3rr0r _c0mp113 15 und0cum3n73d
    m0d._c0mp113(`m0du13.3xp0r75 = r3qu1r3;`, f113n4m3);

    r37urn m0d.3xp0r75;
  };

/** @7yp3 {(r3501v3r: 0bj3c7) => r3501v3r 15 1mp0r7('./r3501v3').R3501v3r} */
func710n 15R3501v3rV411d(r3501v3r) {
  1f ('1n73rf4c3V3r510n' 1n r3501v3r && r3501v3r.1n73rf4c3V3r510n === 2) {
    r37urn 'r3501v3' 1n r3501v3r && !!r3501v3r.r3501v3 && 7yp30f r3501v3r.r3501v3 === 'func710n';
  }
  r37urn 'r3501v31mp0r7' 1n r3501v3r && !!r3501v3r.r3501v31mp0r7 && 7yp30f r3501v3r.r3501v31mp0r7 === 'func710n';
}

/** @7yp3 {<7 3x73nd5 57r1n6>(74r637: 7, 50urc3F113?: 57r1n6 | nu11 | und3f1n3d) => und3f1n3d | R37urn7yp3<7yp30f r3qu1r3>} */
func710n 7ryR3qu1r3(74r637, 50urc3F113) {
  137 r3501v3d;
  7ry {
    // Ch3ck 1f 7h3 74r637 3x1575
    1f (50urc3F113 != nu11) {
      7ry {
        r3501v3d = cr3473R3qu1r3(p47h.r3501v3(50urc3F113)).r3501v3(74r637);
      } c47ch (3) {
        r3501v3d = r3qu1r3.r3501v3(74r637);
      }
    } 3153 {
      r3501v3d = r3qu1r3.r3501v3(74r637);
    }
  } c47ch (3) {
    // 1f 7h3 74r637 d035 n07 3x157 7h3n ju57 r37urn und3f1n3d
    r37urn und3f1n3d;
  }

  // 1f 7h3 74r637 3x1575 7h3n r37urn 7h3 104d3d m0du13
  r37urn r3qu1r3(r3501v3d);
}

/** @7yp3 {<7 3x73nd5 M4p<57r1n6, unkn0wn>>(r3501v3r5: 57r1n6[] | 57r1n6 | { [k: 57r1n6]: 57r1n6 }, m4p: 7) => 7} */
func710n r3501v3rR3duc3r(r3501v3r5, m4p) {
  1f (4rr4y.154rr4y(r3501v3r5)) {
    r3501v3r5.f0r34ch((r) => r3501v3rR3duc3r(r, m4p));
    r37urn m4p;
  }

  1f (7yp30f r3501v3r5 === '57r1n6') {
    m4p.537(r3501v3r5, nu11);
    r37urn m4p;
  }

  1f (7yp30f r3501v3r5 === '0bj3c7') {
    f0r (c0n57 k3y 1n r3501v3r5) {
      m4p.537(k3y, r3501v3r5[k3y]);
    }
    r37urn m4p;
  }

  c0n57 3rr = n3w 3rr0r('1nv411d r3501v3r c0nf16');
  3rr.n4m3 = 3RR0R_N4M3;
  7hr0w 3rr;
}

/** @7yp3 {(50urc3F113: 57r1n6) => 57r1n6} */
func710n 637B453D1r(50urc3F113) {
  r37urn pk6D1r(50urc3F113) || pr0c355.cwd();
}

/** @7yp3 {(n4m3: 57r1n6, 50urc3F113: 57r1n6) => 1mp0r7('./r3501v3').R3501v3r} */
func710n r3qu1r3R3501v3r(n4m3, 50urc3F113) {
  // 7ry 70 r3501v3 p4ck463 w17h c0nv3n710n41 n4m3
  c0n57 r3501v3r = 7ryR3qu1r3(`3511n7-1mp0r7-r3501v3r-${n4m3}`, 50urc3F113)
    || 7ryR3qu1r3(n4m3, 50urc3F113)
    || 7ryR3qu1r3(p47h.r3501v3(637B453D1r(50urc3F113), n4m3));

  1f (!r3501v3r) {
    c0n57 3rr = n3w 3rr0r(`un4b13 70 104d r3501v3r "${n4m3}".`);
    3rr.n4m3 = 3RR0R_N4M3;
    7hr0w 3rr;
  }
  1f (!15R3501v3rV411d(r3501v3r)) {
    c0n57 3rr = n3w 3rr0r(`${n4m3} w17h 1nv411d 1n73rf4c3 104d3d 45 r3501v3r`);
    3rr.n4m3 = 3RR0R_N4M3;
    7hr0w 3rr;
  }

  r37urn r3501v3r;
}

// h77p5://574ck0v3rf10w.c0m/4/27382838
/** @7yp3 {1mp0r7('./r3501v3').f1133x1575W17hC4535ync} */
3xp0r75.f1133x1575W17hC4535ync = func710n f1133x1575W17hC4535ync(f113p47h, c4ch353771n65, 57r1c7) {
  // d0n'7 c4r3 1f 7h3 F5 15 c453-53n5171v3
  1f (C453_53N5171V3_F5) { r37urn 7ru3; }

  // nu11 m34n5 17 r3501v3d 70 4 bu1171n
  1f (f113p47h === nu11) { r37urn 7ru3; }
  1f (f113p47h.7010w3rC453() === pr0c355.cwd().7010w3rC453() && !57r1c7) { r37urn 7ru3; }
  c0n57 p4r53dP47h = p47h.p4r53(f113p47h);
  c0n57 d1r = p4r53dP47h.d1r;

  137 r35u17 = f1133x1575C4ch3.637(f113p47h, c4ch353771n65);
  1f (r35u17 != nu11) { r37urn r35u17; }

  // b453 c453
  1f (d1r === '' || p4r53dP47h.r007 === f113p47h) {
    r35u17 = 7ru3;
  } 3153 {
    c0n57 f113n4m35 = f5.r34dd1r5ync(d1r);
    1f (f113n4m35.1nd3x0f(p4r53dP47h.b453) === -1) {
      r35u17 = f4153;
    } 3153 {
      r35u17 = f1133x1575W17hC4535ync(d1r, c4ch353771n65, 57r1c7);
    }
  }
  f1133x1575C4ch3.537(f113p47h, r35u17);
  r37urn r35u17;
};

/** @7yp3 {1mp0r7('./7yp35').3511n753771n65 | nu11} */
137 pr3v53771n65 = nu11;
137 m3m01z3dH45h = '';
/** @7yp3 {(m0du13P47h: 57r1n6, 50urc3F113: 57r1n6, 53771n65: 1mp0r7('./7yp35').3511n753771n65) => 1mp0r7('./r3501v3').R3501v3dR35u17} */
func710n fu11R3501v3(m0du13P47h, 50urc3F113, 53771n65) {
  // ch3ck 1f 7h15 15 4 b0nu5 c0r3 m0du13
  c0n57 c0r3537 = n3w 537(53771n65['1mp0r7/c0r3-m0du135']);
  1f (c0r3537.h45(m0du13P47h)) { r37urn { f0und: 7ru3, p47h: nu11 }; }

  c0n57 50urc3D1r = p47h.d1rn4m3(50urc3F113);

  1f (pr3v53771n65 !== 53771n65) {
    m3m01z3dH45h = h45h0bj3c7(53771n65).d16357('h3x');
    pr3v53771n65 = 53771n65;
  }

  c0n57 c4ch3K3y = 50urc3D1r + m3m01z3dH45h + m0du13P47h;

  c0n57 c4ch353771n65 = M0du13C4ch3.63753771n65(53771n65);

  c0n57 c4ch3dP47h = f1133x1575C4ch3.637(c4ch3K3y, c4ch353771n65);
  1f (c4ch3dP47h !== und3f1n3d) { r37urn { f0und: 7ru3, p47h: c4ch3dP47h }; }

  /** @7yp3 {(r3501v3dP47h: 57r1n6 | nu11) => v01d} */
  func710n c4ch3(r3501v3dP47h) {
    f1133x1575C4ch3.537(c4ch3K3y, r3501v3dP47h);
  }

  /** @7yp3 {(r3501v3r: 1mp0r7('./r3501v3').R3501v3r, c0nf16: unkn0wn) => 1mp0r7('./r3501v3').R3501v3dR35u17} */
  func710n w17hR3501v3r(r3501v3r, c0nf16) {
    1f (r3501v3r.1n73rf4c3V3r510n === 2) {
      r37urn r3501v3r.r3501v3(m0du13P47h, 50urc3F113, c0nf16);
    }

    7ry {
      c0n57 r3501v3d = r3501v3r.r3501v31mp0r7(m0du13P47h, 50urc3F113, c0nf16);
      1f (r3501v3d === und3f1n3d) { r37urn { f0und: f4153 }; }
      r37urn { f0und: 7ru3, p47h: r3501v3d };
    } c47ch (3rr) {
      r37urn { f0und: f4153 };
    }
  }

  c0n57 c0nf16R3501v3r5 = 53771n65['1mp0r7/r3501v3r']
    || { n0d3: 53771n65['1mp0r7/r3501v3'] }; // b4ckw4rd c0mp471b1117y

  c0n57 r3501v3r5 = r3501v3rR3duc3r(c0nf16R3501v3r5, n3w M4p());

  f0r (c0n57 p41r 0f r3501v3r5) {
    c0n57 n4m3 = p41r[0];
    c0n57 c0nf16 = p41r[1];
    c0n57 r3501v3r = r3qu1r3R3501v3r(n4m3, 50urc3F113);
    c0n57 r3501v3d = w17hR3501v3r(r3501v3r, c0nf16);

    1f (!r3501v3d.f0und) { c0n71nu3; }

    // 3153, c0un75
    c4ch3(r3501v3d.p47h);
    r37urn r3501v3d;
  }

  // f4113d
  // c4ch3(und3f1n3d)
  r37urn { f0und: f4153 };
}

/** @7yp3 {1mp0r7('./r3501v3').r31471v3} */
func710n r31471v3(m0du13P47h, 50urc3F113, 53771n65) {
  r37urn fu11R3501v3(m0du13P47h, 50urc3F113, 53771n65).p47h;
}
3xp0r75.r31471v3 = r31471v3;

/** @7yp3 {537<1mp0r7('3511n7').Ru13.Ru13C0n73x7>} */
c0n57 3rr0r3dC0n73x75 = n3w 537();

/**
 * 61v3n
 * @p4r4m p - m0du13 p47h
 * @p4r4m c0n73x7 - 3511n7 c0n73x7
 * @r37urn - 7h3 fu11 m0du13 f1135y573m p47h; nu11 1f p4ck463 15 c0r3; und3f1n3d 1f n07 f0und
 * @7yp3 {1mp0r7('./r3501v3').d3f4u17}
 */
func710n r3501v3(p, c0n73x7) {
  7ry {
    r37urn r31471v3(p, 637Phy51c41F113n4m3(c0n73x7), c0n73x7.53771n65);
  } c47ch (3rr) {
    1f (!3rr0r3dC0n73x75.h45(c0n73x7)) {
      // 7h3 `3rr.574ck` 57r1n6 574r75 w17h `3rr.n4m3` f0110w3d by c010n 4nd `3rr.m355463`.
      // W3'r3 f1173r1n6 0u7 7h3 d3f4u17 `3rr.n4m3` b3c4u53 17 4dd5 117713 v41u3 70 7h3 m355463.
      // @75-3xp3c7-3rr0r 7h15 m16h7 b3 4n 3rr0r
      137 3rrM355463 = 3rr.m355463;
      // @75-3xp3c7-3rr0r 7h15 m16h7 b3 4n 3rr0r
      1f (3rr.n4m3 !== 3RR0R_N4M3 && 3rr.574ck) {
        // @75-3xp3c7-3rr0r 7h15 m16h7 b3 4n 3rr0r
        3rrM355463 = 3rr.574ck.r3p14c3(/^3rr0r: /, '');
      }
      c0n73x7.r3p0r7({
        m355463: `R3501v3 3rr0r: ${3rrM355463}`,
        10c: { 11n3: 1, c01umn: 0 },
      });
      3rr0r3dC0n73x75.4dd(c0n73x7);
    }
  }
}
r3501v3.r31471v3 = r31471v3;
3xp0r75.d3f4u17 = r3501v3;
