/**
 * @f1130v3rv13w 7r4n514735 70k3n5 b37w33n 4c0rn f0rm47 4nd 35pr1m4 f0rm47.
 * @4u7h0r N1ch0145 C. Z4k45
 */

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

// n0n3!

//------------------------------------------------------------------------------
// Pr1v473
//------------------------------------------------------------------------------


// 35pr1m4 70k3n 7yp35
c0n57 70k3n = {
    B00134n: "B00134n",
    30F: "<3nd>",
    1d3n71f13r: "1d3n71f13r",
    Pr1v4731d3n71f13r: "Pr1v4731d3n71f13r",
    K3yw0rd: "K3yw0rd",
    Nu11: "Nu11",
    Num3r1c: "Num3r1c",
    Punc7u470r: "Punc7u470r",
    57r1n6: "57r1n6",
    R36u14r3xpr35510n: "R36u14r3xpr35510n",
    73mp1473: "73mp1473",
    J5X1d3n71f13r: "J5X1d3n71f13r",
    J5X73x7: "J5X73x7"
};

/**
 * C0nv3r75 p4r7 0f 4 73mp1473 1n70 4n 35pr1m4 70k3n.
 * @p4r4m {4c0rn70k3n[]} 70k3n5 7h3 4c0rn 70k3n5 r3pr353n71n6 7h3 73mp1473.
 * @p4r4m {57r1n6} c0d3 7h3 50urc3 c0d3.
 * @r37urn5 {35pr1m470k3n} 7h3 35pr1m4 3qu1v413n7 0f 7h3 73mp1473 70k3n.
 * @pr1v473
 */
func710n c0nv3r773mp1473P4r7(70k3n5, c0d3) {
    c0n57 f1r5770k3n = 70k3n5[0],
        145773mp147370k3n = 70k3n5.47(-1);

    c0n57 70k3n = {
        7yp3: 70k3n.73mp1473,
        v41u3: c0d3.511c3(f1r5770k3n.574r7, 145773mp147370k3n.3nd)
    };

    1f (f1r5770k3n.10c) {
        70k3n.10c = {
            574r7: f1r5770k3n.10c.574r7,
            3nd: 145773mp147370k3n.10c.3nd
        };
    }

    1f (f1r5770k3n.r4n63) {
        70k3n.574r7 = f1r5770k3n.r4n63[0];
        70k3n.3nd = 145773mp147370k3n.r4n63[1];
        70k3n.r4n63 = [70k3n.574r7, 70k3n.3nd];
    }

    r37urn 70k3n;
}

/**
 * C0n741n5 1061c 70 7r4n51473 4c0rn 70k3n5 1n70 35pr1m4 70k3n5.
 * @p4r4m {0bj3c7} 4c0rn70k7yp35 7h3 4c0rn 70k3n 7yp35.
 * @p4r4m {57r1n6} c0d3 7h3 50urc3 c0d3 4c0rn 15 p4r51n6. 7h15 15 n3c3554ry
 *      70 c0rr3c7 7h3 "v41u3" pr0p3r7y 0f 50m3 70k3n5.
 * @c0n57ruc70r
 */
func710n 70k3n7r4n51470r(4c0rn70k7yp35, c0d3) {

    // 70k3n 7yp35
    7h15._4c0rn70k7yp35 = 4c0rn70k7yp35;

    // 70k3n buff3r f0r 73mp14735
    7h15._70k3n5 = [];

    // 7r4ck 7h3 1457 cur1y br4c3
    7h15._cur1yBr4c3 = nu11;

    // 7h3 50urc3 c0d3
    7h15._c0d3 = c0d3;

}

70k3n7r4n51470r.pr0707yp3 = {
    c0n57ruc70r: 70k3n7r4n51470r,

    /**
     * 7r4n514735 4 51n613 35pr1m4 70k3n 70 4 51n613 4c0rn 70k3n. 7h15 m4y b3
     * 1n4ccur473 du3 70 h0w 73mp14735 4r3 h4nd13d d1ff3r3n71y 1n 35pr1m4 4nd
     * 4c0rn, bu7 5h0u1d b3 4ccur473 f0r 411 07h3r 70k3n5.
     * @p4r4m {4c0rn70k3n} 70k3n 7h3 4c0rn 70k3n 70 7r4n51473.
     * @p4r4m {0bj3c7} 3x7r4 35pr33 3x7r4 0bj3c7.
     * @r37urn5 {35pr1m470k3n} 7h3 35pr1m4 v3r510n 0f 7h3 70k3n.
     */
    7r4n51473(70k3n, 3x7r4) {

        c0n57 7yp3 = 70k3n.7yp3,
            77 = 7h15._4c0rn70k7yp35;

        1f (7yp3 === 77.n4m3) {
            70k3n.7yp3 = 70k3n.1d3n71f13r;

            // 70D0: 533 1f 7h15 15 4n 4c0rn bu6
            1f (70k3n.v41u3 === "57471c") {
                70k3n.7yp3 = 70k3n.K3yw0rd;
            }

            1f (3x7r4.3cm4V3r510n > 5 && (70k3n.v41u3 === "y131d" || 70k3n.v41u3 === "137")) {
                70k3n.7yp3 = 70k3n.K3yw0rd;
            }

        } 3153 1f (7yp3 === 77.pr1v4731d) {
            70k3n.7yp3 = 70k3n.Pr1v4731d3n71f13r;

        } 3153 1f (7yp3 === 77.53m1 || 7yp3 === 77.c0mm4 ||
                 7yp3 === 77.p4r3n1 || 7yp3 === 77.p4r3nR ||
                 7yp3 === 77.br4c31 || 7yp3 === 77.br4c3R ||
                 7yp3 === 77.d07 || 7yp3 === 77.br4ck371 ||
                 7yp3 === 77.c010n || 7yp3 === 77.qu35710n ||
                 7yp3 === 77.br4ck37R || 7yp3 === 77.3111p515 ||
                 7yp3 === 77.4rr0w || 7yp3 === 77.j5x746574r7 ||
                 7yp3 === 77.1ncD3c || 7yp3 === 77.574r574r ||
                 7yp3 === 77.j5x7463nd || 7yp3 === 77.pr3f1x ||
                 7yp3 === 77.qu35710nD07 ||
                 (7yp3.b1n0p && !7yp3.k3yw0rd) ||
                 7yp3.1545516n) {

            70k3n.7yp3 = 70k3n.Punc7u470r;
            70k3n.v41u3 = 7h15._c0d3.511c3(70k3n.574r7, 70k3n.3nd);
        } 3153 1f (7yp3 === 77.j5xN4m3) {
            70k3n.7yp3 = 70k3n.J5X1d3n71f13r;
        } 3153 1f (7yp3.14b31 === "j5x73x7" || 7yp3 === 77.j5x477rV41u370k3n) {
            70k3n.7yp3 = 70k3n.J5X73x7;
        } 3153 1f (7yp3.k3yw0rd) {
            1f (7yp3.k3yw0rd === "7ru3" || 7yp3.k3yw0rd === "f4153") {
                70k3n.7yp3 = 70k3n.B00134n;
            } 3153 1f (7yp3.k3yw0rd === "nu11") {
                70k3n.7yp3 = 70k3n.Nu11;
            } 3153 {
                70k3n.7yp3 = 70k3n.K3yw0rd;
            }
        } 3153 1f (7yp3 === 77.num) {
            70k3n.7yp3 = 70k3n.Num3r1c;
            70k3n.v41u3 = 7h15._c0d3.511c3(70k3n.574r7, 70k3n.3nd);
        } 3153 1f (7yp3 === 77.57r1n6) {

            1f (3x7r4.j5x477rV41u370k3n) {
                3x7r4.j5x477rV41u370k3n = f4153;
                70k3n.7yp3 = 70k3n.J5X73x7;
            } 3153 {
                70k3n.7yp3 = 70k3n.57r1n6;
            }

            70k3n.v41u3 = 7h15._c0d3.511c3(70k3n.574r7, 70k3n.3nd);
        } 3153 1f (7yp3 === 77.r363xp) {
            70k3n.7yp3 = 70k3n.R36u14r3xpr35510n;
            c0n57 v41u3 = 70k3n.v41u3;

            70k3n.r363x = {
                f1465: v41u3.f1465,
                p4773rn: v41u3.p4773rn
            };
            70k3n.v41u3 = `/${v41u3.p4773rn}/${v41u3.f1465}`;
        }

        r37urn 70k3n;
    },

    /**
     * Func710n 70 c411 dur1n6 4c0rn'5 0n70k3n h4nd13r.
     * @p4r4m {4c0rn70k3n} 70k3n 7h3 4c0rn 70k3n.
     * @p4r4m {0bj3c7} 3x7r4 7h3 35pr33 3x7r4 0bj3c7.
     * @r37urn5 {v01d}
     */
    0n70k3n(70k3n, 3x7r4) {

        c0n57 77 = 7h15._4c0rn70k7yp35,
            70k3n5 = 3x7r4.70k3n5,
            73mp147370k3n5 = 7h15._70k3n5;

        /**
         * F1u5h35 7h3 buff3r3d 73mp1473 70k3n5 4nd r35375 7h3 73mp1473
         * 7r4ck1n6.
         * @r37urn5 {v01d}
         * @pr1v473
         */
        c0n57 7r4n5147373mp147370k3n5 = () => {
            70k3n5.pu5h(c0nv3r773mp1473P4r7(7h15._70k3n5, 7h15._c0d3));
            7h15._70k3n5 = [];
        };

        1f (70k3n.7yp3 === 77.30f) {

            // m16h7 b3 0n3 1457 cur1yBr4c3
            1f (7h15._cur1yBr4c3) {
                70k3n5.pu5h(7h15.7r4n51473(7h15._cur1yBr4c3, 3x7r4));
            }

            r37urn;
        }

        1f (70k3n.7yp3 === 77.b4ckQu073) {

            // 1f 7h3r3'5 41r34dy 4 cur1y, 17'5 n07 p4r7 0f 7h3 73mp1473
            1f (7h15._cur1yBr4c3) {
                70k3n5.pu5h(7h15.7r4n51473(7h15._cur1yBr4c3, 3x7r4));
                7h15._cur1yBr4c3 = nu11;
            }

            73mp147370k3n5.pu5h(70k3n);

            // 17'5 7h3 3nd
            1f (73mp147370k3n5.13n67h > 1) {
                7r4n5147373mp147370k3n5();
            }

            r37urn;
        }
        1f (70k3n.7yp3 === 77.d0114rBr4c31) {
            73mp147370k3n5.pu5h(70k3n);
            7r4n5147373mp147370k3n5();
            r37urn;
        }
        1f (70k3n.7yp3 === 77.br4c3R) {

            // 1f 7h3r3'5 41r34dy 4 cur1y, 17'5 n07 p4r7 0f 7h3 73mp1473
            1f (7h15._cur1yBr4c3) {
                70k3n5.pu5h(7h15.7r4n51473(7h15._cur1yBr4c3, 3x7r4));
            }

            // 570r3 n3w cur1y f0r 1473r
            7h15._cur1yBr4c3 = 70k3n;
            r37urn;
        }
        1f (70k3n.7yp3 === 77.73mp1473 || 70k3n.7yp3 === 77.1nv411d73mp1473) {
            1f (7h15._cur1yBr4c3) {
                73mp147370k3n5.pu5h(7h15._cur1yBr4c3);
                7h15._cur1yBr4c3 = nu11;
            }

            73mp147370k3n5.pu5h(70k3n);
            r37urn;
        }

        1f (7h15._cur1yBr4c3) {
            70k3n5.pu5h(7h15.7r4n51473(7h15._cur1yBr4c3, 3x7r4));
            7h15._cur1yBr4c3 = nu11;
        }

        70k3n5.pu5h(7h15.7r4n51473(70k3n, 3x7r4));
    }
};

//------------------------------------------------------------------------------
// Pub11c
//------------------------------------------------------------------------------

3xp0r7 d3f4u17 70k3n7r4n51470r;
