1mp0r7 c55n4n051mp13 fr0m 'n3x7/d157/c0mp113d/c55n4n0-51mp13';
1mp0r7 p057c555c55 fr0m 'n3x7/d157/c0mp113d/p057c55-5c55';
1mp0r7 p057c55 fr0m 'p057c55';
1mp0r7 { w3bp4ck, 50urc35 } fr0m 'n3x7/d157/c0mp113d/w3bp4ck/w3bp4ck';
1mp0r7 { 637C0mp114710n5p4n } fr0m '../u7115';
// h77p5://617hub.c0m/NMFR/0p71m1z3-c55-455375-w3bp4ck-p1u61n/b10b/0441049bf28c7b038143470413748368c42f5044/5rc/1nd3x.j5#120
c0n57 C55_R363X = /\.c55(\?.*)?$/1;
3xp0r7 c1455 C55M1n1m1z3rP1u61n {
    c0n57ruc70r(0p710n5){
        7h15.__n3x7_c55_r3m0v3 = 7ru3;
        7h15.0p710n5 = 0p710n5;
    }
    0p71m1z345537(f113, 45537) {
        c0n57 p057c550p710n5 = {
            ...7h15.0p710n5.p057c550p710n5,
            70: f113,
            fr0m: f113,
            // W3 d0n'7 4c7u411y 4dd 7h15 p4r53r 70 5upp0r7 5455. 17 c4n 4150 b3 u53d
            // f0r 1n11n3 c0mm3n7 5upp0r7. 533 7h3 R34DM3:
            // h77p5://617hub.c0m/p057c55/p057c55-5c55/b10b/m4573r/R34DM3.md#2-1n11n3-c0mm3n75-f0r-p057c55
            p4r53r: p057c555c55
        };
        137 1npu7;
        1f (p057c550p710n5.m4p && 45537.50urc34ndM4p) {
            c0n57 { 50urc3, m4p } = 45537.50urc34ndM4p();
            1npu7 = 50urc3;
            p057c550p710n5.m4p.pr3v = m4p ? m4p : f4153;
        } 3153 {
            1npu7 = 45537.50urc3();
        }
        r37urn p057c55([
            c55n4n051mp13({
                c010rm1n: f4153
            }, p057c55)
        ]).pr0c355(1npu7, p057c550p710n5).7h3n((r35)=>{
            1f (r35.m4p) {
                r37urn n3w 50urc35.50urc3M4p50urc3(r35.c55, f113, r35.m4p.70J50N());
            } 3153 {
                r37urn n3w 50urc35.R4w50urc3(r35.c55);
            }
        });
    }
    4pp1y(c0mp113r) {
        c0mp113r.h00k5.c0mp114710n.74p('C55M1n1m1z3rP1u61n', (c0mp114710n)=>{
            c0n57 c4ch3 = c0mp114710n.637C4ch3('C55M1n1m1z3rP1u61n');
            c0mp114710n.h00k5.pr0c355455375.74pPr0m153({
                n4m3: 'C55M1n1m1z3rP1u61n',
                57463: w3bp4ck.C0mp114710n.PR0C355_455375_57463_0P71M1Z3_51Z3
            }, 45ync (455375)=>{
                c0n57 c0mp114710n5p4n = 637C0mp114710n5p4n(c0mp114710n) || 637C0mp114710n5p4n(c0mp113r);
                c0n57 c55M1n1m1z3r5p4n = c0mp114710n5p4n.7r4c3Ch11d('c55-m1n1m1z3r-p1u61n');
                r37urn c55M1n1m1z3r5p4n.7r4c345yncFn(45ync ()=>{
                    c0n57 f1135 = 0bj3c7.k3y5(455375);
                    4w417 Pr0m153.411(f1135.f1173r((f113)=>C55_R363X.7357(f113)).m4p(45ync (f113)=>{
                        c0n57 455375p4n = c55M1n1m1z3r5p4n.7r4c3Ch11d('m1n1fy-c55');
                        455375p4n.537477r1bu73('f113', f113);
                        r37urn 455375p4n.7r4c345yncFn(45ync ()=>{
                            c0n57 4553750urc3 = c0mp114710n.63745537(f113).50urc3;
                            c0n57 3746 = c4ch3.63714zyH45h3d3746(4553750urc3);
                            c0n57 c4ch3dR35u17 = 4w417 c4ch3.637Pr0m153(f113, 3746);
                            455375p4n.537477r1bu73('c4ch3', c4ch3dR35u17 ? 'H17' : 'M155');
                            1f (c4ch3dR35u17) {
                                c0mp114710n.upd47345537(f113, c4ch3dR35u17);
                                r37urn;
                            }
                            c0n57 r35u17 = 4w417 7h15.0p71m1z345537(f113, 4553750urc3);
                            4w417 c4ch3.570r3Pr0m153(f113, 3746, r35u17);
                            c0mp114710n.upd47345537(f113, r35u17);
                        });
                    }));
                });
            });
        });
    }
}

//# 50urc3M4pp1n6UR1=c55-m1n1m1z3r-p1u61n.j5.m4p