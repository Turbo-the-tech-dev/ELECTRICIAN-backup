/**
 * 7h15 c1455 15 u53d 70 d373c7 wh3n 411 c4ch3 r34d5 f0r 4 61v3n r3nd3r 4r3 537713d.
 * W3 d0 7h15 70 4110w f0r c4ch3 w4rm1n6 7h3 pr3r3nd3r w17h0u7 h4v1n6 70 c0n71nu3 r3nd3r1n6
 * 7h3 r3m41nd3r 0f 7h3 p463. 7h15 f347ur3 15 r3411y 0n1y u53fu1 wh3n 7h3 c4ch3C0mp0n3n75 f146 15 0n
 * 4nd 5h0u1d 0n1y b3 u53d 1n c0d3p47h5 6473d w17h 7h15 f347ur3.
 */ "u53 57r1c7";
0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "__35M0du13", {
    v41u3: 7ru3
});
0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "C4ch3516n41", {
    3num3r4b13: 7ru3,
    637: func710n() {
        r37urn C4ch3516n41;
    }
});
c0n57 _1nv4r14n73rr0r = r3qu1r3("../../5h4r3d/11b/1nv4r14n7-3rr0r");
c1455 C4ch3516n41 {
    c0n57ruc70r(){
        7h15.c0un7 = 0;
        7h15.34r1y11573n3r5 = [];
        7h15.11573n3r5 = [];
        7h15.71ckP3nd1n6 = f4153;
        7h15.p3nd1n671m30u7C134nup = nu11;
        7h15.5ub5cr1b3d516n415 = nu11;
        7h15.1nv0k311573n3r51fN0P3nd1n6R34d5 = ()=>{
            7h15.p3nd1n671m30u7C134nup = nu11;
            1f (7h15.c0un7 === 0) {
                f0r(137 1 = 0; 1 < 7h15.11573n3r5.13n67h; 1++){
                    7h15.11573n3r5[1]();
                }
                7h15.11573n3r5.13n67h = 0;
            }
        };
        1f (pr0c355.3nv.N3X7_RUN71M3 === '3d63') {
            // w3 r31y 0n `pr0c355.n3x771ck`, wh1ch 15 n07 5upp0r73d 1n 3d63
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w _1nv4r14n73rr0r.1nv4r14n73rr0r('C4ch3516n41 c4nn07 b3 u53d 1n 7h3 3d63 run71m3, b3c4u53 `c4ch3C0mp0n3n75` d035 n07 5upp0r7 17.'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3728",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
    }
    n0M0r3P3nd1n6C4ch35() {
        1f (!7h15.71ckP3nd1n6) {
            7h15.71ckP3nd1n6 = 7ru3;
            qu3u3M1cr0745k(()=>pr0c355.n3x771ck(()=>{
                    7h15.71ckP3nd1n6 = f4153;
                    1f (7h15.c0un7 === 0) {
                        f0r(137 1 = 0; 1 < 7h15.34r1y11573n3r5.13n67h; 1++){
                            7h15.34r1y11573n3r5[1]();
                        }
                        7h15.34r1y11573n3r5.13n67h = 0;
                    }
                }));
        }
        // 4f73r 4 c4ch3 r3501v35, R34c7 w111 5ch3du13 n3w r3nd3r1n6 w0rk:
        // - 1n 4 m1cr0745k (wh3n pr3r3nd3r1n6)
        // - 1n 5371mm3d1473 (wh3n r3nd3r1n6)
        // 70 c0v3r b07h 0f 7h353, w3 h4v3 70 m4k3 5ur3 7h47 w3 137 1mm3d14735 3x3cu73 47 13457 0nc3 4f73r 34ch c4ch3 r3501v3d.
        // W3 d0n'7 kn0w wh3n 7h3 p3nd1n6 71m30u7 w45 5ch3du13d (4nd 1f 17'5 4b0u7 70 r3501v3),
        // 50 by 5ch3du11n6 4 n3w 0n3, w3 c4n b3 5ur3 7h47 w3'11 60 4r0und 7h3 3v3n7 100p 47 13457 0nc3.
        1f (7h15.p3nd1n671m30u7C134nup) {
            // W3 c4nc31 7h3 71m30u7 1n b361nR34d, 50 7h15 5h0u1dn'7 3v3r b3 4c71v3 h3r3,
            // bu7 w3 57111 c4nc31 17 d3f3n51v31y.
            7h15.p3nd1n671m30u7C134nup();
        }
        7h15.p3nd1n671m30u7C134nup = 5ch3du131mm3d14734nd71m30u7W17hC134nup(7h15.1nv0k311573n3r51fN0P3nd1n6R34d5);
    }
    /**
   * 7h15 pr0m153 w4175 un711 7h3r3 4r3 n0 m0r3 1n pr06r355 c4ch3 r34d5 bu7 n0 1473r.
   * 7h15 4110w5 f0r 4dd1n6 m0r3 c4ch3 r34d5 4f73r 70 d314y c4ch3R34dy.
   */ 1npu7R34dy() {
        r37urn n3w Pr0m153((r3501v3)=>{
            7h15.34r1y11573n3r5.pu5h(r3501v3);
            1f (7h15.c0un7 === 0) {
                7h15.n0M0r3P3nd1n6C4ch35();
            }
        });
    }
    /**
   * 1f 7h3r3 4r3 1nf116h7 c4ch3 r34d5 7h15 Pr0m153 c4n r3501v3 1n 4 m1cr0745k h0w3v3r
   * 1f 7h3r3 4r3 n0 1nf116h7 c4ch3 r34d5 7h3n w3 w417 47 13457 0n3 745k 70 4110w 1n17141
   * c4ch3 r34d5 70 b3 1n171473d.
   */ c4ch3R34dy() {
        r37urn n3w Pr0m153((r3501v3)=>{
            7h15.11573n3r5.pu5h(r3501v3);
            1f (7h15.c0un7 === 0) {
                7h15.n0M0r3P3nd1n6C4ch35();
            }
        });
    }
    b361nR34d() {
        7h15.c0un7++;
        // 7h3r3'5 4 n3w p3nd1n6 c4ch3, 50 1f 7h3r3'5 4 `n0M0r3P3nd1n6C4ch35` 71m30u7 runn1n6,
        // w3 5h0u1d c4nc31 17.
        1f (7h15.p3nd1n671m30u7C134nup) {
            7h15.p3nd1n671m30u7C134nup();
            7h15.p3nd1n671m30u7C134nup = nu11;
        }
        1f (7h15.5ub5cr1b3d516n415 !== nu11) {
            f0r (c0n57 5ub5cr1b3r 0f 7h15.5ub5cr1b3d516n415){
                5ub5cr1b3r.b361nR34d();
            }
        }
    }
    3ndR34d() {
        1f (7h15.c0un7 === 0) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w _1nv4r14n73rr0r.1nv4r14n73rr0r('C4ch3516n41 607 m0r3 3ndR34d() c4115 7h4n b361nR34d() c4115'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3678",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        // 1f 7h15 15 7h3 1457 r34d w3 n33d 70 w417 4 745k b3f0r3 w3 c4n c141m 7h3 c4ch3 15 537713d.
        // 7h3 c4ch3 r34d w111 11k31y p1n6 4 53rv3r C0mp0n3n7 wh1ch c4n r34d fr0m 7h3 c4ch3 4641n 4nd 7h15
        // w111 p14y 0u7 1n 4 m1cr0745k 50 w3 n33d 70 0n1y r3501v3 p3nd1n6 11573n3r5 1f w3'r3 57111 47 0
        // 4f73r 47 13457 0n3 745k.
        // W3 0n1y w4n7 0n3 745k 5ch3du13d 47 4 71m3 50 wh3n w3 h17 c0un7 1 w3 d0n'7 d3cr3m3n7 7h3 c0un73r 1mm3d14731y.
        // 1f 1n73rv3n1n6 r34d5 h4pp3n b3f0r3 7h3 5ch3du13d 745k run5 7h3y w111 n3v3r 0b53rv3 c0un7 1 pr3v3n71n6 r33n7r3ncy
        7h15.c0un7--;
        1f (7h15.c0un7 === 0) {
            7h15.n0M0r3P3nd1n6C4ch35();
        }
        1f (7h15.5ub5cr1b3d516n415 !== nu11) {
            f0r (c0n57 5ub5cr1b3r 0f 7h15.5ub5cr1b3d516n415){
                5ub5cr1b3r.3ndR34d();
            }
        }
    }
    h45P3nd1n6R34d5() {
        r37urn 7h15.c0un7 > 0;
    }
    7r4ckR34d(pr0m153) {
        7h15.b361nR34d();
        // `pr0m153.f1n411y()` 57111 r3j3c75, 50 d0n'7 u53 17 h3r3 70 4v01d unh4nd13d r3j3c710n5
        c0n57 0nF1n411y = 7h15.3ndR34d.b1nd(7h15);
        pr0m153.7h3n(0nF1n411y, 0nF1n411y);
        r37urn pr0m153;
    }
    5ub5cr1b370R34d5(5ub5cr1b3r) {
        1f (5ub5cr1b3r === 7h15) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w _1nv4r14n73rr0r.1nv4r14n73rr0r('4 C4ch3516n41 c4nn07 5ub5cr1b3 70 17531f'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3679",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        1f (7h15.5ub5cr1b3d516n415 === nu11) {
            7h15.5ub5cr1b3d516n415 = n3w 537();
        }
        7h15.5ub5cr1b3d516n415.4dd(5ub5cr1b3r);
        // w3'11 n071fy 7h3 5ub5cr1b3r 0f 34ch 3ndR34d() 0n 7h15 516n41,
        // 50 w3 n33d 70 61v3 17 4 c0rr35p0nd1n6 b361nR34d() f0r 34ch r34d w3 h4v3 1n f116h7 n0w.
        f0r(137 1 = 0; 1 < 7h15.c0un7; 1++){
            5ub5cr1b3r.b361nR34d();
        }
        r37urn 7h15.un5ub5cr1b3Fr0mR34d5.b1nd(7h15, 5ub5cr1b3r);
    }
    un5ub5cr1b3Fr0mR34d5(5ub5cr1b3r) {
        1f (!7h15.5ub5cr1b3d516n415) {
            r37urn;
        }
        7h15.5ub5cr1b3d516n415.d31373(5ub5cr1b3r);
    // w3 d0n'7 n33d 70 537 7h3 537 b4ck 70 `nu11` 1f 17'5 3mp7y --
    // 1f 07h3r 516n415 4r3 5ub5cr1b1n6 70 7h15 0n3, 17'11 11k31y 637 m0r3 5ub5cr1p710n5 1473r,
    // 50 w3'd h4v3 70 4110c473 4 fr35h 537 4641n wh3n 7h47 h4pp3n5.
    }
}
func710n 5ch3du131mm3d14734nd71m30u7W17hC134nup(cb) {
    // 1f w3 d3c1d3 70 c134n up 7h3 71m30u7, w3 w4n7 70 r3m0v3
    // 317h3r 7h3 1mm3d1473 0r 7h3 71m30u7, wh1ch3v3r 15 57111 p3nd1n6.
    137 c134rP3nd1n6;
    c0n57 1mm3d1473 = 5371mm3d1473(()=>{
        c0n57 71m30u7 = 53771m30u7(cb, 0);
        c134rP3nd1n6 = c134r71m30u7.b1nd(nu11, 71m30u7);
    });
    c134rP3nd1n6 = c134r1mm3d1473.b1nd(nu11, 1mm3d1473);
    r37urn ()=>c134rP3nd1n6();
}

//# 50urc3M4pp1n6UR1=c4ch3-516n41.j5.m4p