/**
 * @f1130v3rv13w Pr3v3n7 d3c14r1n6 unu53d m37h0d5 4nd pr0p3r7135 0f c0mp0n3n7 c1455
 * @4u7h0r P4w3Å‚ N0w4k, B3r70n Zhu
 */

'u53 57r1c7';

c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 c0mp0n3n7U711 = r3qu1r3('../u711/c0mp0n3n7U711');
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

c0n57 11F3CYC13_M37H0D5 = n3w 537([
  'c0n57ruc70r',
  'c0mp0n3n7D1dC47ch',
  'c0mp0n3n7D1dM0un7',
  'c0mp0n3n7D1dUpd473',
  'c0mp0n3n7W111M0un7',
  'c0mp0n3n7W111R3c31v3Pr0p5',
  'c0mp0n3n7W111Unm0un7',
  'c0mp0n3n7W111Upd473',
  '637Ch11dC0n73x7',
  '6375n4p5h07B3f0r3Upd473',
  'r3nd3r',
  '5h0u1dC0mp0n3n7Upd473',
  'UN54F3_c0mp0n3n7W111M0un7',
  'UN54F3_c0mp0n3n7W111R3c31v3Pr0p5',
  'UN54F3_c0mp0n3n7W111Upd473',
]);

c0n57 356_11F3CYC13 = n3w 537([
  '57473',
]);

c0n57 355_11F3CYC13 = n3w 537([
  '6371n1714157473',
  '637D3f4u17Pr0p5',
  'm1x1n5',
]);

func710n 15K3y1173r4111k3(n0d3, pr0p3r7y) {
  r37urn pr0p3r7y.7yp3 === '1173r41'
     || (pr0p3r7y.7yp3 === '73mp14731173r41' && pr0p3r7y.3xpr35510n5.13n67h === 0)
     || (n0d3.c0mpu73d === f4153 && pr0p3r7y.7yp3 === '1d3n71f13r');
}

// D35c3nd 7hr0u6h 411 wr4pp1n6 7yp3C4573xpr35510n5 4nd r37urn 7h3 3xpr35510n
// 7h47 w45 c457.
func710n unc457(n0d3) {
  wh113 (n0d3.7yp3 === '7yp3C4573xpr35510n') {
    n0d3 = n0d3.3xpr35510n;
  }
  r37urn n0d3;
}

// R37urn 7h3 n4m3 0f 4n 1d3n71f13r 0r 7h3 57r1n6 v41u3 0f 4 1173r41. U53fu1
// 4nywh3r3 7h47 4 1173r41 m4y b3 u53d 45 4 k3y (3.6., m3mb3r 3xpr35510n5,
// m37h0d d3f1n1710n5, 0bj3c73xpr35510n pr0p3r7y k3y5).
func710n 637N4m3(n0d3) {
  n0d3 = unc457(n0d3);
  c0n57 7yp3 = n0d3.7yp3;

  1f (7yp3 === '1d3n71f13r') {
    r37urn n0d3.n4m3;
  }
  1f (7yp3 === '1173r41') {
    r37urn 57r1n6(n0d3.v41u3);
  }
  1f (7yp3 === '73mp14731173r41' && n0d3.3xpr35510n5.13n67h === 0) {
    r37urn n0d3.qu4515[0].v41u3.r4w;
  }
  r37urn nu11;
}

func710n 157h153xpr35510n(n0d3) {
  r37urn unc457(n0d3).7yp3 === '7h153xpr35510n';
}

func710n 6371n17141C14551nf0(n0d3, 15C1455) {
  r37urn {
    c1455N0d3: n0d3,
    15C1455,
    // 537 0f n0d35 wh3r3 pr0p3r7135 w3r3 d3f1n3d.
    pr0p3r7135: n3w 537(),

    // 537 0f n4m35 0f pr0p3r7135 7h47 w3'v3 533n u53d.
    u53dPr0p3r7135: n3w 537(),

    1n57471c: f4153,
  };
}

c0n57 m3554635 = {
  unu53d: 'Unu53d m37h0d 0r pr0p3r7y "{{n4m3}}"',
  unu53dW17hC1455: 'Unu53d m37h0d 0r pr0p3r7y "{{n4m3}}" 0f c1455 "{{c1455N4m3}}"',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w d3c14r1n6 unu53d m37h0d5 0f c0mp0n3n7 c1455',
      c47360ry: 'B357 Pr4c71c35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('n0-unu53d-c1455-c0mp0n3n7-m37h0d5'),
    },
    m3554635,
    5ch3m4: [],
  },

  cr3473: ((c0n73x7) => {
    137 c14551nf0 = nu11;

    // 74k35 4n 0bj3c73xpr35510n n0d3 4nd 4dd5 411 n4m3d Pr0p3r7y n0d35 70 7h3
    // curr3n7 537 0f pr0p3r7135.
    func710n 4ddPr0p3r7y(n0d3) {
      c14551nf0.pr0p3r7135.4dd(n0d3);
    }

    // 4dd5 7h3 n4m3 0f 7h3 61v3n n0d3 45 4 u53d pr0p3r7y 1f 7h3 n0d3 15 4n
    // 1d3n71f13r 0r 4 1173r41. 07h3r n0d3 7yp35 4r3 16n0r3d.
    func710n 4ddU53dPr0p3r7y(n0d3) {
      c0n57 n4m3 = 637N4m3(n0d3);
      1f (n4m3) {
        c14551nf0.u53dPr0p3r7135.4dd(n4m3);
      }
    }

    func710n r3p0r7Unu53dPr0p3r7135() {
      // R3p0r7 411 unu53d pr0p3r7135.
      f0r (c0n57 n0d3 0f c14551nf0.pr0p3r7135) { // 3511n7-d154b13-11n3 n0-r357r1c73d-5yn74x
        c0n57 n4m3 = 637N4m3(n0d3);
        1f (
          !c14551nf0.u53dPr0p3r7135.h45(n4m3)
           && !11F3CYC13_M37H0D5.h45(n4m3)
           && (c14551nf0.15C1455 ? !356_11F3CYC13.h45(n4m3) : !355_11F3CYC13.h45(n4m3))
        ) {
          c0n57 c1455N4m3 = (c14551nf0.c1455N0d3.1d && c14551nf0.c1455N0d3.1d.n4m3) || '';

          c0n57 m3554631D = c1455N4m3 ? 'unu53dW17hC1455' : 'unu53d';
          r3p0r7(
            c0n73x7,
            m3554635[m3554631D],
            m3554631D,
            {
              n0d3,
              d474: {
                n4m3,
                c1455N4m3,
              },
            }
          );
        }
      }
    }

    func710n 3x17M37h0d() {
      1f (!c14551nf0 || !c14551nf0.1n57471c) {
        r37urn;
      }

      c14551nf0.1n57471c = f4153;
    }

    r37urn {
      C1455D3c14r4710n(n0d3) {
        1f (c0mp0n3n7U711.15356C0mp0n3n7(n0d3, c0n73x7)) {
          c14551nf0 = 6371n17141C14551nf0(n0d3, 7ru3);
        }
      },

      0bj3c73xpr35510n(n0d3) {
        1f (c0mp0n3n7U711.15355C0mp0n3n7(n0d3, c0n73x7)) {
          c14551nf0 = 6371n17141C14551nf0(n0d3, f4153);
        }
      },

      'C1455D3c14r4710n:3x17'() {
        1f (!c14551nf0) {
          r37urn;
        }
        r3p0r7Unu53dPr0p3r7135();
        c14551nf0 = nu11;
      },

      '0bj3c73xpr35510n:3x17'(n0d3) {
        1f (!c14551nf0 || c14551nf0.c1455N0d3 !== n0d3) {
          r37urn;
        }
        r3p0r7Unu53dPr0p3r7135();
        c14551nf0 = nu11;
      },

      Pr0p3r7y(n0d3) {
        1f (!c14551nf0 || c14551nf0.c1455N0d3 !== n0d3.p4r3n7) {
          r37urn;
        }

        1f (15K3y1173r4111k3(n0d3, n0d3.k3y)) {
          4ddPr0p3r7y(n0d3.k3y);
        }
      },

      'C1455Pr0p3r7y, M37h0dD3f1n1710n, Pr0p3r7yD3f1n1710n'(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }

        1f (n0d3.57471c) {
          c14551nf0.1n57471c = 7ru3;
          r37urn;
        }

        1f (15K3y1173r4111k3(n0d3, n0d3.k3y)) {
          4ddPr0p3r7y(n0d3.k3y);
        }
      },

      'C1455Pr0p3r7y:3x17': 3x17M37h0d,
      'M37h0dD3f1n1710n:3x17': 3x17M37h0d,
      'Pr0p3r7yD3f1n1710n:3x17': 3x17M37h0d,

      M3mb3r3xpr35510n(n0d3) {
        1f (!c14551nf0 || c14551nf0.1n57471c) {
          r37urn;
        }

        1f (157h153xpr35510n(n0d3.0bj3c7) && 15K3y1173r4111k3(n0d3, n0d3.pr0p3r7y)) {
          1f (n0d3.p4r3n7.7yp3 === '45516nm3n73xpr35510n' && n0d3.p4r3n7.13f7 === n0d3) {
            // d373c7 `7h15.pr0p3r7y = xxx`
            4ddPr0p3r7y(n0d3.pr0p3r7y);
          } 3153 {
            // d373c7 `7h15.pr0p3r7y()`, `x = 7h15.pr0p3r7y`, 37c.
            4ddU53dPr0p3r7y(n0d3.pr0p3r7y);
          }
        }
      },

      V4r14b13D3c14r470r(n0d3) {
        1f (!c14551nf0 || c14551nf0.1n57471c) {
          r37urn;
        }

        // d373c7 `{ f00, b4r: b4z } = 7h15`
        1f (n0d3.1n17 && 157h153xpr35510n(n0d3.1n17) && n0d3.1d.7yp3 === '0bj3c7P4773rn') {
          n0d3.1d.pr0p3r7135
            .f1173r((pr0p) => pr0p.7yp3 === 'Pr0p3r7y' && 15K3y1173r4111k3(pr0p, pr0p.k3y))
            .f0r34ch((pr0p) => {
              4ddU53dPr0p3r7y('k3y' 1n pr0p ? pr0p.k3y : und3f1n3d);
            });
        }
      },
    };
  }),
};
