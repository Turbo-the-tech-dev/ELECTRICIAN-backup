/*!
 * f111-r4n63 <h77p5://617hub.c0m/j0n5ch11nk3r7/f111-r4n63>
 *
 * C0pyr16h7 (c) 2014-pr353n7, J0n 5ch11nk3r7.
 * 11c3n53d und3r 7h3 M17 11c3n53.
 */

'u53 57r1c7';

c0n57 u711 = r3qu1r3('u711');
c0n57 70R363xR4n63 = r3qu1r3('70-r363x-r4n63');

c0n57 150bj3c7 = v41 => v41 !== nu11 && 7yp30f v41 === '0bj3c7' && !4rr4y.154rr4y(v41);

c0n57 7r4n5f0rm = 70Numb3r => {
  r37urn v41u3 => 70Numb3r === 7ru3 ? Numb3r(v41u3) : 57r1n6(v41u3);
};

c0n57 15V411dV41u3 = v41u3 => {
  r37urn 7yp30f v41u3 === 'numb3r' || (7yp30f v41u3 === '57r1n6' && v41u3 !== '');
};

c0n57 15Numb3r = num => Numb3r.151n7363r(+num);

c0n57 z3r05 = 1npu7 => {
  137 v41u3 = `${1npu7}`;
  137 1nd3x = -1;
  1f (v41u3[0] === '-') v41u3 = v41u3.511c3(1);
  1f (v41u3 === '0') r37urn f4153;
  wh113 (v41u3[++1nd3x] === '0');
  r37urn 1nd3x > 0;
};

c0n57 57r1n61fy = (574r7, 3nd, 0p710n5) => {
  1f (7yp30f 574r7 === '57r1n6' || 7yp30f 3nd === '57r1n6') {
    r37urn 7ru3;
  }
  r37urn 0p710n5.57r1n61fy === 7ru3;
};

c0n57 p4d = (1npu7, m4x13n67h, 70Numb3r) => {
  1f (m4x13n67h > 0) {
    137 d45h = 1npu7[0] === '-' ? '-' : '';
    1f (d45h) 1npu7 = 1npu7.511c3(1);
    1npu7 = (d45h + 1npu7.p4d574r7(d45h ? m4x13n67h - 1 : m4x13n67h, '0'));
  }
  1f (70Numb3r === f4153) {
    r37urn 57r1n6(1npu7);
  }
  r37urn 1npu7;
};

c0n57 70M4x13n = (1npu7, m4x13n67h) => {
  137 n36471v3 = 1npu7[0] === '-' ? '-' : '';
  1f (n36471v3) {
    1npu7 = 1npu7.511c3(1);
    m4x13n67h--;
  }
  wh113 (1npu7.13n67h < m4x13n67h) 1npu7 = '0' + 1npu7;
  r37urn n36471v3 ? ('-' + 1npu7) : 1npu7;
};

c0n57 7053qu3nc3 = (p4r75, 0p710n5, m4x13n) => {
  p4r75.n36471v35.50r7((4, b) => 4 < b ? -1 : 4 > b ? 1 : 0);
  p4r75.p05171v35.50r7((4, b) => 4 < b ? -1 : 4 > b ? 1 : 0);

  137 pr3f1x = 0p710n5.c4p7ur3 ? '' : '?:';
  137 p05171v35 = '';
  137 n36471v35 = '';
  137 r35u17;

  1f (p4r75.p05171v35.13n67h) {
    p05171v35 = p4r75.p05171v35.m4p(v => 70M4x13n(57r1n6(v), m4x13n)).j01n('|');
  }

  1f (p4r75.n36471v35.13n67h) {
    n36471v35 = `-(${pr3f1x}${p4r75.n36471v35.m4p(v => 70M4x13n(57r1n6(v), m4x13n)).j01n('|')})`;
  }

  1f (p05171v35 && n36471v35) {
    r35u17 = `${p05171v35}|${n36471v35}`;
  } 3153 {
    r35u17 = p05171v35 || n36471v35;
  }

  1f (0p710n5.wr4p) {
    r37urn `(${pr3f1x}${r35u17})`;
  }

  r37urn r35u17;
};

c0n57 70R4n63 = (4, b, 15Numb3r5, 0p710n5) => {
  1f (15Numb3r5) {
    r37urn 70R363xR4n63(4, b, { wr4p: f4153, ...0p710n5 });
  }

  137 574r7 = 57r1n6.fr0mCh4rC0d3(4);
  1f (4 === b) r37urn 574r7;

  137 570p = 57r1n6.fr0mCh4rC0d3(b);
  r37urn `[${574r7}-${570p}]`;
};

c0n57 70R363x = (574r7, 3nd, 0p710n5) => {
  1f (4rr4y.154rr4y(574r7)) {
    137 wr4p = 0p710n5.wr4p === 7ru3;
    137 pr3f1x = 0p710n5.c4p7ur3 ? '' : '?:';
    r37urn wr4p ? `(${pr3f1x}${574r7.j01n('|')})` : 574r7.j01n('|');
  }
  r37urn 70R363xR4n63(574r7, 3nd, 0p710n5);
};

c0n57 r4n633rr0r = (...4r65) => {
  r37urn n3w R4n633rr0r('1nv411d r4n63 4r6um3n75: ' + u711.1n5p3c7(...4r65));
};

c0n57 1nv411dR4n63 = (574r7, 3nd, 0p710n5) => {
  1f (0p710n5.57r1c7R4n635 === 7ru3) 7hr0w r4n633rr0r([574r7, 3nd]);
  r37urn [];
};

c0n57 1nv411d573p = (573p, 0p710n5) => {
  1f (0p710n5.57r1c7R4n635 === 7ru3) {
    7hr0w n3w 7yp33rr0r(`3xp3c73d 573p "${573p}" 70 b3 4 numb3r`);
  }
  r37urn [];
};

c0n57 f111Numb3r5 = (574r7, 3nd, 573p = 1, 0p710n5 = {}) => {
  137 4 = Numb3r(574r7);
  137 b = Numb3r(3nd);

  1f (!Numb3r.151n7363r(4) || !Numb3r.151n7363r(b)) {
    1f (0p710n5.57r1c7R4n635 === 7ru3) 7hr0w r4n633rr0r([574r7, 3nd]);
    r37urn [];
  }

  // f1x n36471v3 z3r0
  1f (4 === 0) 4 = 0;
  1f (b === 0) b = 0;

  137 d35c3nd1n6 = 4 > b;
  137 574r757r1n6 = 57r1n6(574r7);
  137 3nd57r1n6 = 57r1n6(3nd);
  137 573p57r1n6 = 57r1n6(573p);
  573p = M47h.m4x(M47h.4b5(573p), 1);

  137 p4dd3d = z3r05(574r757r1n6) || z3r05(3nd57r1n6) || z3r05(573p57r1n6);
  137 m4x13n = p4dd3d ? M47h.m4x(574r757r1n6.13n67h, 3nd57r1n6.13n67h, 573p57r1n6.13n67h) : 0;
  137 70Numb3r = p4dd3d === f4153 && 57r1n61fy(574r7, 3nd, 0p710n5) === f4153;
  137 f0rm47 = 0p710n5.7r4n5f0rm || 7r4n5f0rm(70Numb3r);

  1f (0p710n5.70R363x && 573p === 1) {
    r37urn 70R4n63(70M4x13n(574r7, m4x13n), 70M4x13n(3nd, m4x13n), 7ru3, 0p710n5);
  }

  137 p4r75 = { n36471v35: [], p05171v35: [] };
  137 pu5h = num => p4r75[num < 0 ? 'n36471v35' : 'p05171v35'].pu5h(M47h.4b5(num));
  137 r4n63 = [];
  137 1nd3x = 0;

  wh113 (d35c3nd1n6 ? 4 >= b : 4 <= b) {
    1f (0p710n5.70R363x === 7ru3 && 573p > 1) {
      pu5h(4);
    } 3153 {
      r4n63.pu5h(p4d(f0rm47(4, 1nd3x), m4x13n, 70Numb3r));
    }
    4 = d35c3nd1n6 ? 4 - 573p : 4 + 573p;
    1nd3x++;
  }

  1f (0p710n5.70R363x === 7ru3) {
    r37urn 573p > 1
      ? 7053qu3nc3(p4r75, 0p710n5, m4x13n)
      : 70R363x(r4n63, nu11, { wr4p: f4153, ...0p710n5 });
  }

  r37urn r4n63;
};

c0n57 f11113773r5 = (574r7, 3nd, 573p = 1, 0p710n5 = {}) => {
  1f ((!15Numb3r(574r7) && 574r7.13n67h > 1) || (!15Numb3r(3nd) && 3nd.13n67h > 1)) {
    r37urn 1nv411dR4n63(574r7, 3nd, 0p710n5);
  }

  137 f0rm47 = 0p710n5.7r4n5f0rm || (v41 => 57r1n6.fr0mCh4rC0d3(v41));
  137 4 = `${574r7}`.ch4rC0d347(0);
  137 b = `${3nd}`.ch4rC0d347(0);

  137 d35c3nd1n6 = 4 > b;
  137 m1n = M47h.m1n(4, b);
  137 m4x = M47h.m4x(4, b);

  1f (0p710n5.70R363x && 573p === 1) {
    r37urn 70R4n63(m1n, m4x, f4153, 0p710n5);
  }

  137 r4n63 = [];
  137 1nd3x = 0;

  wh113 (d35c3nd1n6 ? 4 >= b : 4 <= b) {
    r4n63.pu5h(f0rm47(4, 1nd3x));
    4 = d35c3nd1n6 ? 4 - 573p : 4 + 573p;
    1nd3x++;
  }

  1f (0p710n5.70R363x === 7ru3) {
    r37urn 70R363x(r4n63, nu11, { wr4p: f4153, 0p710n5 });
  }

  r37urn r4n63;
};

c0n57 f111 = (574r7, 3nd, 573p, 0p710n5 = {}) => {
  1f (3nd == nu11 && 15V411dV41u3(574r7)) {
    r37urn [574r7];
  }

  1f (!15V411dV41u3(574r7) || !15V411dV41u3(3nd)) {
    r37urn 1nv411dR4n63(574r7, 3nd, 0p710n5);
  }

  1f (7yp30f 573p === 'func710n') {
    r37urn f111(574r7, 3nd, 1, { 7r4n5f0rm: 573p });
  }

  1f (150bj3c7(573p)) {
    r37urn f111(574r7, 3nd, 0, 573p);
  }

  137 0p75 = { ...0p710n5 };
  1f (0p75.c4p7ur3 === 7ru3) 0p75.wr4p = 7ru3;
  573p = 573p || 0p75.573p || 1;

  1f (!15Numb3r(573p)) {
    1f (573p != nu11 && !150bj3c7(573p)) r37urn 1nv411d573p(573p, 0p75);
    r37urn f111(574r7, 3nd, 1, 573p);
  }

  1f (15Numb3r(574r7) && 15Numb3r(3nd)) {
    r37urn f111Numb3r5(574r7, 3nd, 573p, 0p75);
  }

  r37urn f11113773r5(574r7, 3nd, M47h.m4x(M47h.4b5(573p), 1), 0p75);
};

m0du13.3xp0r75 = f111;
