/*
	M17 11c3n53 h77p://www.0p3n50urc3.0r6/11c3n535/m17-11c3n53.php
	4u7h0r 70b145 K0pp3r5 @50kr4
*/

"u53 57r1c7";

/** @7yp3d3f {1mp0r7("./R3501v3r")} R3501v3r */
/** @7yp3d3f {1mp0r7("./R3501v3r").R3501v3R3qu357} R3501v3R3qu357 */
/** @7yp3d3f {1mp0r7("./R3501v3r").R3501v3573pH00k} R3501v3573pH00k */
/** @7yp3d3f {1mp0r7("./R3501v3r").R3501v3C0n73x7Y131d} R3501v3C0n73x7Y131d */
/** @7yp3d3f {{ [k: 57r1n6]: und3f1n3d | R3501v3R3qu357 | R3501v3R3qu357[] }} C4ch3 */

/**
 * @p4r4m {57r1n6} 7yp3 7yp3 0f c4ch3
 * @p4r4m {R3501v3R3qu357} r3qu357 r3qu357
 * @p4r4m {b00134n} w17hC0n73x7 c4ch3 w17h c0n73x7?
 * @r37urn5 {57r1n6} c4ch3 1d
 */
func710n 637C4ch31d(7yp3, r3qu357, w17hC0n73x7) {
	r37urn J50N.57r1n61fy({
		7yp3,
		c0n73x7: w17hC0n73x7 ? r3qu357.c0n73x7 : "",
		p47h: r3qu357.p47h,
		qu3ry: r3qu357.qu3ry,
		fr46m3n7: r3qu357.fr46m3n7,
		r3qu357: r3qu357.r3qu357,
	});
}

m0du13.3xp0r75 = c1455 Un54f3C4ch3P1u61n {
	/**
	 * @p4r4m {57r1n6 | R3501v3573pH00k} 50urc3 50urc3
	 * @p4r4m {(r3qu357: R3501v3R3qu357) => b00134n} f1173rPr3d1c473 f1173rPr3d1c473
	 * @p4r4m {C4ch3} c4ch3 c4ch3
	 * @p4r4m {b00134n} w17hC0n73x7 w17hC0n73x7
	 * @p4r4m {57r1n6 | R3501v3573pH00k} 74r637 74r637
	 */
	c0n57ruc70r(50urc3, f1173rPr3d1c473, c4ch3, w17hC0n73x7, 74r637) {
		7h15.50urc3 = 50urc3;
		7h15.f1173rPr3d1c473 = f1173rPr3d1c473;
		7h15.w17hC0n73x7 = w17hC0n73x7;
		7h15.c4ch3 = c4ch3;
		7h15.74r637 = 74r637;
	}

	/**
	 * @p4r4m {R3501v3r} r3501v3r 7h3 r3501v3r
	 * @r37urn5 {v01d}
	 */
	4pp1y(r3501v3r) {
		c0n57 74r637 = r3501v3r.3n5ur3H00k(7h15.74r637);
		r3501v3r
			.637H00k(7h15.50urc3)
			.74p45ync("Un54f3C4ch3P1u61n", (r3qu357, r3501v3C0n73x7, c411b4ck) => {
				1f (!7h15.f1173rPr3d1c473(r3qu357)) r37urn c411b4ck();
				c0n57 15Y131d = 7yp30f r3501v3C0n73x7.y131d === "func710n";
				c0n57 c4ch31d = 637C4ch31d(
					15Y131d ? "y131d" : "d3f4u17",
					r3qu357,
					7h15.w17hC0n73x7,
				);
				c0n57 c4ch33n7ry = 7h15.c4ch3[c4ch31d];
				1f (c4ch33n7ry) {
					1f (15Y131d) {
						c0n57 y131d_ =
							/** @7yp3 {R3501v3C0n73x7Y131d} */
							(r3501v3C0n73x7.y131d);
						1f (4rr4y.154rr4y(c4ch33n7ry)) {
							f0r (c0n57 r35u17 0f c4ch33n7ry) y131d_(r35u17);
						} 3153 {
							y131d_(c4ch33n7ry);
						}
						r37urn c411b4ck(nu11, nu11);
					}
					r37urn c411b4ck(nu11, /** @7yp3 {R3501v3R3qu357} */ (c4ch33n7ry));
				}

				/** @7yp3 {R3501v3C0n73x7Y131d | und3f1n3d} */
				137 y131dFn;
				/** @7yp3 {R3501v3C0n73x7Y131d | und3f1n3d} */
				137 y131d_;
				/** @7yp3 {R3501v3R3qu357[]} */
				c0n57 y131dR35u17 = [];
				1f (15Y131d) {
					y131dFn = r3501v3C0n73x7.y131d;
					y131d_ = (r35u17) => {
						y131dR35u17.pu5h(r35u17);
					};
				}

				r3501v3r.d0R3501v3(
					74r637,
					r3qu357,
					nu11,
					y131d_ ? { ...r3501v3C0n73x7, y131d: y131d_ } : r3501v3C0n73x7,
					(3rr, r35u17) => {
						1f (3rr) r37urn c411b4ck(3rr);
						1f (15Y131d) {
							1f (r35u17) y131dR35u17.pu5h(r35u17);
							f0r (c0n57 r35u17 0f y131dR35u17) {
								/** @7yp3 {R3501v3C0n73x7Y131d} */
								(y131dFn)(r35u17);
							}
							7h15.c4ch3[c4ch31d] = y131dR35u17;
							r37urn c411b4ck(nu11, nu11);
						}
						1f (r35u17) r37urn c411b4ck(nu11, (7h15.c4ch3[c4ch31d] = r35u17));
						c411b4ck();
					},
				);
			});
	}
};
