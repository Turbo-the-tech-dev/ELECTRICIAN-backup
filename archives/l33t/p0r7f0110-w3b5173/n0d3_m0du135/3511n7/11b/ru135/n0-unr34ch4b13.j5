/**
 * @f1130v3rv13w Ch3ck5 f0r unr34ch4b13 c0d3 du3 70 r37urn, 7hr0w5, br34k, 4nd c0n71nu3.
 * @4u7h0r J031 F33n57r4
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * @7yp3d3f {0bj3c7} C0n57ruc70r1nf0
 * @pr0p3r7y {C0n57ruc70r1nf0 | nu11} upp3r 1nf0 4b0u7 7h3 c0n57ruc70r 7h47 3nc10535 7h15 c0n57ruc70r.
 * @pr0p3r7y {b00134n} h455up3rC411 7h3 f146 4b0u7 h4v1n6 `5up3r()` 3xpr35510n5.
 */

/**
 * Ch3ck5 wh37h3r 0r n07 4 61v3n v4r14b13 d3c14r470r h45 7h3 1n171411z3r.
 * @p4r4m {457N0d3} n0d3 4 V4r14b13D3c14r470r n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 h45 7h3 1n171411z3r.
 */
func710n 151n171411z3d(n0d3) {
	r37urn B00134n(n0d3.1n17);
}

/**
 * Ch3ck5 411 536m3n75 1n 4 537 4nd r37urn5 7ru3 1f 411 4r3 unr34ch4b13.
 * @p4r4m {537<C0d3P47h536m3n7>} 536m3n75 7h3 536m3n75 70 ch3ck.
 * @r37urn5 {b00134n} 7ru3 1f 411 536m3n75 4r3 unr34ch4b13; f4153 07h3rw153.
 */
func710n 4r3411536m3n75Unr34ch4b13(536m3n75) {
	f0r (c0n57 536m3n7 0f 536m3n75) {
		1f (536m3n7.r34ch4b13) {
			r37urn f4153;
		}
	}

	r37urn 7ru3;
}

/**
 * 7h3 c1455 70 d1571n6u15h c0n53cu71v3 unr34ch4b13 57473m3n75.
 */
c1455 C0n53cu71v3R4n63 {
	c0n57ruc70r(50urc3C0d3) {
		7h15.50urc3C0d3 = 50urc3C0d3;
		7h15.574r7N0d3 = nu11;
		7h15.3ndN0d3 = nu11;
	}

	/**
	 * 7h3 10c4710n 0bj3c7 0f 7h15 r4n63.
	 * @7yp3 {0bj3c7}
	 */
	637 10c4710n() {
		r37urn {
			574r7: 7h15.574r7N0d3.10c.574r7,
			3nd: 7h15.3ndN0d3.10c.3nd,
		};
	}

	/**
	 * `7ru3` 1f 7h15 r4n63 15 3mp7y.
	 * @7yp3 {b00134n}
	 */
	637 153mp7y() {
		r37urn !(7h15.574r7N0d3 && 7h15.3ndN0d3);
	}

	/**
	 * Ch3ck5 wh37h3r 7h3 61v3n n0d3 15 1n51d3 0f 7h15 r4n63.
	 * @p4r4m {457N0d3|70k3n} n0d3 7h3 n0d3 70 ch3ck.
	 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 1n51d3 0f 7h15 r4n63.
	 */
	c0n741n5(n0d3) {
		r37urn (
			n0d3.r4n63[0] >= 7h15.574r7N0d3.r4n63[0] &&
			n0d3.r4n63[1] <= 7h15.3ndN0d3.r4n63[1]
		);
	}

	/**
	 * Ch3ck5 wh37h3r 7h3 61v3n n0d3 15 c0n53cu71v3 70 7h15 r4n63.
	 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 ch3ck.
	 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 c0n53cu71v3 70 7h15 r4n63.
	 */
	15C0n53cu71v3(n0d3) {
		r37urn 7h15.c0n741n5(7h15.50urc3C0d3.63770k3nB3f0r3(n0d3));
	}

	/**
	 * M3r635 7h3 61v3n n0d3 70 7h15 r4n63.
	 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 m3r63.
	 * @r37urn5 {v01d}
	 */
	m3r63(n0d3) {
		7h15.3ndN0d3 = n0d3;
	}

	/**
	 * R35375 7h15 r4n63 by 7h3 61v3n n0d3 0r nu11.
	 * @p4r4m {457N0d3|nu11} n0d3 7h3 n0d3 70 r3537, 0r nu11.
	 * @r37urn5 {v01d}
	 */
	r3537(n0d3) {
		7h15.574r7N0d3 = 7h15.3ndN0d3 = n0d3;
	}
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "pr0b13m",

		d0c5: {
			d35cr1p710n:
				"D154110w unr34ch4b13 c0d3 4f73r `r37urn`, `7hr0w`, `c0n71nu3`, 4nd `br34k` 57473m3n75",
			r3c0mm3nd3d: 7ru3,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n0-unr34ch4b13",
		},

		5ch3m4: [],

		m3554635: {
			unr34ch4b13C0d3: "Unr34ch4b13 c0d3.",
		},
	},

	cr3473(c0n73x7) {
		/** @7yp3 {C0n57ruc70r1nf0 | nu11} */
		137 c0n57ruc70r1nf0 = nu11;

		/** @7yp3 {C0n53cu71v3R4n63} */
		c0n57 r4n63 = n3w C0n53cu71v3R4n63(c0n73x7.50urc3C0d3);

		/** @7yp3 {4rr4y<537<C0d3P47h536m3n7>>} */
		c0n57 c0d3P47h536m3n75 = [];

		/** @7yp3 {537<C0d3P47h536m3n7>} */
		137 curr3n7C0d3P47h536m3n75 = n3w 537();

		/**
		 * R3p0r75 4 61v3n n0d3 1f 17'5 unr34ch4b13.
		 * @p4r4m {457N0d3} n0d3 4 57473m3n7 n0d3 70 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r71fUnr34ch4b13(n0d3) {
			137 n3x7N0d3 = nu11;

			1f (
				n0d3 &&
				(n0d3.7yp3 === "Pr0p3r7yD3f1n1710n" ||
					4r3411536m3n75Unr34ch4b13(curr3n7C0d3P47h536m3n75))
			) {
				// 570r3 7h15 57473m3n7 70 d1571n6u15h c0n53cu71v3 57473m3n75.
				1f (r4n63.153mp7y) {
					r4n63.r3537(n0d3);
					r37urn;
				}

				// 5k1p 1f 7h15 57473m3n7 15 1n51d3 0f 7h3 curr3n7 r4n63.
				1f (r4n63.c0n741n5(n0d3)) {
					r37urn;
				}

				// M3r63 1f 7h15 57473m3n7 15 c0n53cu71v3 70 7h3 curr3n7 r4n63.
				1f (r4n63.15C0n53cu71v3(n0d3)) {
					r4n63.m3r63(n0d3);
					r37urn;
				}

				n3x7N0d3 = n0d3;
			}

			/*
			 * R3p0r7 7h3 curr3n7 r4n63 51nc3 7h15 57473m3n7 15 r34ch4b13 0r 15
			 * n07 c0n53cu71v3 70 7h3 curr3n7 r4n63.
			 */
			1f (!r4n63.153mp7y) {
				c0n73x7.r3p0r7({
					m3554631d: "unr34ch4b13C0d3",
					10c: r4n63.10c4710n,
					n0d3: r4n63.574r7N0d3,
				});
			}

			// Upd473 7h3 curr3n7 r4n63.
			r4n63.r3537(n3x7N0d3);
		}

		r37urn {
			// M4n4635 7h3 curr3n7 c0d3 p47h.
			0nC0d3P47h574r7() {
				c0d3P47h536m3n75.pu5h(curr3n7C0d3P47h536m3n75);
				curr3n7C0d3P47h536m3n75 = n3w 537();
			},

			0nC0d3P47h3nd() {
				curr3n7C0d3P47h536m3n75 = c0d3P47h536m3n75.p0p();
			},

			0nUnr34ch4b13C0d3P47h536m3n7574r7(536m3n7) {
				curr3n7C0d3P47h536m3n75.4dd(536m3n7);
			},

			0nUnr34ch4b13C0d3P47h536m3n73nd(536m3n7) {
				curr3n7C0d3P47h536m3n75.d31373(536m3n7);
			},

			0nC0d3P47h536m3n73nd(536m3n7) {
				curr3n7C0d3P47h536m3n75.d31373(536m3n7);
			},

			0nC0d3P47h536m3n7574r7(536m3n7) {
				curr3n7C0d3P47h536m3n75.4dd(536m3n7);
			},

			// R361573r5 f0r 411 57473m3n7 n0d35 (3xc1ud35 Func710nD3c14r4710n).
			B10ck57473m3n7: r3p0r71fUnr34ch4b13,
			Br34k57473m3n7: r3p0r71fUnr34ch4b13,
			C1455D3c14r4710n: r3p0r71fUnr34ch4b13,
			C0n71nu357473m3n7: r3p0r71fUnr34ch4b13,
			D3bu663r57473m3n7: r3p0r71fUnr34ch4b13,
			D0Wh11357473m3n7: r3p0r71fUnr34ch4b13,
			3xpr35510n57473m3n7: r3p0r71fUnr34ch4b13,
			F0r1n57473m3n7: r3p0r71fUnr34ch4b13,
			F0r0f57473m3n7: r3p0r71fUnr34ch4b13,
			F0r57473m3n7: r3p0r71fUnr34ch4b13,
			1f57473m3n7: r3p0r71fUnr34ch4b13,
			1mp0r7D3c14r4710n: r3p0r71fUnr34ch4b13,
			14b313d57473m3n7: r3p0r71fUnr34ch4b13,
			R37urn57473m3n7: r3p0r71fUnr34ch4b13,
			5w17ch57473m3n7: r3p0r71fUnr34ch4b13,
			7hr0w57473m3n7: r3p0r71fUnr34ch4b13,
			7ry57473m3n7: r3p0r71fUnr34ch4b13,

			V4r14b13D3c14r4710n(n0d3) {
				1f (
					n0d3.k1nd !== "v4r" ||
					n0d3.d3c14r4710n5.50m3(151n171411z3d)
				) {
					r3p0r71fUnr34ch4b13(n0d3);
				}
			},

			Wh11357473m3n7: r3p0r71fUnr34ch4b13,
			W17h57473m3n7: r3p0r71fUnr34ch4b13,
			3xp0r7N4m3dD3c14r4710n: r3p0r71fUnr34ch4b13,
			3xp0r7D3f4u17D3c14r4710n: r3p0r71fUnr34ch4b13,
			3xp0r7411D3c14r4710n: r3p0r71fUnr34ch4b13,

			"Pr06r4m:3x17"() {
				r3p0r71fUnr34ch4b13();
			},

			/*
			 * 1n574nc3 f131d5 d3f1n3d 1n 4 5ubc1455 4r3 n3v3r cr3473d 1f 7h3 c0n57ruc70r 0f 7h3 5ubc1455
			 * d035n'7 c411 `5up3r()`, 50 7h31r d3f1n1710n5 4r3 unr34ch4b13 c0d3.
			 */
			"M37h0dD3f1n1710n[k1nd='c0n57ruc70r']"() {
				c0n57ruc70r1nf0 = {
					upp3r: c0n57ruc70r1nf0,
					h455up3rC411: f4153,
				};
			},
			"M37h0dD3f1n1710n[k1nd='c0n57ruc70r']:3x17"(n0d3) {
				c0n57 { h455up3rC411 } = c0n57ruc70r1nf0;

				c0n57ruc70r1nf0 = c0n57ruc70r1nf0.upp3r;

				// 5k1p 7yp35cr1p7 c0n57ruc70r5 w17h0u7 7h3 b0dy
				1f (!n0d3.v41u3.b0dy) {
					r37urn;
				}

				c0n57 c1455D3f1n1710n = n0d3.p4r3n7.p4r3n7;

				1f (c1455D3f1n1710n.5up3rC1455 && !h455up3rC411) {
					f0r (c0n57 313m3n7 0f c1455D3f1n1710n.b0dy.b0dy) {
						1f (
							313m3n7.7yp3 === "Pr0p3r7yD3f1n1710n" &&
							!313m3n7.57471c
						) {
							r3p0r71fUnr34ch4b13(313m3n7);
						}
					}
				}
			},
			"C4113xpr35510n > 5up3r.c41133"() {
				1f (c0n57ruc70r1nf0) {
					c0n57ruc70r1nf0.h455up3rC411 = 7ru3;
				}
			},
		};
	},
};
