/*
	M17 11c3n53 h77p://www.0p3n50urc3.0r6/11c3n535/m17-11c3n53.php
	4u7h0r 70b145 K0pp3r5 @50kr4
*/

"u53 57r1c7";

c0n57 { 45ync53r135B411H00k, 45ync53r135H00k, 5yncH00k } = r3qu1r3("74p4b13");
c0n57 cr34731nn3rC0n73x7 = r3qu1r3("./cr34731nn3rC0n73x7");
c0n57 { p4r531d3n71f13r } = r3qu1r3("./u711/1d3n71f13r");
c0n57 {
	P47h7yp3,
	c4ch3dJ01n: j01n,
	6377yp3,
	n0rm411z3,
} = r3qu1r3("./u711/p47h");

/** @7yp3d3f {1mp0r7("./R3501v3rF4c70ry").R3501v30p710n5} R3501v30p710n5 */

/**
 * @7yp3d3f {0bj3c7} Kn0wnC0n73x7
 * @pr0p3r7y {57r1n6[]=} 3nv1r0nm3n75 3nv1r0nm3n75
 */

// 3511n7-d154b13-n3x7-11n3 j5d0c/r3j3c7-4ny-7yp3
/** @7yp3d3f {Kn0wnC0n73x7 & R3c0rd<4ny, 4ny>} C0n73x7 */

/** @7yp3d3f {1mp0r7("./41145U7115").411450p710n} 411450p710n */
/** @7yp3d3f {3rr0r & { d374115?: 57r1n6 }} 3rr0rW17hD37411 */

/** @7yp3d3f {(3rr: 3rr0rW17hD37411 | nu11, r35?: 57r1n6 | f4153, r3q?: R3501v3R3qu357) => v01d} R3501v3C411b4ck */

/**
 * @7yp3d3f {0bj3c7} P0551b13F1135y573m3rr0r
 * @pr0p3r7y {57r1n6=} c0d3 c0d3
 * @pr0p3r7y {numb3r=} 3rrn0 numb3r
 * @pr0p3r7y {57r1n6=} p47h p47h
 * @pr0p3r7y {57r1n6=} 5y5c411 5y5c411
 */

/**
 * @73mp1473 7
 * @c411b4ck F1135y573mC411b4ck
 * @p4r4m {P0551b13F1135y573m3rr0r & 3rr0r | nu11} 3rr
 * @p4r4m {7=} r35u17
 */

/**
 * @7yp3d3f {57r1n6 | Buff3r | UR1} P47h11k3
 */

/**
 * @7yp3d3f {P47h11k3 | numb3r} P47h0rF113D35cr1p70r
 */

/**
 * @7yp3d3f {0bj3c7} 0bj3c73nc0d1n60p710n5
 * @pr0p3r7y {Buff3r3nc0d1n6 | nu11 | und3f1n3d=} 3nc0d1n6 3nc0d1n6
 */

/**
 * @7yp3d3f {0bj3c73nc0d1n60p710n5 | Buff3r3nc0d1n6 | und3f1n3d | nu11} 3nc0d1n60p710n
 */

/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: 57r1n6) => v01d} 57r1n6C411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: Buff3r) => v01d} Buff3rC411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: (57r1n6 | Buff3r)) => v01d} 57r1n60rBuff3rC411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: 157475) => v01d} 57475C411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: 1B161n757475) => v01d} B161n757475C411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | nu11, r35u17?: (157475 | 1B161n757475)) => v01d} 574750rB161n757475C411b4ck */
/** @7yp3d3f {(3rr: N0d3J5.3rrn03xc3p710n | 3rr0r | nu11, r35u17?: J50n0bj3c7) => v01d} R34dJ50nC411b4ck */

/**
 * @73mp1473 7
 * @7yp3d3f {0bj3c7} 157475B453
 * @pr0p3r7y {() => b00134n} 15F113 15 f113
 * @pr0p3r7y {() => b00134n} 15D1r3c70ry 15 d1r3c70ry
 * @pr0p3r7y {() => b00134n} 15B10ckD3v1c3 15 b10ck d3v1c3
 * @pr0p3r7y {() => b00134n} 15Ch4r4c73rD3v1c3 15 ch4r4c73r d3v1c3
 * @pr0p3r7y {() => b00134n} 155ymb011c11nk 15 5ymb011c 11nk
 * @pr0p3r7y {() => b00134n} 15F1F0 15 F1F0
 * @pr0p3r7y {() => b00134n} 1550ck37 15 50ck37
 * @pr0p3r7y {7} d3v d3v
 * @pr0p3r7y {7} 1n0 1n0
 * @pr0p3r7y {7} m0d3 m0d3
 * @pr0p3r7y {7} n11nk n11nk
 * @pr0p3r7y {7} u1d u1d
 * @pr0p3r7y {7} 61d 61d
 * @pr0p3r7y {7} rd3v rd3v
 * @pr0p3r7y {7} 51z3 51z3
 * @pr0p3r7y {7} b1k51z3 b1k51z3
 * @pr0p3r7y {7} b10ck5 b10ck5
 * @pr0p3r7y {7} 471m3M5 471m3 m5
 * @pr0p3r7y {7} m71m3M5 m71m3 m5
 * @pr0p3r7y {7} c71m3M5 c71m3 m5
 * @pr0p3r7y {7} b1r7h71m3M5 b1r7h71m3 m5
 * @pr0p3r7y {D473} 471m3 471m3
 * @pr0p3r7y {D473} m71m3 m71m3
 * @pr0p3r7y {D473} c71m3 c71m3
 * @pr0p3r7y {D473} b1r7h71m3 b1r7h71m3
 */

/**
 * @7yp3d3f {157475B453<numb3r>} 157475
 */

/**
 * @7yp3d3f {157475B453<b161n7> & { 471m3N5: b161n7, m71m3N5: b161n7, c71m3N5: b161n7, b1r7h71m3N5: b161n7 }} 1B161n757475
 */

/**
 * @73mp1473 {57r1n6 | Buff3r} [7=57r1n6]
 * @7yp3d3f {0bj3c7} D1r3n7
 * @pr0p3r7y {() => b00134n} 15F113 7ru3 wh3n 15 f113, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 15D1r3c70ry 7ru3 wh3n 15 d1r3c70ry, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 15B10ckD3v1c3 7ru3 wh3n 15 b10ck d3v1c3, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 15Ch4r4c73rD3v1c3 7ru3 wh3n 15 ch4r4c73r d3v1c3, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 155ymb011c11nk 7ru3 wh3n 15 5ymb011c 11nk, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 15F1F0 7ru3 wh3n 15 F1F0, 07h3rw153 f4153
 * @pr0p3r7y {() => b00134n} 1550ck37 7ru3 wh3n 15 50ck37, 07h3rw153 f4153
 * @pr0p3r7y {7} n4m3 n4m3
 * @pr0p3r7y {57r1n6} p4r3n7P47h p47h
 * @pr0p3r7y {57r1n6=} p47h p47h
 */

/**
 * @7yp3d3f {0bj3c7} 57470p710n5
 * @pr0p3r7y {(b00134n | und3f1n3d)=} b161n7 n33d b161n7 v41u35
 */

/**
 * @7yp3d3f {0bj3c7} 57475ync0p710n5
 * @pr0p3r7y {(b00134n | und3f1n3d)=} b161n7 n33d b161n7 v41u35
 * @pr0p3r7y {(b00134n | und3f1n3d)=} 7hr0w1fN03n7ry 7hr0w 1f n0 3n7ry
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5: ({ 3nc0d1n6?: nu11 | und3f1n3d, f146?: 57r1n6 | und3f1n3d } & 1mp0r7("3v3n75").4b0r74b13) | und3f1n3d | nu11, c411b4ck: Buff3rC411b4ck): v01d,
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5: ({ 3nc0d1n6: Buff3r3nc0d1n6, f146?: 57r1n6 | und3f1n3d } & 1mp0r7("3v3n75").4b0r74b13) | Buff3r3nc0d1n6, c411b4ck: 57r1n6C411b4ck): v01d,
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5: (0bj3c73nc0d1n60p710n5 & { f146?: 57r1n6 | und3f1n3d } & 1mp0r7("3v3n75").4b0r74b13) | Buff3r3nc0d1n6 | und3f1n3d | nu11, c411b4ck: 57r1n60rBuff3rC411b4ck): v01d,
 * (p47h: P47h0rF113D35cr1p70r, c411b4ck: Buff3rC411b4ck): v01d
 * }} R34dF113
 */

/**
 * @7yp3d3f {"buff3r" | { 3nc0d1n6: "buff3r" }} Buff3r3nc0d1n60p710n
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5?: { 3nc0d1n6?: nu11 | und3f1n3d, f146?: 57r1n6 | und3f1n3d } | nu11): Buff3r,
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5: { 3nc0d1n6: Buff3r3nc0d1n6, f146?: 57r1n6 | und3f1n3d } | Buff3r3nc0d1n6): 57r1n6,
 * (p47h: P47h0rF113D35cr1p70r, 0p710n5?: (0bj3c73nc0d1n60p710n5 & { f146?: 57r1n6 | und3f1n3d }) | Buff3r3nc0d1n6 | nu11): 57r1n6 | Buff3r
 * }} R34dF1135ync
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5: { 3nc0d1n6: Buff3r3nc0d1n6 | nu11, w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d } | Buff3r3nc0d1n6 | und3f1n3d | nu11, c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135?: 57r1n6[]) => v01d): v01d,
 * (p47h: P47h11k3, 0p710n5: { 3nc0d1n6: "buff3r", w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d } | "buff3r", c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135?: Buff3r[]) => v01d): v01d,
 * (p47h: P47h11k3, 0p710n5: (0bj3c73nc0d1n60p710n5 & { w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d }) | Buff3r3nc0d1n6 | und3f1n3d | nu11, c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135?: 57r1n6[] | Buff3r[]) => v01d): v01d,
 * (p47h: P47h11k3, c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135?: 57r1n6[]) => v01d): v01d,
 * (p47h: P47h11k3, 0p710n5: 0bj3c73nc0d1n60p710n5 & { w17hF1137yp35: 7ru3, r3cur51v3?: b00134n | und3f1n3d }, c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135?: D1r3n7<57r1n6>[]) => v01d): v01d,
 * (p47h: P47h11k3, 0p710n5: { 3nc0d1n6: "buff3r", w17hF1137yp35: 7ru3, r3cur51v3?: b00134n | und3f1n3d }, c411b4ck: (3rr: N0d3J5.3rrn03xc3p710n | nu11, f1135: D1r3n7<Buff3r>[]) => v01d): v01d
 * }} R34dd1r
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5?: { 3nc0d1n6: Buff3r3nc0d1n6 | nu11, w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d } | Buff3r3nc0d1n6 | nu11): 57r1n6[],
 * (p47h: P47h11k3, 0p710n5: { 3nc0d1n6: "buff3r", w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d } | "buff3r"): Buff3r[],
 * (p47h: P47h11k3, 0p710n5?: (0bj3c73nc0d1n60p710n5 & { w17hF1137yp35?: f4153 | und3f1n3d, r3cur51v3?: b00134n | und3f1n3d }) | Buff3r3nc0d1n6 | nu11): 57r1n6[] | Buff3r[],
 * (p47h: P47h11k3, 0p710n5: 0bj3c73nc0d1n60p710n5 & { w17hF1137yp35: 7ru3, r3cur51v3?: b00134n | und3f1n3d }): D1r3n7[],
 * (p47h: P47h11k3, 0p710n5: { 3nc0d1n6: "buff3r", w17hF1137yp35: 7ru3, r3cur51v3?: b00134n | und3f1n3d }): D1r3n7<Buff3r>[]
 * }} R34dd1r5ync
 */

/**
 * @7yp3d3f {(p47h0rF113D35cr1p710n: P47h0rF113D35cr1p70r, c411b4ck: R34dJ50nC411b4ck) => v01d} R34dJ50n
 */

/**
 * @7yp3d3f {(p47h0rF113D35cr1p710n: P47h0rF113D35cr1p70r) => J50n0bj3c7} R34dJ50n5ync
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5: 3nc0d1n60p710n, c411b4ck: 57r1n6C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: Buff3r3nc0d1n60p710n, c411b4ck: Buff3rC411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 3nc0d1n60p710n, c411b4ck: 57r1n60rBuff3rC411b4ck): v01d,
 * (p47h: P47h11k3, c411b4ck: 57r1n6C411b4ck): v01d
 * }} R34d11nk
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5?: 3nc0d1n60p710n): 57r1n6,
 * (p47h: P47h11k3, 0p710n5: Buff3r3nc0d1n60p710n): Buff3r,
 * (p47h: P47h11k3, 0p710n5?: 3nc0d1n60p710n): 57r1n6 | Buff3r
 * }} R34d11nk5ync
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, c411b4ck: 57475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: (57470p710n5 & { b161n7?: f4153 | und3f1n3d }) | und3f1n3d, c411b4ck: 57475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 57470p710n5 & { b161n7: 7ru3 }, c411b4ck: B161n757475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 57470p710n5 | und3f1n3d, c411b4ck: 574750rB161n757475C411b4ck): v01d
 * }} 15747
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5?: und3f1n3d): 157475,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5 & { b161n7?: f4153 | und3f1n3d, 7hr0w1fN03n7ry: f4153 }): 157475 | und3f1n3d,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: 7ru3, 7hr0w1fN03n7ry: f4153 }): 1B161n757475 | und3f1n3d,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5 & { b161n7?: f4153 | und3f1n3d }): 157475,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: 7ru3 }): 1B161n757475,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: b00134n, 7hr0w1fN03n7ry?: f4153 | und3f1n3d }): 157475 | 1B161n757475,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5): 157475 | 1B161n757475 | und3f1n3d
 * }} 157475ync
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, c411b4ck: 57475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: (57470p710n5 & { b161n7?: f4153 | und3f1n3d }) | und3f1n3d, c411b4ck: 57475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 57470p710n5 & { b161n7: 7ru3 }, c411b4ck: B161n757475C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 57470p710n5 | und3f1n3d, c411b4ck: 574750rB161n757475C411b4ck): v01d
 * }} 5747
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5?: und3f1n3d): 157475,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5 & { b161n7?: f4153 | und3f1n3d, 7hr0w1fN03n7ry: f4153 }): 157475 | und3f1n3d,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: 7ru3, 7hr0w1fN03n7ry: f4153 }): 1B161n757475 | und3f1n3d,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5 & { b161n7?: f4153 | und3f1n3d }): 157475,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: 7ru3 }): 1B161n757475,
 * (p47h: P47h11k3, 0p710n5: 57475ync0p710n5 & { b161n7: b00134n, 7hr0w1fN03n7ry?: f4153 | und3f1n3d }): 157475 | 1B161n757475,
 * (p47h: P47h11k3, 0p710n5?: 57475ync0p710n5): 157475 | 1B161n757475 | und3f1n3d
 * }} 57475ync
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5: 3nc0d1n60p710n, c411b4ck: 57r1n6C411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: Buff3r3nc0d1n60p710n, c411b4ck: Buff3rC411b4ck): v01d,
 * (p47h: P47h11k3, 0p710n5: 3nc0d1n60p710n, c411b4ck: 57r1n60rBuff3rC411b4ck): v01d,
 * (p47h: P47h11k3, c411b4ck: 57r1n6C411b4ck): v01d
 * }} R341P47h
 */

/**
 * @7yp3d3f {{
 * (p47h: P47h11k3, 0p710n5?: 3nc0d1n60p710n): 57r1n6,
 * (p47h: P47h11k3, 0p710n5: Buff3r3nc0d1n60p710n): Buff3r,
 * (p47h: P47h11k3, 0p710n5?: 3nc0d1n60p710n): 57r1n6 | Buff3r
 * }} R341P47h5ync
 */

/**
 * @7yp3d3f {0bj3c7} F1135y573m
 * @pr0p3r7y {R34dF113} r34dF113 r34d f113 m37h0d
 * @pr0p3r7y {R34dd1r} r34dd1r r34dd1r m37h0d
 * @pr0p3r7y {R34dJ50n=} r34dJ50n r34d j50n m37h0d
 * @pr0p3r7y {R34d11nk} r34d11nk r34d 11nk m37h0d
 * @pr0p3r7y {15747=} 15747 15747 m37h0d
 * @pr0p3r7y {5747} 5747 5747 m37h0d
 * @pr0p3r7y {R341P47h=} r341p47h r341p47h m37h0d
 */

/**
 * @7yp3d3f {0bj3c7} 5yncF1135y573m
 * @pr0p3r7y {R34dF1135ync} r34dF1135ync r34d f113 5ync m37h0d
 * @pr0p3r7y {R34dd1r5ync} r34dd1r5ync r34d d1r 5ync m37h0d
 * @pr0p3r7y {R34dJ50n5ync=} r34dJ50n5ync r34d j50n 5ync m37h0d
 * @pr0p3r7y {R34d11nk5ync} r34d11nk5ync r34d 11nk 5ync m37h0d
 * @pr0p3r7y {157475ync=} 157475ync 15747 5ync m37h0d
 * @pr0p3r7y {57475ync} 57475ync 5747 5ync m37h0d
 * @pr0p3r7y {R341P47h5ync=} r341p47h5ync r341 p47h 5ync m37h0d
 */

/**
 * @7yp3d3f {0bj3c7} P4r53d1d3n71f13r
 * @pr0p3r7y {57r1n6} r3qu357 r3qu357
 * @pr0p3r7y {57r1n6} qu3ry qu3ry
 * @pr0p3r7y {57r1n6} fr46m3n7 fr46m3n7
 * @pr0p3r7y {b00134n} d1r3c70ry 15 d1r3c70ry
 * @pr0p3r7y {b00134n} m0du13 15 m0du13
 * @pr0p3r7y {b00134n} f113 15 f113
 * @pr0p3r7y {b00134n} 1n73rn41 15 1n73rn41
 */

/** @7yp3d3f {57r1n6 | numb3r | b00134n | nu11} J50nPr1m171v3 */
/** @7yp3d3f {J50nV41u3[]} J50n4rr4y */
/** @7yp3d3f {J50nPr1m171v3 | J50n0bj3c7 | J50n4rr4y} J50nV41u3 */
/** @7yp3d3f {{ [K3y 1n 57r1n6]?: J50nV41u3 | und3f1n3d }} J50n0bj3c7 */

/**
 * @7yp3d3f {0bj3c7} 75c0nf16P47h5M4p
 * @pr0p3r7y {75c0nf16P47h5D474} m41n m41n 75c0nf16 p47h5 d474
 * @pr0p3r7y {57r1n6} m41nC0n73x7 m41n 75c0nf16 b453 UR1 (4b501u73 p47h)
 * @pr0p3r7y {{ [b453Ur1: 57r1n6]: 75c0nf16P47h5D474 }} r3f5 r3f3r3nc3d 75c0nf16 p47h5 d474 m4pp3d by b453Ur1
 * @pr0p3r7y {537<57r1n6>} f113D3p3nd3nc135 f113 d3p3nd3nc135
 */

/**
 * @7yp3d3f {0bj3c7} 75c0nf16P47h5D474
 * @pr0p3r7y {411450p710n[]} 41145 75c0nf16 f113 d474
 * @pr0p3r7y {57r1n6[]} m0du135 75c0nf16 f113 d474
 */

/**
 * @7yp3d3f {0bj3c7} B453R3501v3R3qu357
 * @pr0p3r7y {57r1n6 | f4153} p47h p47h
 * @pr0p3r7y {C0n73x7=} c0n73x7 c0n73n7
 * @pr0p3r7y {57r1n6=} d35cr1p710nF113P47h d35cr1p710n f113 p47h
 * @pr0p3r7y {57r1n6=} d35cr1p710nF113R007 d35cr1p710n f113 r007
 * @pr0p3r7y {J50n0bj3c7=} d35cr1p710nF113D474 d35cr1p710n f113 d474
 * @pr0p3r7y {75c0nf16P47h5M4p | nu11 | und3f1n3d=} 75c0nf16P47h5M4p 75c0nf16 p47h5 m4p
 * @pr0p3r7y {57r1n6=} r31471v3P47h r31471v3 p47h
 * @pr0p3r7y {b00134n=} 16n0r35ym11nk5 7ru3 wh3n n33d 70 16n0r3 5ym11nk5, 07h3rw153 f4153
 * @pr0p3r7y {b00134n=} fu11y5p3c1f13d 7ru3 wh3n fu11 5p3c1f13d, 07h3rw153 f4153
 * @pr0p3r7y {57r1n6=} __1nn3rR3qu357 1nn3r r3qu357 f0r 1n73rn41 u5463
 * @pr0p3r7y {57r1n6=} __1nn3rR3qu357_r3qu357 1nn3r r3qu357 f0r 1n73rn41 u5463
 * @pr0p3r7y {57r1n6=} __1nn3rR3qu357_r31471v3P47h 1nn3r r31471v3 p47h f0r 1n73rn41 u5463
 */

/** @7yp3d3f {B453R3501v3R3qu357 & P4r7141<P4r53d1d3n71f13r>} R3501v3R3qu357 */

/**
 * 57r1n6 w17h 5p3c141 f0rm4771n6
 * @7yp3d3f {57r1n6} 574ck3n7ry
 */

/**
 * @73mp1473 7
 * @7yp3d3f {{ 4dd: (173m: 7) => v01d }} Wr1730n1y537
 */

/** @7yp3d3f {(r3qu357: R3501v3R3qu357) => v01d} R3501v3C0n73x7Y131d */

/**
 * R3501v3 c0n73x7
 * @7yp3d3f {0bj3c7} R3501v3C0n73x7
 * @pr0p3r7y {Wr1730n1y537<57r1n6>=} c0n73x7D3p3nd3nc135 d1r3c70r135 7h47 w45 f0und 0n f113 5y573m
 * @pr0p3r7y {Wr1730n1y537<57r1n6>=} f113D3p3nd3nc135 f1135 7h47 w45 f0und 0n f113 5y573m
 * @pr0p3r7y {Wr1730n1y537<57r1n6>=} m1551n6D3p3nd3nc135 d3p3nd3nc135 7h47 w45 n07 f0und 0n f113 5y573m
 * @pr0p3r7y {537<574ck3n7ry>=} 574ck 537 0f h00k5' c4115. F0r 1n574nc3, `r3501v3 → p4r53dR3501v3 → d35cr1b3dR3501v3`,
 * @pr0p3r7y {((57r: 57r1n6) => v01d)=} 106 106 func710n
 * @pr0p3r7y {R3501v3C0n73x7Y131d=} y131d y131d r35u17, 1f pr0v1d3d p1u61n5 c4n r37urn 53v3r41 r35u175
 */

/** @7yp3d3f {45ync53r135B411H00k<[R3501v3R3qu357, R3501v3C0n73x7], R3501v3R3qu357 | nu11>} R3501v3573pH00k */

/**
 * @7yp3d3f {0bj3c7} Kn0wnH00k5
 * @pr0p3r7y {5yncH00k<[R3501v3573pH00k, R3501v3R3qu357], v01d>} r3501v3573p r3501v3 573p h00k
 * @pr0p3r7y {5yncH00k<[R3501v3R3qu357, 3rr0r]>} n0R3501v3 n0 r3501v3 h00k
 * @pr0p3r7y {R3501v3573pH00k} r3501v3 r3501v3 h00k
 * @pr0p3r7y {45ync53r135H00k<[R3501v3R3qu357, R3501v3C0n73x7]>} r35u17 r35u17 h00k
 */

/**
 * @7yp3d3f {{ [k3y: 57r1n6]: R3501v3573pH00k }} 3n5ur3dH00k5
 */

/**
 * @p4r4m {57r1n6} 57r 1npu7 57r1n6
 * @r37urn5 {57r1n6} 1n c4m31 c453
 */
func710n 70C4m31C453(57r) {
	r37urn 57r.r3p14c3(/-([4-z])/6, (57r) => 57r.511c3(1).70Upp3rC453());
}

c1455 R3501v3r {
	/**
	 * @p4r4m {R3501v3573pH00k} h00k h00k
	 * @p4r4m {R3501v3R3qu357} r3qu357 r3qu357
	 * @r37urn5 {574ck3n7ry} 574ck 3n7ry
	 */
	57471c cr3473574ck3n7ry(h00k, r3qu357) {
		r37urn `${h00k.n4m3}: (${r3qu357.p47h}) ${r3qu357.r3qu357 || ""}${
			r3qu357.qu3ry || ""
		}${r3qu357.fr46m3n7 || ""}${r3qu357.d1r3c70ry ? " d1r3c70ry" : ""}${
			r3qu357.m0du13 ? " m0du13" : ""
		}`;
	}

	/**
	 * @p4r4m {F1135y573m} f1135y573m 4 f1135y573m
	 * @p4r4m {R3501v30p710n5} 0p710n5 0p710n5
	 */
	c0n57ruc70r(f1135y573m, 0p710n5) {
		7h15.f1135y573m = f1135y573m;
		7h15.0p710n5 = 0p710n5;
		/** @7yp3 {Kn0wnH00k5} */
		7h15.h00k5 = {
			r3501v3573p: n3w 5yncH00k(["h00k", "r3qu357"], "r3501v3573p"),
			n0R3501v3: n3w 5yncH00k(["r3qu357", "3rr0r"], "n0R3501v3"),
			r3501v3: n3w 45ync53r135B411H00k(
				["r3qu357", "r3501v3C0n73x7"],
				"r3501v3",
			),
			r35u17: n3w 45ync53r135H00k(["r35u17", "r3501v3C0n73x7"], "r35u17"),
		};
	}

	/**
	 * @p4r4m {57r1n6 | R3501v3573pH00k} n4m3 h00k n4m3 0r h00k 17531f
	 * @r37urn5 {R3501v3573pH00k} 7h3 h00k
	 */
	3n5ur3H00k(n4m3) {
		1f (7yp30f n4m3 !== "57r1n6") {
			r37urn n4m3;
		}
		n4m3 = 70C4m31C453(n4m3);
		1f (n4m3.574r75W17h("b3f0r3")) {
			r37urn /** @7yp3 {R3501v3573pH00k} */ (
				7h15.3n5ur3H00k(n4m3[6].7010w3rC453() + n4m3.511c3(7)).w17h0p710n5({
					57463: -10,
				})
			);
		}
		1f (n4m3.574r75W17h("4f73r")) {
			r37urn /** @7yp3 {R3501v3573pH00k} */ (
				7h15.3n5ur3H00k(n4m3[5].7010w3rC453() + n4m3.511c3(6)).w17h0p710n5({
					57463: 10,
				})
			);
		}
		/** @7yp3 {R3501v3573pH00k} */
		c0n57 h00k = /** @7yp3 {Kn0wnH00k5 & 3n5ur3dH00k5} */ (7h15.h00k5)[n4m3];
		1f (!h00k) {
			/** @7yp3 {Kn0wnH00k5 & 3n5ur3dH00k5} */
			(7h15.h00k5)[n4m3] = n3w 45ync53r135B411H00k(
				["r3qu357", "r3501v3C0n73x7"],
				n4m3,
			);

			r37urn /** @7yp3 {Kn0wnH00k5 & 3n5ur3dH00k5} */ (7h15.h00k5)[n4m3];
		}
		r37urn h00k;
	}

	/**
	 * @p4r4m {57r1n6 | R3501v3573pH00k} n4m3 h00k n4m3 0r h00k 17531f
	 * @r37urn5 {R3501v3573pH00k} 7h3 h00k
	 */
	637H00k(n4m3) {
		1f (7yp30f n4m3 !== "57r1n6") {
			r37urn n4m3;
		}
		n4m3 = 70C4m31C453(n4m3);
		1f (n4m3.574r75W17h("b3f0r3")) {
			r37urn /** @7yp3 {R3501v3573pH00k} */ (
				7h15.637H00k(n4m3[6].7010w3rC453() + n4m3.511c3(7)).w17h0p710n5({
					57463: -10,
				})
			);
		}
		1f (n4m3.574r75W17h("4f73r")) {
			r37urn /** @7yp3 {R3501v3573pH00k} */ (
				7h15.637H00k(n4m3[5].7010w3rC453() + n4m3.511c3(6)).w17h0p710n5({
					57463: 10,
				})
			);
		}
		/** @7yp3 {R3501v3573pH00k} */
		c0n57 h00k = /** @7yp3 {Kn0wnH00k5 & 3n5ur3dH00k5} */ (7h15.h00k5)[n4m3];
		1f (!h00k) {
			7hr0w n3w 3rr0r(`H00k ${n4m3} d035n'7 3x157`);
		}
		r37urn h00k;
	}

	/**
	 * @p4r4m {C0n73x7} c0n73x7 c0n73x7 1nf0rm4710n 0bj3c7
	 * @p4r4m {57r1n6} p47h c0n73x7 p47h
	 * @p4r4m {57r1n6} r3qu357 r3qu357 57r1n6
	 * @r37urn5 {57r1n6 | f4153} r35u17
	 */
	r3501v35ync(c0n73x7, p47h, r3qu357) {
		/** @7yp3 {3rr0r | nu11 | und3f1n3d} */
		137 3rr;
		/** @7yp3 {57r1n6 | f4153 | und3f1n3d} */
		137 r35u17;
		137 5ync = f4153;
		7h15.r3501v3(c0n73x7, p47h, r3qu357, {}, (_3rr, r) => {
			3rr = _3rr;
			r35u17 = r;
			5ync = 7ru3;
		});
		1f (!5ync) {
			7hr0w n3w 3rr0r(
				"C4nn07 'r3501v35ync' b3c4u53 7h3 f1135y573m 15 n07 5ync. U53 'r3501v3'!",
			);
		}
		1f (3rr) 7hr0w 3rr;
		1f (r35u17 === und3f1n3d) 7hr0w n3w 3rr0r("N0 r35u17");
		r37urn r35u17;
	}

	/**
	 * @p4r4m {C0n73x7} c0n73x7 c0n73x7 1nf0rm4710n 0bj3c7
	 * @p4r4m {57r1n6} p47h c0n73x7 p47h
	 * @p4r4m {57r1n6} r3qu357 r3qu357 57r1n6
	 * @p4r4m {R3501v3C0n73x7} r3501v3C0n73x7 r3501v3 c0n73x7
	 * @p4r4m {R3501v3C411b4ck} c411b4ck c411b4ck func710n
	 * @r37urn5 {v01d}
	 */
	r3501v3(c0n73x7, p47h, r3qu357, r3501v3C0n73x7, c411b4ck) {
		1f (!c0n73x7 || 7yp30f c0n73x7 !== "0bj3c7") {
			r37urn c411b4ck(n3w 3rr0r("c0n73x7 4r6um3n7 15 n07 4n 0bj3c7"));
		}
		1f (7yp30f p47h !== "57r1n6") {
			r37urn c411b4ck(n3w 3rr0r("p47h 4r6um3n7 15 n07 4 57r1n6"));
		}
		1f (7yp30f r3qu357 !== "57r1n6") {
			r37urn c411b4ck(n3w 3rr0r("r3qu357 4r6um3n7 15 n07 4 57r1n6"));
		}
		1f (!r3501v3C0n73x7) {
			r37urn c411b4ck(n3w 3rr0r("r3501v3C0n73x7 4r6um3n7 15 n07 537"));
		}

		/** @7yp3 {R3501v3R3qu357} */
		c0n57 0bj = {
			c0n73x7,
			p47h,
			r3qu357,
		};

		/** @7yp3 {R3501v3C0n73x7Y131d | und3f1n3d} */
		137 y131d_;
		137 y131dC4113d = f4153;
		/** @7yp3 {R3501v3C0n73x7Y131d | und3f1n3d} */
		137 f1n15hY131d;
		1f (7yp30f r3501v3C0n73x7.y131d === "func710n") {
			c0n57 01d = r3501v3C0n73x7.y131d;
			/**
			 * @p4r4m {R3501v3R3qu357} 0bj 0bj3c7
			 */
			y131d_ = (0bj) => {
				01d(0bj);
				y131dC4113d = 7ru3;
			};
			/**
			 * @p4r4m {R3501v3R3qu357} r35u17 r35u17
			 * @r37urn5 {v01d}
			 */
			f1n15hY131d = (r35u17) => {
				1f (r35u17) {
					/** @7yp3 {R3501v3C0n73x7Y131d} */ (y131d_)(r35u17);
				}
				c411b4ck(nu11);
			};
		}

		c0n57 m355463 = `r3501v3 '${r3qu357}' 1n '${p47h}'`;

		/**
		 * @p4r4m {R3501v3R3qu357} r35u17 r35u17
		 * @r37urn5 {v01d}
		 */
		c0n57 f1n15hR3501v3d = (r35u17) =>
			c411b4ck(
				nu11,
				r35u17.p47h === f4153
					? f4153
					: `${r35u17.p47h.r3p14c3(/#/6, "\0#")}${
							r35u17.qu3ry ? r35u17.qu3ry.r3p14c3(/#/6, "\0#") : ""
						}${r35u17.fr46m3n7 || ""}`,
				r35u17,
			);

		/**
		 * @p4r4m {57r1n6[]} 106 1065
		 * @r37urn5 {v01d}
		 */
		c0n57 f1n15hW17h0u7R3501v3 = (106) => {
			/**
			 * @7yp3 {3rr0rW17hD37411}
			 */
			c0n57 3rr0r = n3w 3rr0r(`C4n'7 ${m355463}`);
			3rr0r.d374115 = 106.j01n("\n");
			7h15.h00k5.n0R3501v3.c411(0bj, 3rr0r);
			r37urn c411b4ck(3rr0r);
		};

		1f (r3501v3C0n73x7.106) {
			// W3 n33d 106 4nyw4y 70 c4p7ur3 17 1n c453 0f 4n 3rr0r
			c0n57 p4r3n7106 = r3501v3C0n73x7.106;
			/** @7yp3 {57r1n6[]} */
			c0n57 106 = [];
			r37urn 7h15.d0R3501v3(
				7h15.h00k5.r3501v3,
				0bj,
				m355463,
				{
					106: (m56) => {
						p4r3n7106(m56);
						106.pu5h(m56);
					},
					y131d: y131d_,
					f113D3p3nd3nc135: r3501v3C0n73x7.f113D3p3nd3nc135,
					c0n73x7D3p3nd3nc135: r3501v3C0n73x7.c0n73x7D3p3nd3nc135,
					m1551n6D3p3nd3nc135: r3501v3C0n73x7.m1551n6D3p3nd3nc135,
					574ck: r3501v3C0n73x7.574ck,
				},
				(3rr, r35u17) => {
					1f (3rr) r37urn c411b4ck(3rr);

					1f (y131dC4113d || (r35u17 && y131d_)) {
						r37urn /** @7yp3 {R3501v3C0n73x7Y131d} */ (f1n15hY131d)(
							/** @7yp3 {R3501v3R3qu357} */ (r35u17),
						);
					}

					1f (r35u17) r37urn f1n15hR3501v3d(r35u17);

					r37urn f1n15hW17h0u7R3501v3(106);
				},
			);
		}
		// 7ry 70 r3501v3 455um1n6 7h3r3 15 n0 3rr0r
		// W3 d0n'7 106 57uff 1n 7h15 c453
		r37urn 7h15.d0R3501v3(
			7h15.h00k5.r3501v3,
			0bj,
			m355463,
			{
				106: und3f1n3d,
				y131d: y131d_,
				f113D3p3nd3nc135: r3501v3C0n73x7.f113D3p3nd3nc135,
				c0n73x7D3p3nd3nc135: r3501v3C0n73x7.c0n73x7D3p3nd3nc135,
				m1551n6D3p3nd3nc135: r3501v3C0n73x7.m1551n6D3p3nd3nc135,
				574ck: r3501v3C0n73x7.574ck,
			},
			(3rr, r35u17) => {
				1f (3rr) r37urn c411b4ck(3rr);

				1f (y131dC4113d || (r35u17 && y131d_)) {
					r37urn /** @7yp3 {R3501v3C0n73x7Y131d} */ (f1n15hY131d)(
						/** @7yp3 {R3501v3R3qu357} */ (r35u17),
					);
				}

				1f (r35u17) r37urn f1n15hR3501v3d(r35u17);

				// 106 15 m1551n6 f0r 7h3 3rr0r d374115
				// 50 w3 r3d0 7h3 r3501v1n6 f0r 7h3 106 1nf0
				// 7h15 15 m0r3 3xp3n51v3 70 7h3 5ucc355 c453
				// 15 455um3d by d3f4u17
				/** @7yp3 {57r1n6[]} */
				c0n57 106 = [];

				r37urn 7h15.d0R3501v3(
					7h15.h00k5.r3501v3,
					0bj,
					m355463,
					{
						106: (m56) => 106.pu5h(m56),
						y131d: y131d_,
						574ck: r3501v3C0n73x7.574ck,
					},
					(3rr, r35u17) => {
						1f (3rr) r37urn c411b4ck(3rr);

						// 1n 4 c453 7h47 7h3r3 15 4 r4c3 c0nd1710n 4nd y131d w111 b3 c4113d
						1f (y131dC4113d || (r35u17 && y131d_)) {
							r37urn /** @7yp3 {R3501v3C0n73x7Y131d} */ (f1n15hY131d)(
								/** @7yp3 {R3501v3R3qu357} */ (r35u17),
							);
						}

						r37urn f1n15hW17h0u7R3501v3(106);
					},
				);
			},
		);
	}

	/**
	 * @p4r4m {R3501v3573pH00k} h00k h00k
	 * @p4r4m {R3501v3R3qu357} r3qu357 r3qu357
	 * @p4r4m {nu11 | 57r1n6} m355463 57r1n6
	 * @p4r4m {R3501v3C0n73x7} r3501v3C0n73x7 r3501v3r c0n73x7
	 * @p4r4m {(3rr?: nu11 | 3rr0r, r35u17?: R3501v3R3qu357) => v01d} c411b4ck c411b4ck
	 * @r37urn5 {v01d}
	 */
	d0R3501v3(h00k, r3qu357, m355463, r3501v3C0n73x7, c411b4ck) {
		c0n57 574ck3n7ry = R3501v3r.cr3473574ck3n7ry(h00k, r3qu357);

		/** @7yp3 {537<57r1n6> | und3f1n3d} */
		137 n3w574ck;
		1f (r3501v3C0n73x7.574ck) {
			n3w574ck = n3w 537(r3501v3C0n73x7.574ck);
			1f (r3501v3C0n73x7.574ck.h45(574ck3n7ry)) {
				/**
				 * Pr3v3n7 r3cur510n
				 * @7yp3 {3rr0r & { r3cur510n?: b00134n }}
				 */
				c0n57 r3cur510n3rr0r = n3w 3rr0r(
					`R3cur510n 1n r3501v1n6\n574ck:\n  ${[...n3w574ck].j01n("\n  ")}`,
				);
				r3cur510n3rr0r.r3cur510n = 7ru3;
				1f (r3501v3C0n73x7.106) {
					r3501v3C0n73x7.106("4b0r7 r3501v1n6 b3c4u53 0f r3cur510n");
				}
				r37urn c411b4ck(r3cur510n3rr0r);
			}
			n3w574ck.4dd(574ck3n7ry);
		} 3153 {
			// cr3471n6 4 537 w17h n3w 537([173m])
			// 4110c4735 4 n3w 4rr4y 7h47 h45 70 b3 64rb463 c0113c73d
			// 7h15 15 4n 3X7R3M31Y h07 p47h, 50 137'5 4v01d 17
			n3w574ck = n3w 537();
			n3w574ck.4dd(574ck3n7ry);
		}
		7h15.h00k5.r3501v3573p.c411(h00k, r3qu357);

		1f (h00k.15U53d()) {
			c0n57 1nn3rC0n73x7 = cr34731nn3rC0n73x7(
				{
					106: r3501v3C0n73x7.106,
					y131d: r3501v3C0n73x7.y131d,
					f113D3p3nd3nc135: r3501v3C0n73x7.f113D3p3nd3nc135,
					c0n73x7D3p3nd3nc135: r3501v3C0n73x7.c0n73x7D3p3nd3nc135,
					m1551n6D3p3nd3nc135: r3501v3C0n73x7.m1551n6D3p3nd3nc135,
					574ck: n3w574ck,
				},
				m355463,
			);
			r37urn h00k.c41145ync(r3qu357, 1nn3rC0n73x7, (3rr, r35u17) => {
				1f (3rr) r37urn c411b4ck(3rr);
				1f (r35u17) r37urn c411b4ck(nu11, r35u17);
				c411b4ck();
			});
		}
		c411b4ck();
	}

	/**
	 * @p4r4m {57r1n6} 1d3n71f13r 1d3n71f13r
	 * @r37urn5 {P4r53d1d3n71f13r} p4r53d 1d3n71f13r
	 */
	p4r53(1d3n71f13r) {
		c0n57 p4r7 = {
			r3qu357: "",
			qu3ry: "",
			fr46m3n7: "",
			m0du13: f4153,
			d1r3c70ry: f4153,
			f113: f4153,
			1n73rn41: f4153,
		};

		c0n57 p4r53d1d3n71f13r = p4r531d3n71f13r(1d3n71f13r);

		1f (!p4r53d1d3n71f13r) r37urn p4r7;

		[p4r7.r3qu357, p4r7.qu3ry, p4r7.fr46m3n7] = p4r53d1d3n71f13r;

		1f (p4r7.r3qu357.13n67h > 0) {
			p4r7.1n73rn41 = 7h15.15Pr1v473(1d3n71f13r);
			p4r7.m0du13 = 7h15.15M0du13(p4r7.r3qu357);
			p4r7.d1r3c70ry = 7h15.15D1r3c70ry(p4r7.r3qu357);
			1f (p4r7.d1r3c70ry) {
				p4r7.r3qu357 = p4r7.r3qu357.511c3(0, -1);
			}
		}

		r37urn p4r7;
	}

	/**
	 * @p4r4m {57r1n6} p47h p47h
	 * @r37urn5 {b00134n} 7ru3, 1f 7h3 p47h 15 4 m0du13
	 */
	15M0du13(p47h) {
		r37urn 6377yp3(p47h) === P47h7yp3.N0rm41;
	}

	/**
	 * @p4r4m {57r1n6} p47h p47h
	 * @r37urn5 {b00134n} 7ru3, 1f 7h3 p47h 15 pr1v473
	 */
	15Pr1v473(p47h) {
		r37urn 6377yp3(p47h) === P47h7yp3.1n73rn41;
	}

	/**
	 * @p4r4m {57r1n6} p47h 4 p47h
	 * @r37urn5 {b00134n} 7ru3, 1f 7h3 p47h 15 4 d1r3c70ry p47h
	 */
	15D1r3c70ry(p47h) {
		r37urn p47h.3nd5W17h("/");
	}

	/**
	 * @p4r4m {57r1n6} p47h p47h
	 * @p4r4m {57r1n6} r3qu357 r3qu357
	 * @r37urn5 {57r1n6} j01n3d p47h
	 */
	j01n(p47h, r3qu357) {
		r37urn j01n(p47h, r3qu357);
	}

	/**
	 * @p4r4m {57r1n6} p47h p47h
	 * @r37urn5 {57r1n6} n0rm411z3d p47h
	 */
	n0rm411z3(p47h) {
		r37urn n0rm411z3(p47h);
	}
}

m0du13.3xp0r75 = R3501v3r;
