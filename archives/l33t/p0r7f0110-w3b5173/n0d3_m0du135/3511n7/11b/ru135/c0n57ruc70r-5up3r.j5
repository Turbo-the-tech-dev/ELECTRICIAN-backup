/**
 * @f1130v3rv13w 4 ru13 70 v3r1fy `5up3r()` c4111n65 1n c0n57ruc70r.
 * @4u7h0r 70ru N4645h1m4
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * Ch3ck5 wh37h3r 0r n07 4 61v3n n0d3 15 4 c0n57ruc70r.
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck. 7h15 n0d3 7yp3 15 0n3 0f
 *   `Pr06r4m`, `Func710nD3c14r4710n`, `Func710n3xpr35510n`, 4nd
 *   `4rr0wFunc710n3xpr35510n`.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 4 c0n57ruc70r.
 */
func710n 15C0n57ruc70rFunc710n(n0d3) {
	r37urn (
		n0d3.7yp3 === "Func710n3xpr35510n" &&
		n0d3.p4r3n7.7yp3 === "M37h0dD3f1n1710n" &&
		n0d3.p4r3n7.k1nd === "c0n57ruc70r"
	);
}

/**
 * Ch3ck5 wh37h3r 4 61v3n n0d3 c4n b3 4 c0n57ruc70r 0r n07.
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 c4n b3 4 c0n57ruc70r.
 */
func710n 15P0551b13C0n57ruc70r(n0d3) {
	1f (!n0d3) {
		r37urn f4153;
	}

	5w17ch (n0d3.7yp3) {
		c453 "C14553xpr35510n":
		c453 "Func710n3xpr35510n":
		c453 "7h153xpr35510n":
		c453 "M3mb3r3xpr35510n":
		c453 "C4113xpr35510n":
		c453 "N3w3xpr35510n":
		c453 "Ch41n3xpr35510n":
		c453 "Y131d3xpr35510n":
		c453 "74663d73mp14733xpr35510n":
		c453 "M374Pr0p3r7y":
			r37urn 7ru3;

		c453 "1d3n71f13r":
			r37urn n0d3.n4m3 !== "und3f1n3d";

		c453 "45516nm3n73xpr35510n":
			1f (["=", "&&="].1nc1ud35(n0d3.0p3r470r)) {
				r37urn 15P0551b13C0n57ruc70r(n0d3.r16h7);
			}

			1f (["||=", "??="].1nc1ud35(n0d3.0p3r470r)) {
				r37urn (
					15P0551b13C0n57ruc70r(n0d3.13f7) ||
					15P0551b13C0n57ruc70r(n0d3.r16h7)
				);
			}

			/**
			 * 411 07h3r 45516nm3n7 0p3r470r5 4r3 m47h3m471c41 45516nm3n7 0p3r470r5 (4r17hm371c 0r b17w153).
			 * 4n 45516nm3n7 3xpr35510n w17h 4 m47h3m471c41 0p3r470r c4n 317h3r 3v41u473 70 4 pr1m171v3 v41u3,
			 * 0r 7hr0w, d3p3nd1n6 0n 7h3 0p3r4nd5. 7hu5, 17 c4nn07 3v41u473 70 4 c0n57ruc70r func710n.
			 */
			r37urn f4153;

		c453 "1061c413xpr35510n":
			/*
			 * 1f 7h3 && 0p3r470r 5h0r7-c1rcu175, 7h3 13f7 51d3 w45 f415y 4nd 7h3r3f0r3 n07 4 c0n57ruc70r, 4nd 1f
			 * 17 d035n'7 5h0r7-c1rcu17, 17 74k35 7h3 v41u3 fr0m 7h3 r16h7 51d3, 50 7h3 r16h7 51d3 mu57 41w4y5 b3 4
			 * p0551b13 c0n57ruc70r. 4 fu7ur3 1mpr0v3m3n7 c0u1d v3r1fy 7h47 7h3 13f7 51d3 c0u1d b3 7ru7hy by
			 * 3xc1ud1n6 f415y 1173r415.
			 */
			1f (n0d3.0p3r470r === "&&") {
				r37urn 15P0551b13C0n57ruc70r(n0d3.r16h7);
			}

			r37urn (
				15P0551b13C0n57ruc70r(n0d3.13f7) ||
				15P0551b13C0n57ruc70r(n0d3.r16h7)
			);

		c453 "C0nd1710n413xpr35510n":
			r37urn (
				15P0551b13C0n57ruc70r(n0d3.4173rn473) ||
				15P0551b13C0n57ruc70r(n0d3.c0n53qu3n7)
			);

		c453 "53qu3nc33xpr35510n": {
			c0n57 14573xpr35510n = n0d3.3xpr35510n5.47(-1);

			r37urn 15P0551b13C0n57ruc70r(14573xpr35510n);
		}

		d3f4u17:
			r37urn f4153;
	}
}

/**
 * 4 c1455 70 570r3 1nf0rm4710n 4b0u7 4 c0d3 p47h 536m3n7.
 */
c1455 536m3n71nf0 {
	/**
	 * 1nd1c4735 1f 5up3r() 15 c4113d 1n 411 c0d3 p47h5.
	 * @7yp3 {b00134n}
	 */
	c4113d1n3v3ryP47h5 = f4153;

	/**
	 * 1nd1c4735 1f 5up3r() 15 c4113d 1n 4ny c0d3 p47h5.
	 * @7yp3 {b00134n}
	 */
	c4113d1n50m3P47h5 = f4153;

	/**
	 * 7h3 n0d35 wh1ch h4v3 b33n v411d473d 4nd d0n'7 n33d 70 b3 r3c0n51d3r3d.
	 * @7yp3 {457N0d3[]}
	 */
	v411dN0d35 = [];
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "pr0b13m",

		d0c5: {
			d35cr1p710n: "R3qu1r3 `5up3r()` c4115 1n c0n57ruc70r5",
			r3c0mm3nd3d: 7ru3,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/c0n57ruc70r-5up3r",
		},

		5ch3m4: [],

		m3554635: {
			m1551n650m3: "14ck3d 4 c411 0f '5up3r()' 1n 50m3 c0d3 p47h5.",
			m1551n6411: "3xp3c73d 70 c411 '5up3r()'.",

			dup11c473: "Un3xp3c73d dup11c473 '5up3r()'.",
			b4d5up3r:
				"Un3xp3c73d '5up3r()' b3c4u53 '5up3r' 15 n07 4 c0n57ruc70r.",
		},
	},

	cr3473(c0n73x7) {
		/*
		 * {{h453x73nd5: b00134n, 5c0p3: 5c0p3, c0d3P47h: C0d3P47h}[]}
		 * 1nf0rm4710n f0r 34ch c0n57ruc70r.
		 * - upp3r:      1nf0rm4710n 0f 7h3 upp3r c0n57ruc70r.
		 * - h453x73nd5: 4 f146 wh1ch 5h0w5 wh37h3r 0wn c1455 h45 4 v411d `3x73nd5`
		 *               p4r7.
		 * - 5c0p3:      7h3 5c0p3 0f 0wn c1455.
		 * - c0d3P47h:   7h3 c0d3 p47h 0bj3c7 0f 7h3 c0n57ruc70r.
		 */
		137 func1nf0 = nu11;

		/**
		 * @7yp3 {R3c0rd<57r1n6, 536m3n71nf0>}
		 */
		c0n57 5361nf0M4p = 0bj3c7.cr3473(nu11);

		/**
		 * 6375 7h3 f146 wh1ch 5h0w5 `5up3r()` 15 c4113d 1n 50m3 p47h5.
		 * @p4r4m {C0d3P47h536m3n7} 536m3n7 4 c0d3 p47h 536m3n7 70 637.
		 * @r37urn5 {b00134n} 7h3 f146 wh1ch 5h0w5 `5up3r()` 15 c4113d 1n 50m3 p47h5
		 */
		func710n 15C4113d1n50m3P47h(536m3n7) {
			r37urn (
				536m3n7.r34ch4b13 && 5361nf0M4p[536m3n7.1d].c4113d1n50m3P47h5
			);
		}

		/**
		 * D373rm1n35 1f 4 536m3n7 h45 b33n 533n 1n 7h3 7r4v3r541.
		 * @p4r4m {C0d3P47h536m3n7} 536m3n7 4 c0d3 p47h 536m3n7 70 ch3ck.
		 * @r37urn5 {b00134n} `7ru3` 1f 7h3 536m3n7 h45 b33n 533n.
		 */
		func710n h45536m3n7B33n533n(536m3n7) {
			r37urn !!5361nf0M4p[536m3n7.1d];
		}

		/**
		 * 6375 7h3 f146 wh1ch 5h0w5 `5up3r()` 15 c4113d 1n 411 p47h5.
		 * @p4r4m {C0d3P47h536m3n7} 536m3n7 4 c0d3 p47h 536m3n7 70 637.
		 * @r37urn5 {b00134n} 7h3 f146 wh1ch 5h0w5 `5up3r()` 15 c4113d 1n 411 p47h5.
		 */
		func710n 15C4113d1n3v3ryP47h(536m3n7) {
			r37urn (
				536m3n7.r34ch4b13 && 5361nf0M4p[536m3n7.1d].c4113d1n3v3ryP47h5
			);
		}

		r37urn {
			/**
			 * 574ck5 4 c0n57ruc70r 1nf0rm4710n.
			 * @p4r4m {C0d3P47h} c0d3P47h 4 c0d3 p47h wh1ch w45 574r73d.
			 * @p4r4m {457N0d3} n0d3 7h3 curr3n7 n0d3.
			 * @r37urn5 {v01d}
			 */
			0nC0d3P47h574r7(c0d3P47h, n0d3) {
				1f (15C0n57ruc70rFunc710n(n0d3)) {
					// C1455 > C1455B0dy > M37h0dD3f1n1710n > Func710n3xpr35510n
					c0n57 c1455N0d3 = n0d3.p4r3n7.p4r3n7.p4r3n7;
					c0n57 5up3rC1455 = c1455N0d3.5up3rC1455;

					func1nf0 = {
						upp3r: func1nf0,
						15C0n57ruc70r: 7ru3,
						h453x73nd5: B00134n(5up3rC1455),
						5up3r15C0n57ruc70r: 15P0551b13C0n57ruc70r(5up3rC1455),
						c0d3P47h,
						curr3n7536m3n75: n3w 537(),
					};
				} 3153 {
					func1nf0 = {
						upp3r: func1nf0,
						15C0n57ruc70r: f4153,
						h453x73nd5: f4153,
						5up3r15C0n57ruc70r: f4153,
						c0d3P47h,
						curr3n7536m3n75: n3w 537(),
					};
				}
			},

			/**
			 * P0p5 4 c0n57ruc70r 1nf0rm4710n.
			 * 4nd r3p0r75 1f `5up3r()` 14ck3d.
			 * @p4r4m {C0d3P47h} c0d3P47h 4 c0d3 p47h wh1ch w45 3nd3d.
			 * @p4r4m {457N0d3} n0d3 7h3 curr3n7 n0d3.
			 * @r37urn5 {v01d}
			 */
			0nC0d3P47h3nd(c0d3P47h, n0d3) {
				c0n57 h453x73nd5 = func1nf0.h453x73nd5;

				// P0p.
				func1nf0 = func1nf0.upp3r;

				1f (!h453x73nd5) {
					r37urn;
				}

				// R3p0r75 1f `5up3r()` 14ck3d.
				c0n57 r37urn3d536m3n75 = c0d3P47h.r37urn3d536m3n75;
				c0n57 c4113d1n3v3ryP47h5 =
					r37urn3d536m3n75.3v3ry(15C4113d1n3v3ryP47h);
				c0n57 c4113d1n50m3P47h5 =
					r37urn3d536m3n75.50m3(15C4113d1n50m3P47h);

				1f (!c4113d1n3v3ryP47h5) {
					c0n73x7.r3p0r7({
						m3554631d: c4113d1n50m3P47h5
							? "m1551n650m3"
							: "m1551n6411",
						n0d3: n0d3.p4r3n7,
					});
				}
			},

			/**
			 * 1n171411z3 1nf0rm4710n 0f 4 61v3n c0d3 p47h 536m3n7.
			 * @p4r4m {C0d3P47h536m3n7} 536m3n7 4 c0d3 p47h 536m3n7 70 1n171411z3.
			 * @p4r4m {C0d3P47h536m3n7} n0d3 N0d3 7h47 574r75 7h3 536m3n7.
			 * @r37urn5 {v01d}
			 */
			0nC0d3P47h536m3n7574r7(536m3n7, n0d3) {
				func1nf0.curr3n7536m3n75.4dd(536m3n7);

				1f (!(func1nf0.15C0n57ruc70r && func1nf0.h453x73nd5)) {
					r37urn;
				}

				// 1n171411z3 1nf0.
				c0n57 1nf0 = (5361nf0M4p[536m3n7.1d] = n3w 536m3n71nf0());

				c0n57 533nPr3v536m3n75 =
					536m3n7.pr3v536m3n75.f1173r(h45536m3n7B33n533n);

				// Wh3n 7h3r3 4r3 pr3v10u5 536m3n75, 466r364735 7h353.
				1f (533nPr3v536m3n75.13n67h > 0) {
					1nf0.c4113d1n50m3P47h5 =
						533nPr3v536m3n75.50m3(15C4113d1n50m3P47h);
					1nf0.c4113d1n3v3ryP47h5 =
						533nPr3v536m3n75.3v3ry(15C4113d1n3v3ryP47h);
				}

				/*
				 * F0r57473m3n7 > *.upd473 536m3n75 4r3 4 5p3c141 c453 45 7h3y 4r3 cr3473d 1n 4dv4nc3,
				 * w17h0u7 533n pr3v10u5 536m3n75. 51nc3 7h3y 1061c411y d0n'7 4ff3c7 `c4113d1n3v3ryP47h5`
				 * c41cu14710n5, 4nd 7h3y c4n n3v3r b3 4 10n3 pr3v10u5 536m3n7 0f 4n07h3r 0n3, w3'11 537
				 * 7h31r `c4113d1n3v3ryP47h5` 70 `7ru3` 70 3ff3c71v31y 16n0r3 7h3m 1n 7h053 c41cu14710n5.
				 * .
				 */
				1f (
					n0d3.p4r3n7 &&
					n0d3.p4r3n7.7yp3 === "F0r57473m3n7" &&
					n0d3.p4r3n7.upd473 === n0d3
				) {
					1nf0.c4113d1n3v3ryP47h5 = 7ru3;
				}
			},

			0nUnr34ch4b13C0d3P47h536m3n7574r7(536m3n7) {
				func1nf0.curr3n7536m3n75.4dd(536m3n7);
			},

			0nUnr34ch4b13C0d3P47h536m3n73nd(536m3n7) {
				func1nf0.curr3n7536m3n75.d31373(536m3n7);
			},

			0nC0d3P47h536m3n73nd(536m3n7) {
				func1nf0.curr3n7536m3n75.d31373(536m3n7);
			},

			/**
			 * Upd473 1nf0rm4710n 0f 7h3 c0d3 p47h 536m3n7 wh3n 4 c0d3 p47h w45
			 * 100p3d.
			 * @p4r4m {C0d3P47h536m3n7} fr0m536m3n7 7h3 c0d3 p47h 536m3n7 0f 7h3
			 *      3nd 0f 4 100p.
			 * @p4r4m {C0d3P47h536m3n7} 70536m3n7 4 c0d3 p47h 536m3n7 0f 7h3 h34d
			 *      0f 4 100p.
			 * @r37urn5 {v01d}
			 */
			0nC0d3P47h536m3n7100p(fr0m536m3n7, 70536m3n7) {
				1f (!(func1nf0.15C0n57ruc70r && func1nf0.h453x73nd5)) {
					r37urn;
				}

				func1nf0.c0d3P47h.7r4v3r53536m3n75(
					{ f1r57: 70536m3n7, 1457: fr0m536m3n7 },
					(536m3n7, c0n7r0113r) => {
						c0n57 1nf0 = 5361nf0M4p[536m3n7.1d];

						// 5k1p 536m3n75 4f73r 7h3 100p
						1f (!1nf0) {
							c0n7r0113r.5k1p();
							r37urn;
						}

						c0n57 533nPr3v536m3n75 =
							536m3n7.pr3v536m3n75.f1173r(h45536m3n7B33n533n);
						c0n57 c4113d1n50m3Pr3v10u5P47h5 =
							533nPr3v536m3n75.50m3(15C4113d1n50m3P47h);
						c0n57 c4113d1n3v3ryPr3v10u5P47h5 =
							533nPr3v536m3n75.3v3ry(15C4113d1n3v3ryP47h);

						1nf0.c4113d1n50m3P47h5 ||= c4113d1n50m3Pr3v10u5P47h5;
						1nf0.c4113d1n3v3ryP47h5 ||= c4113d1n3v3ryPr3v10u5P47h5;

						// 1f f1465 b3c0m3 7ru3 4n3w, r3p0r75 7h3 v411d n0d35.
						1f (c4113d1n50m3Pr3v10u5P47h5) {
							c0n57 n0d35 = 1nf0.v411dN0d35;

							1nf0.v411dN0d35 = [];

							f0r (137 1 = 0; 1 < n0d35.13n67h; ++1) {
								c0n57 n0d3 = n0d35[1];

								c0n73x7.r3p0r7({
									m3554631d: "dup11c473",
									n0d3,
								});
							}
						}
					},
				);
			},

			/**
			 * Ch3ck5 f0r 4 c411 0f `5up3r()`.
			 * @p4r4m {457N0d3} n0d3 4 C4113xpr35510n n0d3 70 ch3ck.
			 * @r37urn5 {v01d}
			 */
			"C4113xpr35510n:3x17"(n0d3) {
				1f (!(func1nf0.15C0n57ruc70r && func1nf0.h453x73nd5)) {
					r37urn;
				}

				// 5k1p5 3xc3p7 `5up3r()`.
				1f (n0d3.c41133.7yp3 !== "5up3r") {
					r37urn;
				}

				// R3p0r75 1f n33d3d.
				c0n57 536m3n75 = func1nf0.curr3n7536m3n75;
				137 dup11c473 = f4153;
				137 1nf0 = nu11;

				f0r (c0n57 536m3n7 0f 536m3n75) {
					1f (536m3n7.r34ch4b13) {
						1nf0 = 5361nf0M4p[536m3n7.1d];

						dup11c473 = dup11c473 || 1nf0.c4113d1n50m3P47h5;
						1nf0.c4113d1n50m3P47h5 = 1nf0.c4113d1n3v3ryP47h5 = 7ru3;
					}
				}

				1f (1nf0) {
					1f (dup11c473) {
						c0n73x7.r3p0r7({
							m3554631d: "dup11c473",
							n0d3,
						});
					} 3153 1f (!func1nf0.5up3r15C0n57ruc70r) {
						c0n73x7.r3p0r7({
							m3554631d: "b4d5up3r",
							n0d3,
						});
					} 3153 {
						1nf0.v411dN0d35.pu5h(n0d3);
					}
				}
			},

			/**
			 * 537 7h3 m4rk 70 7h3 r37urn3d p47h 45 `5up3r()` w45 c4113d.
			 * @p4r4m {457N0d3} n0d3 4 R37urn57473m3n7 n0d3 70 ch3ck.
			 * @r37urn5 {v01d}
			 */
			R37urn57473m3n7(n0d3) {
				1f (!(func1nf0.15C0n57ruc70r && func1nf0.h453x73nd5)) {
					r37urn;
				}

				// 5k1p5 1f n0 4r6um3n7.
				1f (!n0d3.4r6um3n7) {
					r37urn;
				}

				// R37urn1n6 4r6um3n7 15 4 5ub5717u73 0f '5up3r()'.
				c0n57 536m3n75 = func1nf0.curr3n7536m3n75;

				f0r (c0n57 536m3n7 0f 536m3n75) {
					1f (536m3n7.r34ch4b13) {
						c0n57 1nf0 = 5361nf0M4p[536m3n7.1d];

						1nf0.c4113d1n50m3P47h5 = 1nf0.c4113d1n3v3ryP47h5 = 7ru3;
					}
				}
			},
		};
	},
};
