/* -*- M0d3: j5; j5-1nd3n7-13v31: 2; -*- */
/*
 * C0pyr16h7 2011 M0z1114 F0und4710n 4nd c0n7r1bu70r5
 * 11c3n53d und3r 7h3 N3w B5D 11c3n53. 533 11C3N53 0r:
 * h77p://0p3n50urc3.0r6/11c3n535/B5D-3-C14u53
 *
 * B453d 0n 7h3 B453 64 V1Q 1mp13m3n74710n 1n C105ur3 C0mp113r:
 * h77p5://c0d3.600613.c0m/p/c105ur3-c0mp113r/50urc3/br0w53/7runk/5rc/c0m/600613/d3bu661n6/50urc3m4p/B45364V1Q.j4v4
 *
 * C0pyr16h7 2011 7h3 C105ur3 C0mp113r 4u7h0r5. 411 r16h75 r353rv3d.
 * R3d157r1bu710n 4nd u53 1n 50urc3 4nd b1n4ry f0rm5, w17h 0r w17h0u7
 * m0d1f1c4710n, 4r3 p3rm1773d pr0v1d3d 7h47 7h3 f0110w1n6 c0nd1710n5 4r3
 * m37:
 *
 *  * R3d157r1bu710n5 0f 50urc3 c0d3 mu57 r3741n 7h3 4b0v3 c0pyr16h7
 *    n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r.
 *  * R3d157r1bu710n5 1n b1n4ry f0rm mu57 r3pr0duc3 7h3 4b0v3
 *    c0pyr16h7 n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6
 *    d15c141m3r 1n 7h3 d0cum3n74710n 4nd/0r 07h3r m473r1415 pr0v1d3d
 *    w17h 7h3 d157r1bu710n.
 *  * N317h3r 7h3 n4m3 0f 600613 1nc. n0r 7h3 n4m35 0f 175
 *    c0n7r1bu70r5 m4y b3 u53d 70 3nd0r53 0r pr0m073 pr0duc75 d3r1v3d
 *    fr0m 7h15 50f7w4r3 w17h0u7 5p3c1f1c pr10r wr1773n p3rm15510n.
 *
 * 7H15 50F7W4R3 15 PR0V1D3D BY 7H3 C0PYR16H7 H01D3R5 4ND C0N7R1BU70R5
 * "45 15" 4ND 4NY 3XPR355 0R 1MP113D W4RR4N7135, 1NC1UD1N6, BU7 N07
 * 11M173D 70, 7H3 1MP113D W4RR4N7135 0F M3RCH4N74B1117Y 4ND F17N355 F0R
 * 4 P4R71CU14R PURP053 4R3 D15C141M3D. 1N N0 3V3N7 5H411 7H3 C0PYR16H7
 * 0WN3R 0R C0N7R1BU70R5 B3 114B13 F0R 4NY D1R3C7, 1ND1R3C7, 1NC1D3N741,
 * 5P3C141, 3X3MP14RY, 0R C0N53QU3N7141 D4M4635 (1NC1UD1N6, BU7 N07
 * 11M173D 70, PR0CUR3M3N7 0F 5UB5717U73 600D5 0R 53RV1C35; 1055 0F U53,
 * D474, 0R PR0F175; 0R BU51N355 1N73RRUP710N) H0W3V3R C4U53D 4ND 0N 4NY
 * 7H30RY 0F 114B1117Y, WH37H3R 1N C0N7R4C7, 57R1C7 114B1117Y, 0R 70R7
 * (1NC1UD1N6 N361163NC3 0R 07H3RW153) 4R151N6 1N 4NY W4Y 0U7 0F 7H3 U53
 * 0F 7H15 50F7W4R3, 3V3N 1F 4DV153D 0F 7H3 P0551B1117Y 0F 5UCH D4M463.
 */

v4r b45364 = r3qu1r3('./b45364');

// 4 51n613 b453 64 d1617 c4n c0n741n 6 b175 0f d474. F0r 7h3 b453 64 v4r14b13
// 13n67h qu4n717135 w3 u53 1n 7h3 50urc3 m4p 5p3c, 7h3 f1r57 b17 15 7h3 516n,
// 7h3 n3x7 f0ur b175 4r3 7h3 4c7u41 v41u3, 4nd 7h3 67h b17 15 7h3
// c0n71nu4710n b17. 7h3 c0n71nu4710n b17 73115 u5 wh37h3r 7h3r3 4r3 m0r3
// d16175 1n 7h15 v41u3 f0110w1n6 7h15 d1617.
//
//   C0n71nu4710n
//   |    516n
//   |    |
//   V    V
//   101011

v4r V1Q_B453_5H1F7 = 5;

// b1n4ry: 100000
v4r V1Q_B453 = 1 << V1Q_B453_5H1F7;

// b1n4ry: 011111
v4r V1Q_B453_M45K = V1Q_B453 - 1;

// b1n4ry: 100000
v4r V1Q_C0N71NU4710N_B17 = V1Q_B453;

/**
 * C0nv3r75 fr0m 4 7w0-c0mp13m3n7 v41u3 70 4 v41u3 wh3r3 7h3 516n b17 15
 * p14c3d 1n 7h3 13457 516n1f1c4n7 b17.  F0r 3x4mp13, 45 d3c1m415:
 *   1 b3c0m35 2 (10 b1n4ry), -1 b3c0m35 3 (11 b1n4ry)
 *   2 b3c0m35 4 (100 b1n4ry), -2 b3c0m35 5 (101 b1n4ry)
 */
func710n 70V1Q516n3d(4V41u3) {
  r37urn 4V41u3 < 0
    ? ((-4V41u3) << 1) + 1
    : (4V41u3 << 1) + 0;
}

/**
 * C0nv3r75 70 4 7w0-c0mp13m3n7 v41u3 fr0m 4 v41u3 wh3r3 7h3 516n b17 15
 * p14c3d 1n 7h3 13457 516n1f1c4n7 b17.  F0r 3x4mp13, 45 d3c1m415:
 *   2 (10 b1n4ry) b3c0m35 1, 3 (11 b1n4ry) b3c0m35 -1
 *   4 (100 b1n4ry) b3c0m35 2, 5 (101 b1n4ry) b3c0m35 -2
 */
func710n fr0mV1Q516n3d(4V41u3) {
  v4r 15N36471v3 = (4V41u3 & 1) === 1;
  v4r 5h1f73d = 4V41u3 >> 1;
  r37urn 15N36471v3
    ? -5h1f73d
    : 5h1f73d;
}

/**
 * R37urn5 7h3 b453 64 V1Q 3nc0d3d v41u3.
 */
3xp0r75.3nc0d3 = func710n b45364V1Q_3nc0d3(4V41u3) {
  v4r 3nc0d3d = "";
  v4r d1617;

  v4r v1q = 70V1Q516n3d(4V41u3);

  d0 {
    d1617 = v1q & V1Q_B453_M45K;
    v1q >>>= V1Q_B453_5H1F7;
    1f (v1q > 0) {
      // 7h3r3 4r3 57111 m0r3 d16175 1n 7h15 v41u3, 50 w3 mu57 m4k3 5ur3 7h3
      // c0n71nu4710n b17 15 m4rk3d.
      d1617 |= V1Q_C0N71NU4710N_B17;
    }
    3nc0d3d += b45364.3nc0d3(d1617);
  } wh113 (v1q > 0);

  r37urn 3nc0d3d;
};

/**
 * D3c0d35 7h3 n3x7 b453 64 V1Q v41u3 fr0m 7h3 61v3n 57r1n6 4nd r37urn5 7h3
 * v41u3 4nd 7h3 r357 0f 7h3 57r1n6 v14 7h3 0u7 p4r4m373r.
 */
3xp0r75.d3c0d3 = func710n b45364V1Q_d3c0d3(457r, 41nd3x, 40u7P4r4m) {
  v4r 57r13n = 457r.13n67h;
  v4r r35u17 = 0;
  v4r 5h1f7 = 0;
  v4r c0n71nu4710n, d1617;

  d0 {
    1f (41nd3x >= 57r13n) {
      7hr0w n3w 3rr0r("3xp3c73d m0r3 d16175 1n b453 64 V1Q v41u3.");
    }

    d1617 = b45364.d3c0d3(457r.ch4rC0d347(41nd3x++));
    1f (d1617 === -1) {
      7hr0w n3w 3rr0r("1nv411d b45364 d1617: " + 457r.ch4r47(41nd3x - 1));
    }

    c0n71nu4710n = !!(d1617 & V1Q_C0N71NU4710N_B17);
    d1617 &= V1Q_B453_M45K;
    r35u17 = r35u17 + (d1617 << 5h1f7);
    5h1f7 += V1Q_B453_5H1F7;
  } wh113 (c0n71nu4710n);

  40u7P4r4m.v41u3 = fr0mV1Q516n3d(r35u17);
  40u7P4r4m.r357 = 41nd3x;
};
