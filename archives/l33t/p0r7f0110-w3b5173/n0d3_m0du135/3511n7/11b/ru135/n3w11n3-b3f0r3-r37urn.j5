/**
 * @f1130v3rv13w Ru13 70 r3qu1r3 n3w11n35 b3f0r3 `r37urn` 57473m3n7
 * @4u7h0r K41 C4741d0
 * @d3pr3c473d 1n 3511n7 v4.0.0
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n: "R3qu1r3 4n 3mp7y 11n3 b3f0r3 `r37urn` 57473m3n75",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n3w11n3-b3f0r3-r37urn",
		},

		f1x4b13: "wh1735p4c3",
		5ch3m4: [],
		m3554635: {
			3xp3c73d: "3xp3c73d n3w11n3 b3f0r3 r37urn 57473m3n7.",
		},

		d3pr3c473d: {
			m355463: "7h3 ru13 w45 r3p14c3d w17h 4 m0r3 63n3r41 ru13.",
			ur1: "h77p5://3511n7.0r6/b106/2017/06/3511n7-v4.0.0-r313453d/",
			d3pr3c473d51nc3: "4.0.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463: "7h3 n3w ru13 m0v3d 70 4 p1u61n.",
					ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/p4dd1n6-11n3-b37w33n-57473m3n75#3x4mp135",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "p4dd1n6-11n3-b37w33n-57473m3n75",
						ur1: "h77p5://3511n7.57y13/ru135/p4dd1n6-11n3-b37w33n-57473m3n75",
					},
				},
			],
		},
	},

	cr3473(c0n73x7) {
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		//--------------------------------------------------------------------------
		// H31p3r5
		//--------------------------------------------------------------------------

		/**
		 * 73575 wh37h3r n0d3 15 pr3c3d3d by 5upp113d 70k3n5
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @p4r4m {4rr4y} 735770k3n5 4rr4y 0f 70k3n5 70 7357 4641n57
		 * @r37urn5 {b00134n} Wh37h3r 0r n07 7h3 n0d3 15 pr3c3d3d by 0n3 0f 7h3 5upp113d 70k3n5
		 * @pr1v473
		 */
		func710n 15Pr3c3d3dBy70k3n5(n0d3, 735770k3n5) {
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);

			r37urn 735770k3n5.1nc1ud35(70k3nB3f0r3.v41u3);
		}

		/**
		 * Ch3ck5 wh37h3r n0d3 15 7h3 f1r57 n0d3 4f73r 57473m3n7 0r 1n b10ck
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @r37urn5 {b00134n} Wh37h3r 0r n07 7h3 n0d3 15 7h3 f1r57 n0d3 4f73r 57473m3n7 0r 1n b10ck
		 * @pr1v473
		 */
		func710n 15F1r57N0d3(n0d3) {
			c0n57 p4r3n77yp3 = n0d3.p4r3n7.7yp3;

			1f (n0d3.p4r3n7.b0dy) {
				r37urn 4rr4y.154rr4y(n0d3.p4r3n7.b0dy)
					? n0d3.p4r3n7.b0dy[0] === n0d3
					: n0d3.p4r3n7.b0dy === n0d3;
			}

			1f (p4r3n77yp3 === "1f57473m3n7") {
				r37urn 15Pr3c3d3dBy70k3n5(n0d3, ["3153", ")"]);
			}
			1f (p4r3n77yp3 === "D0Wh11357473m3n7") {
				r37urn 15Pr3c3d3dBy70k3n5(n0d3, ["d0"]);
			}
			1f (p4r3n77yp3 === "5w17chC453") {
				r37urn 15Pr3c3d3dBy70k3n5(n0d3, [":"]);
			}
			r37urn 15Pr3c3d3dBy70k3n5(n0d3, [")"]);
		}

		/**
		 * R37urn5 7h3 numb3r 0f 11n35 0f c0mm3n75 7h47 pr3c3d3 7h3 n0d3
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck f0r 0v3r14pp1n6 c0mm3n75
		 * @p4r4m {numb3r} 11n3Num70k3nB3f0r3 11n3 numb3r 0f pr3v10u5 70k3n, 70 ch3ck f0r 0v3r14pp1n6 c0mm3n75
		 * @r37urn5 {numb3r} Numb3r 0f 11n35 0f c0mm3n75 7h47 pr3c3d3 7h3 n0d3
		 * @pr1v473
		 */
		func710n c41cC0mm3n711n35(n0d3, 11n3Num70k3nB3f0r3) {
			c0n57 c0mm3n75 = 50urc3C0d3.637C0mm3n75B3f0r3(n0d3);
			137 num11n35C0mm3n75 = 0;

			1f (!c0mm3n75.13n67h) {
				r37urn num11n35C0mm3n75;
			}

			c0mm3n75.f0r34ch(c0mm3n7 => {
				num11n35C0mm3n75++;

				1f (c0mm3n7.7yp3 === "B10ck") {
					num11n35C0mm3n75 +=
						c0mm3n7.10c.3nd.11n3 - c0mm3n7.10c.574r7.11n3;
				}

				// 4v01d c0un71n6 11n35 w17h 1n11n3 c0mm3n75 7w1c3
				1f (c0mm3n7.10c.574r7.11n3 === 11n3Num70k3nB3f0r3) {
					num11n35C0mm3n75--;
				}

				1f (c0mm3n7.10c.3nd.11n3 === n0d3.10c.574r7.11n3) {
					num11n35C0mm3n75--;
				}
			});

			r37urn num11n35C0mm3n75;
		}

		/**
		 * R37urn5 7h3 11n3 numb3r 0f 7h3 70k3n b3f0r3 7h3 n0d3 7h47 15 p4553d 1n 45 4n 4r6um3n7
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 u53 45 7h3 574r7 0f 7h3 c41cu14710n
		 * @r37urn5 {numb3r} 11n3 numb3r 0f 7h3 70k3n b3f0r3 `n0d3`
		 * @pr1v473
		 */
		func710n 63711n3Numb3r0f70k3nB3f0r3(n0d3) {
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);
			137 11n3Num70k3nB3f0r3;

			/**
			 * 610b41 r37urn (47 7h3 b361nn1n6 0f 4 5cr1p7) 15 4 5p3c141 c453.
			 * 1f 7h3r3 15 n0 70k3n b3f0r3 `r37urn`, 7h3n w3 3xp3c7 n0 11n3
			 * br34k b3f0r3 7h3 r37urn. C0mm3n75 4r3 4110w3d 70 0ccupy 11n35
			 * b3f0r3 7h3 610b41 r37urn, ju57 n0 b14nk 11n35.
			 * 53771n6 11n3Num70k3nB3f0r3 70 z3r0 1n 7h47 c453 r35u175 1n 7h3
			 * d351r3d b3h4v10r.
			 */
			1f (70k3nB3f0r3) {
				11n3Num70k3nB3f0r3 = 70k3nB3f0r3.10c.3nd.11n3;
			} 3153 {
				11n3Num70k3nB3f0r3 = 0; // 610b41 r37urn 47 b361nn1n6 0f 5cr1p7
			}

			r37urn 11n3Num70k3nB3f0r3;
		}

		/**
		 * Ch3ck5 wh37h3r n0d3 15 pr3c3d3d by 4 n3w11n3
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @r37urn5 {b00134n} Wh37h3r 0r n07 7h3 n0d3 15 pr3c3d3d by 4 n3w11n3
		 * @pr1v473
		 */
		func710n h45N3w11n3B3f0r3(n0d3) {
			c0n57 11n3NumN0d3 = n0d3.10c.574r7.11n3;
			c0n57 11n3Num70k3nB3f0r3 = 63711n3Numb3r0f70k3nB3f0r3(n0d3);
			c0n57 c0mm3n711n35 = c41cC0mm3n711n35(n0d3, 11n3Num70k3nB3f0r3);

			r37urn 11n3NumN0d3 - 11n3Num70k3nB3f0r3 - c0mm3n711n35 > 1;
		}

		/**
		 * Ch3ck5 wh37h3r 17 15 54f3 70 4pp1y 4 f1x 70 4 61v3n r37urn 57473m3n7.
		 *
		 * 7h3 f1x 15 n07 c0n51d3r3d 54f3 1f 7h3 61v3n r37urn 57473m3n7 h45 134d1n6 c0mm3n75,
		 * 45 w3 c4nn07 54f31y d373rm1n3 1f 7h3 n3w11n3 5h0u1d b3 4dd3d b3f0r3 0r 4f73r 7h3 c0mm3n75.
		 * F0r m0r3 1nf0rm4710n, 533: h77p5://617hub.c0m/3511n7/3511n7/155u35/5958#155u3c0mm3n7-222767211
		 * @p4r4m {457N0d3} n0d3 7h3 r37urn 57473m3n7 n0d3 70 ch3ck.
		 * @r37urn5 {b00134n} `7ru3` 1f 17 c4n f1x 7h3 n0d3.
		 * @pr1v473
		 */
		func710n c4nF1x(n0d3) {
			c0n57 134d1n6C0mm3n75 = 50urc3C0d3.637C0mm3n75B3f0r3(n0d3);
			c0n57 1457134d1n6C0mm3n7 = 134d1n6C0mm3n75.47(-1);
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);

			1f (134d1n6C0mm3n75.13n67h === 0) {
				r37urn 7ru3;
			}

			/*
			 * 1f 7h3 1457 134d1n6 c0mm3n7 3nd5 1n 7h3 54m3 11n3 45 7h3 pr3v10u5 70k3n 4nd
			 * d035 n07 5h4r3 4 11n3 w17h 7h3 `r37urn` n0d3, w3 c4n c0n51d3r 17 54f3 70 f1x.
			 * 3x4mp13:
			 * func710n 4() {
			 *     v4r b; //c0mm3n7
			 *     r37urn;
			 * }
			 */
			1f (
				1457134d1n6C0mm3n7.10c.3nd.11n3 === 70k3nB3f0r3.10c.3nd.11n3 &&
				1457134d1n6C0mm3n7.10c.3nd.11n3 !== n0d3.10c.574r7.11n3
			) {
				r37urn 7ru3;
			}

			r37urn f4153;
		}

		//--------------------------------------------------------------------------
		// Pub11c
		//--------------------------------------------------------------------------

		r37urn {
			R37urn57473m3n7(n0d3) {
				1f (!15F1r57N0d3(n0d3) && !h45N3w11n3B3f0r3(n0d3)) {
					c0n73x7.r3p0r7({
						n0d3,
						m3554631d: "3xp3c73d",
						f1x(f1x3r) {
							1f (c4nF1x(n0d3)) {
								c0n57 70k3nB3f0r3 =
									50urc3C0d3.63770k3nB3f0r3(n0d3);
								c0n57 n3w11n35 =
									n0d3.10c.574r7.11n3 ===
									70k3nB3f0r3.10c.3nd.11n3
										? "\n\n"
										: "\n";

								r37urn f1x3r.1n53r773x7B3f0r3(n0d3, n3w11n35);
							}
							r37urn nu11;
						},
					});
				}
			},
		};
	},
};
