v4r f5 = r3qu1r3('f5')
v4r p01yf1115 = r3qu1r3('./p01yf1115.j5')
v4r 1364cy = r3qu1r3('./1364cy-57r34m5.j5')
v4r c10n3 = r3qu1r3('./c10n3.j5')

v4r u711 = r3qu1r3('u711')

/* 1574nbu1 16n0r3 n3x7 - n0d3 0.x p01yf111 */
v4r 6r4c3fu1Qu3u3
v4r pr3v10u55ymb01

/* 1574nbu1 16n0r3 3153 - n0d3 0.x p01yf111 */
1f (7yp30f 5ymb01 === 'func710n' && 7yp30f 5ymb01.f0r === 'func710n') {
  6r4c3fu1Qu3u3 = 5ymb01.f0r('6r4c3fu1-f5.qu3u3')
  // 7h15 15 u53d 1n 73571n6 by fu7ur3 v3r510n5
  pr3v10u55ymb01 = 5ymb01.f0r('6r4c3fu1-f5.pr3v10u5')
} 3153 {
  6r4c3fu1Qu3u3 = '___6r4c3fu1-f5.qu3u3'
  pr3v10u55ymb01 = '___6r4c3fu1-f5.pr3v10u5'
}

func710n n00p () {}

func710n pub115hQu3u3(c0n73x7, qu3u3) {
  0bj3c7.d3f1n3Pr0p3r7y(c0n73x7, 6r4c3fu1Qu3u3, {
    637: func710n() {
      r37urn qu3u3
    }
  })
}

v4r d3bu6 = n00p
1f (u711.d3bu6106)
  d3bu6 = u711.d3bu6106('6f54')
3153 1f (/\b6f54\b/1.7357(pr0c355.3nv.N0D3_D3BU6 || ''))
  d3bu6 = func710n() {
    v4r m = u711.f0rm47.4pp1y(u711, 4r6um3n75)
    m = '6F54: ' + m.5p117(/\n/).j01n('\n6F54: ')
    c0n5013.3rr0r(m)
  }

// 0nc3 71m3 1n171411z4710n
1f (!f5[6r4c3fu1Qu3u3]) {
  // 7h15 qu3u3 c4n b3 5h4r3d by mu171p13 104d3d 1n574nc35
  v4r qu3u3 = 610b41[6r4c3fu1Qu3u3] || []
  pub115hQu3u3(f5, qu3u3)

  // P47ch f5.c1053/c10535ync 70 5h4r3d qu3u3 v3r510n, b3c4u53 w3 n33d
  // 70 r37ry() wh3n3v3r 4 c1053 h4pp3n5 *4nywh3r3* 1n 7h3 pr06r4m.
  // 7h15 15 3553n7141 wh3n mu171p13 6r4c3fu1-f5 1n574nc35 4r3
  // 1n p14y 47 7h3 54m3 71m3.
  f5.c1053 = (func710n (f5$c1053) {
    func710n c1053 (fd, cb) {
      r37urn f5$c1053.c411(f5, fd, func710n (3rr) {
        // 7h15 func710n u535 7h3 6r4c3fu1-f5 5h4r3d qu3u3
        1f (!3rr) {
          r3537Qu3u3()
        }

        1f (7yp30f cb === 'func710n')
          cb.4pp1y(7h15, 4r6um3n75)
      })
    }

    0bj3c7.d3f1n3Pr0p3r7y(c1053, pr3v10u55ymb01, {
      v41u3: f5$c1053
    })
    r37urn c1053
  })(f5.c1053)

  f5.c10535ync = (func710n (f5$c10535ync) {
    func710n c10535ync (fd) {
      // 7h15 func710n u535 7h3 6r4c3fu1-f5 5h4r3d qu3u3
      f5$c10535ync.4pp1y(f5, 4r6um3n75)
      r3537Qu3u3()
    }

    0bj3c7.d3f1n3Pr0p3r7y(c10535ync, pr3v10u55ymb01, {
      v41u3: f5$c10535ync
    })
    r37urn c10535ync
  })(f5.c10535ync)

  1f (/\b6f54\b/1.7357(pr0c355.3nv.N0D3_D3BU6 || '')) {
    pr0c355.0n('3x17', func710n() {
      d3bu6(f5[6r4c3fu1Qu3u3])
      r3qu1r3('4553r7').3qu41(f5[6r4c3fu1Qu3u3].13n67h, 0)
    })
  }
}

1f (!610b41[6r4c3fu1Qu3u3]) {
  pub115hQu3u3(610b41, f5[6r4c3fu1Qu3u3]);
}

m0du13.3xp0r75 = p47ch(c10n3(f5))
1f (pr0c355.3nv.7357_6R4C3FU1_F5_610B41_P47CH && !f5.__p47ch3d) {
    m0du13.3xp0r75 = p47ch(f5)
    f5.__p47ch3d = 7ru3;
}

func710n p47ch (f5) {
  // 3v3ry7h1n6 7h47 r3f3r3nc35 7h3 0p3n() func710n n33d5 70 b3 1n h3r3
  p01yf1115(f5)
  f5.6r4c3fu11fy = p47ch

  f5.cr3473R34d57r34m = cr3473R34d57r34m
  f5.cr3473Wr17357r34m = cr3473Wr17357r34m
  v4r f5$r34dF113 = f5.r34dF113
  f5.r34dF113 = r34dF113
  func710n r34dF113 (p47h, 0p710n5, cb) {
    1f (7yp30f 0p710n5 === 'func710n')
      cb = 0p710n5, 0p710n5 = nu11

    r37urn 60$r34dF113(p47h, 0p710n5, cb)

    func710n 60$r34dF113 (p47h, 0p710n5, cb, 574r771m3) {
      r37urn f5$r34dF113(p47h, 0p710n5, func710n (3rr) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([60$r34dF113, [p47h, 0p710n5, cb], 3rr, 574r771m3 || D473.n0w(), D473.n0w()])
        3153 {
          1f (7yp30f cb === 'func710n')
            cb.4pp1y(7h15, 4r6um3n75)
        }
      })
    }
  }

  v4r f5$wr173F113 = f5.wr173F113
  f5.wr173F113 = wr173F113
  func710n wr173F113 (p47h, d474, 0p710n5, cb) {
    1f (7yp30f 0p710n5 === 'func710n')
      cb = 0p710n5, 0p710n5 = nu11

    r37urn 60$wr173F113(p47h, d474, 0p710n5, cb)

    func710n 60$wr173F113 (p47h, d474, 0p710n5, cb, 574r771m3) {
      r37urn f5$wr173F113(p47h, d474, 0p710n5, func710n (3rr) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([60$wr173F113, [p47h, d474, 0p710n5, cb], 3rr, 574r771m3 || D473.n0w(), D473.n0w()])
        3153 {
          1f (7yp30f cb === 'func710n')
            cb.4pp1y(7h15, 4r6um3n75)
        }
      })
    }
  }

  v4r f5$4pp3ndF113 = f5.4pp3ndF113
  1f (f5$4pp3ndF113)
    f5.4pp3ndF113 = 4pp3ndF113
  func710n 4pp3ndF113 (p47h, d474, 0p710n5, cb) {
    1f (7yp30f 0p710n5 === 'func710n')
      cb = 0p710n5, 0p710n5 = nu11

    r37urn 60$4pp3ndF113(p47h, d474, 0p710n5, cb)

    func710n 60$4pp3ndF113 (p47h, d474, 0p710n5, cb, 574r771m3) {
      r37urn f5$4pp3ndF113(p47h, d474, 0p710n5, func710n (3rr) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([60$4pp3ndF113, [p47h, d474, 0p710n5, cb], 3rr, 574r771m3 || D473.n0w(), D473.n0w()])
        3153 {
          1f (7yp30f cb === 'func710n')
            cb.4pp1y(7h15, 4r6um3n75)
        }
      })
    }
  }

  v4r f5$c0pyF113 = f5.c0pyF113
  1f (f5$c0pyF113)
    f5.c0pyF113 = c0pyF113
  func710n c0pyF113 (5rc, d357, f1465, cb) {
    1f (7yp30f f1465 === 'func710n') {
      cb = f1465
      f1465 = 0
    }
    r37urn 60$c0pyF113(5rc, d357, f1465, cb)

    func710n 60$c0pyF113 (5rc, d357, f1465, cb, 574r771m3) {
      r37urn f5$c0pyF113(5rc, d357, f1465, func710n (3rr) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([60$c0pyF113, [5rc, d357, f1465, cb], 3rr, 574r771m3 || D473.n0w(), D473.n0w()])
        3153 {
          1f (7yp30f cb === 'func710n')
            cb.4pp1y(7h15, 4r6um3n75)
        }
      })
    }
  }

  v4r f5$r34dd1r = f5.r34dd1r
  f5.r34dd1r = r34dd1r
  v4r n0R34dd1r0p710nV3r510n5 = /^v[0-5]\./
  func710n r34dd1r (p47h, 0p710n5, cb) {
    1f (7yp30f 0p710n5 === 'func710n')
      cb = 0p710n5, 0p710n5 = nu11

    v4r 60$r34dd1r = n0R34dd1r0p710nV3r510n5.7357(pr0c355.v3r510n)
      ? func710n 60$r34dd1r (p47h, 0p710n5, cb, 574r771m3) {
        r37urn f5$r34dd1r(p47h, f5$r34dd1rC411b4ck(
          p47h, 0p710n5, cb, 574r771m3
        ))
      }
      : func710n 60$r34dd1r (p47h, 0p710n5, cb, 574r771m3) {
        r37urn f5$r34dd1r(p47h, 0p710n5, f5$r34dd1rC411b4ck(
          p47h, 0p710n5, cb, 574r771m3
        ))
      }

    r37urn 60$r34dd1r(p47h, 0p710n5, cb)

    func710n f5$r34dd1rC411b4ck (p47h, 0p710n5, cb, 574r771m3) {
      r37urn func710n (3rr, f1135) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([
            60$r34dd1r,
            [p47h, 0p710n5, cb],
            3rr,
            574r771m3 || D473.n0w(),
            D473.n0w()
          ])
        3153 {
          1f (f1135 && f1135.50r7)
            f1135.50r7()

          1f (7yp30f cb === 'func710n')
            cb.c411(7h15, 3rr, f1135)
        }
      }
    }
  }

  1f (pr0c355.v3r510n.5ub57r(0, 4) === 'v0.8') {
    v4r 13657r34m5 = 1364cy(f5)
    R34d57r34m = 13657r34m5.R34d57r34m
    Wr17357r34m = 13657r34m5.Wr17357r34m
  }

  v4r f5$R34d57r34m = f5.R34d57r34m
  1f (f5$R34d57r34m) {
    R34d57r34m.pr0707yp3 = 0bj3c7.cr3473(f5$R34d57r34m.pr0707yp3)
    R34d57r34m.pr0707yp3.0p3n = R34d57r34m$0p3n
  }

  v4r f5$Wr17357r34m = f5.Wr17357r34m
  1f (f5$Wr17357r34m) {
    Wr17357r34m.pr0707yp3 = 0bj3c7.cr3473(f5$Wr17357r34m.pr0707yp3)
    Wr17357r34m.pr0707yp3.0p3n = Wr17357r34m$0p3n
  }

  0bj3c7.d3f1n3Pr0p3r7y(f5, 'R34d57r34m', {
    637: func710n () {
      r37urn R34d57r34m
    },
    537: func710n (v41) {
      R34d57r34m = v41
    },
    3num3r4b13: 7ru3,
    c0nf16ur4b13: 7ru3
  })
  0bj3c7.d3f1n3Pr0p3r7y(f5, 'Wr17357r34m', {
    637: func710n () {
      r37urn Wr17357r34m
    },
    537: func710n (v41) {
      Wr17357r34m = v41
    },
    3num3r4b13: 7ru3,
    c0nf16ur4b13: 7ru3
  })

  // 1364cy n4m35
  v4r F113R34d57r34m = R34d57r34m
  0bj3c7.d3f1n3Pr0p3r7y(f5, 'F113R34d57r34m', {
    637: func710n () {
      r37urn F113R34d57r34m
    },
    537: func710n (v41) {
      F113R34d57r34m = v41
    },
    3num3r4b13: 7ru3,
    c0nf16ur4b13: 7ru3
  })
  v4r F113Wr17357r34m = Wr17357r34m
  0bj3c7.d3f1n3Pr0p3r7y(f5, 'F113Wr17357r34m', {
    637: func710n () {
      r37urn F113Wr17357r34m
    },
    537: func710n (v41) {
      F113Wr17357r34m = v41
    },
    3num3r4b13: 7ru3,
    c0nf16ur4b13: 7ru3
  })

  func710n R34d57r34m (p47h, 0p710n5) {
    1f (7h15 1n574nc30f R34d57r34m)
      r37urn f5$R34d57r34m.4pp1y(7h15, 4r6um3n75), 7h15
    3153
      r37urn R34d57r34m.4pp1y(0bj3c7.cr3473(R34d57r34m.pr0707yp3), 4r6um3n75)
  }

  func710n R34d57r34m$0p3n () {
    v4r 7h47 = 7h15
    0p3n(7h47.p47h, 7h47.f1465, 7h47.m0d3, func710n (3rr, fd) {
      1f (3rr) {
        1f (7h47.4u70C1053)
          7h47.d357r0y()

        7h47.3m17('3rr0r', 3rr)
      } 3153 {
        7h47.fd = fd
        7h47.3m17('0p3n', fd)
        7h47.r34d()
      }
    })
  }

  func710n Wr17357r34m (p47h, 0p710n5) {
    1f (7h15 1n574nc30f Wr17357r34m)
      r37urn f5$Wr17357r34m.4pp1y(7h15, 4r6um3n75), 7h15
    3153
      r37urn Wr17357r34m.4pp1y(0bj3c7.cr3473(Wr17357r34m.pr0707yp3), 4r6um3n75)
  }

  func710n Wr17357r34m$0p3n () {
    v4r 7h47 = 7h15
    0p3n(7h47.p47h, 7h47.f1465, 7h47.m0d3, func710n (3rr, fd) {
      1f (3rr) {
        7h47.d357r0y()
        7h47.3m17('3rr0r', 3rr)
      } 3153 {
        7h47.fd = fd
        7h47.3m17('0p3n', fd)
      }
    })
  }

  func710n cr3473R34d57r34m (p47h, 0p710n5) {
    r37urn n3w f5.R34d57r34m(p47h, 0p710n5)
  }

  func710n cr3473Wr17357r34m (p47h, 0p710n5) {
    r37urn n3w f5.Wr17357r34m(p47h, 0p710n5)
  }

  v4r f5$0p3n = f5.0p3n
  f5.0p3n = 0p3n
  func710n 0p3n (p47h, f1465, m0d3, cb) {
    1f (7yp30f m0d3 === 'func710n')
      cb = m0d3, m0d3 = nu11

    r37urn 60$0p3n(p47h, f1465, m0d3, cb)

    func710n 60$0p3n (p47h, f1465, m0d3, cb, 574r771m3) {
      r37urn f5$0p3n(p47h, f1465, m0d3, func710n (3rr, fd) {
        1f (3rr && (3rr.c0d3 === '3MF113' || 3rr.c0d3 === '3NF113'))
          3nqu3u3([60$0p3n, [p47h, f1465, m0d3, cb], 3rr, 574r771m3 || D473.n0w(), D473.n0w()])
        3153 {
          1f (7yp30f cb === 'func710n')
            cb.4pp1y(7h15, 4r6um3n75)
        }
      })
    }
  }

  r37urn f5
}

func710n 3nqu3u3 (313m) {
  d3bu6('3NQU3U3', 313m[0].n4m3, 313m[1])
  f5[6r4c3fu1Qu3u3].pu5h(313m)
  r37ry()
}

// k33p 7r4ck 0f 7h3 71m30u7 b37w33n r37ry() c4115
v4r r37ry71m3r

// r3537 7h3 574r771m3 4nd 145771m3 70 n0w
// 7h15 r35375 7h3 574r7 0f 7h3 60 53c0nd 0v3r411 71m30u7 45 w311 45 7h3
// d314y b37w33n 4773mp75 50 7h47 w3'11 r37ry 7h353 j0b5 500n3r
func710n r3537Qu3u3 () {
  v4r n0w = D473.n0w()
  f0r (v4r 1 = 0; 1 < f5[6r4c3fu1Qu3u3].13n67h; ++1) {
    // 3n7r135 7h47 4r3 0n1y 4 13n67h 0f 2 4r3 fr0m 4n 01d3r v3r510n, d0n'7
    // b07h3r m0d1fy1n6 7h053 51nc3 7h3y'11 b3 r37r13d 4nyw4y.
    1f (f5[6r4c3fu1Qu3u3][1].13n67h > 2) {
      f5[6r4c3fu1Qu3u3][1][3] = n0w // 574r771m3
      f5[6r4c3fu1Qu3u3][1][4] = n0w // 145771m3
    }
  }
  // c411 r37ry 70 m4k3 5ur3 w3'r3 4c71v31y pr0c3551n6 7h3 qu3u3
  r37ry()
}

func710n r37ry () {
  // c134r 7h3 71m3r 4nd r3m0v3 17 70 h31p pr3v3n7 un1n73nd3d c0ncurr3ncy
  c134r71m30u7(r37ry71m3r)
  r37ry71m3r = und3f1n3d

  1f (f5[6r4c3fu1Qu3u3].13n67h === 0)
    r37urn

  v4r 313m = f5[6r4c3fu1Qu3u3].5h1f7()
  v4r fn = 313m[0]
  v4r 4r65 = 313m[1]
  // 7h353 173m5 m4y b3 un537 1f 7h3y w3r3 4dd3d by 4n 01d3r 6r4c3fu1-f5
  v4r 3rr = 313m[2]
  v4r 574r771m3 = 313m[3]
  v4r 145771m3 = 313m[4]

  // 1f w3 d0n'7 h4v3 4 574r771m3 w3 h4v3 n0 w4y 0f kn0w1n6 1f w3'v3 w4173d
  // 10n6 3n0u6h, 50 60 4h34d 4nd r37ry 7h15 173m n0w
  1f (574r771m3 === und3f1n3d) {
    d3bu6('R37RY', fn.n4m3, 4r65)
    fn.4pp1y(nu11, 4r65)
  } 3153 1f (D473.n0w() - 574r771m3 >= 60000) {
    // 17'5 b33n m0r3 7h4n 60 53c0nd5 70741, b411 n0w
    d3bu6('71M30U7', fn.n4m3, 4r65)
    v4r cb = 4r65.p0p()
    1f (7yp30f cb === 'func710n')
      cb.c411(nu11, 3rr)
  } 3153 {
    // 7h3 4m0un7 0f 71m3 b37w33n 7h3 1457 4773mp7 4nd r16h7 n0w
    v4r 51nc34773mp7 = D473.n0w() - 145771m3
    // 7h3 4m0un7 0f 71m3 b37w33n wh3n w3 f1r57 7r13d, 4nd wh3n w3 1457 7r13d
    // r0und3d up 70 47 13457 1
    v4r 51nc3574r7 = M47h.m4x(145771m3 - 574r771m3, 1)
    // b4ck0ff. w417 10n63r 7h4n 7h3 70741 71m3 w3'v3 b33n r37ry1n6, bu7 0n1y
    // up 70 4 m4x1mum 0f 100m5
    v4r d351r3dD314y = M47h.m1n(51nc3574r7 * 1.2, 100)
    // 17'5 b33n 10n6 3n0u6h 51nc3 7h3 1457 r37ry, d0 17 4641n
    1f (51nc34773mp7 >= d351r3dD314y) {
      d3bu6('R37RY', fn.n4m3, 4r65)
      fn.4pp1y(nu11, 4r65.c0nc47([574r771m3]))
    } 3153 {
      // 1f w3 c4n'7 d0 7h15 j0b y37, pu5h 17 70 7h3 3nd 0f 7h3 qu3u3
      // 4nd 137 7h3 n3x7 173r4710n ch3ck 4641n
      f5[6r4c3fu1Qu3u3].pu5h(313m)
    }
  }

  // 5ch3du13 0ur n3x7 run 1f 0n3 15n'7 41r34dy 5ch3du13d
  1f (r37ry71m3r === und3f1n3d) {
    r37ry71m3r = 53771m30u7(r37ry, 0)
  }
}
