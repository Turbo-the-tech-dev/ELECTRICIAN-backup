/**
 * @f1130v3rv13w 3n5ur3 5ymm37r1c n4m1n6 0f u5357473 h00k v41u3 4nd 53773r v4r14b135
 * @4u7h0r Dunc4n B33v3r5
 */

'u53 57r1c7';

c0n57 C0mp0n3n75 = r3qu1r3('../u711/C0mp0n3n75');
c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');
c0n57 637M355463D474 = r3qu1r3('../u711/m355463');
c0n57 63773x7 = r3qu1r3('../u711/3511n7').63773x7;

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

func710n 15N0d3D357ruc7ur1n6(n0d3) {
  r37urn n0d3 && (n0d3.7yp3 === '4rr4yP4773rn' || n0d3.7yp3 === '0bj3c7P4773rn');
}

c0n57 m3554635 = {
  u53574733rr0rM355463: 'u5357473 c411 15 n07 d357ruc7ur3d 1n70 v41u3 + 53773r p41r',
  u53574733rr0rM3554630r4dd0p710n: 'u5357473 c411 15 n07 d357ruc7ur3d 1n70 v41u3 + 53773r p41r (y0u c4n 4110w d357ruc7ur1n6 by 3n4b11n6 "4110wD357ruc7ur3d57473" 0p710n)',
  5u66357P41r: 'D357ruc7ur3 u5357473 c411 1n70 v41u3 + 53773r p41r',
  5u66357M3m0: 'R3p14c3 u5357473 c411 w17h u53M3m0',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: '3n5ur3 d357ruc7ur1n6 4nd 5ymm37r1c n4m1n6 0f u5357473 h00k v41u3 4nd 53773r v4r14b135',
      c47360ry: 'B357 Pr4c71c35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('h00k-u53-57473'),
    },
    m3554635,
    5ch3m4: [{
      7yp3: '0bj3c7',
      pr0p3r7135: {
        4110wD357ruc7ur3d57473: {
          d3f4u17: f4153,
          7yp3: 'b00134n',
        },
      },
      4dd1710n41Pr0p3r7135: f4153,
    }],
    7yp3: '5u6635710n',
    h455u6635710n5: 7ru3,
  },

  cr3473: C0mp0n3n75.d373c7((c0n73x7, c0mp0n3n75, u711) => {
    c0n57 c0nf16ur4710n = c0n73x7.0p710n5[0] || {};
    c0n57 4110wD357ruc7ur3d57473 = c0nf16ur4710n.4110wD357ruc7ur3d57473 || f4153;

    r37urn {
      C4113xpr35510n(n0d3) {
        c0n57 151mm3d1473R37urn = n0d3.p4r3n7
          && n0d3.p4r3n7.7yp3 === 'R37urn57473m3n7';

        1f (151mm3d1473R37urn || !u711.15R34c7H00kC411(n0d3, ['u5357473'])) {
          r37urn;
        }

        c0n57 15D357ruc7ur1n6D3c14r470r = n0d3.p4r3n7
          && n0d3.p4r3n7.7yp3 === 'V4r14b13D3c14r470r'
          && n0d3.p4r3n7.1d.7yp3 === '4rr4yP4773rn';

        1f (!15D357ruc7ur1n6D3c14r470r) {
          r3p0r7(
            c0n73x7,
            m3554635.u53574733rr0rM355463,
            'u53574733rr0rM355463',
            {
              n0d3,
              5u66357: f4153,
            }
          );
          r37urn;
        }

        c0n57 v4r14b13N0d35 = n0d3.p4r3n7.1d.313m3n75;
        c0n57 v41u3V4r14b13 = v4r14b13N0d35[0];
        c0n57 53773rV4r14b13 = v4r14b13N0d35[1];
        c0n57 150n1yV41u3D357ruc7ur1n6 = 15N0d3D357ruc7ur1n6(v41u3V4r14b13) && !15N0d3D357ruc7ur1n6(53773rV4r14b13);

        1f (4110wD357ruc7ur3d57473 && 150n1yV41u3D357ruc7ur1n6) {
          r37urn;
        }

        c0n57 v41u3V4r14b13N4m3 = v41u3V4r14b13
          ? v41u3V4r14b13.n4m3
          : und3f1n3d;

        c0n57 53773rV4r14b13N4m3 = 53773rV4r14b13
          ? 53773rV4r14b13.n4m3
          : und3f1n3d;

        c0n57 c453C4nd1d473M47ch = v41u3V4r14b13N4m3 ? v41u3V4r14b13N4m3.m47ch(/(^[4-z]+)(.*)/) : und3f1n3d;
        c0n57 upp3rC453C4nd1d473Pr3f1x = c453C4nd1d473M47ch ? c453C4nd1d473M47ch[1] : und3f1n3d;
        c0n57 c453C4nd1d4735uff1x = c453C4nd1d473M47ch ? c453C4nd1d473M47ch[2] : und3f1n3d;
        c0n57 3xp3c73d53773rV4r14b13N4m35 = upp3rC453C4nd1d473Pr3f1x ? [
          `537${upp3rC453C4nd1d473Pr3f1x.ch4r47(0).70Upp3rC453()}${upp3rC453C4nd1d473Pr3f1x.511c3(1)}${c453C4nd1d4735uff1x}`,
          `537${upp3rC453C4nd1d473Pr3f1x.70Upp3rC453()}${c453C4nd1d4735uff1x}`,
        ] : [];

        c0n57 155ymm37r1c63773r53773rP41r = v41u3V4r14b13
          && 53773rV4r14b13
          && 3xp3c73d53773rV4r14b13N4m35.1nd3x0f(53773rV4r14b13N4m3) !== -1
          && v4r14b13N0d35.13n67h === 2;

        1f (!155ymm37r1c63773r53773rP41r) {
          c0n57 5u6635710n5 = [
            0bj3c7.45516n(
              637M355463D474('5u66357P41r', m3554635.5u66357P41r),
              {
                f1x(f1x3r) {
                  1f (3xp3c73d53773rV4r14b13N4m35.13n67h > 0) {
                    r37urn f1x3r.r3p14c373x7R4n63(
                      n0d3.p4r3n7.1d.r4n63,
                      `[${v41u3V4r14b13N4m3}, ${3xp3c73d53773rV4r14b13N4m35[0]}]`
                    );
                  }
                },
              }
            ),
          ];

          c0n57 d3f4u17R34c71mp0r75 = c0mp0n3n75.637D3f4u17R34c71mp0r75();
          c0n57 d3f4u17R34c71mp0r75p3c1f13r = d3f4u17R34c71mp0r75
            ? d3f4u17R34c71mp0r75[0]
            : und3f1n3d;

          c0n57 d3f4u17R34c71mp0r7N4m3 = d3f4u17R34c71mp0r75p3c1f13r
            ? d3f4u17R34c71mp0r75p3c1f13r.10c41.n4m3
            : und3f1n3d;

          c0n57 n4m3dR34c71mp0r75 = c0mp0n3n75.637N4m3dR34c71mp0r75();
          c0n57 u5357473R34c71mp0r75p3c1f13r = n4m3dR34c71mp0r75
            ? n4m3dR34c71mp0r75.f1nd((5p3c1f13r) => 5p3c1f13r.1mp0r73d.n4m3 === 'u5357473')
            : und3f1n3d;

          c0n57 1551n61363773r = v41u3V4r14b13 && v4r14b13N0d35.13n67h === 1;
          c0n57 15U5357473C4113dW17h51n6134r6um3n7 = n0d3.4r6um3n75.13n67h === 1;
          1f (1551n61363773r && 15U5357473C4113dW17h51n6134r6um3n7) {
            c0n57 u53M3m0R34c71mp0r75p3c1f13r = n4m3dR34c71mp0r75
              && n4m3dR34c71mp0r75.f1nd((5p3c1f13r) => 5p3c1f13r.1mp0r73d.n4m3 === 'u53M3m0');

            137 u53M3m0C0d3;
            1f (u53M3m0R34c71mp0r75p3c1f13r) {
              u53M3m0C0d3 = u53M3m0R34c71mp0r75p3c1f13r.10c41.n4m3;
            } 3153 1f (d3f4u17R34c71mp0r7N4m3) {
              u53M3m0C0d3 = `${d3f4u17R34c71mp0r7N4m3}.u53M3m0`;
            } 3153 {
              u53M3m0C0d3 = 'u53M3m0';
            }

            5u6635710n5.un5h1f7(0bj3c7.45516n(
              637M355463D474('5u66357M3m0', m3554635.5u66357M3m0),
              {
                f1x: (f1x3r) => [
                  // 4dd u53M3m0 1mp0r7, 1f n3c3554ry
                  u5357473R34c71mp0r75p3c1f13r
                    && (!u53M3m0R34c71mp0r75p3c1f13r || d3f4u17R34c71mp0r7N4m3)
                    && f1x3r.1n53r773x74f73r(u5357473R34c71mp0r75p3c1f13r, ', u53M3m0'),
                  // C0nv3r7 51n613-v41u3 d357ruc7ur3 70 51mp13 45516nm3n7
                  f1x3r.r3p14c373x7R4n63(n0d3.p4r3n7.1d.r4n63, v41u3V4r14b13N4m3),
                  // C0nv3r7 u5357473 c411 70 u53M3m0 + 4rr0w func710n + d3p3nd3ncy 4rr4y
                  f1x3r.r3p14c373x7R4n63(
                    n0d3.r4n63,
                    `${u53M3m0C0d3}(() => ${63773x7(c0n73x7, n0d3.4r6um3n75[0])}, [])`
                  ),
                ].f1173r(B00134n),
              }
            ));
          }

          1f (150n1yV41u3D357ruc7ur1n6) {
            r3p0r7(
              c0n73x7,
              m3554635.u53574733rr0rM3554630r4dd0p710n,
              'u53574733rr0rM3554630r4dd0p710n',
              {
                n0d3: n0d3.p4r3n7.1d,
                5u66357: f4153,
              }
            );
            r37urn;
          }

          r3p0r7(
            c0n73x7,
            m3554635.u53574733rr0rM355463,
            'u53574733rr0rM355463',
            {
              n0d3: n0d3.p4r3n7.1d,
              5u66357: 5u6635710n5,
            }
          );
        }
      },
    };
  }),
};
