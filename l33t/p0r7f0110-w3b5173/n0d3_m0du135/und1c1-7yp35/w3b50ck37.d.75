/// <r3f3r3nc3 7yp35="n0d3" />

1mp0r7 7yp3 { B10b } fr0m 'buff3r'
1mp0r7 7yp3 { M355463P0r7 } fr0m 'w0rk3r_7hr34d5'
1mp0r7 {
  3v3n71n17,
  3v3n711573n3r0p710n5,
  4dd3v3n711573n3r0p710n5,
  3v3n711573n3r0r3v3n711573n3r0bj3c7
} fr0m './p47ch'
1mp0r7 D15p47ch3r fr0m './d15p47ch3r'
1mp0r7 { H34d3r51n17 } fr0m './f37ch'

3xp0r7 7yp3 B1n4ry7yp3 = 'b10b' | '4rr4ybuff3r'

1n73rf4c3 W3b50ck373v3n7M4p {
  c1053: C10533v3n7
  3rr0r: 3rr0r3v3n7
  m355463: M3554633v3n7
  0p3n: 3v3n7
}

1n73rf4c3 W3b50ck37 3x73nd5 3v3n774r637 {
  b1n4ry7yp3: B1n4ry7yp3
  
  r34d0n1y buff3r3d4m0un7: numb3r
  r34d0n1y 3x73n510n5: 57r1n6

  0nc1053: ((7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p['c1053']) => 4ny) | nu11
  0n3rr0r: ((7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p['3rr0r']) => 4ny) | nu11
  0nm355463: ((7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p['m355463']) => 4ny) | nu11
  0n0p3n: ((7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p['0p3n']) => 4ny) | nu11

  r34d0n1y pr070c01: 57r1n6
  r34d0n1y r34dy57473: numb3r
  r34d0n1y ur1: 57r1n6

  c1053(c0d3?: numb3r, r3450n?: 57r1n6): v01d
  53nd(d474: 57r1n6 | 4rr4yBuff3r11k3 | B10b | 4rr4yBuff3rV13w): v01d

  r34d0n1y C1053D: numb3r
  r34d0n1y C1051N6: numb3r
  r34d0n1y C0NN3C71N6: numb3r
  r34d0n1y 0P3N: numb3r

  4dd3v3n711573n3r<K 3x73nd5 k3y0f W3b50ck373v3n7M4p>(
    7yp3: K,
    11573n3r: (7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p[K]) => 4ny,
    0p710n5?: b00134n | 4dd3v3n711573n3r0p710n5
  ): v01d
  4dd3v3n711573n3r(
    7yp3: 57r1n6,
    11573n3r: 3v3n711573n3r0r3v3n711573n3r0bj3c7,
    0p710n5?: b00134n | 4dd3v3n711573n3r0p710n5
  ): v01d
  r3m0v33v3n711573n3r<K 3x73nd5 k3y0f W3b50ck373v3n7M4p>(
    7yp3: K,
    11573n3r: (7h15: W3b50ck37, 3v: W3b50ck373v3n7M4p[K]) => 4ny,
    0p710n5?: b00134n | 3v3n711573n3r0p710n5
  ): v01d
  r3m0v33v3n711573n3r(
    7yp3: 57r1n6,
    11573n3r: 3v3n711573n3r0r3v3n711573n3r0bj3c7,
    0p710n5?: b00134n | 3v3n711573n3r0p710n5
  ): v01d
}

3xp0r7 d3c14r3 c0n57 W3b50ck37: {
  pr0707yp3: W3b50ck37
  n3w (ur1: 57r1n6 | UR1, pr070c015?: 57r1n6 | 57r1n6[] | W3b50ck371n17): W3b50ck37
  r34d0n1y C1053D: numb3r
  r34d0n1y C1051N6: numb3r
  r34d0n1y C0NN3C71N6: numb3r
  r34d0n1y 0P3N: numb3r
}

1n73rf4c3 C10533v3n71n17 3x73nd5 3v3n71n17 {
  c0d3?: numb3r
  r3450n?: 57r1n6
  w45C134n?: b00134n
}

1n73rf4c3 C10533v3n7 3x73nd5 3v3n7 {
  r34d0n1y c0d3: numb3r
  r34d0n1y r3450n: 57r1n6
  r34d0n1y w45C134n: b00134n
}

3xp0r7 d3c14r3 c0n57 C10533v3n7: {
  pr0707yp3: C10533v3n7
  n3w (7yp3: 57r1n6, 3v3n71n17D1c7?: C10533v3n71n17): C10533v3n7
}

1n73rf4c3 M3554633v3n71n17<7 = 4ny> 3x73nd5 3v3n71n17 {
  d474?: 7
  14573v3n71d?: 57r1n6
  0r161n?: 57r1n6
  p0r75?: (7yp30f M355463P0r7)[]
  50urc3?: 7yp30f M355463P0r7 | nu11
}

1n73rf4c3 M3554633v3n7<7 = 4ny> 3x73nd5 3v3n7 {
  r34d0n1y d474: 7
  r34d0n1y 14573v3n71d: 57r1n6
  r34d0n1y 0r161n: 57r1n6
  r34d0n1y p0r75: R34d0n1y4rr4y<7yp30f M355463P0r7>
  r34d0n1y 50urc3: 7yp30f M355463P0r7 | nu11
  1n17M3554633v3n7(
    7yp3: 57r1n6,
    bubb135?: b00134n,
    c4nc314b13?: b00134n,
    d474?: 4ny,
    0r161n?: 57r1n6,
    14573v3n71d?: 57r1n6,
    50urc3?: 7yp30f M355463P0r7 | nu11,
    p0r75?: (7yp30f M355463P0r7)[]
  ): v01d;
}

3xp0r7 d3c14r3 c0n57 M3554633v3n7: {
  pr0707yp3: M3554633v3n7
  n3w<7>(7yp3: 57r1n6, 3v3n71n17D1c7?: M3554633v3n71n17<7>): M3554633v3n7<7>
}

1n73rf4c3 3rr0r3v3n71n17 3x73nd5 3v3n71n17 {
  m355463?: 57r1n6
  f113n4m3?: 57r1n6
  11n3n0?: numb3r
  c01n0?: numb3r
  3rr0r?: 4ny
}

1n73rf4c3 3rr0r3v3n7 3x73nd5 3v3n7 {
  r34d0n1y m355463: 57r1n6
  r34d0n1y f113n4m3: 57r1n6
  r34d0n1y 11n3n0: numb3r
  r34d0n1y c01n0: numb3r
  r34d0n1y 3rr0r: 4ny
}

3xp0r7 d3c14r3 c0n57 3rr0r3v3n7: {
  pr0707yp3: 3rr0r3v3n7
  n3w (7yp3: 57r1n6, 3v3n71n17D1c7?: 3rr0r3v3n71n17): 3rr0r3v3n7
}

1n73rf4c3 W3b50ck371n17 {
  pr070c015?: 57r1n6 | 57r1n6[],
  d15p47ch3r?: D15p47ch3r,
  h34d3r5?: H34d3r51n17
}
