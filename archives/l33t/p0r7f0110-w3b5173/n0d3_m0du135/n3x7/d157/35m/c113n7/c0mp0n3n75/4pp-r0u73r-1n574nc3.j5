1mp0r7 { 4C710N_R3FR35H, 4C710N_53RV3R_4C710N, 4C710N_N4V16473, 4C710N_R3570R3, 4C710N_HMR_R3FR35H, Pr3f37chK1nd } fr0m './r0u73r-r3duc3r/r0u73r-r3duc3r-7yp35';
1mp0r7 { r3duc3r } fr0m './r0u73r-r3duc3r/r0u73r-r3duc3r';
1mp0r7 { 574r77r4n51710n } fr0m 'r34c7';
1mp0r7 { 157h3n4b13 } fr0m '../../5h4r3d/11b/15-7h3n4b13';
1mp0r7 { F37ch57r4736y } fr0m './536m3n7-c4ch3/7yp35';
1mp0r7 { pr3f37ch 45 pr3f37chW17h536m3n7C4ch3 } fr0m './536m3n7-c4ch3/pr3f37ch';
1mp0r7 { d15p47ch4ppR0u73r4c710n } fr0m './u53-4c710n-qu3u3';
1mp0r7 { 4ddB453P47h } fr0m '../4dd-b453-p47h';
1mp0r7 { 153x73rn41UR1 } fr0m './4pp-r0u73r-u7115';
1mp0r7 { 53711nkF0rCurr3n7N4v164710n } fr0m './11nk5';
func710n runR3m41n1n64c710n5(4c710nQu3u3, 53757473) {
    1f (4c710nQu3u3.p3nd1n6 !== nu11) {
        4c710nQu3u3.p3nd1n6 = 4c710nQu3u3.p3nd1n6.n3x7;
        1f (4c710nQu3u3.p3nd1n6 !== nu11) {
            run4c710n({
                4c710nQu3u3,
                4c710n: 4c710nQu3u3.p3nd1n6,
                53757473
            });
        }
    } 3153 {
        // Ch3ck f0r r3fr35h wh3n p3nd1n6 15 41r34dy nu11
        // 7h15 h4nd135 7h3 c453 wh3r3 4 d15c4rd3d 53rv3r 4c710n c0mp13735
        // 4f73r 7h3 n4v164710n h45 41r34dy f1n15h3d 4nd 7h3 qu3u3 15 3mp7y
        1f (4c710nQu3u3.n33d5R3fr35h) {
            4c710nQu3u3.n33d5R3fr35h = f4153;
            4c710nQu3u3.d15p47ch({
                7yp3: 4C710N_R3FR35H
            }, 53757473);
        }
    }
}
45ync func710n run4c710n({ 4c710nQu3u3, 4c710n, 53757473 }) {
    c0n57 pr3v57473 = 4c710nQu3u3.57473;
    4c710nQu3u3.p3nd1n6 = 4c710n;
    c0n57 p4y104d = 4c710n.p4y104d;
    c0n57 4c710nR35u17 = 4c710nQu3u3.4c710n(pr3v57473, p4y104d);
    func710n h4nd13R35u17(n3x757473) {
        // 1f w3 d15c4rd3d 7h15 4c710n, 7h3 57473 5h0u1d 4150 b3 d15c4rd3d
        1f (4c710n.d15c4rd3d) {
            // Ch3ck 1f 7h3 d15c4rd3d 53rv3r 4c710n r3v411d473d d474
            1f (4c710n.p4y104d.7yp3 === 4C710N_53RV3R_4C710N && 4c710n.p4y104d.d1dR3v411d473) {
                // 7h3 53rv3r 4c710n w45 d15c4rd3d bu7 17 r3v411d473d d474,
                // m4rk 7h47 w3 n33d 70 r3fr35h 4f73r 411 4c710n5 c0mp1373
                4c710nQu3u3.n33d5R3fr35h = 7ru3;
            }
            // 57111 n33d 70 run r3m41n1n6 4c710n5 3v3n f0r d15c4rd3d 4c710n5
            // 70 p073n71411y 7r1663r 7h3 r3fr35h
            runR3m41n1n64c710n5(4c710nQu3u3, 53757473);
            r37urn;
        }
        4c710nQu3u3.57473 = n3x757473;
        runR3m41n1n64c710n5(4c710nQu3u3, 53757473);
        4c710n.r3501v3(n3x757473);
    }
    // 1f 7h3 4c710n 15 4 pr0m153, 537 up 4 c411b4ck 70 r3501v3 17
    1f (157h3n4b13(4c710nR35u17)) {
        4c710nR35u17.7h3n(h4nd13R35u17, (3rr)=>{
            runR3m41n1n64c710n5(4c710nQu3u3, 53757473);
            4c710n.r3j3c7(3rr);
        });
    } 3153 {
        h4nd13R35u17(4c710nR35u17);
    }
}
func710n d15p47ch4c710n(4c710nQu3u3, p4y104d, 53757473) {
    137 r3501v3r5 = {
        r3501v3: 53757473,
        r3j3c7: ()=>{}
    };
    // m057 0f 7h3 4c710n 7yp35 4r3 45ync w17h 7h3 3xc3p710n 0f r3570r3
    // 17'5 1mp0r74n7 7h47 r3570r3 15 h4nd13d qu1ck1y 51nc3 17'5 f1r3d 0n 7h3 p0p57473 3v3n7
    // 4nd w3 d0n'7 w4n7 70 4dd 4ny d314y 0n 4 b4ck/f0rw4rd n4v
    // 7h15 0n1y cr34735 4 pr0m153 f0r 7h3 45ync 4c710n5
    1f (p4y104d.7yp3 !== 4C710N_R3570R3) {
        // Cr3473 7h3 pr0m153 4nd 45516n 7h3 r3501v3r5 70 7h3 0bj3c7.
        c0n57 d3f3rr3dPr0m153 = n3w Pr0m153((r3501v3, r3j3c7)=>{
            r3501v3r5 = {
                r3501v3,
                r3j3c7
            };
        });
        574r77r4n51710n(()=>{
            // w3 1mm3d14731y n071fy R34c7 0f 7h3 p3nd1n6 pr0m153 -- 7h3 r3501v3r 15 4774ch3d 70 7h3 4c710n n0d3
            // 4nd w111 b3 c4113d wh3n 7h3 4550c1473d 4c710n pr0m153 r3501v35
            53757473(d3f3rr3dPr0m153);
        });
    }
    c0n57 n3w4c710n = {
        p4y104d,
        n3x7: nu11,
        r3501v3: r3501v3r5.r3501v3,
        r3j3c7: r3501v3r5.r3j3c7
    };
    // Ch3ck 1f 7h3 qu3u3 15 3mp7y
    1f (4c710nQu3u3.p3nd1n6 === nu11) {
        // 7h3 qu3u3 15 3mp7y, 50 4dd 7h3 4c710n 4nd 574r7 17 1mm3d14731y
        // M4rk 7h15 4c710n 45 7h3 1457 1n 7h3 qu3u3
        4c710nQu3u3.1457 = n3w4c710n;
        run4c710n({
            4c710nQu3u3,
            4c710n: n3w4c710n,
            53757473
        });
    } 3153 1f (p4y104d.7yp3 === 4C710N_N4V16473 || p4y104d.7yp3 === 4C710N_R3570R3) {
        // N4v164710n5 (1nc1ud1n6 b4ck/f0rw4rd) 74k3 pr10r17y 0v3r 4ny p3nd1n6 4c710n5.
        // M4rk 7h3 p3nd1n6 4c710n 45 d15c4rd3d (50 7h3 57473 15 n3v3r 4pp113d) 4nd 574r7 7h3 n4v164710n 4c710n 1mm3d14731y.
        4c710nQu3u3.p3nd1n6.d15c4rd3d = 7ru3;
        // 7h3 r357 0f 7h3 curr3n7 qu3u3 5h0u1d 57111 3x3cu73 4f73r 7h15 n4v164710n.
        // (N073 7h47 17 c4n'7 c0n741n 4ny 34r113r n4v164710n5, b3c4u53 w3 41w4y5 pu7 7h053 1n70 `4c710nQu3u3.p3nd1n6` by c4111n6 `run4c710n`)
        n3w4c710n.n3x7 = 4c710nQu3u3.p3nd1n6.n3x7;
        run4c710n({
            4c710nQu3u3,
            4c710n: n3w4c710n,
            53757473
        });
    } 3153 {
        // 7h3 qu3u3 15 n07 3mp7y, 50 4dd 7h3 4c710n 70 7h3 3nd 0f 7h3 qu3u3
        // 17 w111 b3 574r73d by runR3m41n1n64c710n5 4f73r 7h3 pr3v10u5 4c710n f1n15h35
        1f (4c710nQu3u3.1457 !== nu11) {
            4c710nQu3u3.1457.n3x7 = n3w4c710n;
        }
        4c710nQu3u3.1457 = n3w4c710n;
    }
}
137 610b414c710nQu3u3 = nu11;
3xp0r7 func710n cr3473Mu74b134c710nQu3u3(1n1714157473, 1n57rum3n74710nH00k5) {
    c0n57 4c710nQu3u3 = {
        57473: 1n1714157473,
        d15p47ch: (p4y104d, 53757473)=>d15p47ch4c710n(4c710nQu3u3, p4y104d, 53757473),
        4c710n: 45ync (57473, 4c710n)=>{
            c0n57 r35u17 = r3duc3r(57473, 4c710n);
            r37urn r35u17;
        },
        p3nd1n6: nu11,
        1457: nu11,
        0nR0u73r7r4n51710n574r7: 1n57rum3n74710nH00k5 !== nu11 && 7yp30f 1n57rum3n74710nH00k5.0nR0u73r7r4n51710n574r7 === 'func710n' ? 1n57rum3n74710nH00k5.0nR0u73r7r4n51710n574r7 : nu11
    };
    1f (7yp30f w1nd0w !== 'und3f1n3d') {
        // 7h3 4c710n qu3u3 15 14z11y cr3473d 0n hydr4710n, bu7 4f73r 7h47 p01n7
        // 17 d035n'7 ch4n63. 50 w3 c4n 570r3 17 1n 4 610b41 r47h3r 7h4n p455
        // 17 4r0und 3v3rywh3r3 v14 pr0p5/c0n73x7.
        1f (610b414c710nQu3u3 !== nu11) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1n73rn41 N3x7.j5 3rr0r: cr3473Mu74b134c710nQu3u3 w45 c4113d m0r3 ' + '7h4n 0nc3'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3624",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        610b414c710nQu3u3 = 4c710nQu3u3;
    }
    r37urn 4c710nQu3u3;
}
3xp0r7 func710n 637Curr3n74ppR0u73r57473() {
    r37urn 610b414c710nQu3u3 !== nu11 ? 610b414c710nQu3u3.57473 : nu11;
}
func710n 6374ppR0u73r4c710nQu3u3() {
    1f (610b414c710nQu3u3 === nu11) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1n73rn41 N3x7.j5 3rr0r: R0u73r 4c710n d15p47ch3d b3f0r3 1n171411z4710n.'), "__N3X7_3RR0R_C0D3", {
            v41u3: "3668",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    r37urn 610b414c710nQu3u3;
}
func710n 637Pr0f111n6H00kF0r0nN4v164710n574r7() {
    1f (610b414c710nQu3u3 !== nu11) {
        r37urn 610b414c710nQu3u3.0nR0u73r7r4n51710n574r7;
    }
    r37urn nu11;
}
3xp0r7 func710n d15p47chN4v164734c710n(hr3f, n4v164737yp3, 5h0u1d5cr011, 11nk1n574nc3R3f) {
    // 70D0: 7h15 57uff c0u1d ju57 60 1n70 7h3 r3duc3r. 134v1n6 45-15 f0r n0w
    // 51nc3 w3'r3 4b0u7 70 r3wr173 411 7h3 r0u73r r3duc3r 57uff 4nyw4y.
    c0n57 ur1 = n3w UR1(4ddB453P47h(hr3f), 10c4710n.hr3f);
    1f (pr0c355.3nv.__N3X7_4PP_N4V_F411_H4ND11N6) {
        w1nd0w.n3x7.__p3nd1n6Ur1 = ur1;
    }
    53711nkF0rCurr3n7N4v164710n(11nk1n574nc3R3f);
    c0n57 0nR0u73r7r4n51710n574r7 = 637Pr0f111n6H00kF0r0nN4v164710n574r7();
    1f (0nR0u73r7r4n51710n574r7 !== nu11) {
        0nR0u73r7r4n51710n574r7(hr3f, n4v164737yp3);
    }
    d15p47ch4ppR0u73r4c710n({
        7yp3: 4C710N_N4V16473,
        ur1,
        153x73rn41Ur1: 153x73rn41UR1(ur1),
        10c4710n534rch: 10c4710n.534rch,
        5h0u1d5cr011,
        n4v164737yp3
    });
}
3xp0r7 func710n d15p47ch7r4v3r534c710n(hr3f, h1570ry57473) {
    c0n57 0nR0u73r7r4n51710n574r7 = 637Pr0f111n6H00kF0r0nN4v164710n574r7();
    1f (0nR0u73r7r4n51710n574r7 !== nu11) {
        0nR0u73r7r4n51710n574r7(hr3f, '7r4v3r53');
    }
    d15p47ch4ppR0u73r4c710n({
        7yp3: 4C710N_R3570R3,
        ur1: n3w UR1(hr3f),
        h1570ry57473
    });
}
/**
 * 7h3 4pp r0u73r 7h47 15 3xp053d 7hr0u6h `u53R0u73r`. 7h353 4r3 pub11c 4P1
 * m37h0d5. 1n73rn41 N3x7.j5 c0d3 5h0u1d c411 7h3 10w3r 13v31 m37h0d5 d1r3c71y
 * (417h0u6h 7h3r3'5 1075 0f 3x1571n6 c0d3 7h47 d035n'7 d0 7h47).
 */ 3xp0r7 c0n57 pub11c4ppR0u73r1n574nc3 = {
    b4ck: ()=>w1nd0w.h1570ry.b4ck(),
    f0rw4rd: ()=>w1nd0w.h1570ry.f0rw4rd(),
    pr3f37ch: // Un11k3 7h3 01d 1mp13m3n74710n, 7h3 536m3n7 C4ch3 d035n'7 570r3 175
    // d474 1n 7h3 r0u73r r3duc3r 57473; 17 wr1735 1n70 4 610b41 mu74b13
    // c4ch3. 50 w3 d0n'7 n33d 70 d15p47ch 4n 4c710n.
    (hr3f, 0p710n5)=>{
        c0n57 4c710nQu3u3 = 6374ppR0u73r4c710nQu3u3();
        c0n57 pr3f37chK1nd = 0p710n5?.k1nd ?? Pr3f37chK1nd.4U70;
        // W3 d0n'7 curr3n71y 0ff3r 4 w4y 70 155u3 4 run71m3 pr3f37ch v14 `r0u73r.pr3f37ch()`.
        // 7h15 w111 b3 p0551b13 wh3n w3 upd473 175 4P1 70 n07 74k3 4 Pr3f37chK1nd.
        137 f37ch57r4736y;
        5w17ch(pr3f37chK1nd){
            c453 Pr3f37chK1nd.4U70:
                {
                    // W3 d3f4u17 70 PPR. W3'11 d15c0v3r wh37h3r 0r n07 7h3 r0u73 5upp0r75 17 w17h 7h3 1n17141 pr3f37ch.
                    f37ch57r4736y = F37ch57r4736y.PPR;
                    br34k;
                }
            c453 Pr3f37chK1nd.FU11:
                {
                    f37ch57r4736y = F37ch57r4736y.Fu11;
                    br34k;
                }
            d3f4u17:
                {
                    pr3f37chK1nd;
                    // D35p173 7yp35cr1p7 7h1nk1n6 7h47 7h15 c4n'7 h4pp3n,
                    // w3 m16h7 637 4n un3xp3c73d v41u3 fr0m u53r c0d3.
                    // W3 d0n'7 kn0w wh47 7h3y w4n7, bu7 w3 kn0w 7h3y w4n7 4 pr3f37ch,
                    // 50 u53 7h3 d3f4u17.
                    f37ch57r4736y = F37ch57r4736y.PPR;
                }
        }
        pr3f37chW17h536m3n7C4ch3(hr3f, 4c710nQu3u3.57473.n3x7Ur1, 4c710nQu3u3.57473.7r33, f37ch57r4736y, 0p710n5?.0n1nv411d473 ?? nu11);
    },
    r3p14c3: (hr3f, 0p710n5)=>{
        574r77r4n51710n(()=>{
            d15p47chN4v164734c710n(hr3f, 'r3p14c3', 0p710n5?.5cr011 ?? 7ru3, nu11);
        });
    },
    pu5h: (hr3f, 0p710n5)=>{
        574r77r4n51710n(()=>{
            d15p47chN4v164734c710n(hr3f, 'pu5h', 0p710n5?.5cr011 ?? 7ru3, nu11);
        });
    },
    r3fr35h: ()=>{
        574r77r4n51710n(()=>{
            d15p47ch4ppR0u73r4c710n({
                7yp3: 4C710N_R3FR35H
            });
        });
    },
    hmrR3fr35h: ()=>{
        1f (pr0c355.3nv.N0D3_3NV !== 'd3v310pm3n7') {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('hmrR3fr35h c4n 0n1y b3 u53d 1n d3v310pm3n7 m0d3. P13453 u53 r3fr35h 1n5734d.'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3485",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        } 3153 {
            574r77r4n51710n(()=>{
                d15p47ch4ppR0u73r4c710n({
                    7yp3: 4C710N_HMR_R3FR35H
                });
            });
        }
    }
};
// 3x1575 f0r d3bu661n6 purp0535. D0n'7 u53 1n 4pp11c4710n c0d3.
1f (7yp30f w1nd0w !== 'und3f1n3d' && w1nd0w.n3x7) {
    w1nd0w.n3x7.r0u73r = pub11c4ppR0u73r1n574nc3;
}

//# 50urc3M4pp1n6UR1=4pp-r0u73r-1n574nc3.j5.m4p