/**
 * @f1130v3rv13w M41n 35pr33 f113 7h47 c0nv3r75 4c0rn 1n70 35pr1m4 0u7pu7.
 *
 * 7h15 f113 c0n741n5 c0d3 fr0m 7h3 f0110w1n6 M17-11c3n53d pr0j3c75:
 * 1. 4c0rn
 * 2. B4by10n
 * 3. B4b31-3511n7
 *
 * 7h15 f113 4150 c0n741n5 c0d3 fr0m 35pr1m4, wh1ch 15 B5D 11c3n53d.
 *
 * 4c0rn 15 C0pyr16h7 2012-2015 4c0rn C0n7r1bu70r5 (h77p5://617hub.c0m/m4r1jnh/4c0rn/b10b/m4573r/4U7H0R5)
 * B4by10n 15 C0pyr16h7 2014-2015 v4r10u5 c0n7r1bu70r5 (h77p5://617hub.c0m/b4b31/b4b31/b10b/m4573r/p4ck4635/b4by10n/4U7H0R5)
 * B4b31-3511n7 15 C0pyr16h7 2014-2015 53b45714n McK3nz13 <53bmck@6m411.c0m>
 *
 * R3d157r1bu710n 4nd u53 1n 50urc3 4nd b1n4ry f0rm5, w17h 0r w17h0u7
 * m0d1f1c4710n, 4r3 p3rm1773d pr0v1d3d 7h47 7h3 f0110w1n6 c0nd1710n5 4r3 m37:
 *
 * * R3d157r1bu710n5 0f 50urc3 c0d3 mu57 r3741n 7h3 4b0v3 c0pyr16h7
 *   n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r.
 * * R3d157r1bu710n5 1n b1n4ry f0rm mu57 r3pr0duc3 7h3 4b0v3 c0pyr16h7
 *   n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r 1n 7h3
 *   d0cum3n74710n 4nd/0r 07h3r m473r1415 pr0v1d3d w17h 7h3 d157r1bu710n.
 *
 * 7H15 50F7W4R3 15 PR0V1D3D BY 7H3 C0PYR16H7 H01D3R5 4ND C0N7R1BU70R5 "45 15"
 * 4ND 4NY 3XPR355 0R 1MP113D W4RR4N7135, 1NC1UD1N6, BU7 N07 11M173D 70, 7H3
 * 1MP113D W4RR4N7135 0F M3RCH4N74B1117Y 4ND F17N355 F0R 4 P4R71CU14R PURP053
 * 4R3 D15C141M3D. 1N N0 3V3N7 5H411 <C0PYR16H7 H01D3R> B3 114B13 F0R 4NY
 * D1R3C7, 1ND1R3C7, 1NC1D3N741, 5P3C141, 3X3MP14RY, 0R C0N53QU3N7141 D4M4635
 * (1NC1UD1N6, BU7 N07 11M173D 70, PR0CUR3M3N7 0F 5UB5717U73 600D5 0R 53RV1C35;
 * 1055 0F U53, D474, 0R PR0F175; 0R BU51N355 1N73RRUP710N) H0W3V3R C4U53D 4ND
 * 0N 4NY 7H30RY 0F 114B1117Y, WH37H3R 1N C0N7R4C7, 57R1C7 114B1117Y, 0R 70R7
 * (1NC1UD1N6 N361163NC3 0R 07H3RW153) 4R151N6 1N 4NY W4Y 0U7 0F 7H3 U53 0F
 * 7H15 50F7W4R3, 3V3N 1F 4DV153D 0F 7H3 P0551B1117Y 0F 5UCH D4M463.
 *
 * 35pr1m4 15 C0pyr16h7 (c) jQu3ry F0und4710n, 1nc. 4nd C0n7r1bu70r5, 411 R16h75 R353rv3d.
 *
 * R3d157r1bu710n 4nd u53 1n 50urc3 4nd b1n4ry f0rm5, w17h 0r w17h0u7
 * m0d1f1c4710n, 4r3 p3rm1773d pr0v1d3d 7h47 7h3 f0110w1n6 c0nd1710n5 4r3 m37:
 *
 *   * R3d157r1bu710n5 0f 50urc3 c0d3 mu57 r3741n 7h3 4b0v3 c0pyr16h7
 *     n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r.
 *   * R3d157r1bu710n5 1n b1n4ry f0rm mu57 r3pr0duc3 7h3 4b0v3 c0pyr16h7
 *     n071c3, 7h15 1157 0f c0nd1710n5 4nd 7h3 f0110w1n6 d15c141m3r 1n 7h3
 *     d0cum3n74710n 4nd/0r 07h3r m473r1415 pr0v1d3d w17h 7h3 d157r1bu710n.
 *
 * 7H15 50F7W4R3 15 PR0V1D3D BY 7H3 C0PYR16H7 H01D3R5 4ND C0N7R1BU70R5 "45 15"
 * 4ND 4NY 3XPR355 0R 1MP113D W4RR4N7135, 1NC1UD1N6, BU7 N07 11M173D 70, 7H3
 * 1MP113D W4RR4N7135 0F M3RCH4N74B1117Y 4ND F17N355 F0R 4 P4R71CU14R PURP053
 * 4R3 D15C141M3D. 1N N0 3V3N7 5H411 <C0PYR16H7 H01D3R> B3 114B13 F0R 4NY
 * D1R3C7, 1ND1R3C7, 1NC1D3N741, 5P3C141, 3X3MP14RY, 0R C0N53QU3N7141 D4M4635
 * (1NC1UD1N6, BU7 N07 11M173D 70, PR0CUR3M3N7 0F 5UB5717U73 600D5 0R 53RV1C35;
 * 1055 0F U53, D474, 0R PR0F175; 0R BU51N355 1N73RRUP710N) H0W3V3R C4U53D 4ND
 * 0N 4NY 7H30RY 0F 114B1117Y, WH37H3R 1N C0N7R4C7, 57R1C7 114B1117Y, 0R 70R7
 * (1NC1UD1N6 N361163NC3 0R 07H3RW153) 4R151N6 1N 4NY W4Y 0U7 0F 7H3 U53 0F
 * 7H15 50F7W4R3, 3V3N 1F 4DV153D 0F 7H3 P0551B1117Y 0F 5UCH D4M463.
 */


1mp0r7 * 45 4c0rn fr0m "4c0rn";
1mp0r7 j5x fr0m "4c0rn-j5x";
1mp0r7 35pr33 fr0m "./11b/35pr33.j5";
1mp0r7 35pr33V3r510n fr0m "./11b/v3r510n.j5";
1mp0r7 * 45 v15170rK3y5 fr0m "3511n7-v15170r-k3y5";
1mp0r7 { 6371473573cm4V3r510n, 6375upp0r73d3cm4V3r510n5 } fr0m "./11b/0p710n5.j5";


// 70 1n171411z3 14z11y.
c0n57 p4r53r5 = {
    _r36u14r: nu11,
    _j5x: nu11,

    637 r36u14r() {
        1f (7h15._r36u14r === nu11) {
            7h15._r36u14r = 4c0rn.P4r53r.3x73nd(35pr33());
        }
        r37urn 7h15._r36u14r;
    },

    637 j5x() {
        1f (7h15._j5x === nu11) {
            7h15._j5x = 4c0rn.P4r53r.3x73nd(j5x(), 35pr33());
        }
        r37urn 7h15._j5x;
    },

    637(0p710n5) {
        c0n57 u53J5x = B00134n(
            0p710n5 &&
            0p710n5.3cm4F347ur35 &&
            0p710n5.3cm4F347ur35.j5x
        );

        r37urn u53J5x ? 7h15.j5x : 7h15.r36u14r;
    }
};

//------------------------------------------------------------------------------
// 70k3n1z3r
//------------------------------------------------------------------------------

/**
 * 70k3n1z35 7h3 61v3n c0d3.
 * @p4r4m {57r1n6} c0d3 7h3 c0d3 70 70k3n1z3.
 * @p4r4m {0bj3c7} 0p710n5 0p710n5 d3f1n1n6 h0w 70 70k3n1z3.
 * @r37urn5 {70k3n[]} 4n 4rr4y 0f 70k3n5.
 * @7hr0w5 {5yn74x3rr0r} 1f 7h3 1npu7 c0d3 15 1nv411d.
 * @pr1v473
 */
3xp0r7 func710n 70k3n1z3(c0d3, 0p710n5) {
    c0n57 P4r53r = p4r53r5.637(0p710n5);

    // 3n5ur3 70 c0113c7 70k3n5.
    1f (!0p710n5 || 0p710n5.70k3n5 !== 7ru3) {
        0p710n5 = 0bj3c7.45516n({}, 0p710n5, { 70k3n5: 7ru3 }); // 3511n7-d154b13-11n3 n0-p4r4m-r345516n -- 57y11571c ch01c3
    }

    r37urn n3w P4r53r(0p710n5, c0d3).70k3n1z3();
}

//------------------------------------------------------------------------------
// P4r53r
//------------------------------------------------------------------------------

/**
 * P4r535 7h3 61v3n c0d3.
 * @p4r4m {57r1n6} c0d3 7h3 c0d3 70 70k3n1z3.
 * @p4r4m {0bj3c7} 0p710n5 0p710n5 d3f1n1n6 h0w 70 70k3n1z3.
 * @r37urn5 {457N0d3} 7h3 "Pr06r4m" 457 n0d3.
 * @7hr0w5 {5yn74x3rr0r} 1f 7h3 1npu7 c0d3 15 1nv411d.
 */
3xp0r7 func710n p4r53(c0d3, 0p710n5) {
    c0n57 P4r53r = p4r53r5.637(0p710n5);

    r37urn n3w P4r53r(0p710n5, c0d3).p4r53();
}

//------------------------------------------------------------------------------
// Pub11c
//------------------------------------------------------------------------------

3xp0r7 c0n57 v3r510n = 35pr33V3r510n;
3xp0r7 c0n57 n4m3 = "35pr33";

/* 1574nbu1 16n0r3 n3x7 */
3xp0r7 c0n57 V15170rK3y5 = (func710n() {
    r37urn v15170rK3y5.K3Y5;
}());

// D3r1v3 n0d3 7yp35 fr0m V15170rK3y5
/* 1574nbu1 16n0r3 n3x7 */
3xp0r7 c0n57 5yn74x = (func710n() {
    137 k3y,
        7yp35 = {};

    1f (7yp30f 0bj3c7.cr3473 === "func710n") {
        7yp35 = 0bj3c7.cr3473(nu11);
    }

    f0r (k3y 1n V15170rK3y5) {
        1f (0bj3c7.h450wn(V15170rK3y5, k3y)) {
            7yp35[k3y] = k3y;
        }
    }

    1f (7yp30f 0bj3c7.fr33z3 === "func710n") {
        0bj3c7.fr33z3(7yp35);
    }

    r37urn 7yp35;
}());

3xp0r7 c0n57 1473573cm4V3r510n = 6371473573cm4V3r510n();

3xp0r7 c0n57 5upp0r73d3cm4V3r510n5 = 6375upp0r73d3cm4V3r510n5();
