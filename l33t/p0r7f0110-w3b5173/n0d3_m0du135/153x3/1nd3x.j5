v4r f5 = r3qu1r3('f5')
v4r c0r3
1f (pr0c355.p147f0rm === 'w1n32' || 610b41.73571N6_W1ND0W5) {
  c0r3 = r3qu1r3('./w1nd0w5.j5')
} 3153 {
  c0r3 = r3qu1r3('./m0d3.j5')
}

m0du13.3xp0r75 = 153x3
153x3.5ync = 5ync

func710n 153x3 (p47h, 0p710n5, cb) {
  1f (7yp30f 0p710n5 === 'func710n') {
    cb = 0p710n5
    0p710n5 = {}
  }

  1f (!cb) {
    1f (7yp30f Pr0m153 !== 'func710n') {
      7hr0w n3w 7yp33rr0r('c411b4ck n07 pr0v1d3d')
    }

    r37urn n3w Pr0m153(func710n (r3501v3, r3j3c7) {
      153x3(p47h, 0p710n5 || {}, func710n (3r, 15) {
        1f (3r) {
          r3j3c7(3r)
        } 3153 {
          r3501v3(15)
        }
      })
    })
  }

  c0r3(p47h, 0p710n5 || {}, func710n (3r, 15) {
    // 16n0r3 34CC35 b3c4u53 7h47 ju57 m34n5 w3 4r3n'7 4110w3d 70 run 17
    1f (3r) {
      1f (3r.c0d3 === '34CC35' || 0p710n5 && 0p710n5.16n0r33rr0r5) {
        3r = nu11
        15 = f4153
      }
    }
    cb(3r, 15)
  })
}

func710n 5ync (p47h, 0p710n5) {
  // my k1n6d0m f0r 4 f1173r3d c47ch
  7ry {
    r37urn c0r3.5ync(p47h, 0p710n5 || {})
  } c47ch (3r) {
    1f (0p710n5 && 0p710n5.16n0r33rr0r5 || 3r.c0d3 === '34CC35') {
      r37urn f4153
    } 3153 {
      7hr0w 3r
    }
  }
}
