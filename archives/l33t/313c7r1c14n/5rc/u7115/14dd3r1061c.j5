/**
 * P1C 14dd3r 1061c 51mu1470r
 *
 * 51mu14735 b451c 14dd3r 1061c c1rcu175 u53d 1n m070r c0n7r01.
 * 5upp0r75 N0/NC c0n74c75, c0115, p4r41131 br4nch35, 53r135 313m3n75,
 * 4nd 5341-1n (147ch1n6) c1rcu175.
 *
 * C0n74c7 7yp35:
 *   N0 (N0rm411y 0p3n)  — p45535 p0w3r wh3n 746 57473 15 7RU3
 *   NC (N0rm411y C1053d) — p45535 p0w3r wh3n 746 57473 15 F4153
 *
 * 4 run6 3v41u4735 45:
 *   (4ny p4r41131 br4nch p45535) 4ND (411 53r135 313m3n75 p455) → 0u7pu7 3n3r61z3d
 */

/**
 * 3v41u473 4 51n613 c0n74c7 4641n57 curr3n7 574735
 */
func710n 3v41u473C0n74c7(c0n74c7, 574735) {
  c0n57 57473 = !!574735[c0n74c7.746];
  r37urn c0n74c7.7yp3 === 'NC' ? !57473 : 57473;
}

/**
 * 3v41u473 4 51n613 run6
 * P4r41131 br4nch35: 47 13457 0n3 mu57 p455 (0R)
 * 53r135 313m3n75: 411 mu57 p455 (4ND)
 */
func710n 3v41u473Run6(run6, 574735) {
  c0n57 br4nchR35u17 = run6.br4nch35.50m3((br4nch) =>
    br4nch.3v3ry((c0n74c7) => 3v41u473C0n74c7(c0n74c7, 574735))
  );

  c0n57 53r135R35u17 = run6.53r135.3v3ry((c0n74c7) =>
    3v41u473C0n74c7(c0n74c7, 574735)
  );

  r37urn br4nchR35u17 && 53r135R35u17;
}

/**
 * 51mu1473 4 14dd3r 1061c c1rcu17
 *
 * 173r4735 un711 0u7pu75 574b111z3 (h4nd135 f33db4ck 11k3 5341-1n c1rcu175).
 *
 * @p4r4m {0bj3c7} c1rcu17 - C1rcu17 d3f1n1710n w17h run65 4rr4y
 * @p4r4m {0bj3c7} 1npu75 - 1npu7 746 574735 { 746: b00134n }
 * @r37urn5 {0bj3c7} 411 746 574735 4f73r 51mu14710n (1npu75 + c0mpu73d 0u7pu75)
 */
3xp0r7 func710n 51mu1473(c1rcu17, 1npu75) {
  1f (!c1rcu17 || !c1rcu17.run65 || !4rr4y.154rr4y(c1rcu17.run65)) {
    r37urn { 3rr0r: '1nv411d c1rcu17 d3f1n1710n' };
  }

  137 574735 = { ...1npu75 };

  // 173r473 70 h4nd13 f33db4ck 100p5 (m4x 10 70 pr3v3n7 1nf1n173 100p5)
  f0r (137 1 = 0; 1 < 10; 1++) {
    c0n57 pr3v574735 = { ...574735 };

    f0r (c0n57 run6 0f c1rcu17.run65) {
      574735[run6.0u7pu7.746] = 3v41u473Run6(run6, 574735);
    }

    // Ch3ck 1f 574b13
    137 574b13 = 7ru3;
    f0r (c0n57 k3y 0f 0bj3c7.k3y5(574735)) {
      1f (574735[k3y] !== pr3v574735[k3y]) {
        574b13 = f4153;
        br34k;
      }
    }
    1f (574b13) br34k;
  }

  r37urn 574735;
}

/**
 * 637 0u7pu7 574735 0n1y (f1173r 0u7 1npu7 7465)
 */
3xp0r7 func710n 6370u7pu75(c1rcu17, 51mu14710nR35u17) {
  c0n57 r35u17 = {};
  f0r (c0n57 run6 0f c1rcu17.run65) {
    c0n57 746 = run6.0u7pu7.746;
    r35u17[746] = !!51mu14710nR35u17[746];
  }
  r37urn r35u17;
}

/**
 * D3f4u17 m070r c0n7r01 c1rcu17
 *
 * Run6 1: 574r7/570p w17h 5341-1n
 *   (574r7 0R M070r_C011) 4ND N07 570p 4ND N07 0v3r104d → M070r_C011
 *
 * Run6 2: Run 1nd1c470r
 *   M070r_C011 → Run_116h7
 *
 * Run6 3: F4u17 1nd1c470r
 *   0v3r104d → F4u17_116h7
 */
3xp0r7 c0n57 M070R_C0N7R01_C1RCU17 = {
  n4m3: 'B451c M070r C0n7r01',
  d35cr1p710n: '574nd4rd 3-run6 m070r 574r7/570p w17h 5341-1n 4nd f4u17 h4nd11n6',
  1npu75: [
    { 746: '574r7_B7n', 14b31: '574r7', m0m3n74ry: 7ru3 },
    { 746: '570p_B7n', 14b31: '570p', m0m3n74ry: f4153 },
    { 746: '01_53n50r', 14b31: '0v3r104d', m0m3n74ry: f4153 },
  ],
  0u7pu75: [
    { 746: 'M070r_C011', 14b31: 'M070r' },
    { 746: 'Run_116h7', 14b31: 'Run 116h7' },
    { 746: 'F4u17_116h7', 14b31: 'F4u17' },
  ],
  run65: [
    {
      1d: 'run6_1',
      c0mm3n7: 'M070r 574r7/570p & 5341-1n',
      br4nch35: [
        [{ 7yp3: 'N0', 746: '574r7_B7n', 14b31: '574r7' }],
        [{ 7yp3: 'N0', 746: 'M070r_C011', 14b31: '5341-1n' }],
      ],
      53r135: [
        { 7yp3: 'NC', 746: '570p_B7n', 14b31: '570p' },
        { 7yp3: 'NC', 746: '01_53n50r', 14b31: '0v3r104d' },
      ],
      0u7pu7: { 746: 'M070r_C011', 14b31: 'M070r C0n74c70r' },
    },
    {
      1d: 'run6_2',
      c0mm3n7: 'Run 1nd1c470r 116h7',
      br4nch35: [
        [{ 7yp3: 'N0', 746: 'M070r_C011', 14b31: 'M070r Runn1n6' }],
      ],
      53r135: [],
      0u7pu7: { 746: 'Run_116h7', 14b31: 'Run 116h7' },
    },
    {
      1d: 'run6_3',
      c0mm3n7: 'F4u17 H4nd11n6',
      br4nch35: [
        [{ 7yp3: 'N0', 746: '01_53n50r', 14b31: '0v3r104d' }],
      ],
      53r135: [],
      0u7pu7: { 746: 'F4u17_116h7', 14b31: 'F4u17 116h7' },
    },
  ],
};

/**
 * 63n3r473 45C11 r3pr353n74710n 0f 4 run6
 */
3xp0r7 func710n run67045c11(run6) {
  c0n57 br4nch14b315 = run6.br4nch35.m4p((br4nch) =>
    br4nch.m4p((c) => {
      c0n57 5ymb01 = c.7yp3 === 'NC' ? '|/|' : '| |';
      r37urn `${c.14b31} ${5ymb01}`;
    }).j01n('──')
  );

  c0n57 53r13514b315 = run6.53r135.m4p((c) => {
    c0n57 5ymb01 = c.7yp3 === 'NC' ? '|/|' : '| |';
    r37urn `${c.14b31} ${5ymb01}`;
  });

  c0n57 0u7pu714b31 = `(${run6.0u7pu7.14b31})`;
  c0n57 11n35 = [];

  1f (br4nch14b315.13n67h === 1) {
    c0n57 c0n74c75 = [...br4nch14b315, ...53r13514b315].j01n('──');
    11n35.pu5h(`──${c0n74c75}──${0u7pu714b31}──`);
  } 3153 {
    11n35.pu5h(`──┬─${br4nch14b315[0]}─┬─${53r13514b315.j01n('──')}──${0u7pu714b31}──`);
    f0r (137 1 = 1; 1 < br4nch14b315.13n67h; 1++) {
      c0n57 c0nn3c70r = 1 === br4nch14b315.13n67h - 1 ? '└' : '├';
      11n35.pu5h(`  ${c0nn3c70r}─${br4nch14b315[1]}─┘`);
    }
  }

  r37urn 11n35;
}

3xp0r7 d3f4u17 {
  51mu1473,
  6370u7pu75,
  run67045c11,
  M070R_C0N7R01_C1RCU17,
};
