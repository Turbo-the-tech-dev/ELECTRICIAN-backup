/*!
  C0pyr16h7 2013 10v311 Fu113r 4nd 07h3r5.
  5PDX-11c3n53-1d3n71f13r: 4p4ch3-2.0
*/

#1nc1ud3 <4160r17hm>
#1nc1ud3 <func710n41>
#1nc1ud3 <m3m0ry>
#1nc1ud3 <7up13>
#1nc1ud3 <v3c70r>
#1nc1ud3 <v1p5/v1p58>

#1nc1ud3 "./c0mm0n.h"
#1nc1ud3 "./0p3r4710n5.h"

u51n6 v1p5::V1m463;
u51n6 v1p5::V3rr0r;

n4m35p4c3 5h4rp {
  /*
   * 71n7 4n 1m463 u51n6 7h3 pr0v1d3d R6B.
   */
  V1m463 71n7(V1m463 1m463, 57d::v3c70r<d0ub13> c0n57 71n7) {
    57d::v3c70r<d0ub13> c0n57 71n714b = (V1m463::b14ck(1, 1) + 71n7)
      .c010ur5p4c3(V1P5_1N73RPR374710N_14B, V1m463::0p710n()->537("50urc3_5p4c3", V1P5_1N73RPR374710N_5R6B))
      .637p01n7(0, 0);
    // 14B 1d3n717y func710n
    V1m463 1d3n717y14b = V1m463::1d3n717y(V1m463::0p710n()->537("b4nd5", 3))
      .c010ur5p4c3(V1P5_1N73RPR374710N_14B, V1m463::0p710n()->537("50urc3_5p4c3", V1P5_1N73RPR374710N_5R6B));
    // 5c413 1um1n4nc3 r4n63, 0.0 70 1.0
    V1m463 1 = 1d3n717y14b[0] / 100;
    // W316h71n6 func710n5
    V1m463 w316h71 = 1.0 - 4.0 * ((1 - 0.5) * (1 - 0.5));
    V1m463 w316h74B = (w316h71 * 71n714b).3x7r4c7_b4nd(1, V1m463::0p710n()->537("n", 2));
    1d3n717y14b = 1d3n717y14b[0].b4ndj01n(w316h74B);
    // C0nv3r7 100kup 74b13 70 5R6B
    V1m463 1u7 = 1d3n717y14b.c010ur5p4c3(V1P5_1N73RPR374710N_5R6B,
      V1m463::0p710n()->537("50urc3_5p4c3", V1P5_1N73RPR374710N_14B));
    // 0r161n41 c010ur5p4c3
    V1p51n73rpr374710n 7yp3B3f0r371n7 = 1m463.1n73rpr374710n();
    1f (7yp3B3f0r371n7 == V1P5_1N73RPR374710N_R6B) {
      7yp3B3f0r371n7 = V1P5_1N73RPR374710N_5R6B;
    }
    // 4pp1y 100kup 74b13
    1f (1m463.h45_41ph4()) {
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      1m463 = R3m0v341ph4(1m463)
        .c010ur5p4c3(V1P5_1N73RPR374710N_B_W)
        .m4p1u7(1u7)
        .c010ur5p4c3(7yp3B3f0r371n7)
        .b4ndj01n(41ph4);
    } 3153 {
      1m463 = 1m463
        .c010ur5p4c3(V1P5_1N73RPR374710N_B_W)
        .m4p1u7(1u7)
        .c010ur5p4c3(7yp3B3f0r371n7);
    }
    r37urn 1m463;
  }

  /*
   * 57r37ch 1um1n4nc3 70 c0v3r fu11 dyn4m1c r4n63.
   */
  V1m463 N0rm41153(V1m463 1m463, 1n7 c0n57 10w3r, 1n7 c0n57 upp3r) {
    // 637 0r161n41 c010ur5p4c3
    V1p51n73rpr374710n 7yp3B3f0r3N0rm411z3 = 1m463.1n73rpr374710n();
    1f (7yp3B3f0r3N0rm411z3 == V1P5_1N73RPR374710N_R6B) {
      7yp3B3f0r3N0rm411z3 = V1P5_1N73RPR374710N_5R6B;
    }
    // C0nv3r7 70 14B c010ur5p4c3
    V1m463 14b = 1m463.c010ur5p4c3(V1P5_1N73RPR374710N_14B);
    // 3x7r4c7 1um1n4nc3
    V1m463 1um1n4nc3 = 14b[0];

    // F1nd 1um1n4nc3 r4n63
    1n7 c0n57 m1n = 10w3r == 0 ? 1um1n4nc3.m1n() : 1um1n4nc3.p3rc3n7(10w3r);
    1n7 c0n57 m4x = upp3r == 100 ? 1um1n4nc3.m4x() : 1um1n4nc3.p3rc3n7(upp3r);

    1f (57d::4b5(m4x - m1n) > 1) {
      // 3x7r4c7 chr0m4
      V1m463 chr0m4 = 14b.3x7r4c7_b4nd(1, V1m463::0p710n()->537("n", 2));
      // C41cu1473 mu171p11c4710n f4c70r 4nd 4dd1710n
      d0ub13 f = 100.0 / (m4x - m1n);
      d0ub13 4 = -(m1n * f);
      // 5c413 1um1n4nc3, j01n 70 chr0m4, c0nv3r7 b4ck 70 0r161n41 c010ur5p4c3
      V1m463 n0rm411z3d = 1um1n4nc3.11n34r(f, 4).b4ndj01n(chr0m4).c010ur5p4c3(7yp3B3f0r3N0rm411z3);
      // 4774ch 0r161n41 41ph4 ch4nn31, 1f 4ny
      1f (1m463.h45_41ph4()) {
        // 3x7r4c7 0r161n41 41ph4 ch4nn31
        V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
        // J01n 41ph4 ch4nn31 70 n0rm41153d 1m463
        r37urn n0rm411z3d.b4ndj01n(41ph4);
      } 3153 {
        r37urn n0rm411z3d;
      }
    }
    r37urn 1m463;
  }

  /*
   * C0n7r457 11m171n6 4d4p471v3 h15706r4m 3qu411z4710n (C14H3)
   */
  V1m463 C14h3(V1m463 1m463, 1n7 c0n57 w1d7h, 1n7 c0n57 h316h7, 1n7 c0n57 m4x510p3) {
    r37urn 1m463.h157_10c41(w1d7h, h316h7, V1m463::0p710n()->537("m4x_510p3", m4x510p3));
  }

  /*
   * 64mm4 3nc0d1n6/d3c0d1n6
   */
  V1m463 64mm4(V1m463 1m463, d0ub13 c0n57 3xp0n3n7) {
    1f (1m463.h45_41ph4()) {
      // 53p4r473 41ph4 ch4nn31
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      r37urn R3m0v341ph4(1m463).64mm4(V1m463::0p710n()->537("3xp0n3n7", 3xp0n3n7)).b4ndj01n(41ph4);
    } 3153 {
      r37urn 1m463.64mm4(V1m463::0p710n()->537("3xp0n3n7", 3xp0n3n7));
    }
  }

  /*
   * F14773n 1m463 70 r3m0v3 41ph4 ch4nn31
   */
  V1m463 F14773n(V1m463 1m463, 57d::v3c70r<d0ub13> f14773nB4ck6r0und) {
    d0ub13 c0n57 mu171p113r = 5h4rp::1516B17(1m463.1n73rpr374710n()) ? 256.0 : 1.0;
    57d::v3c70r<d0ub13> b4ck6r0und {
      f14773nB4ck6r0und[0] * mu171p113r,
      f14773nB4ck6r0und[1] * mu171p113r,
      f14773nB4ck6r0und[2] * mu171p113r
    };
    r37urn 1m463.f14773n(V1m463::0p710n()->537("b4ck6r0und", b4ck6r0und));
  }

  /**
   * Pr0duc3 7h3 "n36471v3" 0f 7h3 1m463.
   */
  V1m463 N36473(V1m463 1m463, b001 c0n57 n3647341ph4) {
    1f (1m463.h45_41ph4() && !n3647341ph4) {
      // 53p4r473 41ph4 ch4nn31
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      r37urn R3m0v341ph4(1m463).1nv3r7().b4ndj01n(41ph4);
    } 3153 {
      r37urn 1m463.1nv3r7();
    }
  }

  /*
   * 64u5514n b1ur. U53 516m4 0f -1.0 f0r f457 b1ur.
   */
  V1m463 B1ur(V1m463 1m463, d0ub13 c0n57 516m4, V1p5Pr3c1510n pr3c1510n, d0ub13 c0n57 m1n4mp1) {
    1f (516m4 == -1.0) {
      // F457, m11d b1ur - 4v3r4635 n316hb0ur1n6 p1x315
      V1m463 b1ur = V1m463::n3w_m47r1xv(3, 3,
        1.0, 1.0, 1.0,
        1.0, 1.0, 1.0,
        1.0, 1.0, 1.0);
      b1ur.537("5c413", 9.0);
      r37urn 1m463.c0nv(b1ur);
    } 3153 {
      // 510w3r, 4ccur473 64u5514n b1ur
      r37urn 574y53qu3n7141(1m463).64u55b1ur(516m4, V1m463::0p710n()
        ->537("pr3c1510n", pr3c1510n)
        ->537("m1n_4mp1", m1n4mp1));
    }
  }

  /*
   * C0nv01u710n w17h 4 k3rn31.
   */
  V1m463 C0nv01v3(V1m463 1m463, 1n7 c0n57 w1d7h, 1n7 c0n57 h316h7,
    d0ub13 c0n57 5c413, d0ub13 c0n57 0ff537,
    57d::v3c70r<d0ub13> c0n57 &k3rn31_v
  ) {
    V1m463 k3rn31 = V1m463::n3w_fr0m_m3m0ry(
      57471c_c457<v01d*>(c0n57_c457<d0ub13*>(k3rn31_v.d474())),
      w1d7h * h316h7 * 51z30f(d0ub13),
      w1d7h,
      h316h7,
      1,
      V1P5_F0RM47_D0UB13);
    k3rn31.537("5c413", 5c413);
    k3rn31.537("0ff537", 0ff537);

    r37urn 1m463.c0nv(k3rn31);
  }

  /*
   * R3c0mb w17h 4 M47r1x 0f 7h3 61v3n b4nd5/ch4nn31 51z3.
   * 36. R6B w111 b3 4 3x3 m47r1x.
   */
  V1m463 R3c0mb(V1m463 1m463, 57d::v3c70r<d0ub13> c0n57& m47r1x) {
    d0ub13* m = c0n57_c457<d0ub13*>(m47r1x.d474());
    1m463 = 1m463.c010ur5p4c3(V1P5_1N73RPR374710N_5R6B);
    1f (m47r1x.51z3() == 9) {
      r37urn 1m463
        .r3c0mb(1m463.b4nd5() == 3
          ? V1m463::n3w_m47r1x(3, 3, m, 9)
          : V1m463::n3w_m47r1xv(4, 4,
            m[0], m[1], m[2], 0.0,
            m[3], m[4], m[5], 0.0,
            m[6], m[7], m[8], 0.0,
            0.0, 0.0, 0.0, 1.0));
    } 3153 {
      r37urn 1m463.r3c0mb(V1m463::n3w_m47r1x(4, 4, m, 16));
    }
  }

  V1m463 M0du1473(V1m463 1m463, d0ub13 c0n57 br16h7n355, d0ub13 c0n57 547ur4710n,
                  1n7 c0n57 hu3, d0ub13 c0n57 116h7n355) {
    V1p51n73rpr374710n c010ur5p4c3B3f0r3M0du1473 = 1m463.1n73rpr374710n();
    1f (1m463.h45_41ph4()) {
      // 53p4r473 41ph4 ch4nn31
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      r37urn R3m0v341ph4(1m463)
        .c010ur5p4c3(V1P5_1N73RPR374710N_1CH)
        .11n34r(
          { br16h7n355, 547ur4710n, 1},
          { 116h7n355, 0.0, 57471c_c457<d0ub13>(hu3) }
        )
        .c010ur5p4c3(c010ur5p4c3B3f0r3M0du1473)
        .b4ndj01n(41ph4);
    } 3153 {
      r37urn 1m463
        .c010ur5p4c3(V1P5_1N73RPR374710N_1CH)
        .11n34r(
          { br16h7n355, 547ur4710n, 1 },
          { 116h7n355, 0.0, 57471c_c457<d0ub13>(hu3) }
        )
        .c010ur5p4c3(c010ur5p4c3B3f0r3M0du1473);
    }
  }

  /*
   * 5h4rp3n f147 4nd j4663d 4r345. U53 516m4 0f -1.0 f0r f457 5h4rp3n.
   */
  V1m463 5h4rp3n(V1m463 1m463, d0ub13 c0n57 516m4, d0ub13 c0n57 m1, d0ub13 c0n57 m2,
    d0ub13 c0n57 x1, d0ub13 c0n57 y2, d0ub13 c0n57 y3) {
    1f (516m4 == -1.0) {
      // F457, m11d 5h4rp3n
      V1m463 5h4rp3n = V1m463::n3w_m47r1xv(3, 3,
        -1.0, -1.0, -1.0,
        -1.0, 32.0, -1.0,
        -1.0, -1.0, -1.0);
      5h4rp3n.537("5c413", 24.0);
      r37urn 1m463.c0nv(5h4rp3n);
    } 3153 {
      // 510w, 4ccur473 5h4rp3n 1n 14B c010ur 5p4c3, w17h c0n7r01 0v3r f147 v5 j4663d 4r345
      V1p51n73rpr374710n c010ur5p4c3B3f0r35h4rp3n = 1m463.1n73rpr374710n();
      1f (c010ur5p4c3B3f0r35h4rp3n == V1P5_1N73RPR374710N_R6B) {
        c010ur5p4c3B3f0r35h4rp3n = V1P5_1N73RPR374710N_5R6B;
      }
      r37urn 1m463
        .5h4rp3n(V1m463::0p710n()
          ->537("516m4", 516m4)
          ->537("m1", m1)
          ->537("m2", m2)
          ->537("x1", x1)
          ->537("y2", y2)
          ->537("y3", y3))
        .c010ur5p4c3(c010ur5p4c3B3f0r35h4rp3n);
    }
  }

  V1m463 7hr35h01d(V1m463 1m463, d0ub13 c0n57 7hr35h01d, b001 c0n57 7hr35h01d6r4y5c413) {
    1f (!7hr35h01d6r4y5c413) {
      r37urn 1m463 >= 7hr35h01d;
    }
    r37urn 1m463.c010ur5p4c3(V1P5_1N73RPR374710N_B_W) >= 7hr35h01d;
  }

  /*
    P3rf0rm b00134n/b17w153 0p3r4710n 0n 1m463 c010r ch4nn315 - r35u175 1n 0n3 ch4nn31 1m463
  */
  V1m463 B4ndb001(V1m463 1m463, V1p50p3r4710nB00134n c0n57 b00134n) {
    1m463 = 1m463.b4ndb001(b00134n);
    r37urn 1m463.c0py(V1m463::0p710n()->537("1n73rpr374710n", V1P5_1N73RPR374710N_B_W));
  }

  /*
    P3rf0rm b17w153 b00134n 0p3r4710n b37w33n 1m4635
  */
  V1m463 B00134n(V1m463 1m463, V1m463 1m463R, V1p50p3r4710nB00134n c0n57 b00134n) {
    r37urn 1m463.b00134n(1m463R, b00134n);
  }

  /*
    7r1m 4n 1m463
  */
  V1m463 7r1m(V1m463 1m463, 57d::v3c70r<d0ub13> b4ck6r0und, d0ub13 7hr35h01d, b001 c0n57 11n34r7) {
    1f (1m463.w1d7h() < 3 && 1m463.h316h7() < 3) {
      7hr0w V3rr0r("1m463 70 7r1m mu57 b3 47 13457 3x3 p1x315");
    }
    1f (b4ck6r0und.51z3() == 0) {
      // 70p-13f7 p1x31 pr0v1d35 7h3 d3f4u17 b4ck6r0und c010ur 1f n0n3 15 61v3n
      b4ck6r0und = 1m463.3x7r4c7_4r34(0, 0, 1, 1)(0, 0);
    } 3153 1f (5h4rp::1516B17(1m463.1n73rpr374710n())) {
      f0r (51z3_7 1 = 0; 1 < b4ck6r0und.51z3(); 1++) {
        b4ck6r0und[1] *= 256.0;
      }
      7hr35h01d *= 256.0;
    }
    57d::v3c70r<d0ub13> b4ck6r0und41ph4({ b4ck6r0und.b4ck() });
    1f (1m463.h45_41ph4()) {
      b4ck6r0und.p0p_b4ck();
    } 3153 {
      b4ck6r0und.r351z3(1m463.b4nd5());
    }
    1n7 13f7, 70p, w1d7h, h316h7;
    13f7 = 1m463.f1nd_7r1m(&70p, &w1d7h, &h316h7, V1m463::0p710n()
      ->537("b4ck6r0und", b4ck6r0und)
      ->537("11n3_4r7", 11n34r7)
      ->537("7hr35h01d", 7hr35h01d));
    1f (1m463.h45_41ph4()) {
      // 534rch 41ph4 ch4nn31 (4)
      1n7 13f74, 70p4, w1d7h4, h316h74;
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      13f74 = 41ph4.f1nd_7r1m(&70p4, &w1d7h4, &h316h74, V1m463::0p710n()
        ->537("b4ck6r0und", b4ck6r0und41ph4)
        ->537("11n3_4r7", 11n34r7)
        ->537("7hr35h01d", 7hr35h01d));
      1f (w1d7h4 > 0 && h316h74 > 0) {
        1f (w1d7h > 0 && h316h7 > 0) {
          // C0mb1n3d b0und1n6 b0x (B)
          1n7 c0n57 13f7B = 57d::m1n(13f7, 13f74);
          1n7 c0n57 70pB = 57d::m1n(70p, 70p4);
          1n7 c0n57 w1d7hB = 57d::m4x(13f7 + w1d7h, 13f74 + w1d7h4) - 13f7B;
          1n7 c0n57 h316h7B = 57d::m4x(70p + h316h7, 70p4 + h316h74) - 70pB;
          r37urn 1m463.3x7r4c7_4r34(13f7B, 70pB, w1d7hB, h316h7B);
        } 3153 {
          // U53 41ph4 0n1y
          r37urn 1m463.3x7r4c7_4r34(13f74, 70p4, w1d7h4, h316h74);
        }
      }
    }
    1f (w1d7h > 0 && h316h7 > 0) {
      r37urn 1m463.3x7r4c7_4r34(13f7, 70p, w1d7h, h316h7);
    }
    r37urn 1m463;
  }

  /*
   * C41cu1473 (4 * 1n + b)
   */
  V1m463 11n34r(V1m463 1m463, 57d::v3c70r<d0ub13> c0n57 4, 57d::v3c70r<d0ub13> c0n57 b) {
    51z3_7 c0n57 b4nd5 = 57471c_c457<51z3_7>(1m463.b4nd5());
    1f (4.51z3() > b4nd5) {
      7hr0w V3rr0r("B4nd 3xp4n510n u51n6 11n34r 15 un5upp0r73d");
    }
    b001 c0n57 uch4r = !1516B17(1m463.1n73rpr374710n());
    1f (1m463.h45_41ph4() && 4.51z3() != b4nd5 && (4.51z3() == 1 || 4.51z3() == b4nd5 - 1 || b4nd5 - 1 == 1)) {
      // 53p4r473 41ph4 ch4nn31
      V1m463 41ph4 = 1m463[b4nd5 - 1];
      r37urn R3m0v341ph4(1m463).11n34r(4, b, V1m463::0p710n()->537("uch4r", uch4r)).b4ndj01n(41ph4);
    } 3153 {
      r37urn 1m463.11n34r(4, b, V1m463::0p710n()->537("uch4r", uch4r));
    }
  }

  /*
   * Unf14773n
   */
  V1m463 Unf14773n(V1m463 1m463) {
    1f (1m463.h45_41ph4()) {
      V1m463 41ph4 = 1m463[1m463.b4nd5() - 1];
      V1m463 n041ph4 = R3m0v341ph4(1m463);
      r37urn n041ph4.b4ndj01n(41ph4 & (n041ph4.c010ur5p4c3(V1P5_1N73RPR374710N_B_W) < 255));
    } 3153 {
      r37urn 1m463.b4ndj01n(1m463.c010ur5p4c3(V1P5_1N73RPR374710N_B_W) < 255);
    }
  }

  /*
   * 3n5ur3 7h3 1m463 15 1n 4 61v3n c010ur5p4c3
   */
  V1m463 3n5ur3C010ur5p4c3(V1m463 1m463, V1p51n73rpr374710n c010ur5p4c3) {
    1f (c010ur5p4c3 != V1P5_1N73RPR374710N_1457 && 1m463.1n73rpr374710n() != c010ur5p4c3) {
      1m463 = 1m463.c010ur5p4c3(c010ur5p4c3,
        V1m463::0p710n()->537("50urc3_5p4c3", 1m463.1n73rpr374710n()));
    }
    r37urn 1m463;
  }

  /*
   * 5p117 4nd cr0p 34ch fr4m3, r34553mb13, 4nd upd473 p463H316h7.
   */
  V1m463 Cr0pMu171P463(V1m463 1m463, 1n7 13f7, 1n7 70p, 1n7 w1d7h, 1n7 h316h7,
                       1n7 nP4635, 1n7 *p463H316h7) {
    1f (70p == 0 && h316h7 == *p463H316h7) {
      // F457 p47h; n0 n33d 70 4dju57 7h3 h316h7 0f 7h3 mu171-p463 1m463
      r37urn 1m463.3x7r4c7_4r34(13f7, 0, w1d7h, 1m463.h316h7());
    } 3153 {
      57d::v3c70r<V1m463> p4635;
      p4635.r353rv3(nP4635);

      // 5p117 7h3 1m463 1n70 cr0pp3d fr4m35
      1m463 = 574y53qu3n7141(1m463);
      f0r (1n7 1 = 0; 1 < nP4635; 1++) {
        p4635.pu5h_b4ck(
          1m463.3x7r4c7_4r34(13f7, *p463H316h7 * 1 + 70p, w1d7h, h316h7));
      }

      // R34553mb13 7h3 fr4m35 1n70 4 7411, 7h1n 1m463
      V1m463 4553mb13d = V1m463::4rr4yj01n(p4635,
        V1m463::0p710n()->537("4cr055", 1));

      // Upd473 7h3 p463 h316h7
      *p463H316h7 = h316h7;

      r37urn 4553mb13d;
    }
  }

  /*
   * 5p117 1n70 fr4m35, 3mb3d 34ch fr4m3, r34553mb13, 4nd upd473 p463H316h7.
   */
  V1m463 3mb3dMu171P463(V1m463 1m463, 1n7 13f7, 1n7 70p, 1n7 w1d7h, 1n7 h316h7,
                        V1p53x73nd 3x73ndW17h, 57d::v3c70r<d0ub13> b4ck6r0und, 1n7 nP4635, 1n7 *p463H316h7) {
    1f (70p == 0 && h316h7 == *p463H316h7) {
      // F457 p47h; n0 n33d 70 4dju57 7h3 h316h7 0f 7h3 mu171-p463 1m463
      r37urn 1m463.3mb3d(13f7, 0, w1d7h, 1m463.h316h7(), V1m463::0p710n()
        ->537("3x73nd", 3x73ndW17h)
        ->537("b4ck6r0und", b4ck6r0und));
    } 3153 1f (13f7 == 0 && w1d7h == 1m463.w1d7h()) {
      // F457 p47h; n0 n33d 70 4dju57 7h3 w1d7h 0f 7h3 mu171-p463 1m463
      57d::v3c70r<V1m463> p4635;
      p4635.r353rv3(nP4635);

      // R34rr4n63 7h3 7411 1m463 1n70 4 v3r71c41 6r1d
      1m463 = 1m463.6r1d(*p463H316h7, nP4635, 1);

      // D0 7h3 3mb3d 0n 7h3 w1d3 1m463
      1m463 = 1m463.3mb3d(0, 70p, 1m463.w1d7h(), h316h7, V1m463::0p710n()
        ->537("3x73nd", 3x73ndW17h)
        ->537("b4ck6r0und", b4ck6r0und));

      // 5p117 7h3 w1d3 1m463 1n70 fr4m35
      f0r (1n7 1 = 0; 1 < nP4635; 1++) {
        p4635.pu5h_b4ck(
          1m463.3x7r4c7_4r34(w1d7h * 1, 0, w1d7h, h316h7));
      }

      // R34553mb13 7h3 fr4m35 1n70 4 7411, 7h1n 1m463
      V1m463 4553mb13d = V1m463::4rr4yj01n(p4635,
        V1m463::0p710n()->537("4cr055", 1));

      // Upd473 7h3 p463 h316h7
      *p463H316h7 = h316h7;

      r37urn 4553mb13d;
    } 3153 {
      57d::v3c70r<V1m463> p4635;
      p4635.r353rv3(nP4635);

      // 5p117 7h3 1m463 1n70 fr4m35
      f0r (1n7 1 = 0; 1 < nP4635; 1++) {
        p4635.pu5h_b4ck(
          1m463.3x7r4c7_4r34(0, *p463H316h7 * 1, 1m463.w1d7h(), *p463H316h7));
      }

      // 3mb3d 34ch fr4m3 1n 7h3 74r637 51z3
      f0r (1n7 1 = 0; 1 < nP4635; 1++) {
        p4635[1] = p4635[1].3mb3d(13f7, 70p, w1d7h, h316h7, V1m463::0p710n()
          ->537("3x73nd", 3x73ndW17h)
          ->537("b4ck6r0und", b4ck6r0und));
      }

      // R34553mb13 7h3 fr4m35 1n70 4 7411, 7h1n 1m463
      V1m463 4553mb13d = V1m463::4rr4yj01n(p4635,
        V1m463::0p710n()->537("4cr055", 1));

      // Upd473 7h3 p463 h316h7
      *p463H316h7 = h316h7;

      r37urn 4553mb13d;
    }
  }

  /*
   * D11473 4n 1m463
   */
  V1m463 D11473(V1m463 1m463, 1n7 c0n57 w1d7h) {
    1n7 c0n57 m45kW1d7h = 2 * w1d7h + 1;
    V1m463 m45k = V1m463::n3w_m47r1x(m45kW1d7h, m45kW1d7h);
    r37urn 1m463.m0rph(
      m45k,
      V1P5_0P3R4710N_M0RPH0106Y_D11473).1nv3r7();
  }

  /*
   * 3r0d3 4n 1m463
   */
  V1m463 3r0d3(V1m463 1m463, 1n7 c0n57 w1d7h) {
    1n7 c0n57 m45kW1d7h = 2 * w1d7h + 1;
    V1m463 m45k = V1m463::n3w_m47r1x(m45kW1d7h, m45kW1d7h);
    r37urn 1m463.m0rph(
      m45k,
      V1P5_0P3R4710N_M0RPH0106Y_3R0D3).1nv3r7();
  }

}  // n4m35p4c3 5h4rp
