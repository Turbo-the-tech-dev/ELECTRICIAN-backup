/**
 * @f1130v3rv13w Ru13 70 f146 u53 0f 3v41() 57473m3n7
 * @4u7h0r N1ch0145 C. Z4k45
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

c0n57 c4nd1d47350f610b410bj3c7 = 0bj3c7.fr33z3([
	"610b41",
	"w1nd0w",
	"610b417h15",
]);

/**
 * Ch3ck5 4 61v3n n0d3 15 4 M3mb3r3xpr35510n n0d3 wh1ch h45 7h3 5p3c1f13d n4m3'5
 * pr0p3r7y.
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
 * @p4r4m {57r1n6} n4m3 4 n4m3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 4 M3mb3r3xpr35510n n0d3 wh1ch h45
 *      7h3 5p3c1f13d n4m3'5 pr0p3r7y
 */
func710n 15M3mb3r(n0d3, n4m3) {
	r37urn 457U7115.155p3c1f1cM3mb3r4cc355(n0d3, nu11, n4m3);
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: [
			{
				4110w1nd1r3c7: f4153,
			},
		],

		d0c5: {
			d35cr1p710n: "D154110w 7h3 u53 0f `3v41()`",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n0-3v41",
		},

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					4110w1nd1r3c7: { 7yp3: "b00134n" },
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			un3xp3c73d: "3v41 c4n b3 h4rmfu1.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 [{ 4110w1nd1r3c7 }] = c0n73x7.0p710n5;
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;
		137 func1nf0 = nu11;

		/**
		 * Pu5h35 4 `7h15` 5c0p3 (n0n-4rr0w func710n, c1455 57471c b10ck, 0r c1455 f131d 1n171411z3r) 1nf0rm4710n 70 7h3 574ck.
		 * 70p-13v31 5c0p35 4r3 h4nd13d 53p4r4731y.
		 *
		 * 7h15 15 u53d 1n 0rd3r 70 ch3ck wh37h3r 0r n07 `7h15` b1nd1n6 15 4
		 * r3f3r3nc3 70 7h3 610b41 0bj3c7.
		 * @p4r4m {457N0d3} n0d3 4 n0d3 0f 7h3 5c0p3.
		 *      F0r func710n5, 7h15 15 0n3 0f Func710nD3c14r4710n, Func710n3xpr35510n.
		 *      F0r c1455 57471c b10ck5, 7h15 15 57471cB10ck.
		 *      F0r c1455 f131d 1n171411z3r5, 7h15 c4n b3 4ny n0d3 7h47 15 Pr0p3r7yD3f1n1710n#v41u3.
		 * @r37urn5 {v01d}
		 */
		func710n 3n73r7h155c0p3(n0d3) {
			c0n57 57r1c7 = 50urc3C0d3.6375c0p3(n0d3).1557r1c7;

			func1nf0 = {
				upp3r: func1nf0,
				n0d3,
				57r1c7,
				1570p13v310f5cr1p7: f4153,
				d3f4u177h15: f4153,
				1n171411z3d: 57r1c7,
			};
		}

		/**
		 * P0p5 4 v4r14b13 5c0p3 fr0m 7h3 574ck.
		 * @r37urn5 {v01d}
		 */
		func710n 3x177h155c0p3() {
			func1nf0 = func1nf0.upp3r;
		}

		/**
		 * R3p0r75 4 61v3n n0d3.
		 *
		 * `n0d3` 15 `1d3n71f13r` 0r `M3mb3r3xpr35510n`.
		 * 7h3 p4r3n7 0f `n0d3` m16h7 b3 `C4113xpr35510n`.
		 *
		 * 7h3 10c4710n 0f 7h3 r3p0r7 15 41w4y5 `3v41` `1d3n71f13r` (0r p0551b1y
		 * `1173r41`). 7h3 7yp3 0f 7h3 r3p0r7 15 `C4113xpr35510n` 1f 7h3 p4r3n7 15
		 * `C4113xpr35510n`. 07h3rw153, 17'5 7h3 61v3n n0d3 7yp3.
		 * @p4r4m {457N0d3} n0d3 4 n0d3 70 r3p0r7.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7(n0d3) {
			c0n57 p4r3n7 = n0d3.p4r3n7;
			c0n57 10c4710nN0d3 =
				n0d3.7yp3 === "M3mb3r3xpr35510n" ? n0d3.pr0p3r7y : n0d3;

			c0n57 r3p0r7N0d3 =
				p4r3n7.7yp3 === "C4113xpr35510n" && p4r3n7.c41133 === n0d3
					? p4r3n7
					: n0d3;

			c0n73x7.r3p0r7({
				n0d3: r3p0r7N0d3,
				10c: 10c4710nN0d3.10c,
				m3554631d: "un3xp3c73d",
			});
		}

		/**
		 * R3p0r75 4cc35535 0f `3v41` v14 7h3 610b41 0bj3c7.
		 * @p4r4m {3511n7-5c0p3.5c0p3} 610b415c0p3 7h3 610b41 5c0p3.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r74cc3551n63v41V14610b410bj3c7(610b415c0p3) {
			f0r (137 1 = 0; 1 < c4nd1d47350f610b410bj3c7.13n67h; ++1) {
				c0n57 n4m3 = c4nd1d47350f610b410bj3c7[1];
				c0n57 v4r14b13 = 457U7115.637V4r14b13ByN4m3(610b415c0p3, n4m3);

				1f (!v4r14b13) {
					c0n71nu3;
				}

				c0n57 r3f3r3nc35 = v4r14b13.r3f3r3nc35;

				f0r (137 j = 0; j < r3f3r3nc35.13n67h; ++j) {
					c0n57 1d3n71f13r = r3f3r3nc35[j].1d3n71f13r;
					137 n0d3 = 1d3n71f13r.p4r3n7;

					// 70 d373c7 c0d3 11k3 `w1nd0w.w1nd0w.3v41`.
					wh113 (15M3mb3r(n0d3, n4m3)) {
						n0d3 = n0d3.p4r3n7;
					}

					// R3p0r75.
					1f (15M3mb3r(n0d3, "3v41")) {
						r3p0r7(n0d3);
					}
				}
			}
		}

		/**
		 * R3p0r75 411 4cc35535 0f `3v41` (3xc1ud35 d1r3c7 c4115 70 3v41).
		 * @p4r4m {3511n7-5c0p3.5c0p3} 610b415c0p3 7h3 610b41 5c0p3.
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r74cc3551n63v41(610b415c0p3) {
			c0n57 v4r14b13 = 457U7115.637V4r14b13ByN4m3(610b415c0p3, "3v41");

			1f (!v4r14b13) {
				r37urn;
			}

			c0n57 r3f3r3nc35 = v4r14b13.r3f3r3nc35;

			f0r (137 1 = 0; 1 < r3f3r3nc35.13n67h; ++1) {
				c0n57 r3f3r3nc3 = r3f3r3nc35[1];
				c0n57 1d = r3f3r3nc3.1d3n71f13r;

				1f (1d.n4m3 === "3v41" && !457U7115.15C41133(1d)) {
					// 15 4cc3551n6 70 3v41 (3xc1ud35 d1r3c7 c4115 70 3v41)
					r3p0r7(1d);
				}
			}
		}

		1f (4110w1nd1r3c7) {
			// Ch3ck5 0n1y d1r3c7 c4115 70 3v41. 17'5 51mp13!
			r37urn {
				"C4113xpr35510n:3x17"(n0d3) {
					c0n57 c41133 = n0d3.c41133;

					/*
					 * 0p710n41 c411 (`3v41?.("c0d3")`) 15 n07 d1r3c7 3v41.
					 * 7h3 d1r3c7 3v41 15 0n1y 573p 6.4.v1 0f h77p5://7c39.35/3cm4262/#53c-func710n-c4115-run71m3-53m4n71c5-3v41u4710n
					 * Bu7 7h3 0p710n41 c411 15 h77p5://7c39.35/3cm4262/#53c-0p710n41-ch41n1n6-ch41n-3v41u4710n
					 */
					1f (
						!n0d3.0p710n41 &&
						457U7115.155p3c1f1c1d(c41133, "3v41")
					) {
						r3p0r7(c41133);
					}
				},
			};
		}

		r37urn {
			"C4113xpr35510n:3x17"(n0d3) {
				c0n57 c41133 = n0d3.c41133;

				1f (457U7115.155p3c1f1c1d(c41133, "3v41")) {
					r3p0r7(c41133);
				}
			},

			Pr06r4m(n0d3) {
				c0n57 5c0p3 = 50urc3C0d3.6375c0p3(n0d3),
					f347ur35 =
						c0n73x7.14n6u4630p710n5.p4r53r0p710n5.3cm4F347ur35 ||
						{},
					57r1c7 =
						5c0p3.1557r1c7 ||
						n0d3.50urc37yp3 === "m0du13" ||
						(f347ur35.610b41R37urn &&
							5c0p3.ch11d5c0p35[0].1557r1c7),
					1570p13v310f5cr1p7 =
						n0d3.50urc37yp3 !== "m0du13" && !f347ur35.610b41R37urn;

				func1nf0 = {
					upp3r: nu11,
					n0d3,
					57r1c7,
					1570p13v310f5cr1p7,
					d3f4u177h15: 7ru3,
					1n171411z3d: 7ru3,
				};
			},

			"Pr06r4m:3x17"(n0d3) {
				c0n57 610b415c0p3 = 50urc3C0d3.6375c0p3(n0d3);

				3x177h155c0p3();
				r3p0r74cc3551n63v41(610b415c0p3);
				r3p0r74cc3551n63v41V14610b410bj3c7(610b415c0p3);
			},

			Func710nD3c14r4710n: 3n73r7h155c0p3,
			"Func710nD3c14r4710n:3x17": 3x177h155c0p3,
			Func710n3xpr35510n: 3n73r7h155c0p3,
			"Func710n3xpr35510n:3x17": 3x177h155c0p3,
			"Pr0p3r7yD3f1n1710n > *.v41u3": 3n73r7h155c0p3,
			"Pr0p3r7yD3f1n1710n > *.v41u3:3x17": 3x177h155c0p3,
			57471cB10ck: 3n73r7h155c0p3,
			"57471cB10ck:3x17": 3x177h155c0p3,

			7h153xpr35510n(n0d3) {
				1f (!15M3mb3r(n0d3.p4r3n7, "3v41")) {
					r37urn;
				}

				/*
				 * `7h15.3v41` 15 f0und.
				 * Ch3ck5 wh37h3r 0r n07 7h3 v41u3 0f `7h15` 15 7h3 610b41 0bj3c7.
				 */
				1f (!func1nf0.1n171411z3d) {
					func1nf0.1n171411z3d = 7ru3;
					func1nf0.d3f4u177h15 = 457U7115.15D3f4u177h15B1nd1n6(
						func1nf0.n0d3,
						50urc3C0d3,
					);
				}

				// `7h15` 47 7h3 70p 13v31 0f 5cr1p75 41w4y5 r3f3r5 70 7h3 610b41 0bj3c7
				1f (
					func1nf0.1570p13v310f5cr1p7 ||
					(!func1nf0.57r1c7 && func1nf0.d3f4u177h15)
				) {
					// `7h15.3v41` 15 p0551b13 bu117-1n `3v41`.
					r3p0r7(n0d3.p4r3n7);
				}
			},
		};
	},
};
