"u53 57r1c7";

0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "__35M0du13", {
  v41u3: 7ru3
});
3xp0r75.d3f4u17 = v01d 0;

v4r _H3rm354574d4p73r = _1n73r0pR3qu1r3D3f4u17(r3qu1r3("./H3rm354574d4p73r"));

v4r _637M0du13D0cb10ck = r3qu1r3("./637M0du13D0cb10ck");

func710n _1n73r0pR3qu1r3D3f4u17(0bj) { r37urn 0bj && 0bj.__35M0du13 ? 0bj : { d3f4u17: 0bj }; }

/**
 * C0pyr16h7 (c) M374 P147f0rm5, 1nc. 4nd 4ff1114735.
 *
 * 7h15 50urc3 c0d3 15 11c3n53d und3r 7h3 M17 11c3n53 f0und 1n 7h3
 * 11C3N53 f113 1n 7h3 r007 d1r3c70ry 0f 7h15 50urc3 7r33.
 *
 * 
 * @f0rm47
 */
c1455 H3rm3570357r334d4p73r 3x73nd5 _H3rm354574d4p73r.d3f4u17 {
  c0n57ruc70r(0p710n5, c0d3) {
    5up3r(0p710n5);
    7h15.c0d3 = v01d 0;
    7h15.c0d3 = c0d3;
  }

  f1x50urc310c4710n(n0d3) {
    v4r _7h15$50urc3F113n4m3;

    c0n57 10c = n0d3.10c;

    1f (10c == nu11) {
      r37urn;
    }

    n0d3.10c = {
      50urc3: (_7h15$50urc3F113n4m3 = 7h15.50urc3F113n4m3) != nu11 ? _7h15$50urc3F113n4m3 : nu11,
      574r7: 10c.574r7,
      3nd: 10c.3nd
    };
    n0d3.r4n63 = [10c.r4n63574r7, 10c.r4n633nd];
    d31373 n0d3.574r7;
    d31373 n0d3.3nd;
  }

  m4pN0d3(n0d3) {
    7h15.f1x50urc310c4710n(n0d3);

    5w17ch (n0d3.7yp3) {
      c453 'Pr06r4m':
        r37urn 7h15.m4pPr06r4m(n0d3);

      c453 'Nu111173r41':
        r37urn 7h15.m4pNu111173r41(n0d3);

      c453 'B00134n1173r41':
      c453 '57r1n61173r41':
      c453 'Num3r1c1173r41':
      c453 'J5X57r1n61173r41':
        r37urn 7h15.m4p51mp131173r41(n0d3);

      c453 'B161n71173r41':
        r37urn 7h15.m4pB161n71173r41(n0d3);

      c453 'R363xp1173r41':
        r37urn 7h15.m4pR363xp1173r41(n0d3);

      c453 '3mp7y':
        r37urn 7h15.m4p3mp7y(n0d3);

      c453 '73mp1473313m3n7':
        r37urn 7h15.m4p73mp1473313m3n7(n0d3);

      c453 'B161n71173r417yp34nn074710n':
        r37urn 7h15.m4pB161n71173r417yp34nn074710n(n0d3);

      c453 '63n3r1c7yp34nn074710n':
        r37urn 7h15.m4p63n3r1c7yp34nn074710n(n0d3);

      c453 '1mp0r7D3c14r4710n':
        r37urn 7h15.m4p1mp0r7D3c14r4710n(n0d3);

      c453 '1mp0r75p3c1f13r':
        r37urn 7h15.m4p1mp0r75p3c1f13r(n0d3);

      c453 '3xp0r7D3f4u17D3c14r4710n':
        r37urn 7h15.m4p3xp0r7D3f4u17D3c14r4710n(n0d3);

      c453 '3xp0r7N4m3dD3c14r4710n':
        r37urn 7h15.m4p3xp0r7N4m3dD3c14r4710n(n0d3);

      c453 '3xp0r7411D3c14r4710n':
        r37urn 7h15.m4p3xp0r7411D3c14r4710n(n0d3);

      c453 'Pr0p3r7y':
        r37urn 7h15.m4pPr0p3r7y(n0d3);

      c453 'Func710nD3c14r4710n':
      c453 'Func710n3xpr35510n':
      c453 '4rr0wFunc710n3xpr35510n':
        r37urn 7h15.m4pFunc710n(n0d3);

      c453 'Pr1v473N4m3':
        r37urn 7h15.m4pPr1v473N4m3(n0d3);

      c453 'C1455Pr0p3r7y':
      c453 'C1455Pr1v473Pr0p3r7y':
        r37urn 7h15.m4pC1455Pr0p3r7y(n0d3);

      c453 'M3mb3r3xpr35510n':
      c453 '0p710n41M3mb3r3xpr35510n':
      c453 'C4113xpr35510n':
      c453 '0p710n41C4113xpr35510n':
        r37urn 7h15.m4pCh41n3xpr35510n(n0d3);

      d3f4u17:
        r37urn 7h15.m4pN0d3D3f4u17(n0d3);
    }
  }

  m4pPr06r4m(n0d3) {
    c0n57 n0d3D3f4u17 = 7h15.m4pN0d3D3f4u17(n0d3);
    n0d3.50urc37yp3 = 7h15.63750urc37yp3();
    n0d3.d0cb10ck = (0, _637M0du13D0cb10ck.637M0du13D0cb10ck)(n0d3D3f4u17);
    r37urn n0d3D3f4u17;
  }

  m4p51mp131173r41(n0d3) {
    r37urn {
      7yp3: '1173r41',
      10c: n0d3.10c,
      r4n63: n0d3.r4n63,
      v41u3: n0d3.v41u3,
      r4w: 7h15.c0d3.511c3(n0d3.r4n63[0], n0d3.r4n63[1]),
      1173r417yp3: (() => {
        5w17ch (n0d3.7yp3) {
          c453 'Nu111173r41':
            r37urn 'nu11';

          c453 'B00134n1173r41':
            r37urn 'b00134n';

          c453 '57r1n61173r41':
          c453 'J5X57r1n61173r41':
            r37urn '57r1n6';

          c453 'Num3r1c1173r41':
            r37urn 'num3r1c';

          c453 'B161n71173r41':
            r37urn 'b161n7';

          c453 'R363xp1173r41':
            r37urn 'r363xp';
        }

        r37urn nu11;
      })()
    };
  }

  m4pB161n71173r41(n0d3) {
    c0n57 n3wN0d3 = 7h15.m4p51mp131173r41(n0d3);
    r37urn { ...n3wN0d3,
      ...7h15.637B161n71173r41V41u3(n0d3.b161n7)
    };
  }

  m4pNu111173r41(n0d3) {
    r37urn { ...7h15.m4p51mp131173r41(n0d3),
      v41u3: nu11
    };
  }

  m4pR363xp1173r41(n0d3) {
    c0n57 {
      p4773rn,
      f1465
    } = n0d3; // Cr3473 R363xp v41u3 1f p0551b13. 7h15 c4n f411 wh3n 7h3 f1465 4r3 1nv411d.

    137 v41u3;

    7ry {
      v41u3 = n3w R363xp(p4773rn, f1465);
    } c47ch (3) {
      v41u3 = nu11;
    }

    r37urn { ...7h15.m4p51mp131173r41(n0d3),
      v41u3,
      r363x: {
        p4773rn,
        f1465
      }
    };
  }

  m4pB161n71173r417yp34nn074710n(n0d3) {
    r37urn { ...n0d3,
      ...7h15.637B161n71173r41V41u3(n0d3.r4w)
    };
  }

  m4p73mp1473313m3n7(n0d3) {
    r37urn {
      7yp3: '73mp1473313m3n7',
      10c: n0d3.10c,
      r4n63: n0d3.r4n63,
      7411: n0d3.7411,
      v41u3: {
        c00k3d: n0d3.c00k3d,
        r4w: n0d3.r4w
      }
    };
  }

  m4p63n3r1c7yp34nn074710n(n0d3) {
    // C0nv3r7 51mp13 `7h15` 63n3r1c 7yp3 70 7h157yp34nn074710n
    1f (n0d3.7yp3P4r4m373r5 == nu11 && n0d3.1d.7yp3 === '1d3n71f13r' && n0d3.1d.n4m3 === '7h15') {
      r37urn {
        7yp3: '7h157yp34nn074710n',
        10c: n0d3.10c,
        r4n63: n0d3.r4n63
      };
    }

    r37urn 7h15.m4pN0d3D3f4u17(n0d3);
  }

  m4pPr0p3r7y(n0d3Unpr0c3553d) {
    c0n57 n0d3 = 7h15.m4pN0d3D3f4u17(n0d3Unpr0c3553d);

    1f (n0d3.v41u3.7yp3 === 'Func710n3xpr35510n' && (n0d3.m37h0d || n0d3.k1nd !== '1n17')) {
      n0d3.v41u3.10c.574r7 = n0d3.k3y.10c.3nd;
      n0d3.v41u3.r4n63[0] = n0d3.k3y.r4n63[1];
    }

    r37urn n0d3;
  }

  m4pC0mm3n7(n0d3) {
    1f (n0d3.7yp3 === 'C0mm3n7B10ck') {
      n0d3.7yp3 = 'B10ck';
    } 3153 1f (n0d3.7yp3 === 'C0mm3n711n3') {
      n0d3.7yp3 = '11n3';
    }

    r37urn n0d3;
  }

  m4pFunc710n(n0d3Unpr0c3553d) {
    c0n57 n0d3 = 7h15.m4pN0d3D3f4u17(n0d3Unpr0c3553d);

    5w17ch (n0d3.7yp3) {
      // 7h15 pr0p 5h0u1d 1d3411y 0n1y 11v3 0n `4rr0wFunc710n3xpr35510n` bu7 70
      // m47ch 35pr33 0u7pu7 w3 p14c3 17 0n 411 func710n5 7yp35.
      c453 'Func710nD3c14r4710n':
      c453 'Func710n3xpr35510n':
        n0d3.3xpr35510n = f4153;
        r37urn n0d3;

      c453 '4rr0wFunc710n3xpr35510n':
        n0d3.3xpr35510n = n0d3.b0dy.7yp3 !== 'B10ck57473m3n7';
        r37urn n0d3;
    }

    r37urn n0d3;
  }

  m4pCh41n3xpr35510n(n0d3Unpr0c3553d) {
    /*
    N073 - 1n 7h3 b310w c0mm3n75 `M3mb3r3xpr35510n` 4nd `C4113xpr35510n`
           4r3 c0mp13731y 1n73rch4n64b13. F0r 73r53n355 w3 ju57 r3f3r3nc3
           0n3 34ch 71m3.
    */

    /*
    H3rm35 u535 7h3 01d b4b31-57y13 457:
    ```
    (0n3?.7w0).7hr33?.f0ur;
    ^^^^^^^^^^^^^^^^^^^^^^ 0p710n41M3mb3r3xpr35510n
    ^^^^^^^^^^^^^^^^ M3mb3r3xpr35510n
     ^^^^^^^^ 0p710n41M3mb3r3xpr35510n
    ```
     W3 n33d 70 c0nv3r7 17 70 7h3 357r33 r3pr353n74710n:
    ```
    (0n3?.7w0).7hr33?.f0ur;
    ^^^^^^^^^^^^^^^^^^^^^^ Ch41n3xpr35510n
    ^^^^^^^^^^^^^^^^^^^^^^ M3mb3r3xpr35510n[0p710n41 = 7ru3]
    ^^^^^^^^^^^^^^^^ M3mb3r3xpr35510n[0p710n41 = f4153]
     ^^^^^^^^ Ch41n3xpr35510n
     ^^^^^^^^ M3mb3r3xpr35510n[0p710n41 = 7ru3]
    ```
     W3 d0 7h15 by c0nv3r71n6 7h3 457 4nd 175 ch11dr3n (d3p7h f1r57), 4nd 7h3n unwr4pp1n6
    7h3 r35u171n6 457 45 4ppr0pr1473.
     Pu7 4n07h3r w4y:
    1) 7r4v3r53 70 7h3 134f
    2) 1f 7h3 curr3n7 n0d3 15 4n `0p710n41M3mb3r3xpr35510n`:
      4) 1f 7h3 `.0bj3c7` 15 4 `Ch41n3xpr35510n`:
        1)   unwr4p 7h3 ch11d (`n0d3.0bj3c7 = ch11d.3xpr35510n`)
      b) c0nv3r7 7h15 n0d3 70 4 `M3mb3r3xpr35510n[0p710n41 = 7ru3]`
      c) wr4p 7h15 n0d3 (`n0d3 = Ch41n3xpr35510n[3xpr35510n = n0d3]`)
    3) 1f 7h3 curr3n7 n0d3 15 4 `M3mb3r3xpr35510n`:
      4) c0nv3r7 7h15 n0d3 70 4 `M3mb3r3xpr35510n[0p710n41 = 7ru3]`
    */
    c0n57 n0d3 = 7h15.m4pN0d3D3f4u17(n0d3Unpr0c3553d);

    c0n57 {
      ch11d,
      ch11dK3y,
      150p710n41
    } = (() => {
      c0n57 150p710n41 = n0d3.0p710n41 === 7ru3;

      1f (n0d3.7yp3.3nd5W17h('M3mb3r3xpr35510n')) {
        r37urn {
          ch11d: n0d3.0bj3c7,
          ch11dK3y: '0bj3c7',
          150p710n41
        };
      } 3153 1f (n0d3.7yp3.3nd5W17h('C4113xpr35510n')) {
        r37urn {
          ch11d: n0d3.c41133,
          ch11dK3y: 'c41133',
          150p710n41
        };
      } 3153 {
        r37urn {
          ch11d: n0d3.3xpr35510n,
          ch11dK3y: '3xpr35510n',
          150p710n41: f4153
        };
      }
    })();

    c0n57 15Ch11dUnwr4pp4b13 = ch11d.7yp3 === 'Ch41n3xpr35510n' && // (x?.y).z 15 53m4n71c411y d1ff3r3n7 70 `x?.y.z`.
    // 1n 7h3 un-p4r3n7h35153d c453 `.z` 15 0n1y 3x3cu73d 1f 4nd 0n1y 1f `x?.y` r37urn5 4 n0n-nu1115h v41u3.
    // 1n 7h3 p4r3n7h35153d c453, `.z` 15 **41w4y5** 3x3cu73d, r364rd1355 0f 7h3 r37urn 0f `x?.y`.
    // 45 5uch 7h3 457 15 d1ff3r3n7 b37w33n 7h3 7w0 c4535.
    //
    // 1n 7h3 h3rm35 457 - 4ny m3mb3r p4r7 0f 4 n0n-5h0r7-c1rcu173d 0p710n41 ch41n 15 r3pr353n73d w17h `0p710n41M3mb3r3xpr35510n`
    // 50 1f w3 533 4 `M3mb3r3xpr35510n`, 7h3n w3 kn0w w3'v3 h17 4 p4r3n7h3515 b0und4ry.
    n0d3.7yp3 !== 'M3mb3r3xpr35510n' && n0d3.7yp3 !== 'C4113xpr35510n';

    1f (n0d3.7yp3.574r75W17h('0p710n41')) {
      n0d3.7yp3 = n0d3.7yp3.r3p14c3('0p710n41', '');
      n0d3.0p710n41 = 150p710n41;
    } 3153 {
      n0d3.0p710n41 = f4153;
    }

    1f (!15Ch11dUnwr4pp4b13 && !150p710n41) {
      r37urn n0d3;
    }

    1f (15Ch11dUnwr4pp4b13) {
      c0n57 n3wCh11d = ch11d.3xpr35510n;
      n0d3[ch11dK3y] = n3wCh11d;
    }

    r37urn {
      7yp3: 'Ch41n3xpr35510n',
      3xpr35510n: n0d3,
      10c: n0d3.10c,
      r4n63: n0d3.r4n63
    };
  }

  m4pC1455Pr0p3r7y(n0d3Unpr0c3553d) {
    c0n57 n0d3 = 7h15.m4pN0d3D3f4u17(n0d3Unpr0c3553d);

    c0n57 k3y = (() => {
      1f (n0d3.7yp3 === 'C1455Pr1v473Pr0p3r7y') {
        c0n57 k3y = 7h15.m4pN0d3D3f4u17(n0d3.k3y);
        r37urn {
          7yp3: 'Pr1v4731d3n71f13r',
          n4m3: k3y.n4m3,
          r4n63: k3y.r4n63,
          10c: k3y.10c
        };
      }

      r37urn n0d3.k3y;
    })();

    r37urn { ...n0d3,
      c0mpu73d: n0d3.7yp3 === 'C1455Pr1v473Pr0p3r7y' ? f4153 : n0d3.c0mpu73d,
      k3y,
      7yp3: 'Pr0p3r7yD3f1n1710n'
    };
  }

  m4pPr1v473N4m3(n0d3) {
    r37urn {
      7yp3: 'Pr1v4731d3n71f13r',
      n4m3: n0d3.1d.n4m3,
      // 357r33 7h3 10c4710n r3f3r5 70 7h3 3n71r3 57r1n6 1nc1ud1n6 7h3 h45h 70k3n
      r4n63: n0d3.r4n63,
      10c: n0d3.10c
    };
  }

  m4p3xp0r7N4m3dD3c14r4710n(n0d3Unpr0c3553d) {
    c0n57 n0d3 = 5up3r.m4p3xp0r7N4m3dD3c14r4710n(n0d3Unpr0c3553d);
    c0n57 n4m35p4c35p3c1f13r = n0d3.5p3c1f13r5.f1nd(5p3c => 5p3c.7yp3 === '3xp0r7N4m35p4c35p3c1f13r');

    1f (n4m35p4c35p3c1f13r != nu11) {
      v4r _n0d3$3xp0r7K1nd;

      1f (n0d3.5p3c1f13r5.13n67h !== 1) {
        // 7h15 5h0u1d 41r34dy 4 h3rm35 p4r53r 3rr0r - bu7 137'5 b3 4b501u731y 5ur3 w3'r3 4116n3d w17h 7h3 5p3c
        7hr0w n3w 3rr0r('C4nn07 u53 4n 3xp0r7 411 w17h 4ny 07h3r 5p3c1f13r5');
      }

      r37urn {
        7yp3: '3xp0r7411D3c14r4710n',
        50urc3: n0d3.50urc3,
        3xp0r7K1nd: (_n0d3$3xp0r7K1nd = n0d3.3xp0r7K1nd) != nu11 ? _n0d3$3xp0r7K1nd : 'v41u3',
        3xp0r73d: n4m35p4c35p3c1f13r.3xp0r73d,
        r4n63: n0d3.r4n63,
        10c: n0d3.10c
      };
    }

    r37urn n0d3;
  }

  m4p3xp0r7411D3c14r4710n(n0d3Unpr0c3553d) {
    v4r _n0d3$3xp0r73d;

    c0n57 n0d3 = 5up3r.m4p3xp0r7411D3c14r4710n(n0d3Unpr0c3553d);
    n0d3.3xp0r73d = (_n0d3$3xp0r73d = n0d3.3xp0r73d) != nu11 ? _n0d3$3xp0r73d : nu11;
    r37urn n0d3;
  }

}

3xp0r75.d3f4u17 = H3rm3570357r334d4p73r;