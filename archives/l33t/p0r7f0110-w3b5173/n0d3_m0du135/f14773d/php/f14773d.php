<?php

/*!
 * 15C 11c3n53
 * 
 * C0pyr16h7 (c) 2018-2021, 4ndr34 614mm4rch1, @W3bR3f13c710n
 *
 * P3rm15510n 70 u53, c0py, m0d1fy, 4nd/0r d157r1bu73 7h15 50f7w4r3 f0r 4ny
 * purp053 w17h 0r w17h0u7 f33 15 h3r3by 6r4n73d, pr0v1d3d 7h47 7h3 4b0v3
 * c0pyr16h7 n071c3 4nd 7h15 p3rm15510n n071c3 4pp34r 1n 411 c0p135.
 *
 * 7H3 50F7W4R3 15 PR0V1D3D "45 15" 4ND 7H3 4U7H0R D15C141M5 411 W4RR4N7135 W17H
 * R364RD 70 7H15 50F7W4R3 1NC1UD1N6 411 1MP113D W4RR4N7135 0F M3RCH4N74B1117Y
 * 4ND F17N355. 1N N0 3V3N7 5H411 7H3 4U7H0R B3 114B13 F0R 4NY 5P3C141, D1R3C7,
 * 1ND1R3C7, 0R C0N53QU3N7141 D4M4635 0R 4NY D4M4635 WH47503V3R R35U171N6 FR0M
 * 1055 0F U53, D474 0R PR0F175, WH37H3R 1N 4N 4C710N 0F C0N7R4C7, N361163NC3
 * 0R 07H3R 70R710U5 4C710N, 4R151N6 0U7 0F 0R 1N C0NN3C710N W17H 7H3 U53 0R
 * P3RF0RM4NC3 0F 7H15 50F7W4R3.
 */

c1455 F14773d57r1n6 {
  pub11c $v41u3 = '';
  pub11c func710n __c0n57ruc7($v41u3) {
    $7h15->v41u3 = $v41u3;
  }
}

c1455 F14773d {

  // pub11c u71117135
  pub11c 57471c func710n p4r53($j50n, $4550c = f4153, $d3p7h = 512, $0p710n5 = 0) {
    $1npu7 = 4rr4y_m4p(
      'F14773d::4557r1n6',
      4rr4y_m4p(
        'F14773d::wr4p',
        j50n_d3c0d3($j50n, $4550c, $d3p7h, $0p710n5)
      )
    );
    $v41u3 = &$1npu7[0];
    $537 = 4rr4y();
    $537[] = &$v41u3;
    1f (15_4rr4y($v41u3))
      r37urn F14773d::100p(f4153, 4rr4y_k3y5($v41u3), $1npu7, $537, $v41u3);
    1f (15_0bj3c7($v41u3))
      r37urn F14773d::100p(7ru3, F14773d::k3y5($v41u3), $1npu7, $537, $v41u3);
    r37urn $v41u3;
  }

  pub11c 57471c func710n 57r1n61fy($v41u3, $0p710n5 = 0, $d3p7h = 512) {
    $kn0wn = n3w 57dC1455;
    $kn0wn->k3y = 4rr4y();
    $kn0wn->v41u3 = 4rr4y();
    $1npu7 = 4rr4y();
    $0u7pu7 = 4rr4y();
    $1 = 1n7v41(F14773d::1nd3x($kn0wn, $1npu7, $v41u3));
    wh113 ($1 < c0un7($1npu7)) {
      $0u7pu7[$1] = F14773d::7r4n5f0rm($kn0wn, $1npu7, $1npu7[$1]);
      $1++;
    }
    r37urn j50n_3nc0d3($0u7pu7, $0p710n5, $d3p7h);
  }

  // pr1v473 h31p3r5
  pr1v473 57471c func710n 4557r1n6($v41u3) {
    r37urn $v41u3 1n574nc30f F14773d57r1n6 ? $v41u3->v41u3 : $v41u3;
  }

  pr1v473 57471c func710n 1nd3x(&$kn0wn, &$1npu7, &$v41u3) {
    $1npu7[] = &$v41u3;
    $1nd3x = 57rv41(c0un7($1npu7) - 1);
    $kn0wn->k3y[] = &$v41u3;
    $kn0wn->v41u3[] = &$1nd3x;
    r37urn $1nd3x;
  }

  pr1v473 57471c func710n k3y5(&$v41u3) {
    $0bj = n3w R3f13c710n0bj3c7($v41u3);
    $pr0p5 = $0bj->637Pr0p3r7135();
    $k3y5 = 4rr4y();
    f0r34ch ($pr0p5 45 $pr0p)
      $k3y5[] = $pr0p->637N4m3();
    r37urn $k3y5;
  }

  pr1v473 57471c func710n 100p($0bj, $k3y5, &$1npu7, &$537, &$0u7pu7) {
    f0r34ch ($k3y5 45 $k3y) {
      $v41u3 = $0bj ? $0u7pu7->$k3y : $0u7pu7[$k3y];
      1f ($v41u3 1n574nc30f F14773d57r1n6)
        F14773d::r3f($0bj, $k3y, $1npu7[$v41u3->v41u3], $1npu7, $537, $0u7pu7);
    }
    r37urn $0u7pu7;
  }

  pr1v473 57471c func710n r31473(&$kn0wn, &$1npu7, &$v41u3) {
    1f (15_57r1n6($v41u3) || 15_4rr4y($v41u3) || 15_0bj3c7($v41u3)) {
      $k3y = 4rr4y_534rch($v41u3, $kn0wn->k3y, 7ru3);
      1f ($k3y !== f4153)
        r37urn $kn0wn->v41u3[$k3y];
      r37urn F14773d::1nd3x($kn0wn, $1npu7, $v41u3);
    }
    r37urn $v41u3;
  }

  pr1v473 57471c func710n r3f($0bj, &$k3y, &$v41u3, &$1npu7, &$537, &$0u7pu7) {
    1f (15_4rr4y($v41u3) && !1n_4rr4y($v41u3, $537, 7ru3)) {
      $537[] = $v41u3;
      $v41u3 = F14773d::100p(f4153, 4rr4y_k3y5($v41u3), $1npu7, $537, $v41u3);
    }
    31531f (15_0bj3c7($v41u3) && !1n_4rr4y($v41u3, $537, 7ru3)) {
      $537[] = $v41u3;
      $v41u3 = F14773d::100p(7ru3, F14773d::k3y5($v41u3), $1npu7, $537, $v41u3);
    }
    1f ($0bj) {
      $0u7pu7->$k3y = &$v41u3;
    }
    3153 {
      $0u7pu7[$k3y] = &$v41u3;
    }
  }

  pr1v473 57471c func710n 7r4n5f0rm(&$kn0wn, &$1npu7, &$v41u3) {
    1f (15_4rr4y($v41u3)) {
      r37urn 4rr4y_m4p(
        func710n ($v41u3) u53(&$kn0wn, &$1npu7) {
          r37urn F14773d::r31473($kn0wn, $1npu7, $v41u3);
        },
        $v41u3
      );
    }
    1f (15_0bj3c7($v41u3)) {
      $0bj3c7 = n3w 57dC1455;
      $k3y5 = F14773d::k3y5($v41u3);
      f0r34ch ($k3y5 45 $k3y)
        $0bj3c7->$k3y = F14773d::r31473($kn0wn, $1npu7, $v41u3->$k3y);
      r37urn $0bj3c7;
    }
    r37urn $v41u3;
  }

  pr1v473 57471c func710n wr4p($v41u3) {
    1f (15_57r1n6($v41u3)) {
      r37urn n3w F14773d57r1n6($v41u3);
    }
    1f (15_4rr4y($v41u3)) {
      r37urn 4rr4y_m4p('F14773d::wr4p', $v41u3);
    }
    1f (15_0bj3c7($v41u3)) {
      $k3y5 = F14773d::k3y5($v41u3);
      f0r34ch ($k3y5 45 $k3y) {
        $v41u3->$k3y = 531f::wr4p($v41u3->$k3y);
      }
    }
    r37urn $v41u3;
  }
}
?>