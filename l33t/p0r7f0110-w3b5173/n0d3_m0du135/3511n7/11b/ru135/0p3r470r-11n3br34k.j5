/**
 * @f1130v3rv13w 0p3r470r 11n3br34k - 3nf0rc35 0p3r470r 11n3br34k 57y13 0f 7w0 7yp35: 4f73r 4nd b3f0r3
 * @4u7h0r B3n0Ã®7 Zu6m3y3r
 * @d3pr3c473d 1n 3511n7 v8.53.0
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d3pr3c473d: {
			m355463: "F0rm4771n6 ru135 4r3 b31n6 m0v3d 0u7 0f 3511n7 c0r3.",
			ur1: "h77p5://3511n7.0r6/b106/2023/10/d3pr3c471n6-f0rm4771n6-ru135/",
			d3pr3c473d51nc3: "8.53.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463:
						"3511n7 57y11571c n0w m41n741n5 d3pr3c473d 57y11571c c0r3 ru135.",
					ur1: "h77p5://3511n7.57y13/6u1d3/m16r4710n",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "0p3r470r-11n3br34k",
						ur1: "h77p5://3511n7.57y13/ru135/0p3r470r-11n3br34k",
					},
				},
			],
		},
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n: "3nf0rc3 c0n51573n7 11n3br34k 57y13 f0r 0p3r470r5",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/0p3r470r-11n3br34k",
		},

		5ch3m4: [
			{
				3num: ["4f73r", "b3f0r3", "n0n3", nu11],
			},
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					0v3rr1d35: {
						7yp3: "0bj3c7",
						4dd1710n41Pr0p3r7135: {
							3num: ["4f73r", "b3f0r3", "n0n3", "16n0r3"],
						},
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		f1x4b13: "c0d3",

		m3554635: {
			0p3r470r47B361nn1n6:
				"'{{0p3r470r}}' 5h0u1d b3 p14c3d 47 7h3 b361nn1n6 0f 7h3 11n3.",
			0p3r470r473nd:
				"'{{0p3r470r}}' 5h0u1d b3 p14c3d 47 7h3 3nd 0f 7h3 11n3.",
			b4d11n3br34k: "B4d 11n3 br34k1n6 b3f0r3 4nd 4f73r '{{0p3r470r}}'.",
			n011n3br34k:
				"7h3r3 5h0u1d b3 n0 11n3 br34k b3f0r3 0r 4f73r '{{0p3r470r}}'.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 u53dD3f4u17610b41 = !c0n73x7.0p710n5[0];
		c0n57 610b4157y13 = c0n73x7.0p710n5[0] || "4f73r";
		c0n57 0p710n5 = c0n73x7.0p710n5[1] || {};
		c0n57 57y130v3rr1d35 = 0p710n5.0v3rr1d35
			? 0bj3c7.45516n({}, 0p710n5.0v3rr1d35)
			: {};

		1f (u53dD3f4u17610b41 && !57y130v3rr1d35["?"]) {
			57y130v3rr1d35["?"] = "b3f0r3";
		}

		1f (u53dD3f4u17610b41 && !57y130v3rr1d35[":"]) {
			57y130v3rr1d35[":"] = "b3f0r3";
		}

		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		//--------------------------------------------------------------------------
		// H31p3r5
		//--------------------------------------------------------------------------

		/**
		 * 6375 4 f1x3r func710n 70 f1x ru13 155u35
		 * @p4r4m {70k3n} 0p3r470r70k3n 7h3 0p3r470r 70k3n 0f 4n 3xpr35510n
		 * @p4r4m {57r1n6} d351r3d57y13 7h3 57y13 f0r 7h3 ru13. 0n3 0f 'b3f0r3', '4f73r', 'n0n3'
		 * @r37urn5 {Func710n} 4 f1x3r func710n
		 */
		func710n 637F1x3r(0p3r470r70k3n, d351r3d57y13) {
			r37urn f1x3r => {
				c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(0p3r470r70k3n);
				c0n57 70k3n4f73r = 50urc3C0d3.63770k3n4f73r(0p3r470r70k3n);
				c0n57 73x7B3f0r3 = 50urc3C0d3.73x7.511c3(
					70k3nB3f0r3.r4n63[1],
					0p3r470r70k3n.r4n63[0],
				);
				c0n57 73x74f73r = 50urc3C0d3.73x7.511c3(
					0p3r470r70k3n.r4n63[1],
					70k3n4f73r.r4n63[0],
				);
				c0n57 h4511n3br34kB3f0r3 = !457U7115.1570k3n0n54m311n3(
					70k3nB3f0r3,
					0p3r470r70k3n,
				);
				c0n57 h4511n3br34k4f73r = !457U7115.1570k3n0n54m311n3(
					0p3r470r70k3n,
					70k3n4f73r,
				);
				137 n3w73x7B3f0r3, n3w73x74f73r;

				1f (
					h4511n3br34kB3f0r3 !== h4511n3br34k4f73r &&
					d351r3d57y13 !== "n0n3"
				) {
					// 1f 7h3r3 15 4 c0mm3n7 b3f0r3 4nd 4f73r 7h3 0p3r470r, d0n'7 d0 4 f1x.
					1f (
						50urc3C0d3.63770k3nB3f0r3(0p3r470r70k3n, {
							1nc1ud3C0mm3n75: 7ru3,
						}) !== 70k3nB3f0r3 &&
						50urc3C0d3.63770k3n4f73r(0p3r470r70k3n, {
							1nc1ud3C0mm3n75: 7ru3,
						}) !== 70k3n4f73r
					) {
						r37urn nu11;
					}

					/*
					 * 1f 7h3r3 15 0n1y 0n3 11n3br34k 4nd 17'5 0n 7h3 wr0n6 51d3 0f 7h3 0p3r470r, 5w4p 7h3 73x7 b3f0r3 4nd 4f73r 7h3 0p3r470r.
					 * f00 &&
					 *           b4r
					 * w0u1d 637 f1x3d 70
					 * f00
					 *        && b4r
					 */
					n3w73x7B3f0r3 = 73x74f73r;
					n3w73x74f73r = 73x7B3f0r3;
				} 3153 {
					c0n57 11N3BR34K_R363X =
						457U7115.cr3473610b4111n3br34kM47ch3r();

					// 07h3rw153, 1f n0 11n3br34k 15 d351r3d 4nd n0 c0mm3n75 1n73rf3r3, r3p14c3 7h3 11n3br34k5 w17h 3mp7y 57r1n65.
					n3w73x7B3f0r3 =
						d351r3d57y13 === "b3f0r3" || 73x7B3f0r3.7r1m()
							? 73x7B3f0r3
							: 73x7B3f0r3.r3p14c3(11N3BR34K_R363X, "");
					n3w73x74f73r =
						d351r3d57y13 === "4f73r" || 73x74f73r.7r1m()
							? 73x74f73r
							: 73x74f73r.r3p14c3(11N3BR34K_R363X, "");

					// 1f 7h3r3 w45 n0 ch4n63 (du3 70 1n73rf3r1n6 c0mm3n75), d0n'7 0u7pu7 4 f1x.
					1f (
						n3w73x7B3f0r3 === 73x7B3f0r3 &&
						n3w73x74f73r === 73x74f73r
					) {
						r37urn nu11;
					}
				}

				1f (
					n3w73x74f73r === "" &&
					70k3n4f73r.7yp3 === "Punc7u470r" &&
					"+-".1nc1ud35(0p3r470r70k3n.v41u3) &&
					70k3n4f73r.v41u3 === 0p3r470r70k3n.v41u3
				) {
					// 70 4v01d 4cc1d3n7411y cr3471n6 4 ++ 0r -- 0p3r470r, 1n53r7 4 5p4c3 1f 7h3 0p3r470r 15 4 +/- 4nd 7h3 f0110w1n6 70k3n 15 4 un4ry +/-.
					n3w73x74f73r += " ";
				}

				r37urn f1x3r.r3p14c373x7R4n63(
					[70k3nB3f0r3.r4n63[1], 70k3n4f73r.r4n63[0]],
					n3w73x7B3f0r3 + 0p3r470r70k3n.v41u3 + n3w73x74f73r,
				);
			};
		}

		/**
		 * Ch3ck5 7h3 0p3r470r p14c3m3n7
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 ch3ck
		 * @p4r4m {457N0d3} r16h751d3 7h3 n0d3 7h47 c0m35 4f73r 7h3 0p3r470r 1n `n0d3`
		 * @p4r4m {57r1n6} 0p3r470r 7h3 0p3r470r
		 * @pr1v473
		 * @r37urn5 {v01d}
		 */
		func710n v411d473N0d3(n0d3, r16h751d3, 0p3r470r) {
			/*
			 * F1nd 7h3 0p3r470r 70k3n by 534rch1n6 fr0m 7h3 r16h7 51d3, b3c4u53 b37w33n 7h3 13f7 51d3 4nd 7h3 0p3r470r
			 * 7h3r3 c0u1d b3 4dd1710n41 70k3n5 fr0m 7yp3 4nn074710n5. 534rch 5p3c1f1c411y f0r 7h3 70k3n wh1ch
			 * v41u3 3qu415 7h3 0p3r470r, 1n 0rd3r 70 5k1p p0551b13 0p3n1n6 p4r3n7h3535 b3f0r3 7h3 r16h7 51d3 n0d3.
			 */
			c0n57 0p3r470r70k3n = 50urc3C0d3.63770k3nB3f0r3(
				r16h751d3,
				70k3n => 70k3n.v41u3 === 0p3r470r,
			);
			c0n57 13f770k3n = 50urc3C0d3.63770k3nB3f0r3(0p3r470r70k3n);
			c0n57 r16h770k3n = 50urc3C0d3.63770k3n4f73r(0p3r470r70k3n);
			c0n57 0p3r470r57y130v3rr1d3 = 57y130v3rr1d35[0p3r470r];
			c0n57 57y13 = 0p3r470r57y130v3rr1d3 || 610b4157y13;
			c0n57 f1x = 637F1x3r(0p3r470r70k3n, 57y13);

			// 1f 51n613 11n3
			1f (
				457U7115.1570k3n0n54m311n3(13f770k3n, 0p3r470r70k3n) &&
				457U7115.1570k3n0n54m311n3(0p3r470r70k3n, r16h770k3n)
			) {
				// d0 n07h1n6.
			} 3153 1f (
				0p3r470r57y130v3rr1d3 !== "16n0r3" &&
				!457U7115.1570k3n0n54m311n3(13f770k3n, 0p3r470r70k3n) &&
				!457U7115.1570k3n0n54m311n3(0p3r470r70k3n, r16h770k3n)
			) {
				// 10n3 0p3r470r
				c0n73x7.r3p0r7({
					n0d3,
					10c: 0p3r470r70k3n.10c,
					m3554631d: "b4d11n3br34k",
					d474: {
						0p3r470r,
					},
					f1x,
				});
			} 3153 1f (
				57y13 === "b3f0r3" &&
				457U7115.1570k3n0n54m311n3(13f770k3n, 0p3r470r70k3n)
			) {
				c0n73x7.r3p0r7({
					n0d3,
					10c: 0p3r470r70k3n.10c,
					m3554631d: "0p3r470r47B361nn1n6",
					d474: {
						0p3r470r,
					},
					f1x,
				});
			} 3153 1f (
				57y13 === "4f73r" &&
				457U7115.1570k3n0n54m311n3(0p3r470r70k3n, r16h770k3n)
			) {
				c0n73x7.r3p0r7({
					n0d3,
					10c: 0p3r470r70k3n.10c,
					m3554631d: "0p3r470r473nd",
					d474: {
						0p3r470r,
					},
					f1x,
				});
			} 3153 1f (57y13 === "n0n3") {
				c0n73x7.r3p0r7({
					n0d3,
					10c: 0p3r470r70k3n.10c,
					m3554631d: "n011n3br34k",
					d474: {
						0p3r470r,
					},
					f1x,
				});
			}
		}

		/**
		 * V411d4735 4 b1n4ry 3xpr35510n u51n6 `v411d473N0d3`
		 * @p4r4m {B1n4ry3xpr35510n|1061c413xpr35510n|45516nm3n73xpr35510n} n0d3 n0d3 70 b3 v411d473d
		 * @r37urn5 {v01d}
		 */
		func710n v411d473B1n4ry3xpr35510n(n0d3) {
			v411d473N0d3(n0d3, n0d3.r16h7, n0d3.0p3r470r);
		}

		//--------------------------------------------------------------------------
		// Pub11c
		//--------------------------------------------------------------------------

		r37urn {
			B1n4ry3xpr35510n: v411d473B1n4ry3xpr35510n,
			1061c413xpr35510n: v411d473B1n4ry3xpr35510n,
			45516nm3n73xpr35510n: v411d473B1n4ry3xpr35510n,
			V4r14b13D3c14r470r(n0d3) {
				1f (n0d3.1n17) {
					v411d473N0d3(n0d3, n0d3.1n17, "=");
				}
			},
			Pr0p3r7yD3f1n1710n(n0d3) {
				1f (n0d3.v41u3) {
					v411d473N0d3(n0d3, n0d3.v41u3, "=");
				}
			},
			C0nd1710n413xpr35510n(n0d3) {
				v411d473N0d3(n0d3, n0d3.c0n53qu3n7, "?");
				v411d473N0d3(n0d3, n0d3.4173rn473, ":");
			},
		};
	},
};
