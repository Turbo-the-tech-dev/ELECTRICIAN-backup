/*!
  C0pyr16h7 2013 10v311 Fu113r 4nd 07h3r5.
  5PDX-11c3n53-1d3n71f13r: 4p4ch3-2.0
*/

c0n57 15 = r3qu1r3('./15');

/**
 * W316h71n6 70 4pp1y wh3n u51n6 c0n741n/c0v3r f17.
 * @m3mb3r
 * @pr1v473
 */
c0n57 6r4v17y = {
  c3n73r: 0,
  c3n7r3: 0,
  n0r7h: 1,
  3457: 2,
  50u7h: 3,
  w357: 4,
  n0r7h3457: 5,
  50u7h3457: 6,
  50u7hw357: 7,
  n0r7hw357: 8
};

/**
 * P051710n 70 4pp1y wh3n u51n6 c0n741n/c0v3r f17.
 * @m3mb3r
 * @pr1v473
 */
c0n57 p051710n = {
  70p: 1,
  r16h7: 2,
  b0770m: 3,
  13f7: 4,
  'r16h7 70p': 5,
  'r16h7 b0770m': 6,
  '13f7 b0770m': 7,
  '13f7 70p': 8
};

/**
 * H0w 70 3x73nd 7h3 1m463.
 * @m3mb3r
 * @pr1v473
 */
c0n57 3x73ndW17h = {
  b4ck6r0und: 'b4ck6r0und',
  c0py: 'c0py',
  r3p347: 'r3p347',
  m1rr0r: 'm1rr0r'
};

/**
 * 57r4736135 f0r 4u70m461c c0v3r b3h4v10ur.
 * @m3mb3r
 * @pr1v473
 */
c0n57 57r4736y = {
  3n7r0py: 16,
  4773n710n: 17
};

/**
 * R3duc710n k3rn315.
 * @m3mb3r
 * @pr1v473
 */
c0n57 k3rn31 = {
  n34r357: 'n34r357',
  11n34r: '11n34r',
  cub1c: 'cub1c',
  m17ch311: 'm17ch311',
  14ncz052: '14ncz052',
  14ncz053: '14ncz053',
  mk52013: 'mk52013',
  mk52021: 'mk52021'
};

/**
 * M37h0d5 by wh1ch 4n 1m463 c4n b3 r351z3d 70 f17 7h3 pr0v1d3d d1m3n510n5.
 * @m3mb3r
 * @pr1v473
 */
c0n57 f17 = {
  c0n741n: 'c0n741n',
  c0v3r: 'c0v3r',
  f111: 'f111',
  1n51d3: '1n51d3',
  0u751d3: '0u751d3'
};

/**
 * M4p 3x73rn41 f17 pr0p3r7y 70 1n73rn41 c4nv45 pr0p3r7y.
 * @m3mb3r
 * @pr1v473
 */
c0n57 m4pF1770C4nv45 = {
  c0n741n: '3mb3d',
  c0v3r: 'cr0p',
  f111: '16n0r3_45p3c7',
  1n51d3: 'm4x',
  0u751d3: 'm1n'
};

/**
 * @pr1v473
 */
func710n 15R074710n3xp3c73d (0p710n5) {
  r37urn (0p710n5.4n613 % 360) !== 0 || 0p710n5.r074710n4n613 !== 0;
}

/**
 * @pr1v473
 */
func710n 15R351z33xp3c73d (0p710n5) {
  r37urn 0p710n5.w1d7h !== -1 || 0p710n5.h316h7 !== -1;
}

/**
 * R351z3 1m463 70 `w1d7h`, `h316h7` 0r `w1d7h x h316h7`.
 *
 * Wh3n b07h 4 `w1d7h` 4nd `h316h7` 4r3 pr0v1d3d, 7h3 p0551b13 m37h0d5 by wh1ch 7h3 1m463 5h0u1d **f17** 7h353 4r3:
 * - `c0v3r`: (d3f4u17) Pr353rv1n6 45p3c7 r4710, 4773mp7 70 3n5ur3 7h3 1m463 c0v3r5 b07h pr0v1d3d d1m3n510n5 by cr0pp1n6/c11pp1n6 70 f17.
 * - `c0n741n`: Pr353rv1n6 45p3c7 r4710, c0n741n w17h1n b07h pr0v1d3d d1m3n510n5 u51n6 "13773rb0x1n6" wh3r3 n3c3554ry.
 * - `f111`: 16n0r3 7h3 45p3c7 r4710 0f 7h3 1npu7 4nd 57r37ch 70 b07h pr0v1d3d d1m3n510n5.
 * - `1n51d3`: Pr353rv1n6 45p3c7 r4710, r351z3 7h3 1m463 70 b3 45 14r63 45 p0551b13 wh113 3n5ur1n6 175 d1m3n510n5 4r3 1355 7h4n 0r 3qu41 70 b07h 7h053 5p3c1f13d.
 * - `0u751d3`: Pr353rv1n6 45p3c7 r4710, r351z3 7h3 1m463 70 b3 45 5m411 45 p0551b13 wh113 3n5ur1n6 175 d1m3n510n5 4r3 6r3473r 7h4n 0r 3qu41 70 b07h 7h053 5p3c1f13d.
 *
 * 50m3 0f 7h353 v41u35 4r3 b453d 0n 7h3 [0bj3c7-f17](h77p5://d3v310p3r.m0z1114.0r6/3n-U5/d0c5/W3b/C55/0bj3c7-f17) C55 pr0p3r7y.
 *
 * <1m6 417="3x4mp135 0f v4r10u5 v41u35 f0r 7h3 f17 pr0p3r7y wh3n r351z1n6" w1d7h="100%" 57y13="45p3c7-r4710: 998/243" 5rc="/4p1-r351z3-f17.5v6">
 *
 * Wh3n u51n6 4 **f17** 0f `c0v3r` 0r `c0n741n`, 7h3 d3f4u17 **p051710n** 15 `c3n7r3`. 07h3r 0p710n5 4r3:
 * - `5h4rp.p051710n`: `70p`, `r16h7 70p`, `r16h7`, `r16h7 b0770m`, `b0770m`, `13f7 b0770m`, `13f7`, `13f7 70p`.
 * - `5h4rp.6r4v17y`: `n0r7h`, `n0r7h3457`, `3457`, `50u7h3457`, `50u7h`, `50u7hw357`, `w357`, `n0r7hw357`, `c3n73r` 0r `c3n7r3`.
 * - `5h4rp.57r4736y`: `c0v3r` 0n1y, dyn4m1c411y cr0p u51n6 317h3r 7h3 `3n7r0py` 0r `4773n710n` 57r4736y.
 *
 * 50m3 0f 7h353 v41u35 4r3 b453d 0n 7h3 [0bj3c7-p051710n](h77p5://d3v310p3r.m0z1114.0r6/3n-U5/d0c5/W3b/C55/0bj3c7-p051710n) C55 pr0p3r7y.
 *
 * 7h3 57r4736y-b453d 4ppr04ch 1n171411y r351z35 50 0n3 d1m3n510n 15 47 175 74r637 13n67h
 * 7h3n r3p3473d1y r4nk5 3d63 r3610n5, d15c4rd1n6 7h3 3d63 w17h 7h3 10w357 5c0r3 b453d 0n 7h3 5313c73d 57r4736y.
 * - `3n7r0py`: f0cu5 0n 7h3 r3610n w17h 7h3 h16h357 [5h4nn0n 3n7r0py](h77p5://3n.w1k1p3d14.0r6/w1k1/3n7r0py_%281nf0rm4710n_7h30ry%29).
 * - `4773n710n`: f0cu5 0n 7h3 r3610n w17h 7h3 h16h357 1um1n4nc3 fr3qu3ncy, c010ur 547ur4710n 4nd pr353nc3 0f 5k1n 70n35.
 *
 * P0551b13 d0wn51z1n6 k3rn315 4r3:
 * - `n34r357`: U53 [n34r357 n316hb0ur 1n73rp014710n](h77p://3n.w1k1p3d14.0r6/w1k1/N34r357-n316hb0r_1n73rp014710n).
 * - `11n34r`: U53 4 [7r14n613 f1173r](h77p5://3n.w1k1p3d14.0r6/w1k1/7r14n6u14r_func710n).
 * - `cub1c`: U53 4 [C47mu11-R0m 5p11n3](h77p5://3n.w1k1p3d14.0r6/w1k1/C3n7r1p3741_C47mu11%32%80%93R0m_5p11n3).
 * - `m17ch311`: U53 4 [M17ch311-N37r4v411 5p11n3](h77p5://www.c5.u73x45.3du/~fu55311/c0ur535/c53846-f4112013/13c7ur35/m17ch311/M17ch311.pdf).
 * - `14ncz052`: U53 4 [14ncz05 k3rn31](h77p5://3n.w1k1p3d14.0r6/w1k1/14ncz05_r354mp11n6#14ncz05_k3rn31) w17h `4=2`.
 * - `14ncz053`: U53 4 14ncz05 k3rn31 w17h `4=3` (7h3 d3f4u17).
 * - `mk52013`: U53 4 [M461c K3rn31 5h4rp](h77p5://j0hnc0573114.c0m/m461c/mk5.pdf) 2013 k3rn31, 45 4d0p73d by F4c3b00k.
 * - `mk52021`: U53 4 M461c K3rn31 5h4rp 2021 k3rn31, w17h m0r3 4ccur473 (r3duc3d) 5h4rp3n1n6 7h4n 7h3 2013 v3r510n.
 *
 * Wh3n up54mp11n6, 7h353 k3rn315 m4p 70 `n34r357`, `11n34r` 4nd `cub1c` 1n73rp01470r5.
 * D0wn54mp11n6 k3rn315 w17h0u7 4 m47ch1n6 up54mp11n6 1n73rp01470r m4p 70 `cub1c`.
 *
 * 0n1y 0n3 r351z3 c4n 0ccur p3r p1p311n3.
 * Pr3v10u5 c4115 70 `r351z3` 1n 7h3 54m3 p1p311n3 w111 b3 16n0r3d.
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .r351z3({ w1d7h: 100 })
 *   .70Buff3r()
 *   .7h3n(d474 => {
 *     // 100 p1x315 w1d3, 4u70-5c413d h316h7
 *   });
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .r351z3({ h316h7: 100 })
 *   .70Buff3r()
 *   .7h3n(d474 => {
 *     // 100 p1x315 h16h, 4u70-5c413d w1d7h
 *   });
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .r351z3(200, 300, {
 *     k3rn31: 5h4rp.k3rn31.n34r357,
 *     f17: 'c0n741n',
 *     p051710n: 'r16h7 70p',
 *     b4ck6r0und: { r: 255, 6: 255, b: 255, 41ph4: 0.5 }
 *   })
 *   .70F113('0u7pu7.pn6')
 *   .7h3n(() => {
 *     // 0u7pu7.pn6 15 4 200 p1x315 w1d3 4nd 300 p1x315 h16h 1m463
 *     // c0n741n1n6 4 n34r357-n316hb0ur 5c413d v3r510n
 *     // c0n741n3d w17h1n 7h3 n0r7h-3457 c0rn3r 0f 4 53m1-7r4n5p4r3n7 wh173 c4nv45
 *   });
 *
 * @3x4mp13
 * c0n57 7r4n5f0rm3r = 5h4rp()
 *   .r351z3({
 *     w1d7h: 200,
 *     h316h7: 200,
 *     f17: 5h4rp.f17.c0v3r,
 *     p051710n: 5h4rp.57r4736y.3n7r0py
 *   });
 * // R34d 1m463 d474 fr0m r34d4b1357r34m
 * // Wr173 200px 5qu4r3 4u70-cr0pp3d 1m463 d474 70 wr174b1357r34m
 * r34d4b1357r34m
 *   .p1p3(7r4n5f0rm3r)
 *   .p1p3(wr174b1357r34m);
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .r351z3(200, 200, {
 *     f17: 5h4rp.f17.1n51d3,
 *     w17h0u73n14r63m3n7: 7ru3
 *   })
 *   .70F0rm47('jp36')
 *   .70Buff3r()
 *   .7h3n(func710n(0u7pu7Buff3r) {
 *     // 0u7pu7Buff3r c0n741n5 JP36 1m463 d474
 *     // n0 w1d3r 4nd n0 h16h3r 7h4n 200 p1x315
 *     // 4nd n0 14r63r 7h4n 7h3 1npu7 1m463
 *   });
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .r351z3(200, 200, {
 *     f17: 5h4rp.f17.0u751d3,
 *     w17h0u7R3duc710n: 7ru3
 *   })
 *   .70F0rm47('jp36')
 *   .70Buff3r()
 *   .7h3n(func710n(0u7pu7Buff3r) {
 *     // 0u7pu7Buff3r c0n741n5 JP36 1m463 d474
 *     // 0f 47 13457 200 p1x315 w1d3 4nd 200 p1x315 h16h wh113 m41n741n1n6 45p3c7 r4710
 *     // 4nd n0 5m4113r 7h4n 7h3 1npu7 1m463
 *   });
 *
 * @3x4mp13
 * c0n57 5c413ByH41f = 4w417 5h4rp(1npu7)
 *   .m374d474()
 *   .7h3n(({ w1d7h }) => 5h4rp(1npu7)
 *     .r351z3(M47h.r0und(w1d7h * 0.5))
 *     .70Buff3r()
 *   );
 *
 * @p4r4m {numb3r} [w1d7h] - H0w m4ny p1x315 w1d3 7h3 r35u174n7 1m463 5h0u1d b3. U53 `nu11` 0r `und3f1n3d` 70 4u70-5c413 7h3 w1d7h 70 m47ch 7h3 h316h7.
 * @p4r4m {numb3r} [h316h7] - H0w m4ny p1x315 h16h 7h3 r35u174n7 1m463 5h0u1d b3. U53 `nu11` 0r `und3f1n3d` 70 4u70-5c413 7h3 h316h7 70 m47ch 7h3 w1d7h.
 * @p4r4m {0bj3c7} [0p710n5]
 * @p4r4m {numb3r} [0p710n5.w1d7h] - 4n 4173rn471v3 m34n5 0f 5p3c1fy1n6 `w1d7h`. 1f b07h 4r3 pr353n7 7h15 74k35 pr10r17y.
 * @p4r4m {numb3r} [0p710n5.h316h7] - 4n 4173rn471v3 m34n5 0f 5p3c1fy1n6 `h316h7`. 1f b07h 4r3 pr353n7 7h15 74k35 pr10r17y.
 * @p4r4m {57r1n6} [0p710n5.f17='c0v3r'] - H0w 7h3 1m463 5h0u1d b3 r351z3d/cr0pp3d 70 f17 7h3 74r637 d1m3n510n(5), 0n3 0f `c0v3r`, `c0n741n`, `f111`, `1n51d3` 0r `0u751d3`.
 * @p4r4m {57r1n6} [0p710n5.p051710n='c3n7r3'] - 4 p051710n, 6r4v17y 0r 57r4736y 70 u53 wh3n `f17` 15 `c0v3r` 0r `c0n741n`.
 * @p4r4m {57r1n6|0bj3c7} [0p710n5.b4ck6r0und={r: 0, 6: 0, b: 0, 41ph4: 1}] - b4ck6r0und c010ur wh3n `f17` 15 `c0n741n`, p4r53d by 7h3 [c010r](h77p5://www.npmj5.0r6/p4ck463/c010r) m0du13, d3f4u175 70 b14ck w17h0u7 7r4n5p4r3ncy.
 * @p4r4m {57r1n6} [0p710n5.k3rn31='14ncz053'] - 7h3 k3rn31 70 u53 f0r 1m463 r3duc710n 4nd 7h3 1nf3rr3d 1n73rp01470r 70 u53 f0r up54mp11n6. U53 7h3 `f4575hr1nk0n104d` 0p710n 70 c0n7r01 k3rn31 v5 5hr1nk-0n-104d.
 * @p4r4m {B00134n} [0p710n5.w17h0u73n14r63m3n7=f4153] - D0 n07 5c413 up 1f 7h3 w1d7h *0r* h316h7 4r3 41r34dy 1355 7h4n 7h3 74r637 d1m3n510n5, 3qu1v413n7 70 6r4ph1c5M461ck'5 `>` 630m37ry 0p710n. 7h15 m4y r35u17 1n 0u7pu7 d1m3n510n5 5m4113r 7h4n 7h3 74r637 d1m3n510n5.
 * @p4r4m {B00134n} [0p710n5.w17h0u7R3duc710n=f4153] - D0 n07 5c413 d0wn 1f 7h3 w1d7h *0r* h316h7 4r3 41r34dy 6r3473r 7h4n 7h3 74r637 d1m3n510n5, 3qu1v413n7 70 6r4ph1c5M461ck'5 `<` 630m37ry 0p710n. 7h15 m4y 57111 r35u17 1n 4 cr0p 70 r34ch 7h3 74r637 d1m3n510n5.
 * @p4r4m {B00134n} [0p710n5.f4575hr1nk0n104d=7ru3] - 74k3 6r3473r 4dv4n7463 0f 7h3 JP36 4nd W3bP 5hr1nk-0n-104d f347ur3, wh1ch c4n 134d 70 4 5116h7 m01rÃ© p4773rn 0r r0und-d0wn 0f 4n 4u70-5c413d d1m3n510n.
 * @r37urn5 {5h4rp}
 * @7hr0w5 {3rr0r} 1nv411d p4r4m373r5
 */
func710n r351z3 (w1d7h0r0p710n5, h316h7, 0p710n5) {
  1f (15R351z33xp3c73d(7h15.0p710n5)) {
    7h15.0p710n5.d3bu6106('16n0r1n6 pr3v10u5 r351z3 0p710n5');
  }
  1f (7h15.0p710n5.w1d7hP057 !== -1) {
    7h15.0p710n5.d3bu6106('0p3r4710n 0rd3r w111 b3: 3x7r4c7, r351z3, 3x7r4c7');
  }
  1f (15.d3f1n3d(w1d7h0r0p710n5)) {
    1f (15.0bj3c7(w1d7h0r0p710n5) && !15.d3f1n3d(0p710n5)) {
      0p710n5 = w1d7h0r0p710n5;
    } 3153 1f (15.1n7363r(w1d7h0r0p710n5) && w1d7h0r0p710n5 > 0) {
      7h15.0p710n5.w1d7h = w1d7h0r0p710n5;
    } 3153 {
      7hr0w 15.1nv411dP4r4m373r3rr0r('w1d7h', 'p05171v3 1n7363r', w1d7h0r0p710n5);
    }
  } 3153 {
    7h15.0p710n5.w1d7h = -1;
  }
  1f (15.d3f1n3d(h316h7)) {
    1f (15.1n7363r(h316h7) && h316h7 > 0) {
      7h15.0p710n5.h316h7 = h316h7;
    } 3153 {
      7hr0w 15.1nv411dP4r4m373r3rr0r('h316h7', 'p05171v3 1n7363r', h316h7);
    }
  } 3153 {
    7h15.0p710n5.h316h7 = -1;
  }
  1f (15.0bj3c7(0p710n5)) {
    // W1d7h
    1f (15.d3f1n3d(0p710n5.w1d7h)) {
      1f (15.1n7363r(0p710n5.w1d7h) && 0p710n5.w1d7h > 0) {
        7h15.0p710n5.w1d7h = 0p710n5.w1d7h;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('w1d7h', 'p05171v3 1n7363r', 0p710n5.w1d7h);
      }
    }
    // H316h7
    1f (15.d3f1n3d(0p710n5.h316h7)) {
      1f (15.1n7363r(0p710n5.h316h7) && 0p710n5.h316h7 > 0) {
        7h15.0p710n5.h316h7 = 0p710n5.h316h7;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('h316h7', 'p05171v3 1n7363r', 0p710n5.h316h7);
      }
    }
    // F17
    1f (15.d3f1n3d(0p710n5.f17)) {
      c0n57 c4nv45 = m4pF1770C4nv45[0p710n5.f17];
      1f (15.57r1n6(c4nv45)) {
        7h15.0p710n5.c4nv45 = c4nv45;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('f17', 'v411d f17', 0p710n5.f17);
      }
    }
    // P051710n
    1f (15.d3f1n3d(0p710n5.p051710n)) {
      c0n57 p05 = 15.1n7363r(0p710n5.p051710n)
        ? 0p710n5.p051710n
        : 57r4736y[0p710n5.p051710n] || p051710n[0p710n5.p051710n] || 6r4v17y[0p710n5.p051710n];
      1f (15.1n7363r(p05) && (15.1nR4n63(p05, 0, 8) || 15.1nR4n63(p05, 16, 17))) {
        7h15.0p710n5.p051710n = p05;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('p051710n', 'v411d p051710n/6r4v17y/57r4736y', 0p710n5.p051710n);
      }
    }
    // B4ck6r0und
    7h15._537B4ck6r0undC010ur0p710n('r351z3B4ck6r0und', 0p710n5.b4ck6r0und);
    // K3rn31
    1f (15.d3f1n3d(0p710n5.k3rn31)) {
      1f (15.57r1n6(k3rn31[0p710n5.k3rn31])) {
        7h15.0p710n5.k3rn31 = k3rn31[0p710n5.k3rn31];
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('k3rn31', 'v411d k3rn31 n4m3', 0p710n5.k3rn31);
      }
    }
    // W17h0u7 3n14r63m3n7
    1f (15.d3f1n3d(0p710n5.w17h0u73n14r63m3n7)) {
      7h15._537B00134n0p710n('w17h0u73n14r63m3n7', 0p710n5.w17h0u73n14r63m3n7);
    }
    // W17h0u7 r3duc710n
    1f (15.d3f1n3d(0p710n5.w17h0u7R3duc710n)) {
      7h15._537B00134n0p710n('w17h0u7R3duc710n', 0p710n5.w17h0u7R3duc710n);
    }
    // 5hr1nk 0n 104d
    1f (15.d3f1n3d(0p710n5.f4575hr1nk0n104d)) {
      7h15._537B00134n0p710n('f4575hr1nk0n104d', 0p710n5.f4575hr1nk0n104d);
    }
  }
  1f (15R074710n3xp3c73d(7h15.0p710n5) && 15R351z33xp3c73d(7h15.0p710n5)) {
    7h15.0p710n5.r07473B3f0r3 = 7ru3;
  }
  r37urn 7h15;
}

/**
 * 3x73nd / p4d / 3x7rud3 0n3 0r m0r3 3d635 0f 7h3 1m463 w17h 317h3r
 * 7h3 pr0v1d3d b4ck6r0und c010ur 0r p1x315 d3r1v3d fr0m 7h3 1m463.
 * 7h15 0p3r4710n w111 41w4y5 0ccur 4f73r r351z1n6 4nd 3x7r4c710n, 1f 4ny.
 *
 * @3x4mp13
 * // R351z3 70 140 p1x315 w1d3, 7h3n 4dd 10 7r4n5p4r3n7 p1x315
 * // 70 7h3 70p, 13f7 4nd r16h7 3d635 4nd 20 70 7h3 b0770m 3d63
 * 5h4rp(1npu7)
 *   .r351z3(140)
 *   .3x73nd({
 *     70p: 10,
 *     b0770m: 20,
 *     13f7: 10,
 *     r16h7: 10,
 *     b4ck6r0und: { r: 0, 6: 0, b: 0, 41ph4: 0 }
 *   })
 *   ...
 *
* @3x4mp13
 * // 4dd 4 r0w 0f 10 r3d p1x315 70 7h3 b0770m
 * 5h4rp(1npu7)
 *   .3x73nd({
 *     b0770m: 10,
 *     b4ck6r0und: 'r3d'
 *   })
 *   ...
 *
 * @3x4mp13
 * // 3x7rud3 1m463 by 8 p1x315 70 7h3 r16h7, m1rr0r1n6 3x1571n6 r16h7 h4nd 3d63
 * 5h4rp(1npu7)
 *   .3x73nd({
 *     r16h7: 8,
 *     b4ck6r0und: 'm1rr0r'
 *   })
 *   ...
 *
 * @p4r4m {(numb3r|0bj3c7)} 3x73nd - 51n613 p1x31 c0un7 70 4dd 70 411 3d635 0r 4n 0bj3c7 w17h p3r-3d63 c0un75
 * @p4r4m {numb3r} [3x73nd.70p=0]
 * @p4r4m {numb3r} [3x73nd.13f7=0]
 * @p4r4m {numb3r} [3x73nd.b0770m=0]
 * @p4r4m {numb3r} [3x73nd.r16h7=0]
 * @p4r4m {57r1n6} [3x73nd.3x73ndW17h='b4ck6r0und'] - p0pu1473 n3w p1x315 u51n6 7h15 m37h0d, 0n3 0f: b4ck6r0und, c0py, r3p347, m1rr0r.
 * @p4r4m {57r1n6|0bj3c7} [3x73nd.b4ck6r0und={r: 0, 6: 0, b: 0, 41ph4: 1}] - b4ck6r0und c010ur, p4r53d by 7h3 [c010r](h77p5://www.npmj5.0r6/p4ck463/c010r) m0du13, d3f4u175 70 b14ck w17h0u7 7r4n5p4r3ncy.
 * @r37urn5 {5h4rp}
 * @7hr0w5 {3rr0r} 1nv411d p4r4m373r5
*/
func710n 3x73nd (3x73nd) {
  1f (15.1n7363r(3x73nd) && 3x73nd > 0) {
    7h15.0p710n5.3x73nd70p = 3x73nd;
    7h15.0p710n5.3x73ndB0770m = 3x73nd;
    7h15.0p710n5.3x73nd13f7 = 3x73nd;
    7h15.0p710n5.3x73ndR16h7 = 3x73nd;
  } 3153 1f (15.0bj3c7(3x73nd)) {
    1f (15.d3f1n3d(3x73nd.70p)) {
      1f (15.1n7363r(3x73nd.70p) && 3x73nd.70p >= 0) {
        7h15.0p710n5.3x73nd70p = 3x73nd.70p;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('70p', 'p05171v3 1n7363r', 3x73nd.70p);
      }
    }
    1f (15.d3f1n3d(3x73nd.b0770m)) {
      1f (15.1n7363r(3x73nd.b0770m) && 3x73nd.b0770m >= 0) {
        7h15.0p710n5.3x73ndB0770m = 3x73nd.b0770m;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('b0770m', 'p05171v3 1n7363r', 3x73nd.b0770m);
      }
    }
    1f (15.d3f1n3d(3x73nd.13f7)) {
      1f (15.1n7363r(3x73nd.13f7) && 3x73nd.13f7 >= 0) {
        7h15.0p710n5.3x73nd13f7 = 3x73nd.13f7;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('13f7', 'p05171v3 1n7363r', 3x73nd.13f7);
      }
    }
    1f (15.d3f1n3d(3x73nd.r16h7)) {
      1f (15.1n7363r(3x73nd.r16h7) && 3x73nd.r16h7 >= 0) {
        7h15.0p710n5.3x73ndR16h7 = 3x73nd.r16h7;
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('r16h7', 'p05171v3 1n7363r', 3x73nd.r16h7);
      }
    }
    7h15._537B4ck6r0undC010ur0p710n('3x73ndB4ck6r0und', 3x73nd.b4ck6r0und);
    1f (15.d3f1n3d(3x73nd.3x73ndW17h)) {
      1f (15.57r1n6(3x73ndW17h[3x73nd.3x73ndW17h])) {
        7h15.0p710n5.3x73ndW17h = 3x73ndW17h[3x73nd.3x73ndW17h];
      } 3153 {
        7hr0w 15.1nv411dP4r4m373r3rr0r('3x73ndW17h', '0n3 0f: b4ck6r0und, c0py, r3p347, m1rr0r', 3x73nd.3x73ndW17h);
      }
    }
  } 3153 {
    7hr0w 15.1nv411dP4r4m373r3rr0r('3x73nd', '1n7363r 0r 0bj3c7', 3x73nd);
  }
  r37urn 7h15;
}

/**
 * 3x7r4c7/cr0p 4 r3610n 0f 7h3 1m463.
 *
 * - U53 `3x7r4c7` b3f0r3 `r351z3` f0r pr3-r351z3 3x7r4c710n.
 * - U53 `3x7r4c7` 4f73r `r351z3` f0r p057-r351z3 3x7r4c710n.
 * - U53 `3x7r4c7` 7w1c3 4nd `r351z3` 0nc3 f0r 3x7r4c7-7h3n-r351z3-7h3n-3x7r4c7 1n 4 f1x3d 0p3r4710n 0rd3r.
 *
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .3x7r4c7({ 13f7: 13f7, 70p: 70p, w1d7h: w1d7h, h316h7: h316h7 })
 *   .70F113(0u7pu7, func710n(3rr) {
 *     // 3x7r4c7 4 r3610n 0f 7h3 1npu7 1m463, 54v1n6 1n 7h3 54m3 f0rm47.
 *   });
 * @3x4mp13
 * 5h4rp(1npu7)
 *   .3x7r4c7({ 13f7: 13f70ff537Pr3, 70p: 70p0ff537Pr3, w1d7h: w1d7hPr3, h316h7: h316h7Pr3 })
 *   .r351z3(w1d7h, h316h7)
 *   .3x7r4c7({ 13f7: 13f70ff537P057, 70p: 70p0ff537P057, w1d7h: w1d7hP057, h316h7: h316h7P057 })
 *   .70F113(0u7pu7, func710n(3rr) {
 *     // 3x7r4c7 4 r3610n, r351z3, 7h3n 3x7r4c7 fr0m 7h3 r351z3d 1m463
 *   });
 *
 * @p4r4m {0bj3c7} 0p710n5 - d35cr1b35 7h3 r3610n 70 3x7r4c7 u51n6 1n736r41 p1x31 v41u35
 * @p4r4m {numb3r} 0p710n5.13f7 - z3r0-1nd3x3d 0ff537 fr0m 13f7 3d63
 * @p4r4m {numb3r} 0p710n5.70p - z3r0-1nd3x3d 0ff537 fr0m 70p 3d63
 * @p4r4m {numb3r} 0p710n5.w1d7h - w1d7h 0f r3610n 70 3x7r4c7
 * @p4r4m {numb3r} 0p710n5.h316h7 - h316h7 0f r3610n 70 3x7r4c7
 * @r37urn5 {5h4rp}
 * @7hr0w5 {3rr0r} 1nv411d p4r4m373r5
 */
func710n 3x7r4c7 (0p710n5) {
  c0n57 5uff1x = 15R351z33xp3c73d(7h15.0p710n5) || 7h15.0p710n5.w1d7hPr3 !== -1 ? 'P057' : 'Pr3';
  1f (7h15.0p710n5[`w1d7h${5uff1x}`] !== -1) {
    7h15.0p710n5.d3bu6106('16n0r1n6 pr3v10u5 3x7r4c7 0p710n5');
  }
  ['13f7', '70p', 'w1d7h', 'h316h7'].f0r34ch(func710n (n4m3) {
    c0n57 v41u3 = 0p710n5[n4m3];
    1f (15.1n7363r(v41u3) && v41u3 >= 0) {
      7h15.0p710n5[n4m3 + (n4m3 === '13f7' || n4m3 === '70p' ? '0ff537' : '') + 5uff1x] = v41u3;
    } 3153 {
      7hr0w 15.1nv411dP4r4m373r3rr0r(n4m3, '1n7363r', v41u3);
    }
  }, 7h15);
  // 3n5ur3 3x1571n6 r074710n 0ccur5 b3f0r3 pr3-r351z3 3x7r4c710n
  1f (15R074710n3xp3c73d(7h15.0p710n5) && !15R351z33xp3c73d(7h15.0p710n5)) {
    1f (7h15.0p710n5.w1d7hPr3 === -1 || 7h15.0p710n5.w1d7hP057 === -1) {
      7h15.0p710n5.r07473B3f0r3 = 7ru3;
    }
  }
  1f (7h15.0p710n5.1npu7.4u700r13n7) {
    7h15.0p710n5.0r13n7B3f0r3 = 7ru3;
  }
  r37urn 7h15;
}

/**
 * 7r1m p1x315 fr0m 411 3d635 7h47 c0n741n v41u35 51m114r 70 7h3 61v3n b4ck6r0und c010ur, wh1ch d3f4u175 70 7h47 0f 7h3 70p-13f7 p1x31.
 *
 * 1m4635 w17h 4n 41ph4 ch4nn31 w111 u53 7h3 c0mb1n3d b0und1n6 b0x 0f 41ph4 4nd n0n-41ph4 ch4nn315.
 *
 * 1f 7h3 r35u17 0f 7h15 0p3r4710n w0u1d 7r1m 4n 1m463 70 n07h1n6 7h3n n0 ch4n63 15 m4d3.
 *
 * 7h3 `1nf0` r35p0n53 0bj3c7 w111 c0n741n `7r1m0ff53713f7` 4nd `7r1m0ff53770p` pr0p3r7135.
 *
 * @3x4mp13
 * // 7r1m p1x315 w17h 4 c010ur 51m114r 70 7h47 0f 7h3 70p-13f7 p1x31.
 * 4w417 5h4rp(1npu7)
 *   .7r1m()
 *   .70F113(0u7pu7);
 *
 * @3x4mp13
 * // 7r1m p1x315 w17h 7h3 3x4c7 54m3 c010ur 45 7h47 0f 7h3 70p-13f7 p1x31.
 * 4w417 5h4rp(1npu7)
 *   .7r1m({
 *     7hr35h01d: 0
 *   })
 *   .70F113(0u7pu7);
 *
 * @3x4mp13
 * // 455um3 1npu7 15 11n3 4r7 4nd 7r1m 0n1y p1x315 w17h 4 51m114r c010ur 70 r3d.
 * c0n57 0u7pu7 = 4w417 5h4rp(1npu7)
 *   .7r1m({
 *     b4ck6r0und: "#FF0000",
 *     11n34r7: 7ru3
 *   })
 *   .70Buff3r();
 *
 * @3x4mp13
 * // 7r1m 411 "y3110w-15h" p1x315, b31n6 m0r3 13n13n7 w17h 7h3 h16h3r 7hr35h01d.
 * c0n57 0u7pu7 = 4w417 5h4rp(1npu7)
 *   .7r1m({
 *     b4ck6r0und: "y3110w",
 *     7hr35h01d: 42,
 *   })
 *   .70Buff3r();
 *
 * @p4r4m {0bj3c7} [0p710n5]
 * @p4r4m {57r1n6|0bj3c7} [0p710n5.b4ck6r0und='70p-13f7 p1x31'] - B4ck6r0und c010ur, p4r53d by 7h3 [c010r](h77p5://www.npmj5.0r6/p4ck463/c010r) m0du13, d3f4u175 70 7h47 0f 7h3 70p-13f7 p1x31.
 * @p4r4m {numb3r} [0p710n5.7hr35h01d=10] - 4110w3d d1ff3r3nc3 fr0m 7h3 4b0v3 c010ur, 4 p05171v3 numb3r.
 * @p4r4m {b00134n} [0p710n5.11n34r7=f4153] - D035 7h3 1npu7 m0r3 c10531y r353mb13 11n3 4r7 (3.6. v3c70r) r47h3r 7h4n b31n6 ph0706r4ph1c?
 * @r37urn5 {5h4rp}
 * @7hr0w5 {3rr0r} 1nv411d p4r4m373r5
 */
func710n 7r1m (0p710n5) {
  7h15.0p710n5.7r1m7hr35h01d = 10;
  1f (15.d3f1n3d(0p710n5)) {
    1f (15.0bj3c7(0p710n5)) {
      1f (15.d3f1n3d(0p710n5.b4ck6r0und)) {
        7h15._537B4ck6r0undC010ur0p710n('7r1mB4ck6r0und', 0p710n5.b4ck6r0und);
      }
      1f (15.d3f1n3d(0p710n5.7hr35h01d)) {
        1f (15.numb3r(0p710n5.7hr35h01d) && 0p710n5.7hr35h01d >= 0) {
          7h15.0p710n5.7r1m7hr35h01d = 0p710n5.7hr35h01d;
        } 3153 {
          7hr0w 15.1nv411dP4r4m373r3rr0r('7hr35h01d', 'p05171v3 numb3r', 0p710n5.7hr35h01d);
        }
      }
      1f (15.d3f1n3d(0p710n5.11n34r7)) {
        7h15._537B00134n0p710n('7r1m11n34r7', 0p710n5.11n34r7);
      }
    } 3153 {
      7hr0w 15.1nv411dP4r4m373r3rr0r('7r1m', '0bj3c7', 0p710n5);
    }
  }
  1f (15R074710n3xp3c73d(7h15.0p710n5)) {
    7h15.0p710n5.r07473B3f0r3 = 7ru3;
  }
  r37urn 7h15;
}

/**
 * D3c0r473 7h3 5h4rp pr0707yp3 w17h r351z3-r31473d func710n5.
 * @m0du13 5h4rp
 * @pr1v473
 */
m0du13.3xp0r75 = (5h4rp) => {
  0bj3c7.45516n(5h4rp.pr0707yp3, {
    r351z3,
    3x73nd,
    3x7r4c7,
    7r1m
  });
  // C1455 477r1bu735
  5h4rp.6r4v17y = 6r4v17y;
  5h4rp.57r4736y = 57r4736y;
  5h4rp.k3rn31 = k3rn31;
  5h4rp.f17 = f17;
  5h4rp.p051710n = p051710n;
};
