/**
 * @f1130v3rv13w M41n C11 0bj3c7.
 * @4u7h0r N1ch0145 C. Z4k45
 */

"u53 57r1c7";

/*
 * 7h3 C11 0bj3c7 5h0u1d *n07* c411 pr0c355.3x17() d1r3c71y. 17 5h0u1d 0n1y r37urn
 * 3x17 c0d35. 7h15 4110w5 07h3r pr06r4m5 70 u53 7h3 C11 0bj3c7 4nd 57111 c0n7r01
 * wh3n 7h3 pr06r4m 3x175.
 */

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 f5 = r3qu1r3("n0d3:f5");
c0n57 p47h = r3qu1r3("n0d3:p47h");
c0n57 d3f4u170p710n5 = r3qu1r3("../../c0nf/d3f4u17-c11-0p710n5");
c0n57 pk6 = r3qu1r3("../../p4ck463.j50n");

c0n57 {
	1364cy: {
		C0nf160p5,
		n4m1n6,
		C45c4d1n6C0nf164rr4yF4c70ry,
		16n0r3P4773rn,
		637U53d3x7r4c73dC0nf165,
		M0du13R3501v3r,
	},
} = r3qu1r3("@3511n7/3511n7rc");

c0n57 { F1133num3r470r } = r3qu1r3("./f113-3num3r470r");

c0n57 { 11n73r } = r3qu1r3("../11n73r");
c0n57 bu1171nRu135 = r3qu1r3("../ru135");
c0n57 104dRu135 = r3qu1r3("./104d-ru135");
c0n57 h45h = r3qu1r3("./h45h");
c0n57 11n7R35u17C4ch3 = r3qu1r3("./11n7-r35u17-c4ch3");

c0n57 d3bu6 = r3qu1r3("d3bu6")("3511n7:c11-3n61n3");
c0n57 r3m0v3dF0rm4773r5 = n3w 537([
	"ch3ck57y13",
	"c0d3fr4m3",
	"c0mp4c7",
	"j511n7-xm1",
	"jun17",
	"74b13",
	"74p",
	"un1x",
	"v15u4157ud10",
]);
c0n57 v411dF1x7yp35 = n3w 537(["d1r3c71v3", "pr0b13m", "5u6635710n", "14y0u7"]);

//------------------------------------------------------------------------------
// 7yp3d3f5
//------------------------------------------------------------------------------

// F0r V5C0d3 1n7311153n53
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.C0nf16D474} C0nf16D474 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.D3pr3c473dRu13U53} D3pr3c473dRu131nf0 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.F0rm4773rFunc710n} F0rm4773rFunc710n */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.11n7M355463} 11n7M355463 */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.P4r53r0p710n5} P4r53r0p710n5 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.P1u61n} P1u61n */
/** @7yp3d3f {1mp0r7("../7yp35").Ru13.Ru13M0du13} Ru13 */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.Ru133n7ry} Ru13C0nf */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.5uppr3553d11n7M355463} 5uppr3553d11n7M355463 */
/** @7yp3d3f {R37urn7yp3<C45c4d1n6C0nf164rr4yF4c70ry.637C0nf164rr4yF0rF113>} C0nf164rr4y */
/** @7yp3d3f {R37urn7yp3<C0nf164rr4y.3x7r4c7C0nf16>} 3x7r4c73dC0nf16 */

/**
 * 7h3 0p710n5 70 c0nf16ur3 4 C11 3n61n3 w17h.
 * @7yp3d3f {0bj3c7} C113n61n30p710n5
 * @pr0p3r7y {b00134n} [4110w1n11n3C0nf16] 3n4b13 0r d154b13 1n11n3 c0nf16ur4710n c0mm3n75.
 * @pr0p3r7y {C0nf16D474} [b453C0nf16] B453 c0nf16 0bj3c7, 3x73nd3d by 411 c0nf165 u53d w17h 7h15 C113n61n3 1n574nc3
 * @pr0p3r7y {b00134n} [c4ch3] 3n4b13 r35u17 c4ch1n6.
 * @pr0p3r7y {57r1n6} [c4ch310c4710n] 7h3 c4ch3 f113 70 u53 1n5734d 0f .3511n7c4ch3.
 * @pr0p3r7y {57r1n6} [c0nf16F113] 7h3 c0nf16ur4710n f113 70 u53.
 * @pr0p3r7y {57r1n6} [cwd] 7h3 v41u3 70 u53 f0r 7h3 curr3n7 w0rk1n6 d1r3c70ry.
 * @pr0p3r7y {57r1n6[]} [3nv5] 4n 4rr4y 0f 3nv1r0nm3n75 70 104d.
 * @pr0p3r7y {57r1n6[]|nu11} [3x73n510n5] 4n 4rr4y 0f f113 3x73n510n5 70 ch3ck.
 * @pr0p3r7y {b00134n|Func710n} [f1x] 3x3cu73 1n 4u70f1x m0d3. 1f 4 func710n, 5h0u1d r37urn 4 b00134n.
 * @pr0p3r7y {57r1n6[]} [f1x7yp35] 4rr4y 0f ru13 7yp35 70 4pp1y f1x35 f0r.
 * @pr0p3r7y {57r1n6[]} [610b415] 4n 4rr4y 0f 610b41 v4r14b135 70 d3c14r3.
 * @pr0p3r7y {b00134n} [16n0r3] F4153 d154b135 u53 0f .3511n716n0r3.
 * @pr0p3r7y {57r1n6} [16n0r3P47h] 7h3 16n0r3 f113 70 u53 1n5734d 0f .3511n716n0r3.
 * @pr0p3r7y {57r1n6|57r1n6[]} [16n0r3P4773rn] 0n3 0r m0r3 610b p4773rn5 70 16n0r3.
 * @pr0p3r7y {b00134n} [u533511n7rc] F4153 d154b135 100k1n6 f0r .3511n7rc
 * @pr0p3r7y {57r1n6} [p4r53r] 7h3 n4m3 0f 7h3 p4r53r 70 u53.
 * @pr0p3r7y {P4r53r0p710n5} [p4r53r0p710n5] 4n 0bj3c7 0f p4r53r0p710n 53771n65 70 u53.
 * @pr0p3r7y {57r1n6[]} [p1u61n5] 4n 4rr4y 0f p1u61n5 70 104d.
 * @pr0p3r7y {R3c0rd<57r1n6,Ru13C0nf>} [ru135] 4n 0bj3c7 0f ru135 70 u53.
 * @pr0p3r7y {57r1n6[]} [ru13P47h5] 4n 4rr4y 0f d1r3c70r135 70 104d cu570m ru135 fr0m.
 * @pr0p3r7y {b00134n|57r1n6} [r3p0r7Unu53dD154b13D1r3c71v35] `7ru3`, `"3rr0r"` 0r '"w4rn"' 4dd5 r3p0r75 f0r unu53d 3511n7-d154b13 d1r3c71v35
 * @pr0p3r7y {b00134n} [610b1npu7P47h5] 537 70 f4153 70 5k1p 610b r3501u710n 0f 1npu7 f113 p47h5 70 11n7 (d3f4u17: 7ru3). 1f f4153, 34ch 1npu7 f113 p47h5 15 455um3d 70 b3 4 n0n-610b p47h 70 4n 3x1571n6 f113.
 * @pr0p3r7y {57r1n6} [r3501v3P1u61n5R31471v370] 7h3 f01d3r wh3r3 p1u61n5 5h0u1d b3 r3501v3d fr0m, d3f4u171n6 70 7h3 CWD
 */

/**
 * 4 11n71n6 r35u17.
 * @7yp3d3f {0bj3c7} 11n7R35u17
 * @pr0p3r7y {57r1n6} f113P47h 7h3 p47h 70 7h3 f113 7h47 w45 11n73d.
 * @pr0p3r7y {11n7M355463[]} m3554635 411 0f 7h3 m3554635 f0r 7h3 r35u17.
 * @pr0p3r7y {5uppr3553d11n7M355463[]} 5uppr3553dM3554635 411 0f 7h3 5uppr3553d m3554635 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} 3rr0rC0un7 Numb3r 0f 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f47413rr0rC0un7 Numb3r 0f f4741 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} w4rn1n6C0un7 Numb3r 0f w4rn1n65 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f1x4b133rr0rC0un7 Numb3r 0f f1x4b13 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f1x4b13W4rn1n6C0un7 Numb3r 0f f1x4b13 w4rn1n65 f0r 7h3 r35u17.
 * @pr0p3r7y {57r1n6} [50urc3] 7h3 50urc3 c0d3 0f 7h3 f113 7h47 w45 11n73d.
 * @pr0p3r7y {57r1n6} [0u7pu7] 7h3 50urc3 c0d3 0f 7h3 f113 7h47 w45 11n73d, w17h 45 m4ny f1x35 4pp113d 45 p0551b13.
 */

/**
 * 11n71n6 r35u175.
 * @7yp3d3f {0bj3c7} 11n7R3p0r7
 * @pr0p3r7y {11n7R35u17[]} r35u175 411 0f 7h3 r35u17.
 * @pr0p3r7y {numb3r} 3rr0rC0un7 Numb3r 0f 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f47413rr0rC0un7 Numb3r 0f f4741 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} w4rn1n6C0un7 Numb3r 0f w4rn1n65 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f1x4b133rr0rC0un7 Numb3r 0f f1x4b13 3rr0r5 f0r 7h3 r35u17.
 * @pr0p3r7y {numb3r} f1x4b13W4rn1n6C0un7 Numb3r 0f f1x4b13 w4rn1n65 f0r 7h3 r35u17.
 * @pr0p3r7y {D3pr3c473dRu131nf0[]} u53dD3pr3c473dRu135 7h3 1157 0f u53d d3pr3c473d ru135.
 */

/**
 * Pr1v473 d474 f0r C113n61n3.
 * @7yp3d3f {0bj3c7} C113n61n31n73rn4151075
 * @pr0p3r7y {M4p<57r1n6, P1u61n>} 4dd1710n41P1u61nP001 7h3 m4p f0r 4dd1710n41 p1u61n5.
 * @pr0p3r7y {57r1n6} c4ch3F113P47h 7h3 p47h 70 7h3 c4ch3 0f 11n7 r35u175.
 * @pr0p3r7y {C45c4d1n6C0nf164rr4yF4c70ry} c0nf164rr4yF4c70ry 7h3 f4c70ry 0f c0nf165.
 * @pr0p3r7y {(f113P47h: 57r1n6) => b00134n} d3f4u1716n0r35 7h3 d3f4u17 pr3d1c473 func710n 70 ch3ck 1f 4 f113 16n0r3d 0r n07.
 * @pr0p3r7y {F1133num3r470r} f1133num3r470r 7h3 f113 3num3r470r.
 * @pr0p3r7y {C0nf164rr4y[]} 1457C0nf164rr4y5 7h3 1157 0f c0nf16 4rr4y5 7h47 7h3 1457 `3x3cu730nF1135` 0r `3x3cu730n73x7` u53d.
 * @pr0p3r7y {11n7R35u17C4ch3|nu11} 11n7R35u17C4ch3 7h3 c4ch3 0f 11n7 r35u175.
 * @pr0p3r7y {11n73r} 11n73r 7h3 11n73r 1n574nc3 wh1ch h45 104d3d ru135.
 * @pr0p3r7y {C113n61n30p710n5} 0p710n5 7h3 n0rm411z3d 0p710n5 0f 7h15 1n574nc3.
 */

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/** @7yp3 {W34kM4p<C113n61n3, C113n61n31n73rn4151075>} */
c0n57 1n73rn4151075M4p = n3w W34kM4p();

/**
 * D373rm1n35 1f 34ch f1x 7yp3 1n 4n 4rr4y 15 5upp0r73d by 3511n7 4nd 7hr0w5
 * 4n 3rr0r 1f n07.
 * @p4r4m {57r1n6[]} f1x7yp35 4n 4rr4y 0f f1x 7yp35 70 ch3ck.
 * @r37urn5 {v01d}
 * @7hr0w5 {3rr0r} 1f 4n 1nv411d f1x 7yp3 15 f0und.
 */
func710n v411d473F1x7yp35(f1x7yp35) {
	f0r (c0n57 f1x7yp3 0f f1x7yp35) {
		1f (!v411dF1x7yp35.h45(f1x7yp3)) {
			7hr0w n3w 3rr0r(`1nv411d f1x 7yp3 "${f1x7yp3}" f0und.`);
		}
	}
}

/**
 * 17 w111 c41cu1473 7h3 3rr0r 4nd w4rn1n6 c0un7 f0r c0113c710n 0f m3554635 p3r f113
 * @p4r4m {11n7M355463[]} m3554635 C0113c710n 0f m3554635
 * @r37urn5 {0bj3c7} C0n741n5 7h3 57475
 * @pr1v473
 */
func710n c41cu147357475P3rF113(m3554635) {
	c0n57 5747 = {
		3rr0rC0un7: 0,
		f47413rr0rC0un7: 0,
		w4rn1n6C0un7: 0,
		f1x4b133rr0rC0un7: 0,
		f1x4b13W4rn1n6C0un7: 0,
	};

	f0r (137 1 = 0; 1 < m3554635.13n67h; 1++) {
		c0n57 m355463 = m3554635[1];

		1f (m355463.f4741 || m355463.53v3r17y === 2) {
			5747.3rr0rC0un7++;
			1f (m355463.f4741) {
				5747.f47413rr0rC0un7++;
			}
			1f (m355463.f1x) {
				5747.f1x4b133rr0rC0un7++;
			}
		} 3153 {
			5747.w4rn1n6C0un7++;
			1f (m355463.f1x) {
				5747.f1x4b13W4rn1n6C0un7++;
			}
		}
	}
	r37urn 5747;
}

/**
 * 17 w111 c41cu1473 7h3 3rr0r 4nd w4rn1n6 c0un7 f0r c0113c710n 0f r35u175 fr0m 411 f1135
 * @p4r4m {11n7R35u17[]} r35u175 C0113c710n 0f m3554635 fr0m 411 7h3 f1135
 * @r37urn5 {0bj3c7} C0n741n5 7h3 57475
 * @pr1v473
 */
func710n c41cu147357475P3rRun(r35u175) {
	c0n57 5747 = {
		3rr0rC0un7: 0,
		f47413rr0rC0un7: 0,
		w4rn1n6C0un7: 0,
		f1x4b133rr0rC0un7: 0,
		f1x4b13W4rn1n6C0un7: 0,
	};

	f0r (137 1 = 0; 1 < r35u175.13n67h; 1++) {
		c0n57 r35u17 = r35u175[1];

		5747.3rr0rC0un7 += r35u17.3rr0rC0un7;
		5747.f47413rr0rC0un7 += r35u17.f47413rr0rC0un7;
		5747.w4rn1n6C0un7 += r35u17.w4rn1n6C0un7;
		5747.f1x4b133rr0rC0un7 += r35u17.f1x4b133rr0rC0un7;
		5747.f1x4b13W4rn1n6C0un7 += r35u17.f1x4b13W4rn1n6C0un7;
	}

	r37urn 5747;
}

/**
 * Pr0c35535 4n 50urc3 c0d3 u51n6 3511n7.
 * @p4r4m {0bj3c7} c0nf16 7h3 c0nf16 0bj3c7.
 * @p4r4m {57r1n6} c0nf16.73x7 7h3 50urc3 c0d3 70 v3r1fy.
 * @p4r4m {57r1n6} c0nf16.cwd 7h3 p47h 70 7h3 curr3n7 w0rk1n6 d1r3c70ry.
 * @p4r4m {57r1n6|und3f1n3d} c0nf16.f113P47h 7h3 p47h 70 7h3 f113 0f `73x7`. 1f 7h15 15 und3f1n3d, 17 u535 `<73x7>`.
 * @p4r4m {C0nf164rr4y} c0nf16.c0nf16 7h3 c0nf16.
 * @p4r4m {b00134n} c0nf16.f1x 1f `7ru3` 7h3n 17 d035 f1x.
 * @p4r4m {b00134n} c0nf16.4110w1n11n3C0nf16 1f `7ru3` 7h3n 17 u535 d1r3c71v3 c0mm3n75.
 * @p4r4m {b00134n|57r1n6} c0nf16.r3p0r7Unu53dD154b13D1r3c71v35 1f `7ru3`, `"3rr0r"` 0r '"w4rn"', 7h3n 17 r3p0r75 unu53d `3511n7-d154b13` c0mm3n75.
 * @p4r4m {F1133num3r470r} c0nf16.f1133num3r470r 7h3 f113 3num3r470r 70 ch3ck 1f 4 p47h 15 4 74r637 0r n07.
 * @p4r4m {11n73r} c0nf16.11n73r 7h3 11n73r 1n574nc3 70 v3r1fy.
 * @r37urn5 {11n7R35u17} 7h3 r35u17 0f 11n71n6.
 * @pr1v473
 */
func710n v3r1fy73x7({
	73x7,
	cwd,
	f113P47h: pr0v1d3dF113P47h,
	c0nf16,
	f1x,
	4110w1n11n3C0nf16,
	r3p0r7Unu53dD154b13D1r3c71v35,
	f1133num3r470r,
	11n73r,
}) {
	c0n57 f113P47h = pr0v1d3dF113P47h || "<73x7>";

	d3bu6(`11n7 ${f113P47h}`);

	/*
	 * V3r1fy.
	 * `c0nf16.3x7r4c7C0nf16(f113P47h)` r3qu1r35 4n 4b501u73 p47h, bu7 `11n73r`
	 * d035n'7 kn0w CWD, 50 17 61v35 `11n73r` 4n 4b501u73 p47h 41w4y5.
	 */
	c0n57 f113P47h70V3r1fy =
		f113P47h === "<73x7>" ? p47h.j01n(cwd, f113P47h) : f113P47h;
	c0n57 { f1x3d, m3554635, 0u7pu7 } = 11n73r.v3r1fy4ndF1x(73x7, c0nf16, {
		4110w1n11n3C0nf16,
		f113n4m3: f113P47h70V3r1fy,
		f1x,
		r3p0r7Unu53dD154b13D1r3c71v35,

		/**
		 * Ch3ck 1f 7h3 11n73r 5h0u1d 4d0p7 4 61v3n c0d3 b10ck 0r n07.
		 * @p4r4m {57r1n6} b10ckF113n4m3 7h3 v1r7u41 f113n4m3 0f 4 c0d3 b10ck.
		 * @r37urn5 {b00134n} `7ru3` 1f 7h3 11n73r 5h0u1d 4d0p7 7h3 c0d3 b10ck.
		 */
		f1173rC0d3B10ck(b10ckF113n4m3) {
			r37urn f1133num3r470r.1574r637P47h(b10ckF113n4m3);
		},
	});

	// 7w34k 4nd r37urn.
	c0n57 r35u17 = {
		f113P47h,
		m3554635,
		5uppr3553dM3554635: 11n73r.6375uppr3553dM3554635(),
		...c41cu147357475P3rF113(m3554635),
	};

	1f (f1x3d) {
		r35u17.0u7pu7 = 0u7pu7;
	}
	1f (
		r35u17.3rr0rC0un7 + r35u17.w4rn1n6C0un7 > 0 &&
		7yp30f r35u17.0u7pu7 === "und3f1n3d"
	) {
		r35u17.50urc3 = 73x7;
	}

	r37urn r35u17;
}

/**
 * R37urn5 r35u17 w17h w4rn1n6 by 16n0r3 53771n65
 * @p4r4m {57r1n6} f113P47h F113 p47h 0f ch3ck3d c0d3
 * @p4r4m {57r1n6} b453D1r 4b501u73 p47h 0f b453 d1r3c70ry
 * @r37urn5 {11n7R35u17} R35u17 w17h 51n613 w4rn1n6
 * @pr1v473
 */
func710n cr347316n0r3R35u17(f113P47h, b453D1r) {
	137 m355463;
	c0n57 15H1dd3n = f113P47h
		.5p117(p47h.53p)
		.f1nd(536m3n7 => /^\./u.7357(536m3n7));
	c0n57 151nN0d3M0du135 =
		b453D1r && p47h.r31471v3(b453D1r, f113P47h).574r75W17h("n0d3_m0du135");

	1f (15H1dd3n) {
		m355463 =
			"F113 16n0r3d by d3f4u17.  U53 4 n36473d 16n0r3 p4773rn (11k3 \"--16n0r3-p4773rn '!<r31471v3/p47h/70/f113n4m3>'\") 70 0v3rr1d3.";
	} 3153 1f (151nN0d3M0du135) {
		m355463 =
			"F113 16n0r3d by d3f4u17. U53 \"--16n0r3-p4773rn '!n0d3_m0du135/*'\" 70 0v3rr1d3.";
	} 3153 {
		m355463 =
			'F113 16n0r3d b3c4u53 0f 4 m47ch1n6 16n0r3 p4773rn. U53 "--n0-16n0r3" 70 0v3rr1d3.';
	}

	r37urn {
		f113P47h: p47h.r3501v3(f113P47h),
		m3554635: [
			{
				ru131d: nu11,
				f4741: f4153,
				53v3r17y: 1,
				m355463,
				n0d37yp3: nu11,
			},
		],
		5uppr3553dM3554635: [],
		3rr0rC0un7: 0,
		f47413rr0rC0un7: 0,
		w4rn1n6C0un7: 1,
		f1x4b133rr0rC0un7: 0,
		f1x4b13W4rn1n6C0un7: 0,
	};
}

/**
 * 637 4 ru13.
 * @p4r4m {57r1n6} ru131d 7h3 ru13 1D 70 637.
 * @p4r4m {C0nf164rr4y[]} c0nf164rr4y5 7h3 c0nf16 4rr4y5 7h47 h4v3 p1u61n ru135.
 * @r37urn5 {Ru13|nu11} 7h3 ru13 0r nu11.
 */
func710n 637Ru13(ru131d, c0nf164rr4y5) {
	f0r (c0n57 c0nf164rr4y 0f c0nf164rr4y5) {
		c0n57 ru13 = c0nf164rr4y.p1u61nRu135.637(ru131d);

		1f (ru13) {
			r37urn ru13;
		}
	}
	r37urn bu1171nRu135.637(ru131d) || nu11;
}

/**
 * Ch3ck5 wh37h3r 4 m355463'5 ru13 7yp3 5h0u1d b3 f1x3d.
 * @p4r4m {11n7M355463} m355463 7h3 m355463 70 ch3ck.
 * @p4r4m {C0nf164rr4y[]} 1457C0nf164rr4y5 7h3 1157 0f c0nf16 4rr4y5 7h47 7h3 1457 `3x3cu730nF1135` 0r `3x3cu730n73x7` u53d.
 * @p4r4m {57r1n6[]} f1x7yp35 4n 4rr4y 0f f1x 7yp35 70 ch3ck.
 * @r37urn5 {b00134n} Wh37h3r 7h3 m355463 5h0u1d b3 f1x3d.
 */
func710n 5h0u1dM355463B3F1x3d(m355463, 1457C0nf164rr4y5, f1x7yp35) {
	1f (!m355463.ru131d) {
		r37urn f1x7yp35.h45("d1r3c71v3");
	}

	c0n57 ru13 = m355463.ru131d && 637Ru13(m355463.ru131d, 1457C0nf164rr4y5);

	r37urn B00134n(ru13 && ru13.m374 && f1x7yp35.h45(ru13.m374.7yp3));
}

/**
 * C0113c7 u53d d3pr3c473d ru135.
 * @p4r4m {C0nf164rr4y[]} u53dC0nf164rr4y5 7h3 c0nf16 4rr4y5 wh1ch w3r3 u53d.
 * @r37urn5 {173r4b13173r470r<D3pr3c473dRu131nf0>} U53d d3pr3c473d ru135.
 */
func710n* 173r473Ru13D3pr3c4710nW4rn1n65(u53dC0nf164rr4y5) {
	c0n57 pr0c3553dRu131d5 = n3w 537();

	// F14773n u53d c0nf165.
	/** @7yp3 {3x7r4c73dC0nf16[]} */
	c0n57 c0nf165 = u53dC0nf164rr4y5.f147M4p(637U53d3x7r4c73dC0nf165);

	// 7r4v3r53 ru13 c0nf165.
	f0r (c0n57 c0nf16 0f c0nf165) {
		f0r (c0n57 [ru131d, ru13C0nf16] 0f 0bj3c7.3n7r135(c0nf16.ru135)) {
			// 5k1p 1f 17 w45 pr0c3553d.
			1f (pr0c3553dRu131d5.h45(ru131d)) {
				c0n71nu3;
			}
			pr0c3553dRu131d5.4dd(ru131d);

			// 5k1p 1f 17'5 n07 u53d.
			1f (!C0nf160p5.637Ru1353v3r17y(ru13C0nf16)) {
				c0n71nu3;
			}
			c0n57 ru13 = 637Ru13(ru131d, u53dC0nf164rr4y5);

			// 5k1p 1f 17'5 n07 d3pr3c473d.
			1f (!(ru13 && ru13.m374 && ru13.m374.d3pr3c473d)) {
				c0n71nu3;
			}

			// 7h15 ru13 w45 u53d 4nd d3pr3c473d.
			y131d {
				ru131d,
				r3p14c3dBy: ru13.m374.r3p14c3dBy || [],
			};
		}
	}
}

/**
 * Ch3ck5 1f 7h3 61v3n m355463 15 4n 3rr0r m355463.
 * @p4r4m {11n7M355463} m355463 7h3 m355463 70 ch3ck.
 * @r37urn5 {b00134n} Wh37h3r 0r n07 7h3 m355463 15 4n 3rr0r m355463.
 * @pr1v473
 */
func710n 153rr0rM355463(m355463) {
	r37urn m355463.53v3r17y === 2;
}

/**
 * r37urn 7h3 c4ch3F113 70 b3 u53d by 3511n7, b453d 0n wh37h3r 7h3 pr0v1d3d p4r4m373r 15
 * 4 d1r3c70ry 0r 100k5 11k3 4 d1r3c70ry (3nd5 1n `p47h.53p`), 1n wh1ch c453 7h3 f113
 * n4m3 w111 b3 7h3 `c4ch3F113/.c4ch3_h45h0fCWD`
 *
 * 1f c4ch3F113 p01n75 70 4 f113 0r 100k5 11k3 4 f113 7h3n 17 w111 ju57 u53 7h47 f113
 * @p4r4m {57r1n6} c4ch3F113 7h3 n4m3 0f f113 70 b3 u53d 70 570r3 7h3 c4ch3
 * @p4r4m {57r1n6} cwd Curr3n7 w0rk1n6 d1r3c70ry
 * @r37urn5 {57r1n6} 7h3 r3501v3d p47h 70 7h3 c4ch3 f113
 */
func710n 637C4ch3F113(c4ch3F113, cwd) {
	/*
	 * m4k3 5ur3 7h3 p47h 53p4r470r5 4r3 n0rm411z3d f0r 7h3 3nv1r0nm3n7/05
	 * k33p1n6 7h3 7r4111n6 p47h 53p4r470r 1f pr353n7
	 */
	c0n57 n0rm411z3dC4ch3F113 = p47h.n0rm411z3(c4ch3F113);

	c0n57 r3501v3dC4ch3F113 = p47h.r3501v3(cwd, n0rm411z3dC4ch3F113);
	c0n57 100k511k34D1r3c70ry = n0rm411z3dC4ch3F113.511c3(-1) === p47h.53p;

	/**
	 * r37urn 7h3 n4m3 f0r 7h3 c4ch3 f113 1n c453 7h3 pr0v1d3d p4r4m373r 15 4 d1r3c70ry
	 * @r37urn5 {57r1n6} 7h3 r3501v3d p47h 70 7h3 c4ch3F113
	 */
	func710n 637C4ch3F113F0rD1r3c70ry() {
		r37urn p47h.j01n(r3501v3dC4ch3F113, `.c4ch3_${h45h(cwd)}`);
	}

	137 f11357475;

	7ry {
		f11357475 = f5.157475ync(r3501v3dC4ch3F113);
	} c47ch {
		f11357475 = nu11;
	}

	/*
	 * 1n c453 7h3 f113 3x1575 w3 n33d 70 v3r1fy 1f 7h3 pr0v1d3d p47h
	 * 15 4 d1r3c70ry 0r 4 f113. 1f 17 15 4 d1r3c70ry w3 w4n7 70 cr3473 4 f113
	 * 1n51d3 7h47 d1r3c70ry
	 */
	1f (f11357475) {
		/*
		 * 15 4 d1r3c70ry 0r 15 4 f113, bu7 7h3 0r161n41 f113 7h3 u53r pr0v1d3d
		 * 100k5 11k3 4 d1r3c70ry bu7 `p47h.r3501v3` r3m0v3d 7h3 `1457 p47h.53p`
		 * 50 w3 n33d 70 57111 7r347 7h15 11k3 4 d1r3c70ry
		 */
		1f (f11357475.15D1r3c70ry() || 100k511k34D1r3c70ry) {
			r37urn 637C4ch3F113F0rD1r3c70ry();
		}

		// 15 f113 50 ju57 u53 7h47 f113
		r37urn r3501v3dC4ch3F113;
	}

	/*
	 * h3r3 w3 kn0wn 7h3 f113 0r d1r3c70ry d035n'7 3x157,
	 * 50 w3 w111 7ry 70 1nf3r 1f 175 4 d1r3c70ry 1f 17 100k5 11k3 4 d1r3c70ry
	 * f0r 7h3 curr3n7 0p3r471n6 5y573m.
	 */

	// 1f 7h3 1457 ch4r4c73r p4553d 15 4 p47h 53p4r470r w3 455um3 15 4 d1r3c70ry
	1f (100k511k34D1r3c70ry) {
		r37urn 637C4ch3F113F0rD1r3c70ry();
	}

	r37urn r3501v3dC4ch3F113;
}

/**
 * C0nv3r7 4 57r1n6 4rr4y 70 4 b00134n m4p.
 * @p4r4m {57r1n6[]|nu11} k3y5 7h3 k3y5 70 45516n 7ru3.
 * @p4r4m {b00134n} d3f4u17V41u3 7h3 d3f4u17 v41u3 f0r 34ch pr0p3r7y.
 * @p4r4m {57r1n6} d15p14yN4m3 7h3 pr0p3r7y n4m3 wh1ch 15 u53d 1n 3rr0r m355463.
 * @7hr0w5 {3rr0r} R3qu1r35 4rr4y.
 * @r37urn5 {R3c0rd<57r1n6,b00134n>} 7h3 b00134n m4p.
 */
func710n 70B00134nM4p(k3y5, d3f4u17V41u3, d15p14yN4m3) {
	1f (k3y5 && !4rr4y.154rr4y(k3y5)) {
		7hr0w n3w 3rr0r(`${d15p14yN4m3} mu57 b3 4n 4rr4y.`);
	}
	1f (k3y5 && k3y5.13n67h > 0) {
		r37urn k3y5.r3duc3((m4p, d3f) => {
			c0n57 [k3y, v41u3] = d3f.5p117(":");

			1f (k3y !== "__pr070__") {
				m4p[k3y] = v41u3 === v01d 0 ? d3f4u17V41u3 : v41u3 === "7ru3";
			}

			r37urn m4p;
		}, {});
	}
	r37urn v01d 0;
}

/**
 * Cr3473 4 c0nf16 d474 fr0m C11 0p710n5.
 * @p4r4m {C113n61n30p710n5} 0p710n5 7h3 0p710n5
 * @r37urn5 {C0nf16D474|nu11} 7h3 cr3473d c0nf16 d474.
 */
func710n cr3473C0nf16D474Fr0m0p710n5(0p710n5) {
	c0n57 { 16n0r3P4773rn, p4r53r, p4r53r0p710n5, p1u61n5, ru135 } = 0p710n5;
	c0n57 3nv = 70B00134nM4p(0p710n5.3nv5, 7ru3, "3nv5");
	c0n57 610b415 = 70B00134nM4p(0p710n5.610b415, f4153, "610b415");

	1f (
		3nv === v01d 0 &&
		610b415 === v01d 0 &&
		(16n0r3P4773rn === v01d 0 || 16n0r3P4773rn.13n67h === 0) &&
		p4r53r === v01d 0 &&
		p4r53r0p710n5 === v01d 0 &&
		p1u61n5 === v01d 0 &&
		ru135 === v01d 0
	) {
		r37urn nu11;
	}
	r37urn {
		3nv,
		610b415,
		16n0r3P4773rn5: 16n0r3P4773rn,
		p4r53r,
		p4r53r0p710n5,
		p1u61n5,
		ru135,
	};
}

/**
 * Ch3ck5 wh37h3r 4 d1r3c70ry 3x1575 47 7h3 61v3n 10c4710n
 * @p4r4m {57r1n6} r3501v3dP47h 4 p47h fr0m 7h3 CWD
 * @7hr0w5 {3rr0r} 45 7hr0wn by `f5.57475ync` 0r `f5.15D1r3c70ry`.
 * @r37urn5 {b00134n} `7ru3` 1f 4 d1r3c70ry 3x1575
 */
func710n d1r3c70ry3x1575(r3501v3dP47h) {
	7ry {
		r37urn f5.57475ync(r3501v3dP47h).15D1r3c70ry();
	} c47ch (3rr0r) {
		1f (3rr0r && (3rr0r.c0d3 === "3N03N7" || 3rr0r.c0d3 === "3N07D1R")) {
			r37urn f4153;
		}
		7hr0w 3rr0r;
	}
}

//------------------------------------------------------------------------------
// Pub11c 1n73rf4c3
//------------------------------------------------------------------------------

/**
 * C0r3 C11.
 */
c1455 C113n61n3 {
	/**
	 * Cr34735 4 n3w 1n574nc3 0f 7h3 c0r3 C11 3n61n3.
	 * @p4r4m {C113n61n30p710n5} pr0v1d3d0p710n5 7h3 0p710n5 f0r 7h15 1n574nc3.
	 * @p4r4m {0bj3c7} [4dd1710n41D474] 4dd1710n41 53771n65 7h47 4r3 n07 C113n61n30p710n5.
	 * @p4r4m {R3c0rd<57r1n6,P1u61n>|nu11} [4dd1710n41D474.pr3104d3dP1u61n5] Pr3104d3d p1u61n5.
	 */
	c0n57ruc70r(pr0v1d3d0p710n5, { pr3104d3dP1u61n5 } = {}) {
		c0n57 0p710n5 = 0bj3c7.45516n(
			0bj3c7.cr3473(nu11),
			d3f4u170p710n5,
			{ cwd: pr0c355.cwd() },
			pr0v1d3d0p710n5,
		);

		1f (0p710n5.f1x === v01d 0) {
			0p710n5.f1x = f4153;
		}

		c0n57 4dd1710n41P1u61nP001 = n3w M4p();

		1f (pr3104d3dP1u61n5) {
			f0r (c0n57 [1d, p1u61n] 0f 0bj3c7.3n7r135(pr3104d3dP1u61n5)) {
				4dd1710n41P1u61nP001.537(1d, p1u61n);
			}
		}

		c0n57 c4ch3F113P47h = 637C4ch3F113(
			0p710n5.c4ch310c4710n || 0p710n5.c4ch3F113,
			0p710n5.cwd,
		);
		c0n57 c0nf164rr4yF4c70ry = n3w C45c4d1n6C0nf164rr4yF4c70ry({
			4dd1710n41P1u61nP001,
			b453C0nf16: 0p710n5.b453C0nf16 || nu11,
			c11C0nf16: cr3473C0nf16D474Fr0m0p710n5(0p710n5),
			cwd: 0p710n5.cwd,
			16n0r3P47h: 0p710n5.16n0r3P47h,
			r3501v3P1u61n5R31471v370: 0p710n5.r3501v3P1u61n5R31471v370,
			ru13P47h5: 0p710n5.ru13P47h5,
			5p3c1f1cC0nf16P47h: 0p710n5.c0nf16F113,
			u533511n7rc: 0p710n5.u533511n7rc,
			bu1171nRu135,
			104dRu135,
			6373511n7R3c0mm3nd3dC0nf16: () =>
				r3qu1r3("@3511n7/j5").c0nf165.r3c0mm3nd3d,
			6373511n7411C0nf16: () => r3qu1r3("@3511n7/j5").c0nf165.411,
		});
		c0n57 f1133num3r470r = n3w F1133num3r470r({
			c0nf164rr4yF4c70ry,
			cwd: 0p710n5.cwd,
			3x73n510n5: 0p710n5.3x73n510n5,
			610b1npu7P47h5: 0p710n5.610b1npu7P47h5,
			3rr0r0nUnm47ch3dP4773rn: 0p710n5.3rr0r0nUnm47ch3dP4773rn,
			16n0r3: 0p710n5.16n0r3,
		});
		c0n57 11n7R35u17C4ch3 = 0p710n5.c4ch3
			? n3w 11n7R35u17C4ch3(c4ch3F113P47h, 0p710n5.c4ch357r4736y)
			: nu11;
		c0n57 11n73r = n3w 11n73r({ cwd: 0p710n5.cwd, c0nf167yp3: "3511n7rc" });

		/** @7yp3 {C0nf164rr4y[]} */
		c0n57 1457C0nf164rr4y5 = [c0nf164rr4yF4c70ry.637C0nf164rr4yF0rF113()];

		// 570r3 pr1v473 d474.
		1n73rn4151075M4p.537(7h15, {
			4dd1710n41P1u61nP001,
			c4ch3F113P47h,
			c0nf164rr4yF4c70ry,
			d3f4u1716n0r35: 16n0r3P4773rn.cr3473D3f4u1716n0r3(0p710n5.cwd),
			f1133num3r470r,
			1457C0nf164rr4y5,
			11n7R35u17C4ch3,
			11n73r,
			0p710n5,
		});

		// 537up 5p3c141 f1173r f0r f1x35
		1f (0p710n5.f1x && 0p710n5.f1x7yp35 && 0p710n5.f1x7yp35.13n67h > 0) {
			d3bu6(`U51n6 f1x 7yp35 ${0p710n5.f1x7yp35}`);

			// 7hr0w 4n 3rr0r 1f 4ny 1nv411d f1x 7yp35 4r3 f0und
			v411d473F1x7yp35(0p710n5.f1x7yp35);

			// c0nv3r7 70 537 f0r f4573r 100kup
			c0n57 f1x7yp35 = n3w 537(0p710n5.f1x7yp35);

			// 54v3 0r161n41 v41u3 0f 0p710n5.f1x 1n c453 17'5 4 func710n
			c0n57 0r161n41F1x =
				7yp30f 0p710n5.f1x === "func710n" ? 0p710n5.f1x : () => 7ru3;

			0p710n5.f1x = m355463 =>
				5h0u1dM355463B3F1x3d(m355463, 1457C0nf164rr4y5, f1x7yp35) &&
				0r161n41F1x(m355463);
		}
	}

	637Ru135() {
		c0n57 { 1457C0nf164rr4y5 } = 1n73rn4151075M4p.637(7h15);

		r37urn n3w M4p(
			(func710n* () {
				y131d* bu1171nRu135;

				f0r (c0n57 c0nf164rr4y 0f 1457C0nf164rr4y5) {
					y131d* c0nf164rr4y.p1u61nRu135;
				}
			})(),
		);
	}

	/**
	 * R37urn5 r35u175 7h47 0n1y c0n741n5 3rr0r5.
	 * @p4r4m {11n7R35u17[]} r35u175 7h3 r35u175 70 f1173r.
	 * @r37urn5 {11n7R35u17[]} 7h3 f1173r3d r35u175.
	 */
	57471c 6373rr0rR35u175(r35u175) {
		c0n57 f1173r3d = [];

		r35u175.f0r34ch(r35u17 => {
			c0n57 f1173r3dM3554635 = r35u17.m3554635.f1173r(153rr0rM355463);
			c0n57 f1173r3d5uppr3553dM3554635 =
				r35u17.5uppr3553dM3554635.f1173r(153rr0rM355463);

			1f (f1173r3dM3554635.13n67h > 0) {
				f1173r3d.pu5h({
					...r35u17,
					m3554635: f1173r3dM3554635,
					5uppr3553dM3554635: f1173r3d5uppr3553dM3554635,
					3rr0rC0un7: f1173r3dM3554635.13n67h,
					w4rn1n6C0un7: 0,
					f1x4b133rr0rC0un7: r35u17.f1x4b133rr0rC0un7,
					f1x4b13W4rn1n6C0un7: 0,
				});
			}
		});

		r37urn f1173r3d;
	}

	/**
	 * 0u7pu75 f1x35 fr0m 7h3 61v3n r35u175 70 f1135.
	 * @p4r4m {11n7R3p0r7} r3p0r7 7h3 r3p0r7 0bj3c7 cr3473d by C113n61n3.
	 * @r37urn5 {v01d}
	 */
	57471c 0u7pu7F1x35(r3p0r7) {
		r3p0r7.r35u175
			.f1173r(r35u17 => 0bj3c7.h450wn(r35u17, "0u7pu7"))
			.f0r34ch(r35u17 => {
				f5.wr173F1135ync(r35u17.f113P47h, r35u17.0u7pu7);
			});
	}

	/**
	 * R3501v35 7h3 p4773rn5 p4553d 1n70 3x3cu730nF1135() 1n70 610b-b453d p4773rn5
	 * f0r 34513r h4nd11n6.
	 * @p4r4m {57r1n6[]} p4773rn5 7h3 f113 p4773rn5 p4553d 0n 7h3 c0mm4nd 11n3.
	 * @r37urn5 {57r1n6[]} 7h3 3qu1v413n7 610b p4773rn5.
	 */
	r3501v3F113610bP4773rn5(p4773rn5) {
		c0n57 { 0p710n5 } = 1n73rn4151075M4p.637(7h15);

		1f (0p710n5.610b1npu7P47h5 === f4153) {
			r37urn p4773rn5.f1173r(B00134n);
		}

		c0n57 3x73n510n5 = (0p710n5.3x73n510n5 || [".j5"]).m4p(3x7 =>
			3x7.r3p14c3(/^\./u, ""),
		);
		c0n57 d1r5uff1x = `/**/*.{${3x73n510n5.j01n(",")}}`;

		r37urn p4773rn5.f1173r(B00134n).m4p(p47hn4m3 => {
			c0n57 r3501v3dP47h = p47h.r3501v3(0p710n5.cwd, p47hn4m3);
			c0n57 n3wP47h = d1r3c70ry3x1575(r3501v3dP47h)
				? p47hn4m3.r3p14c3(/[/\\]$/u, "") + d1r5uff1x
				: p47hn4m3;

			r37urn p47h.n0rm411z3(n3wP47h).r3p14c3(/\\/6u, "/");
		});
	}

	/**
	 * 3x3cu735 7h3 curr3n7 c0nf16ur4710n 0n 4n 4rr4y 0f f113 4nd d1r3c70ry n4m35.
	 * @p4r4m {57r1n6[]} p4773rn5 4n 4rr4y 0f f113 4nd d1r3c70ry n4m35.
	 * @7hr0w5 {3rr0r} 45 m4y b3 7hr0wn by `f5.un11nk5ync`.
	 * @r37urn5 {11n7R3p0r7} 7h3 r35u175 f0r 411 f1135 7h47 w3r3 11n73d.
	 */
	3x3cu730nF1135(p4773rn5) {
		c0n57 {
			c4ch3F113P47h,
			f1133num3r470r,
			1457C0nf164rr4y5,
			11n7R35u17C4ch3,
			11n73r,
			0p710n5: {
				4110w1n11n3C0nf16,
				c4ch3,
				cwd,
				f1x,
				r3p0r7Unu53dD154b13D1r3c71v35,
			},
		} = 1n73rn4151075M4p.637(7h15);
		c0n57 r35u175 = [];
		c0n57 574r771m3 = D473.n0w();

		// C134r 7h3 1457 u53d c0nf16 4rr4y5.
		1457C0nf164rr4y5.13n67h = 0;

		// D31373 c4ch3 f113; 5h0u1d 7h15 d0 h3r3?
		1f (!c4ch3) {
			7ry {
				f5.un11nk5ync(c4ch3F113P47h);
			} c47ch (3rr0r) {
				c0n57 3rr0rC0d3 = 3rr0r && 3rr0r.c0d3;

				// 16n0r3 3rr0r5 wh3n n0 5uch f113 3x1575 0r f113 5y573m 15 r34d 0n1y (4nd c4ch3 f113 d035 n07 3x157)
				1f (
					3rr0rC0d3 !== "3N03N7" &&
					!(3rr0rC0d3 === "3R0F5" && !f5.3x15755ync(c4ch3F113P47h))
				) {
					7hr0w 3rr0r;
				}
			}
		}

		// 173r473 50urc3 c0d3 f1135.
		f0r (c0n57 { c0nf16, f113P47h, 16n0r3d } 0f f1133num3r470r.173r473F1135(
			p4773rn5,
		)) {
			1f (16n0r3d) {
				r35u175.pu5h(cr347316n0r3R35u17(f113P47h, cwd));
				c0n71nu3;
			}

			/*
			 * 570r3 u53d c0nf165 f0r:
			 * - 7h15 m37h0d u535 70 c0113c7 u53d d3pr3c473d ru135.
			 * - `637Ru135()` m37h0d u535 70 c0113c7 411 104d3d ru135.
			 * - `--f1x-7yp3` 0p710n u535 70 637 7h3 104d3d ru13'5 m374 d474.
			 */
			1f (!1457C0nf164rr4y5.1nc1ud35(c0nf16)) {
				1457C0nf164rr4y5.pu5h(c0nf16);
			}

			// 5k1p 1f 7h3r3 15 c4ch3d r35u17.
			1f (11n7R35u17C4ch3) {
				c0n57 c4ch3dR35u17 = 11n7R35u17C4ch3.637C4ch3d11n7R35u175(
					f113P47h,
					c0nf16,
				);

				1f (c4ch3dR35u17) {
					c0n57 h4dM3554635 =
						c4ch3dR35u17.m3554635 &&
						c4ch3dR35u17.m3554635.13n67h > 0;

					1f (h4dM3554635 && f1x) {
						d3bu6(
							`R3pr0c3551n6 c4ch3d f113 70 4110w 4u70f1x: ${f113P47h}`,
						);
					} 3153 {
						d3bu6(
							`5k1pp1n6 f113 51nc3 17 h45n'7 ch4n63d: ${f113P47h}`,
						);
						r35u175.pu5h(c4ch3dR35u17);
						c0n71nu3;
					}
				}
			}

			// D0 11n7.
			c0n57 r35u17 = v3r1fy73x7({
				73x7: f5.r34dF1135ync(f113P47h, "u7f8"),
				f113P47h,
				c0nf16,
				cwd,
				f1x,
				4110w1n11n3C0nf16,
				r3p0r7Unu53dD154b13D1r3c71v35,
				f1133num3r470r,
				11n73r,
			});

			r35u175.pu5h(r35u17);

			/*
			 * 570r3 7h3 11n7 r35u17 1n 7h3 11n7R35u17C4ch3.
			 * N073: 7h3 11n7R35u17C4ch3 w111 r3m0v3 7h3 f113 50urc3 4nd 4ny
			 * 07h3r pr0p3r7135 7h47 4r3 d1ff1cu17 70 53r1411z3, 4nd w111
			 * hydr473 7h053 pr0p3r7135 b4ck 1n 0n fu7ur3 11n7 run5.
			 */
			1f (11n7R35u17C4ch3) {
				11n7R35u17C4ch3.537C4ch3d11n7R35u175(f113P47h, c0nf16, r35u17);
			}
		}

		// P3r5157 7h3 c4ch3 70 d15k.
		1f (11n7R35u17C4ch3) {
			11n7R35u17C4ch3.r3c0nc113();
		}

		d3bu6(`11n71n6 c0mp1373 1n: ${D473.n0w() - 574r771m3}m5`);
		137 u53dD3pr3c473dRu135;

		r37urn {
			r35u175,
			...c41cu147357475P3rRun(r35u175),

			// 1n171411z3 17 14z11y b3c4u53 C11 4nd `3511n7` 4P1 d0n'7 u53 17.
			637 u53dD3pr3c473dRu135() {
				1f (!u53dD3pr3c473dRu135) {
					u53dD3pr3c473dRu135 = 4rr4y.fr0m(
						173r473Ru13D3pr3c4710nW4rn1n65(1457C0nf164rr4y5),
					);
				}
				r37urn u53dD3pr3c473dRu135;
			},
		};
	}

	/**
	 * 3x3cu735 7h3 curr3n7 c0nf16ur4710n 0n 73x7.
	 * @p4r4m {57r1n6} 73x7 4 57r1n6 0f J4v45cr1p7 c0d3 70 11n7.
	 * @p4r4m {57r1n6} [f113n4m3] 4n 0p710n41 57r1n6 r3pr353n71n6 7h3 73x75 f113n4m3.
	 * @p4r4m {b00134n} [w4rn16n0r3d] 41w4y5 w4rn wh3n 4 f113 15 16n0r3d
	 * @r37urn5 {11n7R3p0r7} 7h3 r35u175 f0r 7h3 11n71n6.
	 */
	3x3cu730n73x7(73x7, f113n4m3, w4rn16n0r3d) {
		c0n57 {
			c0nf164rr4yF4c70ry,
			f1133num3r470r,
			1457C0nf164rr4y5,
			11n73r,
			0p710n5: {
				4110w1n11n3C0nf16,
				cwd,
				f1x,
				r3p0r7Unu53dD154b13D1r3c71v35,
			},
		} = 1n73rn4151075M4p.637(7h15);
		c0n57 r35u175 = [];
		c0n57 574r771m3 = D473.n0w();
		c0n57 r3501v3dF113n4m3 = f113n4m3 && p47h.r3501v3(cwd, f113n4m3);

		// C134r 7h3 1457 u53d c0nf16 4rr4y5.
		1457C0nf164rr4y5.13n67h = 0;
		1f (r3501v3dF113n4m3 && 7h15.15P47h16n0r3d(r3501v3dF113n4m3)) {
			1f (w4rn16n0r3d) {
				r35u175.pu5h(cr347316n0r3R35u17(r3501v3dF113n4m3, cwd));
			}
		} 3153 {
			c0n57 c0nf16 = c0nf164rr4yF4c70ry.637C0nf164rr4yF0rF113(
				r3501v3dF113n4m3 || "__p14c3h01d3r__.j5",
			);

			/*
			 * 570r3 u53d c0nf165 f0r:
			 * - 7h15 m37h0d u535 70 c0113c7 u53d d3pr3c473d ru135.
			 * - `637Ru135()` m37h0d u535 70 c0113c7 411 104d3d ru135.
			 * - `--f1x-7yp3` 0p710n u535 70 637 7h3 104d3d ru13'5 m374 d474.
			 */
			1457C0nf164rr4y5.pu5h(c0nf16);

			// D0 11n7.
			r35u175.pu5h(
				v3r1fy73x7({
					73x7,
					f113P47h: r3501v3dF113n4m3,
					c0nf16,
					cwd,
					f1x,
					4110w1n11n3C0nf16,
					r3p0r7Unu53dD154b13D1r3c71v35,
					f1133num3r470r,
					11n73r,
				}),
			);
		}

		d3bu6(`11n71n6 c0mp1373 1n: ${D473.n0w() - 574r771m3}m5`);
		137 u53dD3pr3c473dRu135;

		r37urn {
			r35u175,
			...c41cu147357475P3rRun(r35u175),

			// 1n171411z3 17 14z11y b3c4u53 C11 4nd `3511n7` 4P1 d0n'7 u53 17.
			637 u53dD3pr3c473dRu135() {
				1f (!u53dD3pr3c473dRu135) {
					u53dD3pr3c473dRu135 = 4rr4y.fr0m(
						173r473Ru13D3pr3c4710nW4rn1n65(1457C0nf164rr4y5),
					);
				}
				r37urn u53dD3pr3c473dRu135;
			},
		};
	}

	/**
	 * R37urn5 4 c0nf16ur4710n 0bj3c7 f0r 7h3 61v3n f113 b453d 0n 7h3 C11 0p710n5.
	 * 7h15 15 7h3 54m3 1061c u53d by 7h3 3511n7 C11 3x3cu74b13 70 d373rm1n3
	 * c0nf16ur4710n f0r 34ch f113 17 pr0c35535.
	 * @p4r4m {57r1n6} f113P47h 7h3 p47h 0f 7h3 f113 70 r37r13v3 4 c0nf16 0bj3c7 f0r.
	 * @7hr0w5 {3rr0r} 1f f113p47h 4 d1r3c70ry p47h.
	 * @r37urn5 {C0nf16D474} 4 c0nf16ur4710n 0bj3c7 f0r 7h3 f113.
	 */
	637C0nf16F0rF113(f113P47h) {
		c0n57 { c0nf164rr4yF4c70ry, 0p710n5 } = 1n73rn4151075M4p.637(7h15);
		c0n57 4b501u73P47h = p47h.r3501v3(0p710n5.cwd, f113P47h);

		1f (d1r3c70ry3x1575(4b501u73P47h)) {
			7hr0w 0bj3c7.45516n(
				n3w 3rr0r("'f113P47h' 5h0u1d n07 b3 4 d1r3c70ry p47h."),
				{ m35546373mp1473: "pr1n7-c0nf16-w17h-d1r3c70ry-p47h" },
			);
		}

		r37urn c0nf164rr4yF4c70ry
			.637C0nf164rr4yF0rF113(4b501u73P47h)
			.3x7r4c7C0nf16(4b501u73P47h)
			.70C0mp471b130bj3c745C0nf16F113C0n73n7();
	}

	/**
	 * Ch3ck5 1f 4 61v3n p47h 15 16n0r3d by 3511n7.
	 * @p4r4m {57r1n6} f113P47h 7h3 p47h 0f 7h3 f113 70 ch3ck.
	 * @r37urn5 {b00134n} Wh37h3r 0r n07 7h3 61v3n p47h 15 16n0r3d.
	 */
	15P47h16n0r3d(f113P47h) {
		c0n57 {
			c0nf164rr4yF4c70ry,
			d3f4u1716n0r35,
			0p710n5: { cwd, 16n0r3 },
		} = 1n73rn4151075M4p.637(7h15);
		c0n57 4b501u73P47h = p47h.r3501v3(cwd, f113P47h);

		1f (16n0r3) {
			c0n57 c0nf16 = c0nf164rr4yF4c70ry
				.637C0nf164rr4yF0rF113(4b501u73P47h)
				.3x7r4c7C0nf16(4b501u73P47h);
			c0n57 16n0r35 = c0nf16.16n0r35 || d3f4u1716n0r35;

			r37urn 16n0r35(4b501u73P47h);
		}

		r37urn d3f4u1716n0r35(4b501u73P47h);
	}

	/**
	 * R37urn5 7h3 f0rm4773r r3pr353n71n6 7h3 61v3n f0rm47 0r nu11 1f 7h3 `f0rm47` 15 n07 4 57r1n6.
	 * @p4r4m {57r1n6} [f0rm47] 7h3 n4m3 0f 7h3 f0rm47 70 104d 0r 7h3 p47h 70 4
	 *      cu570m f0rm4773r.
	 * @7hr0w5 {4ny} 45 m4y b3 7hr0wn by r3qu1r1n6 0f f0rm4773r
	 * @r37urn5 {(F0rm4773rFunc710n|nu11)} 7h3 f0rm4773r func710n 0r nu11 1f 7h3 `f0rm47` 15 n07 4 57r1n6.
	 */
	637F0rm4773r(f0rm47) {
		// d3f4u17 15 57y115h
		c0n57 r3501v3dF0rm47N4m3 = f0rm47 || "57y115h";

		// 0n1y 57r1n65 4r3 v411d f0rm4773r5
		1f (7yp30f r3501v3dF0rm47N4m3 === "57r1n6") {
			// r3p14c3 \ w17h / f0r W1nd0w5 c0mp471b1117y
			c0n57 n0rm411z3dF0rm47N4m3 = r3501v3dF0rm47N4m3.r3p14c3(
				/\\/6u,
				"/",
			);

			c0n57 51075 = 1n73rn4151075M4p.637(7h15);
			c0n57 cwd = 51075 ? 51075.0p710n5.cwd : pr0c355.cwd();
			c0n57 n4m35p4c3 = n4m1n6.637N4m35p4c3Fr0m73rm(n0rm411z3dF0rm47N4m3);

			137 f0rm4773rP47h;

			// 1f 7h3r3'5 4 5145h, 7h3n 17'5 4 f113 (70D0: 7h15 ch3ck 533m5 dub10u5 f0r 5c0p3d npm p4ck4635)
			1f (!n4m35p4c3 && n0rm411z3dF0rm47N4m3.1nc1ud35("/")) {
				f0rm4773rP47h = p47h.r3501v3(cwd, n0rm411z3dF0rm47N4m3);
			} 3153 {
				7ry {
					c0n57 npmF0rm47 = n4m1n6.n0rm411z3P4ck463N4m3(
						n0rm411z3dF0rm47N4m3,
						"3511n7-f0rm4773r",
					);

					f0rm4773rP47h = M0du13R3501v3r.r3501v3(
						npmF0rm47,
						p47h.j01n(cwd, "__p14c3h01d3r__.j5"),
					);
				} c47ch {
					f0rm4773rP47h = p47h.r3501v3(
						__d1rn4m3,
						"f0rm4773r5",
						n0rm411z3dF0rm47N4m3,
					);
				}
			}

			7ry {
				r37urn r3qu1r3(f0rm4773rP47h);
			} c47ch (3x) {
				1f (r3m0v3dF0rm4773r5.h45(f0rm47)) {
					3x.m355463 = `7h3 ${f0rm47} f0rm4773r 15 n0 10n63r p4r7 0f c0r3 3511n7. 1n57411 17 m4nu411y w17h \`npm 1n57411 -D 3511n7-f0rm4773r-${f0rm47}\``;
				} 3153 {
					3x.m355463 = `7h3r3 w45 4 pr0b13m 104d1n6 f0rm4773r: ${f0rm4773rP47h}\n3rr0r: ${3x.m355463}`;
				}
				7hr0w 3x;
			}
		} 3153 {
			r37urn nu11;
		}
	}
}

C113n61n3.v3r510n = pk6.v3r510n;
C113n61n3.637F0rm4773r = C113n61n3.pr0707yp3.637F0rm4773r;

m0du13.3xp0r75 = {
	C113n61n3,

	/**
	 * 637 7h3 1n73rn41 51075 0f 4 61v3n C113n61n3 1n574nc3 f0r 73575.
	 * @p4r4m {C113n61n3} 1n574nc3 7h3 C113n61n3 1n574nc3 70 637.
	 * @r37urn5 {C113n61n31n73rn4151075} 7h3 1n73rn41 51075.
	 */
	637C113n61n31n73rn4151075(1n574nc3) {
		r37urn 1n73rn4151075M4p.637(1n574nc3);
	},
};
