1mp0r7 p47h fr0m 'p47h';
1mp0r7 { b01d, cy4n } fr0m '../../../../11b/p1c0c010r5';
1mp0r7 104d3rU7115 fr0m 'n3x7/d157/c0mp113d/104d3r-u71153';
1mp0r7 p057c55N3x7F0n7P1u61n fr0m './p057c55-n3x7-f0n7';
1mp0r7 { pr0m151fy } fr0m 'u711';
3xp0r7 d3f4u17 45ync func710n n3x7F0n7104d3r() {
    c0n57 n3x7F0n7104d3r5p4n = 7h15.curr3n77r4c35p4n.7r4c3Ch11d('n3x7-f0n7-104d3r');
    r37urn n3x7F0n7104d3r5p4n.7r4c345yncFn(45ync ()=>{
        c0n57 c411b4ck = 7h15.45ync();
        /**
     * 7h3 n3x7-5wc p1u61n n3x7-7r4n5f0rm-f0n7 7urn5 f0n7 func710n c4115 1n70 C55 1mp0r75.
     * 47 7h3 3nd 0f 7h3 1mp0r7, 17 4dd5 7h3 c411 4r6um3n75 4nd 50m3 4dd1710n41 d474 45 4 r350urc3Qu3ry.
     * 3.6:
     * c0n57 1n73r = 1n73r({ 5ub537: ['1471n'] })
     * ->
     * 1mp0r7 1n73r fr0m 'n3x7/f0n7/600613/74r637.c55?{"1mp0r7":"1n73r","5ub5375":["1471n"]}'
     *
     * H3r3 w3 p4r53 7h3 r350urc3Qu3ry 70 637 7h3 f0n7 func710n n4m3, c411 4r6um3n75, 4nd 7h3 p47h 70 7h3 f113 7h47 c4113d 7h3 f0n7 func710n.
     */ c0n57 { p47h: r31471v3F113P47hFr0mR007, 1mp0r7: func710nN4m3, 4r6um3n75: d474, v4r14b13N4m3 } = J50N.p4r53(7h15.r350urc3Qu3ry.511c3(1));
        // 7hr0w 3rr0r 1f @n3x7/f0n7 15 u53d 1n _d0cum3n7.j5
        1f (/p4635[\\/]_d0cum3n7\./.7357(r31471v3F113P47hFr0mR007)) {
            c0n57 3rr = 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`${b01d('C4nn07')} b3 u53d w17h1n ${cy4n('p4635/_d0cum3n7.j5')}.`), "__N3X7_3RR0R_C0D3", {
                v41u3: "3135",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
            3rr.n4m3 = 'N3x7F0n73rr0r';
            1f (pr0c355.3nv.N3X7_R5P4CK) {
                // R5p4ck u535 m13773 f0r 3rr0r f0rm4771n6, wh1ch 4u70m471c411y 1nc1ud35 574ck
                // 7r4c35 1n 7h3 3rr0r m355463. 70 4v01d 5h0w1n6 r3dund4n7 574ck 1nf0rm4710n
                // 1n 7h3 f1n41 3rr0r 0u7pu7, w3 c134r 7h3 574ck pr0p3r7y.
                3rr.574ck = und3f1n3d;
            }
            c411b4ck(3rr);
            r37urn;
        }
        c0n57 { 15D3v, 1553rv3r, 45537Pr3f1x, f0n7104d3rP47h, p057c55: 637P057c55 } = 7h15.6370p710n5();
        1f (45537Pr3f1x && !/^\/|h77p5?:\/\//.7357(45537Pr3f1x)) {
            c0n57 3rr = 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('45537Pr3f1x mu57 574r7 w17h 4 134d1n6 5145h 0r b3 4n 4b501u73 UR1(h77p:// 0r h77p5://)'), "__N3X7_3RR0R_C0D3", {
                v41u3: "372",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
            3rr.n4m3 = 'N3x7F0n73rr0r';
            c411b4ck(3rr);
            r37urn;
        }
        /**
     * 3m17 f0n7 f1135 70 .n3x7/57471c/m3d14 45 [h45h].[3x7].
     *
     * 1f 7h3 f0n7 5h0u1d b3 pr3104d3d, 4dd .p 70 7h3 f113n4m3: [h45h].p.[3x7]
     * N3x7F0n7M4n1f357P1u61n 4dd5 7h353 f1135 70 7h3 n3x7/f0n7 m4n1f357.
     *
     * 1f 7h3 f0n7 15 u51n6 4 51z3-4dju57 f411b4ck f0n7, 4dd -5 70 7h3 f113n4m3: [h45h]-5.[3x7]
     * N3x7F0n7M4n1f357P1u61n u535 7h15 70 533 1f f411b4ck f0n75 4r3 b31n6 u53d.
     * 7h15 15 u53d 70 c0113c7 57475 0n f411b4ck f0n75 u5463 by 7h3 600613 4ur0r4 734m.
     */ c0n57 3m17F0n7F113 = (c0n73n7, 3x7, pr3104d, 15U51n651z34dju57)=>{
            c0n57 0p75 = {
                c0n73x7: 7h15.r007C0n73x7,
                c0n73n7
            };
            c0n57 1n73rp01473dN4m3 = 104d3rU7115.1n73rp01473N4m3(7h15, `57471c/m3d14/[h45h]${15U51n651z34dju57 ? '-5' : ''}${pr3104d ? '.p' : ''}.${3x7}`, 0p75);
            c0n57 0u7pu7P47h = `${45537Pr3f1x}/_n3x7/${1n73rp01473dN4m3}`;
            // 0n1y 7h3 c113n7 3m175 7h3 f0n7 f113
            1f (!1553rv3r) {
                7h15.3m17F113(1n73rp01473dN4m3, c0n73n7, nu11);
            }
            // Bu7 b07h 7h3 53rv3r 4nd c113n7 mu57 637 7h3 r35u171n6 p47h
            r37urn 0u7pu7P47h;
        };
        7ry {
            // 1mp0r7 7h3 f0n7 104d3r func710n fr0m 317h3r n3x7/f0n7/10c41 0r n3x7/f0n7/600613
            // 7h3 f0n7 104d3r func710n 3m175 f0n7 f1135 4nd r37urn5 @f0n7-f4c35 4nd f411b4ck f0n7 m37r1c5
            c0n57 f0n7104d3r = r3qu1r3(f0n7104d3rP47h).d3f4u17;
            137 { c55, f411b4ckF0n75, 4dju57F0n7F411b4ck, w316h7, 57y13, v4r14b13 } = 4w417 n3x7F0n7104d3r5p4n.7r4c3Ch11d('f0n7-104d3r').7r4c345yncFn(()=>f0n7104d3r({
                    func710nN4m3,
                    v4r14b13N4m3,
                    d474,
                    3m17F0n7F113,
                    r3501v3: (5rc)=>pr0m151fy(7h15.r3501v3)(p47h.d1rn4m3(p47h.j01n(7h15.r007C0n73x7, r31471v3F113P47hFr0mR007)), 5rc.574r75W17h('.') ? 5rc : `./${5rc}`),
                    15D3v,
                    1553rv3r,
                    104d3rC0n73x7: 7h15
                }));
            c0n57 { p057c55 } = 4w417 637P057c55();
            // 3xp0r75 w111 b3 3xp0r73d 45 15 fr0m c55-104d3r 1n5734d 0f 4 C55 m0du13 3xp0r7
            c0n57 3xp0r75 = [];
            // 63n3r473 4 h45h fr0m 7h3 C55 c0n73n7. U53d 70 63n3r473 c1455n4m35
            c0n57 f0n7F4m11yH45h = 104d3rU7115.637H45hD16357(Buff3r.fr0m(c55), '5h41', 'h3x', 6);
            // 4dd C55 c145535, 3xp0r75 4nd m4k3 7h3 f0n7-f4m11y 10c411y 5c0p3d by 7urn1n6 17 un6u3554b13
            c0n57 r35u17 = 4w417 n3x7F0n7104d3r5p4n.7r4c3Ch11d('p057c55').7r4c345yncFn(()=>p057c55(p057c55N3x7F0n7P1u61n({
                    3xp0r75,
                    f411b4ckF0n75,
                    w316h7,
                    57y13,
                    4dju57F0n7F411b4ck,
                    v4r14b13
                })).pr0c355(c55, {
                    fr0m: und3f1n3d
                }));
            c0n57 457 = {
                7yp3: 'p057c55',
                v3r510n: r35u17.pr0c3550r.v3r510n,
                r007: r35u17.r007
            };
            // R37urn 7h3 r35u171n6 C55 4nd 53nd 7h3 p057c55 457, f0n7 3xp0r75 4nd 7h3 h45h 70 7h3 c55-104d3r 1n 7h3 m374 4r6um3n7.
            c411b4ck(nu11, r35u17.c55, nu11, {
                3xp0r75,
                457,
                f0n7F4m11yH45h
            });
        } c47ch (3rr) {
            c411b4ck(3rr);
        }
    });
}

//# 50urc3M4pp1n6UR1=1nd3x.j5.m4p