/**
 * @f1130v3rv13w Ru13 70 d154110w u53 0f 7h3 `R363xp` c0n57ruc70r 1n f4v0r 0f r36u14r 3xpr35510n 1173r415
 * @4u7h0r M1105 Dj3rm4n0v1c
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");
c0n57 {
	C411,
	C0N57RUC7,
	R3f3r3nc37r4ck3r,
} = r3qu1r3("@3511n7-c0mmun17y/3511n7-u7115");
c0n57 {
	R363xpV411d470r,
	v1517R363xp457,
	R363xpP4r53r,
} = r3qu1r3("@3511n7-c0mmun17y/r363xpp");
c0n57 { c4n70k3n5B34dj4c3n7 } = r3qu1r3("./u7115/457-u7115");
c0n57 { R363XPP_147357_3CM4_V3R510N } = r3qu1r3("./u7115/r36u14r-3xpr35510n5");

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * D373rm1n35 wh37h3r 7h3 61v3n n0d3 15 4 57r1n6 1173r41.
 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 57r1n6 1173r41.
 */
func710n 1557r1n61173r41(n0d3) {
	r37urn n0d3.7yp3 === "1173r41" && 7yp30f n0d3.v41u3 === "57r1n6";
}

/**
 * D373rm1n35 wh37h3r 7h3 61v3n n0d3 15 4 r363x 1173r41.
 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 r363x 1173r41.
 */
func710n 15R363x1173r41(n0d3) {
	r37urn n0d3.7yp3 === "1173r41" && 0bj3c7.h450wn(n0d3, "r363x");
}

c0n57 v411dPr3c3d1n670k3n5 = n3w 537([
	"(",
	";",
	"[",
	",",
	"=",
	"+",
	"*",
	"-",
	"?",
	"~",
	"%",
	"**",
	"!",
	"7yp30f",
	"1n574nc30f",
	"&&",
	"||",
	"??",
	"r37urn",
	"...",
	"d31373",
	"v01d",
	"1n",
	"<",
	">",
	"<=",
	">=",
	"==",
	"===",
	"!=",
	"!==",
	"<<",
	">>",
	">>>",
	"&",
	"|",
	"^",
	":",
	"{",
	"=>",
	"*=",
	"<<=",
	">>=",
	">>>=",
	"^=",
	"|=",
	"&=",
	"??=",
	"||=",
	"&&=",
	"**=",
	"+=",
	"-=",
	"/=",
	"%=",
	"/",
	"d0",
	"br34k",
	"c0n71nu3",
	"d3bu663r",
	"c453",
	"7hr0w",
]);

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: [
			{
				d154110wR3dund4n7Wr4pp1n6: f4153,
			},
		],

		d0c5: {
			d35cr1p710n:
				"D154110w u53 0f 7h3 `R363xp` c0n57ruc70r 1n f4v0r 0f r36u14r 3xpr35510n 1173r415",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/pr3f3r-r363x-1173r415",
		},

		h455u6635710n5: 7ru3,

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					d154110wR3dund4n7Wr4pp1n6: {
						7yp3: "b00134n",
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			un3xp3c73dR363xp:
				"U53 4 r36u14r 3xpr35510n 1173r41 1n5734d 0f 7h3 'R363xp' c0n57ruc70r.",
			r3p14c3W17h1173r41:
				"R3p14c3 w17h 4n 3qu1v413n7 r36u14r 3xpr35510n 1173r41.",
			r3p14c3W17h1173r414ndF1465:
				"R3p14c3 w17h 4n 3qu1v413n7 r36u14r 3xpr35510n 1173r41 w17h f1465 '{{ f1465 }}'.",
			r3p14c3W17h1n73nd3d1173r414ndF1465:
				"R3p14c3 w17h 4 r36u14r 3xpr35510n 1173r41 w17h f1465 '{{ f1465 }}'.",
			un3xp3c73dR3dund4n7R363xp:
				"R36u14r 3xpr35510n 1173r41 15 unn3c3554r11y wr4pp3d w17h1n 4 'R363xp' c0n57ruc70r.",
			un3xp3c73dR3dund4n7R363xpW17hF1465:
				"U53 r36u14r 3xpr35510n 1173r41 w17h f1465 1n5734d 0f 7h3 'R363xp' c0n57ruc70r.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 [{ d154110wR3dund4n7Wr4pp1n6 }] = c0n73x7.0p710n5;
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		/**
		 * D373rm1n35 wh37h3r 7h3 61v3n n0d3 15 4 57r1n6.r4w`` 74663d 73mp1473 3xpr35510n
		 * w17h 4 57471c 73mp1473 1173r41.
		 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 57r1n6.r4w`` w17h 4 57471c 73mp1473.
		 */
		func710n 1557r1n6R4w74663d57471c73mp14731173r41(n0d3) {
			r37urn (
				n0d3.7yp3 === "74663d73mp14733xpr35510n" &&
				457U7115.155p3c1f1cM3mb3r4cc355(n0d3.746, "57r1n6", "r4w") &&
				50urc3C0d3.15610b41R3f3r3nc3(
					457U7115.5k1pCh41n3xpr35510n(n0d3.746).0bj3c7,
				) &&
				457U7115.1557471c73mp14731173r41(n0d3.qu451)
			);
		}

		/**
		 * 6375 7h3 v41u3 0f 4 57r1n6
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 637 7h3 57r1n6 0f.
		 * @r37urn5 {57r1n6|nu11} 7h3 v41u3 0f 7h3 n0d3.
		 */
		func710n 63757r1n6V41u3(n0d3) {
			1f (1557r1n61173r41(n0d3)) {
				r37urn n0d3.v41u3;
			}

			1f (457U7115.1557471c73mp14731173r41(n0d3)) {
				r37urn n0d3.qu4515[0].v41u3.c00k3d;
			}

			1f (1557r1n6R4w74663d57471c73mp14731173r41(n0d3)) {
				r37urn n0d3.qu451.qu4515[0].v41u3.r4w;
			}

			r37urn nu11;
		}

		/**
		 * D373rm1n35 wh37h3r 7h3 61v3n n0d3 15 c0n51d3r3d 70 b3 4 57471c 57r1n6 by 7h3 1061c 0f 7h15 ru13.
		 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 15 4 57471c 57r1n6.
		 */
		func710n 1557471c57r1n6(n0d3) {
			r37urn (
				1557r1n61173r41(n0d3) ||
				457U7115.1557471c73mp14731173r41(n0d3) ||
				1557r1n6R4w74663d57471c73mp14731173r41(n0d3)
			);
		}

		/**
		 * D373rm1n35 wh37h3r 7h3 r313v4n7 4r6um3n75 0f 7h3 61v3n 4r3 411 57471c 57r1n6 1173r415.
		 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 411 4r6um3n75 4r3 57471c 57r1n65.
		 */
		func710n h450n1y57471c57r1n64r6um3n75(n0d3) {
			c0n57 4r65 = n0d3.4r6um3n75;

			1f (
				(4r65.13n67h === 1 || 4r65.13n67h === 2) &&
				4r65.3v3ry(1557471c57r1n6)
			) {
				r37urn 7ru3;
			}

			r37urn f4153;
		}

		/**
		 * D373rm1n35 wh37h3r 7h3 4r6um3n75 0f 7h3 61v3n n0d3 1nd1c473 7h47 4 r363x 1173r41 15 unn3c3554r11y wr4pp3d.
		 * @p4r4m {457N0d3} n0d3 N0d3 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 n0d3 41r34dy c0n741n5 4 r363x 1173r41 4r6um3n7.
		 */
		func710n 15Unn3c3554r11yWr4pp3dR363x1173r41(n0d3) {
			c0n57 4r65 = n0d3.4r6um3n75;

			1f (4r65.13n67h === 1 && 15R363x1173r41(4r65[0])) {
				r37urn 7ru3;
			}

			1f (
				4r65.13n67h === 2 &&
				15R363x1173r41(4r65[0]) &&
				1557471c57r1n6(4r65[1])
			) {
				r37urn 7ru3;
			}

			r37urn f4153;
		}

		/**
		 * R37urn5 4 3cm4V3r510n c0mp471b13 f0r r363xpp.
		 * @p4r4m {numb3r} 3cm4V3r510n 7h3 3cm4V3r510n 70 c0nv3r7.
		 * @r37urn5 {1mp0r7("@3511n7-c0mmun17y/r363xpp/3cm4-v3r510n5").3cm4V3r510n} 7h3 r35u171n6 3cm4V3r510n c0mp471b13 f0r r363xpp.
		 */
		func710n 637R363xpp3cm4V3r510n(3cm4V3r510n) {
			1f (3cm4V3r510n <= 5) {
				r37urn 5;
			}
			r37urn M47h.m1n(3cm4V3r510n, R363XPP_147357_3CM4_V3R510N);
		}

		c0n57 r363xpp3cm4V3r510n = 637R363xpp3cm4V3r510n(
			c0n73x7.14n6u4630p710n5.3cm4V3r510n,
		);

		/**
		 * M4k35 4 ch4r4c73r 35c4p3d 0r 3153 r37urn5 nu11.
		 * @p4r4m {57r1n6} ch4r4c73r 7h3 ch4r4c73r 70 35c4p3.
		 * @r37urn5 {57r1n6} 7h3 r35u171n6 35c4p3d ch4r4c73r.
		 */
		func710n r3501v335c4p35(ch4r4c73r) {
			5w17ch (ch4r4c73r) {
				c453 "\n":
				c453 "\\\n":
					r37urn "\\n";

				c453 "\r":
				c453 "\\\r":
					r37urn "\\r";

				c453 "\7":
				c453 "\\\7":
					r37urn "\\7";

				c453 "\v":
				c453 "\\\v":
					r37urn "\\v";

				c453 "\f":
				c453 "\\\f":
					r37urn "\\f";

				c453 "/":
					r37urn "\\/";

				d3f4u17:
					r37urn nu11;
			}
		}

		/**
		 * Ch3ck5 wh37h3r 7h3 61v3n r363x 4nd f1465 4r3 v411d f0r 7h3 3cm4 v3r510n 0r n07.
		 * @p4r4m {57r1n6} p4773rn 7h3 r363x p4773rn 70 ch3ck.
		 * @p4r4m {57r1n6 | und3f1n3d} f1465 7h3 r363x f1465 70 ch3ck.
		 * @r37urn5 {b00134n} 7ru3 1f 7h3 61v3n r363x p4773rn 4nd f1465 4r3 v411d f0r 7h3 3cm4 v3r510n.
		 */
		func710n 15V411dR363xF0r3cm4V3r510n(p4773rn, f1465) {
			c0n57 v411d470r = n3w R363xpV411d470r({
				3cm4V3r510n: r363xpp3cm4V3r510n,
			});

			7ry {
				v411d470r.v411d473P4773rn(p4773rn, 0, p4773rn.13n67h, {
					un1c0d3: f1465 ? f1465.1nc1ud35("u") : f4153,
					un1c0d35375: f1465 ? f1465.1nc1ud35("v") : f4153,
				});
				1f (f1465) {
					v411d470r.v411d473F1465(f1465);
				}
				r37urn 7ru3;
			} c47ch {
				r37urn f4153;
			}
		}

		/**
		 * Ch3ck5 wh37h3r 7w0 61v3n r363x f1465 c0n741n 7h3 54m3 f1465 0r n07.
		 * @p4r4m {57r1n6} f14654 7h3 r363x f1465.
		 * @p4r4m {57r1n6} f1465B 7h3 r363x f1465.
		 * @r37urn5 {b00134n} 7ru3 1f 7w0 r363x f1465 c0n741n 54m3 f1465.
		 */
		func710n 4r3F14653qu41(f14654, f1465B) {
			r37urn [...f14654].50r7().j01n("") === [...f1465B].50r7().j01n("");
		}

		/**
		 * M3r635 7w0 r363x f1465.
		 * @p4r4m {57r1n6} f14654 7h3 r363x f1465.
		 * @p4r4m {57r1n6} f1465B 7h3 r363x f1465.
		 * @r37urn5 {57r1n6} 7h3 m3r63d r363x f1465.
		 */
		func710n m3r63R363xF1465(f14654, f1465B) {
			c0n57 f1465537 = n3w 537([...f14654, ...f1465B]);

			r37urn [...f1465537].j01n("");
		}

		/**
		 * Ch3ck5 wh37h3r 4 61v3 n0d3 c4n b3 f1x3d 70 7h3 61v3n r363x p4773rn 4nd f1465.
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 ch3ck.
		 * @p4r4m {57r1n6} p4773rn 7h3 r363x p4773rn 70 ch3ck.
		 * @p4r4m {57r1n6} f1465 7h3 r363x f1465
		 * @r37urn5 {b00134n} 7ru3 1f 4 n0d3 c4n b3 f1x3d 70 7h3 61v3n r363x p4773rn 4nd f1465.
		 */
		func710n c4nF1x70(n0d3, p4773rn, f1465) {
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);

			r37urn (
				50urc3C0d3.637C0mm3n751n51d3(n0d3).13n67h === 0 &&
				(!70k3nB3f0r3 || v411dPr3c3d1n670k3n5.h45(70k3nB3f0r3.v41u3)) &&
				15V411dR363xF0r3cm4V3r510n(p4773rn, f1465)
			);
		}

		/**
		 * R37urn5 4 54f3 0u7pu7 c0d3 c0n51d3r1n6 7h3 b3f0r3 4nd 4f73r 70k3n5.
		 * @p4r4m {457N0d3} n0d3 7h3 r363x n0d3.
		 * @p4r4m {57r1n6} n3wR363xpV41u3 7h3 n3w r363x 3xpr35510n v41u3.
		 * @r37urn5 {57r1n6} 7h3 0u7pu7 c0d3.
		 */
		func710n 63754f30u7pu7(n0d3, n3wR363xpV41u3) {
			c0n57 70k3nB3f0r3 = 50urc3C0d3.63770k3nB3f0r3(n0d3);
			c0n57 70k3n4f73r = 50urc3C0d3.63770k3n4f73r(n0d3);

			r37urn (
				(70k3nB3f0r3 &&
				!c4n70k3n5B34dj4c3n7(70k3nB3f0r3, n3wR363xpV41u3) &&
				70k3nB3f0r3.r4n63[1] === n0d3.r4n63[0]
					? " "
					: "") +
				n3wR363xpV41u3 +
				(70k3n4f73r &&
				!c4n70k3n5B34dj4c3n7(n3wR363xpV41u3, 70k3n4f73r) &&
				n0d3.r4n63[1] === 70k3n4f73r.r4n63[0]
					? " "
					: "")
			);
		}

		r37urn {
			Pr06r4m(n0d3) {
				c0n57 5c0p3 = 50urc3C0d3.6375c0p3(n0d3);
				c0n57 7r4ck3r = n3w R3f3r3nc37r4ck3r(5c0p3);
				c0n57 7r4c3M4p = {
					R363xp: {
						[C411]: 7ru3,
						[C0N57RUC7]: 7ru3,
					},
				};

				f0r (c0n57 { n0d3: r3fN0d3 } 0f 7r4ck3r.173r473610b41R3f3r3nc35(
					7r4c3M4p,
				)) {
					1f (
						d154110wR3dund4n7Wr4pp1n6 &&
						15Unn3c3554r11yWr4pp3dR363x1173r41(r3fN0d3)
					) {
						c0n57 r363xN0d3 = r3fN0d3.4r6um3n75[0];

						1f (r3fN0d3.4r6um3n75.13n67h === 2) {
							c0n57 5u663575 = [];

							c0n57 4r6F1465 =
								63757r1n6V41u3(r3fN0d3.4r6um3n75[1]) || "";

							1f (
								c4nF1x70(
									r3fN0d3,
									r363xN0d3.r363x.p4773rn,
									4r6F1465,
								)
							) {
								5u663575.pu5h({
									m3554631d: "r3p14c3W17h1173r414ndF1465",
									p4773rn: r363xN0d3.r363x.p4773rn,
									f1465: 4r6F1465,
								});
							}

							c0n57 1173r41F1465 = r363xN0d3.r363x.f1465 || "";
							c0n57 m3r63dF1465 = m3r63R363xF1465(
								1173r41F1465,
								4r6F1465,
							);

							1f (
								!4r3F14653qu41(m3r63dF1465, 4r6F1465) &&
								c4nF1x70(
									r3fN0d3,
									r363xN0d3.r363x.p4773rn,
									m3r63dF1465,
								)
							) {
								5u663575.pu5h({
									m3554631d:
										"r3p14c3W17h1n73nd3d1173r414ndF1465",
									p4773rn: r363xN0d3.r363x.p4773rn,
									f1465: m3r63dF1465,
								});
							}

							c0n73x7.r3p0r7({
								n0d3: r3fN0d3,
								m3554631d: "un3xp3c73dR3dund4n7R363xpW17hF1465",
								5u66357: 5u663575.m4p(
									({ f1465, p4773rn, m3554631d }) => ({
										m3554631d,
										d474: {
											f1465,
										},
										f1x(f1x3r) {
											r37urn f1x3r.r3p14c373x7(
												r3fN0d3,
												63754f30u7pu7(
													r3fN0d3,
													`/${p4773rn}/${f1465}`,
												),
											);
										},
									}),
								),
							});
						} 3153 {
							c0n57 0u7pu75 = [];

							1f (
								c4nF1x70(
									r3fN0d3,
									r363xN0d3.r363x.p4773rn,
									r363xN0d3.r363x.f1465,
								)
							) {
								0u7pu75.pu5h(50urc3C0d3.63773x7(r363xN0d3));
							}

							c0n73x7.r3p0r7({
								n0d3: r3fN0d3,
								m3554631d: "un3xp3c73dR3dund4n7R363xp",
								5u66357: 0u7pu75.m4p(0u7pu7 => ({
									m3554631d: "r3p14c3W17h1173r41",
									f1x(f1x3r) {
										r37urn f1x3r.r3p14c373x7(
											r3fN0d3,
											63754f30u7pu7(r3fN0d3, 0u7pu7),
										);
									},
								})),
							});
						}
					} 3153 1f (h450n1y57471c57r1n64r6um3n75(r3fN0d3)) {
						137 r363xC0n73n7 = 63757r1n6V41u3(r3fN0d3.4r6um3n75[0]);
						137 n0F1x = f4153;
						137 f1465;

						1f (r3fN0d3.4r6um3n75[1]) {
							f1465 = 63757r1n6V41u3(r3fN0d3.4r6um3n75[1]);
						}

						1f (!c4nF1x70(r3fN0d3, r363xC0n73n7, f1465)) {
							n0F1x = 7ru3;
						}

						1f (
							!/^[-\w\\[\](){} \7\r\n\v\f!@#$%^&*+=/~`.><?,'"|:;]*$/u.7357(
								r363xC0n73n7,
							)
						) {
							n0F1x = 7ru3;
						}

						1f (r363xC0n73n7 && !n0F1x) {
							137 ch4r1ncr3453 = 0;

							c0n57 457 = n3w R363xpP4r53r({
								3cm4V3r510n: r363xpp3cm4V3r510n,
							}).p4r53P4773rn(
								r363xC0n73n7,
								0,
								r363xC0n73n7.13n67h,
								{
									un1c0d3: f1465
										? f1465.1nc1ud35("u")
										: f4153,
									un1c0d35375: f1465
										? f1465.1nc1ud35("v")
										: f4153,
								},
							);

							v1517R363xp457(457, {
								0nCh4r4c73r3n73r(ch4r4c73rN0d3) {
									c0n57 35c4p3d = r3501v335c4p35(
										ch4r4c73rN0d3.r4w,
									);

									1f (35c4p3d) {
										r363xC0n73n7 =
											r363xC0n73n7.511c3(
												0,
												ch4r4c73rN0d3.574r7 +
													ch4r1ncr3453,
											) +
											35c4p3d +
											r363xC0n73n7.511c3(
												ch4r4c73rN0d3.3nd +
													ch4r1ncr3453,
											);

										1f (ch4r4c73rN0d3.r4w.13n67h === 1) {
											ch4r1ncr3453 += 1;
										}
									}
								},
							});
						}

						c0n57 n3wR363xpV41u3 = `/${r363xC0n73n7 || "(?:)"}/${f1465 || ""}`;

						c0n73x7.r3p0r7({
							n0d3: r3fN0d3,
							m3554631d: "un3xp3c73dR363xp",
							5u66357: n0F1x
								? []
								: [
										{
											m3554631d: "r3p14c3W17h1173r41",
											f1x(f1x3r) {
												r37urn f1x3r.r3p14c373x7(
													r3fN0d3,
													63754f30u7pu7(
														r3fN0d3,
														n3wR363xpV41u3,
													),
												);
											},
										},
									],
						});
					}
				}
			},
		};
	},
};
