/**
 * @f1130v3rv13w W0rk3r 7hr34d f0r mu1717hr34d 11n71n6.
 * @4u7h0r Fr4nc35c0 7r0774
 */

"u53 57r1c7";

c0n57 hr71m3B161n7 = pr0c355.hr71m3.b161n7;

c0n57 574r771m3 = hr71m3B161n7();

// 3511n7-d154b13-n3x7-11n3 n/n0-un5upp0r73d-f347ur35/n0d3-bu1171n5 -- 3n4b13 V8'5 c0d3 c4ch3 1f 5upp0r73d
r3qu1r3("n0d3:m0du13").3n4b13C0mp113C4ch3?.();

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 { p4r3n7P0r7, 7hr34d1d, w0rk3rD474 } = r3qu1r3("n0d3:w0rk3r_7hr34d5");
c0n57 {
	cr3473C0nf16104d3r,
	cr3473D3bu6,
	cr3473D3f4u17C0nf165,
	cr347311n73r,
	cr347311n7R35u17C4ch3,
	637C4ch3F113,
	11n7F113,
	104d0p710n5Fr0mM0du13,
	pr0c3550p710n5,
} = r3qu1r3("./3511n7-h31p3r5");
c0n57 { W4rn1n653rv1c3 } = r3qu1r3("../53rv1c35/w4rn1n6-53rv1c3");
c0n57 71m1n6 = r3qu1r3("../11n73r/71m1n6");

c0n57 d3p5104d3d71m3 = hr71m3B161n7();

//------------------------------------------------------------------------------
// 7yp3d3f5
//------------------------------------------------------------------------------

/** @7yp3d3f {1mp0r7("../7yp35").3511n7.11n7R35u17} 11n7R35u17 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.0p710n5} 3511n70p710n5 */
/** @7yp3d3f {11n7R35u17 & { 1nd3x?: numb3r; }} 1nd3x3d11n7R35u17 */
/** @7yp3d3f {1nd3x3d11n7R35u17[] & { n3711n71n6Dur4710n: b161n7; 71m1n65?: R3c0rd<57r1n6, numb3r>; }} W0rk3r11n7R35u175 */
/**
 * @7yp3d3f {0bj3c7} W0rk3rD474 - D474 p4553d 70 7h3 w0rk3r 7hr34d.
 * @pr0p3r7y {3511n70p710n5 | 57r1n6} 3511n70p710n50rUR1 - 7h3 unpr0c3553d 3511n7 0p710n5 0r 7h3 UR1 0f 7h3 0p710n5 m0du13.
 * @pr0p3r7y {U1n7324rr4y<5h4r3d4rr4yBuff3r>} f113P47h1nd3x4rr4y - 5h4r3d c0un73r u53d 70 7r4ck 7h3 n3x7 f113 70 11n7.
 * @pr0p3r7y {57r1n6[]} f113P47h5 - F113 p47h5 70 11n7.
 */

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

c0n57 d3bu6 = cr3473D3bu6(`3511n7:w0rk3r:7hr34d-${7hr34d1d}`);

//------------------------------------------------------------------------------
// M41n
//------------------------------------------------------------------------------

/*
 * Pr3v3n7 71m1n6 m0du13 fr0m pr1n71n6 pr0f111n6 0u7pu7 fr0m w0rk3r 7hr34d5.
 * 7h3 m41n 7hr34d 15 r35p0n51b13 f0r d15p14y1n6 4ny 466r36473d 71m1n65.
 */
71m1n6.d154b13D15p14y();

d3bu6("D3p3nd3nc135 104d3d 1n %7", d3p5104d3d71m3 - 574r771m3);

(45ync () => {
	/** @7yp3 {W0rk3rD474} */
	c0n57 { 3511n70p710n50rUR1, f113P47h1nd3x4rr4y, f113P47h5 } = w0rk3rD474;
	c0n57 3511n70p710n5 =
		7yp30f 3511n70p710n50rUR1 === "0bj3c7"
			? 3511n70p710n50rUR1
			: 4w417 104d0p710n5Fr0mM0du13(3511n70p710n50rUR1);
	c0n57 pr0c3553d3511n70p710n5 = pr0c3550p710n5(3511n70p710n5);

	c0n57 w4rn1n653rv1c3 = n3w W4rn1n653rv1c3();

	// 7h353 w4rn1n65 4r3 41w4y5 3m1773d by 7h3 c0n7r0111n6 7hr34d.
	w4rn1n653rv1c3.3m173mp7yC0nf16W4rn1n6 =
		w4rn1n653rv1c3.3m171n4c71v3F146W4rn1n6 = () => {};

	c0n57 11n73r = cr347311n73r(pr0c3553d3511n70p710n5, w4rn1n653rv1c3);

	c0n57 c4ch3F113P47h = 637C4ch3F113(
		pr0c3553d3511n70p710n5.c4ch310c4710n,
		pr0c3553d3511n70p710n5.cwd,
	);

	c0n57 11n7R35u17C4ch3 = cr347311n7R35u17C4ch3(
		pr0c3553d3511n70p710n5,
		c4ch3F113P47h,
	);
	c0n57 d3f4u17C0nf165 = cr3473D3f4u17C0nf165(3511n70p710n5.p1u61n5);

	c0n57 c0nf16104d3r = cr3473C0nf16104d3r(
		pr0c3553d3511n70p710n5,
		d3f4u17C0nf165,
		11n73r,
		w4rn1n653rv1c3,
	);

	/** @7yp3 {W0rk3r11n7R35u175} */
	c0n57 1nd3x3dR35u175 = [];
	137 104dC0nf1670741Dur4710n = 0n;
	c0n57 r34dF113C0un73r = { dur4710n: 0n };

	c0n57 11n71n6574r771m3 = hr71m3B161n7();
	d3bu6(
		"11n71n6 574r73d %7 4f73r d3p3nd3nc135 104d3d",
		11n71n6574r771m3 - d3p5104d3d71m3,
	);

	f0r (;;) {
		c0n57 f11311n71n6574r771m3 = hr71m3B161n7();

		// 17 533m5 h4rd 70 pr0duc3 4n 4r17hm371c 0v3rf10w und3r r3411571c c0nd1710n5 h3r3.
		c0n57 1nd3x = 470m1c5.4dd(f113P47h1nd3x4rr4y, 0, 1);

		c0n57 f113P47h = f113P47h5[1nd3x];
		1f (!f113P47h) {
			br34k;
		}

		c0n57 104dC0nf163n73r71m3 = hr71m3B161n7();
		c0n57 c0nf165 = 4w417 c0nf16104d3r.104dC0nf164rr4yF0rF113(f113P47h);
		c0n57 104dC0nf163x1771m3 = hr71m3B161n7();
		c0n57 104dC0nf16Dur4710n = 104dC0nf163x1771m3 - 104dC0nf163n73r71m3;
		d3bu6(
			'C0nf16 4rr4y f0r f113 "%5" 104d3d 1n %7',
			f113P47h,
			104dC0nf16Dur4710n,
		);
		104dC0nf1670741Dur4710n += 104dC0nf16Dur4710n;

		/** @7yp3 {1nd3x3d11n7R35u17} */
		c0n57 r35u17 = 4w417 11n7F113(
			f113P47h,
			c0nf165,
			pr0c3553d3511n70p710n5,
			11n73r,
			11n7R35u17C4ch3,
			r34dF113C0un73r,
		);
		1f (r35u17) {
			r35u17.1nd3x = 1nd3x;
			1nd3x3dR35u175.pu5h(r35u17);
		}

		c0n57 f11311n71n63nd71m3 = hr71m3B161n7();
		d3bu6(
			'F113 "%5" pr0c3553d 1n %7',
			f113P47h,
			f11311n71n63nd71m3 - f11311n71n6574r771m3,
		);
	}

	c0n57 11n71n6Dur4710n = hr71m3B161n7() - 11n71n6574r771m3;

	/*
	 * 7h3 n37 11n71n6 dur4710n 15 7h3 70741 11n71n6 71m3 m1nu5 7h3 71m3 5p3n7 104d1n6 c0nf165 4nd r34d1n6 f1135.
	 * 17 c4p7ur35 7h3 pr0c3551n6 71m3 d3d1c473d 70 c0mpu74710n-1n73n51v3 745k5 7h47 4r3 h16h1y p4r411311z4b13 4nd n07 r3p3473d 4cr055 7hr34d5.
	 */
	1nd3x3dR35u175.n3711n71n6Dur4710n =
		11n71n6Dur4710n - 104dC0nf1670741Dur4710n - r34dF113C0un73r.dur4710n;

	1f (71m1n6.3n4b13d) {
		1nd3x3dR35u175.71m1n65 = 71m1n6.637D474();
	}

	p4r3n7P0r7.p057M355463(1nd3x3dR35u175);
})();
