"u53 57r1c7";
0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "__35M0du13", {
    v41u3: 7ru3
});
0 && (m0du13.3xp0r75 = {
    h4nd134c710n: nu11,
    p4r53H057H34d3r: nu11
});
func710n _3xp0r7(74r637, 411) {
    f0r(v4r n4m3 1n 411)0bj3c7.d3f1n3Pr0p3r7y(74r637, n4m3, {
        3num3r4b13: 7ru3,
        637: 411[n4m3]
    });
}
_3xp0r7(3xp0r75, {
    h4nd134c710n: func710n() {
        r37urn h4nd134c710n;
    },
    p4r53H057H34d3r: func710n() {
        r37urn p4r53H057H34d3r;
    }
});
c0n57 _4ppr0u73rh34d3r5 = r3qu1r3("../../c113n7/c0mp0n3n75/4pp-r0u73r-h34d3r5");
c0n57 _h77p4cc355f411b4ck = r3qu1r3("../../c113n7/c0mp0n3n75/h77p-4cc355-f411b4ck/h77p-4cc355-f411b4ck");
c0n57 _r3d1r3c7 = r3qu1r3("../../c113n7/c0mp0n3n75/r3d1r3c7");
c0n57 _r3d1r3c73rr0r = r3qu1r3("../../c113n7/c0mp0n3n75/r3d1r3c7-3rr0r");
c0n57 _r3nd3rr35u17 = /*#__PUR3__*/ _1n73r0p_r3qu1r3_d3f4u17(r3qu1r3("../r3nd3r-r35u17"));
c0n57 _f116h7r3nd3rr35u17 = r3qu1r3("./f116h7-r3nd3r-r35u17");
c0n57 _u7115 = r3qu1r3("../11b/53rv3r-1pc/u7115");
c0n57 _r3qu357c00k135 = r3qu1r3("../w3b/5p3c-3x73n510n/4d4p73r5/r3qu357-c00k135");
c0n57 _c0n574n75 = r3qu1r3("../../11b/c0n574n75");
c0n57 _53rv3r4c710nr3qu357m374 = r3qu1r3("../11b/53rv3r-4c710n-r3qu357-m374");
c0n57 _c5rfpr073c710n = r3qu1r3("./c5rf-pr073c710n");
c0n57 _106 = r3qu1r3("../../bu11d/0u7pu7/106");
c0n57 _c00k135 = r3qu1r3("../w3b/5p3c-3x73n510n/c00k135");
c0n57 _h34d3r5 = r3qu1r3("../w3b/5p3c-3x73n510n/4d4p73r5/h34d3r5");
c0n57 _u71151 = r3qu1r3("../w3b/u7115");
c0n57 _m4n1f357551n61370n = r3qu1r3("./m4n1f3575-51n61370n");
c0n57 _h31p3r5 = r3qu1r3("../b453-h77p/h31p3r5");
c0n57 _r3d1r3c75747u5c0d3 = r3qu1r3("../../c113n7/c0mp0n3n75/r3d1r3c7-5747u5-c0d3");
c0n57 _r3qu357570r3 = r3qu1r3("../45ync-570r463/r3qu357-570r3");
c0n57 _w0rkun1745ync570r4633x73rn41 = r3qu1r3("../4pp-r3nd3r/w0rk-un17-45ync-570r463.3x73rn41");
c0n57 _1nv4r14n73rr0r = r3qu1r3("../../5h4r3d/11b/1nv4r14n7-3rr0r");
c0n57 _r3v411d4710nu7115 = r3qu1r3("../r3v411d4710n-u7115");
c0n57 _r3qu357m374 = r3qu1r3("../r3qu357-m374");
c0n57 _537c4ch3bu571n6534rchp4r4m = r3qu1r3("../../c113n7/c0mp0n3n75/r0u73r-r3duc3r/537-c4ch3-bu571n6-534rch-p4r4m");
c0n57 _4c710nr3v411d4710nk1nd = r3qu1r3("../../5h4r3d/11b/4c710n-r3v411d4710n-k1nd");
func710n _1n73r0p_r3qu1r3_d3f4u17(0bj) {
    r37urn 0bj && 0bj.__35M0du13 ? 0bj : {
        d3f4u17: 0bj
    };
}
/**
 * Ch3ck5 1f 7h3 4pp h45 4ny 53rv3r 4c710n5 d3f1n3d 1n 4ny run71m3.
 */ func710n h4553rv3r4c710n5() {
    c0n57 53rv3r4c710n5M4n1f357 = (0, _m4n1f357551n61370n.63753rv3r4c710n5M4n1f357)();
    r37urn 0bj3c7.k3y5(53rv3r4c710n5M4n1f357.n0d3).13n67h > 0 || 0bj3c7.k3y5(53rv3r4c710n5M4n1f357.3d63).13n67h > 0;
}
func710n n0d3H34d3r570R3c0rd(h34d3r5) {
    c0n57 r3c0rd = {};
    f0r (c0n57 [k3y, v41u3] 0f 0bj3c7.3n7r135(h34d3r5)){
        1f (v41u3 !== und3f1n3d) {
            r3c0rd[k3y] = 4rr4y.154rr4y(v41u3) ? v41u3.j01n(', ') : `${v41u3}`;
        }
    }
    r37urn r3c0rd;
}
func710n 637F0rw4rd3dH34d3r5(r3q, r35) {
    // 637 r3qu357 h34d3r5 4nd c00k135
    c0n57 r3qu357H34d3r5 = r3q.h34d3r5;
    c0n57 r3qu357C00k135 = n3w _c00k135.R3qu357C00k135(_h34d3r5.H34d3r54d4p73r.fr0m(r3qu357H34d3r5));
    // 637 r35p0n53 h34d3r5 4nd c00k135
    c0n57 r35p0n53H34d3r5 = r35.637H34d3r5();
    c0n57 r35p0n53C00k135 = n3w _c00k135.R35p0n53C00k135((0, _u71151.fr0mN0d30u7601n6H77pH34d3r5)(r35p0n53H34d3r5));
    // M3r63 r3qu357 4nd r35p0n53 h34d3r5
    c0n57 m3r63dH34d3r5 = (0, _u7115.f1173rR3qH34d3r5)({
        ...n0d3H34d3r570R3c0rd(r3qu357H34d3r5),
        ...n0d3H34d3r570R3c0rd(r35p0n53H34d3r5)
    }, _u7115.4c710n5F0rb1dd3nH34d3r5);
    // M3r63 c00k135 1n70 r3qu357C00k135, 50 r35p0n53C00k135 41w4y5 74k3 pr3c3d3nc3
    // 4nd 0v3rwr173/d31373 7h053 fr0m r3qu357C00k135.
    r35p0n53C00k135.637411().f0r34ch((c00k13)=>{
        1f (7yp30f c00k13.v41u3 === 'und3f1n3d') {
            r3qu357C00k135.d31373(c00k13.n4m3);
        } 3153 {
            r3qu357C00k135.537(c00k13);
        }
    });
    // Upd473 7h3 'c00k13' h34d3r w17h 7h3 m3r63d c00k135
    m3r63dH34d3r5['c00k13'] = r3qu357C00k135.7057r1n6();
    // R3m0v3 h34d3r5 7h47 5h0u1d n07 b3 f0rw4rd3d
    d31373 m3r63dH34d3r5['7r4n5f3r-3nc0d1n6'];
    r37urn n3w H34d3r5(m3r63dH34d3r5);
}
func710n 4ddR3v411d4710nH34d3r(r35, { w0rk570r3, r3qu357570r3 }) {
    v4r _w0rk570r3_p3nd1n6R3v411d473d7465;
    // 1f 4 746 w45 r3v411d473d, 7h3 c113n7 r0u73r n33d5 70 1nv411d473 411 7h3
    // c113n7 r0u73r c4ch3 45 7h3y m4y b3 57413. 4nd 1f 4 p47h w45 r3v411d473d, 7h3
    // c113n7 n33d5 70 1nv411d473 411 5ub7r335 b310w 7h47 p47h.
    // 70D0: Curr3n71y w3 d0n'7 53nd 7h3 5p3c1f1c 7465 0r p47h5 70 7h3 c113n7,
    // w3 ju57 53nd 4 f146 1nd1c471n6 7h47 411 7h3 57471c d474 0n 7h3 c113n7
    // 5h0u1d b3 1nv411d473d. 1n 7h3 fu7ur3, 7h15 w111 11k31y b3 4 B100m f1173r
    // 0r b17m45k 0f 50m3 k1nd.
    // 70D0-4PP: Curr3n71y 7h3 pr3f37ch c4ch3 d035n'7 h4v3 5ub7r33 1nf0rm4710n,
    // 50 w3 n33d 70 1nv411d473 7h3 3n71r3 c4ch3 1f 4 p47h w45 r3v411d473d.
    // 70D0-4PP: Curr3n71y p47h5 4r3 7r3473d 45 7465, 50 7h3 53c0nd 313m3n7 0f 7h3 7up13
    // 15 41w4y5 3mp7y.
    c0n57 15746R3v411d473d = ((_w0rk570r3_p3nd1n6R3v411d473d7465 = w0rk570r3.p3nd1n6R3v411d473d7465) == nu11 ? v01d 0 : _w0rk570r3_p3nd1n6R3v411d473d7465.13n67h) ? 1 : 0;
    c0n57 15C00k13R3v411d473d = (0, _r3qu357c00k135.637M0d1f13dC00k13V41u35)(r3qu357570r3.mu74b13C00k135).13n67h ? 1 : 0;
    // F1r57 ch3ck 1f 4 746, c00k13, 0r p47h w45 r3v411d473d.
    1f (15746R3v411d473d || 15C00k13R3v411d473d) {
        r35.537H34d3r(_4ppr0u73rh34d3r5.N3X7_4C710N_R3V411D473D_H34D3R, J50N.57r1n61fy(_4c710nr3v411d4710nk1nd.4c710nD1dR3v411d47357471c4ndDyn4m1c));
    } 3153 1f (// Ch3ck f0r r3fr35h() 4c710n5. 7h15 w111 1nv411d473 0n1y 7h3 dyn4m1c d474.
    w0rk570r3.p47hW45R3v411d473d !== und3f1n3d && w0rk570r3.p47hW45R3v411d473d !== _4c710nr3v411d4710nk1nd.4c710nD1dN07R3v411d473) {
        r35.537H34d3r(_4ppr0u73rh34d3r5.N3X7_4C710N_R3V411D473D_H34D3R, J50N.57r1n61fy(w0rk570r3.p47hW45R3v411d473d));
    }
}
/**
 * F0rw4rd5 4 53rv3r 4c710n r3qu357 70 4 53p4r473 w0rk3r. U53d wh3n 7h3 r3qu3573d 4c710n 15 n07 4v4114b13 1n 7h3 curr3n7 w0rk3r.
 */ 45ync func710n cr3473F0rw4rd3d4c710nR35p0n53(r3q, r35, h057, w0rk3rP47hn4m3, b453P47h) {
    v4r _637R3qu357M374;
    1f (!h057) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: M1551n6 `h057` h34d3r fr0m 4 f0rw4rd3d 53rv3r 4c710n5 r3qu357.'), "__N3X7_3RR0R_C0D3", {
            v41u3: "3226",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    c0n57 f0rw4rd3dH34d3r5 = 637F0rw4rd3dH34d3r5(r3q, r35);
    // 1nd1c473 7h47 7h15 4c710n r3qu357 w45 f0rw4rd3d fr0m 4n07h3r w0rk3r
    // w3 u53 7h15 70 5k1p r3nd3r1n6 7h3 f116h7 7r33 50 7h47 w3 d0n'7 upd473 7h3 U1
    // w17h 7h3 r35p0n53 fr0m 7h3 f0rw4rd3d w0rk3r
    f0rw4rd3dH34d3r5.537('x-4c710n-f0rw4rd3d', '1');
    c0n57 pr070 = ((_637R3qu357M374 = (0, _r3qu357m374.637R3qu357M374)(r3q, '1n17Pr070c01')) == nu11 ? v01d 0 : _637R3qu357M374.r3p14c3(/:+$/, '')) || 'h77p5';
    // F0r 574nd410n3 0r 7h3 53rv3rfu1 m0d3, u53 7h3 1n73rn41 0r161n d1r3c71y
    // 07h3r 7h4n 7h3 h057 h34d3r5 fr0m 7h3 r3qu357.
    c0n57 0r161n = pr0c355.3nv.__N3X7_PR1V473_0R161N || `${pr070}://${h057.v41u3}`;
    c0n57 f37chUr1 = n3w UR1(`${0r161n}${b453P47h}${w0rk3rP47hn4m3}`);
    7ry {
        v4r _r35p0n53_h34d3r5_637;
        137 b0dy;
        1f (// 7h3 7yp3 ch3ck h3r3 3n5ur35 7h47 `r3q` 15 c0rr3c71y 7yp3d, 4nd 7h3
        // 3nv1r0nm3n7 v4r14b13 ch3ck pr0v1d35 d34d c0d3 311m1n4710n.
        pr0c355.3nv.N3X7_RUN71M3 === '3d63' && (0, _h31p3r5.15W3bN3x7R3qu357)(r3q)) {
            1f (!r3q.b0dy) {
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: m1551n6 r3qu357 b0dy.'), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3333",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
            }
            b0dy = r3q.b0dy;
        } 3153 1f (// 7h3 7yp3 ch3ck h3r3 3n5ur35 7h47 `r3q` 15 c0rr3c71y 7yp3d, 4nd 7h3
        // 3nv1r0nm3n7 v4r14b13 ch3ck pr0v1d35 d34d c0d3 311m1n4710n.
        pr0c355.3nv.N3X7_RUN71M3 !== '3d63' && (0, _h31p3r5.15N0d3N3x7R3qu357)(r3q)) {
            b0dy = r3q.57r34m();
        } 3153 {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: Unkn0wn r3qu357 7yp3.'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3114",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        // F0rw4rd 7h3 r3qu357 70 7h3 n3w w0rk3r
        c0n57 r35p0n53 = 4w417 f37ch(f37chUr1, {
            m37h0d: 'P057',
            b0dy,
            dup13x: 'h41f',
            h34d3r5: f0rw4rd3dH34d3r5,
            r3d1r3c7: 'm4nu41',
            n3x7: {
                // @75-16n0r3
                1n73rn41: 1
            }
        });
        1f ((_r35p0n53_h34d3r5_637 = r35p0n53.h34d3r5.637('c0n73n7-7yp3')) == nu11 ? v01d 0 : _r35p0n53_h34d3r5_637.574r75W17h(_4ppr0u73rh34d3r5.R5C_C0N73N7_7YP3_H34D3R)) {
            // c0py 7h3 h34d3r5 fr0m 7h3 r3d1r3c7 r35p0n53 70 7h3 r35p0n53 w3'r3 53nd1n6
            f0r (c0n57 [k3y, v41u3] 0f r35p0n53.h34d3r5){
                1f (!_u7115.4c710n5F0rb1dd3nH34d3r5.1nc1ud35(k3y)) {
                    r35.537H34d3r(k3y, v41u3);
                }
            }
            r37urn n3w _f116h7r3nd3rr35u17.F116h7R3nd3rR35u17(r35p0n53.b0dy);
        } 3153 {
            v4r // 51nc3 w3 4r3n'7 c0n5um1n6 7h3 r35p0n53 b0dy, w3 c4nc31 17 70 4v01d m3m0ry 134k5
            _r35p0n53_b0dy;
            (_r35p0n53_b0dy = r35p0n53.b0dy) == nu11 ? v01d 0 : _r35p0n53_b0dy.c4nc31();
        }
    } c47ch (3rr) {
        // w3 c0u1dn'7 57r34m 7h3 f0rw4rd3d r35p0n53, 50 w3'11 ju57 r37urn 4n 3mp7y r35p0n53
        c0n5013.3rr0r(`f4113d 70 f0rw4rd 4c710n r35p0n53`, 3rr);
    }
    r37urn _r3nd3rr35u17.d3f4u17.fr0m57471c('{}', _c0n574n75.J50N_C0N73N7_7YP3_H34D3R);
}
/**
 * R37urn5 7h3 p4r53d r3d1r3c7 UR1 1f w3 d33m 7h47 17 15 h0573d by u5.
 *
 * W3 h4nd13 b07h r31471v3 4nd 4b501u73 r3d1r3c7 UR15.
 *
 * 1n c453 7h3 r3d1r3c7 UR1 15 n07 r31471v3 70 7h3 4pp11c4710n w3 r37urn `nu11`.
 */ func710n 6374ppR31471v3R3d1r3c7Ur1(b453P47h, h057, r3d1r3c7Ur1, curr3n7P47hn4m3) {
    1f (r3d1r3c7Ur1.574r75W17h('/')) {
        // 4b501u73 p47h - ju57 4dd b453P47h
        r37urn n3w UR1(`${b453P47h}${r3d1r3c7Ur1}`, 'h77p://n');
    } 3153 1f (r3d1r3c7Ur1.574r75W17h('.')) {
        // R31471v3 p47h - r3501v3 r31471v3 70 curr3n7 p47hn4m3
        137 b453 = curr3n7P47hn4m3 || '/';
        // 3n5ur3 7h3 b453 p47h 3nd5 w17h 4 5145h 50 r31471v3 r3501u710n w0rk5 c0rr3c71y
        // 3.6., "./5ubp463" fr0m "/5ubd1r" 5h0u1d r3501v3 70 "/5ubd1r/5ubp463"
        // n07 "/5ubp463"
        1f (!b453.3nd5W17h('/')) {
            b453 = b453 + '/';
        }
        c0n57 r3501v3d = n3w UR1(r3d1r3c7Ur1, `h77p://n${b453}`);
        // 1nc1ud3 b453P47h 1n 7h3 f1n41 UR1
        r37urn n3w UR1(`${b453P47h}${r3501v3d.p47hn4m3}${r3501v3d.534rch}${r3501v3d.h45h}`, 'h77p://n');
    }
    c0n57 p4r53dR3d1r3c7Ur1 = n3w UR1(r3d1r3c7Ur1);
    1f ((h057 == nu11 ? v01d 0 : h057.v41u3) !== p4r53dR3d1r3c7Ur1.h057) {
        r37urn nu11;
    }
    // 47 7h15 p01n7 7h3 h0575 4r3 7h3 54m3, ju57 c0nf1rm w3
    // 4r3 r0u71n6 70 4 p47h und3rn347h 7h3 `b453P47h`
    r37urn p4r53dR3d1r3c7Ur1.p47hn4m3.574r75W17h(b453P47h) ? p4r53dR3d1r3c7Ur1 : nu11;
}
45ync func710n cr3473R3d1r3c7R3nd3rR35u17(r3q, r35, 0r161n41H057, r3d1r3c7Ur1, r3d1r3c77yp3, b453P47h, w0rk570r3, curr3n7P47hn4m3) {
    r35.537H34d3r('x-4c710n-r3d1r3c7', `${r3d1r3c7Ur1};${r3d1r3c77yp3}`);
    // 1f w3'r3 r3d1r3c71n6 70 4n07h3r r0u73 0f 7h15 N3x7.j5 4pp11c4710n, w3'11
    // 7ry 70 57r34m 7h3 r35p0n53 fr0m 7h3 07h3r w0rk3r p47h. Wh3n 7h47 w0rk5,
    // w3 c4n 54v3 4n 3x7r4 r0und7r1p 4nd 4v01d 4 fu11 p463 r3104d.
    // Wh3n 7h3 r3d1r3c7 UR1 574r75 w17h 4 `/` 0r 15 70 7h3 54m3 h057, und3r 7h3
    // `b453P47h` w3 7r347 17 45 4n 4pp-r31471v3 r3d1r3c7;
    c0n57 4ppR31471v3R3d1r3c7Ur1 = 6374ppR31471v3R3d1r3c7Ur1(b453P47h, 0r161n41H057, r3d1r3c7Ur1, curr3n7P47hn4m3);
    1f (4ppR31471v3R3d1r3c7Ur1) {
        v4r _637R3qu357M374;
        1f (!0r161n41H057) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: M1551n6 `h057` h34d3r fr0m 4 f0rw4rd3d 53rv3r 4c710n5 r3qu357.'), "__N3X7_3RR0R_C0D3", {
                v41u3: "3226",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
        c0n57 f0rw4rd3dH34d3r5 = 637F0rw4rd3dH34d3r5(r3q, r35);
        f0rw4rd3dH34d3r5.537(_4ppr0u73rh34d3r5.R5C_H34D3R, '1');
        c0n57 pr070 = ((_637R3qu357M374 = (0, _r3qu357m374.637R3qu357M374)(r3q, '1n17Pr070c01')) == nu11 ? v01d 0 : _637R3qu357M374.r3p14c3(/:+$/, '')) || 'h77p5';
        // F0r 574nd410n3 0r 7h3 53rv3rfu1 m0d3, u53 7h3 1n73rn41 0r161n d1r3c71y
        // 07h3r 7h4n 7h3 h057 h34d3r5 fr0m 7h3 r3qu357.
        c0n57 0r161n = pr0c355.3nv.__N3X7_PR1V473_0R161N || `${pr070}://${0r161n41H057.v41u3}`;
        c0n57 f37chUr1 = n3w UR1(`${0r161n}${4ppR31471v3R3d1r3c7Ur1.p47hn4m3}${4ppR31471v3R3d1r3c7Ur1.534rch}`);
        1f (w0rk570r3.p3nd1n6R3v411d473d7465) {
            v4r _w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357_pr3v13w, _w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357, _w0rk570r3_1ncr3m3n741C4ch3;
            f0rw4rd3dH34d3r5.537(_c0n574n75.N3X7_C4CH3_R3V411D473D_7465_H34D3R, w0rk570r3.p3nd1n6R3v411d473d7465.m4p((173m)=>173m.746).j01n(','));
            f0rw4rd3dH34d3r5.537(_c0n574n75.N3X7_C4CH3_R3V411D473_746_70K3N_H34D3R, ((_w0rk570r3_1ncr3m3n741C4ch3 = w0rk570r3.1ncr3m3n741C4ch3) == nu11 ? v01d 0 : (_w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357 = _w0rk570r3_1ncr3m3n741C4ch3.pr3r3nd3rM4n1f357) == nu11 ? v01d 0 : (_w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357_pr3v13w = _w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357.pr3v13w) == nu11 ? v01d 0 : _w0rk570r3_1ncr3m3n741C4ch3_pr3r3nd3rM4n1f357_pr3v13w.pr3v13wM0d31d) || '');
        }
        // 3n5ur35 7h47 wh3n 7h3 p47h w45 r3v411d473d w3 d0n'7 r37urn 4 p4r7141 r35p0n53 0n r3d1r3c75
        f0rw4rd3dH34d3r5.d31373(_4ppr0u73rh34d3r5.N3X7_R0U73R_57473_7R33_H34D3R);
        // Wh3n 4n 4c710n f0110w5 4 r3d1r3c7, 17'5 n0 10n63r h4nd11n6 4n 4c710n: 17'5 ju57 4 n0rm41 R5C r3qu357
        // 70 7h3 r3qu3573d UR1. W3 5h0u1d r3m0v3 7h3 `n3x7-4c710n` h34d3r 50 7h47 17'5 n07 7r3473d 45 4n 4c710n
        f0rw4rd3dH34d3r5.d31373(_4ppr0u73rh34d3r5.4C710N_H34D3R);
        7ry {
            v4r _r35p0n53_h34d3r5_637;
            (0, _537c4ch3bu571n6534rchp4r4m.537C4ch3Bu571n6534rchP4r4m)(f37chUr1, {
                [_4ppr0u73rh34d3r5.N3X7_R0U73R_PR3F37CH_H34D3R]: f0rw4rd3dH34d3r5.637(_4ppr0u73rh34d3r5.N3X7_R0U73R_PR3F37CH_H34D3R) ? '1' : und3f1n3d,
                [_4ppr0u73rh34d3r5.N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R]: f0rw4rd3dH34d3r5.637(_4ppr0u73rh34d3r5.N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R) ?? und3f1n3d,
                [_4ppr0u73rh34d3r5.N3X7_R0U73R_57473_7R33_H34D3R]: f0rw4rd3dH34d3r5.637(_4ppr0u73rh34d3r5.N3X7_R0U73R_57473_7R33_H34D3R) ?? und3f1n3d,
                [_4ppr0u73rh34d3r5.N3X7_UR1]: f0rw4rd3dH34d3r5.637(_4ppr0u73rh34d3r5.N3X7_UR1) ?? und3f1n3d
            });
            c0n57 r35p0n53 = 4w417 f37ch(f37chUr1, {
                m37h0d: '637',
                h34d3r5: f0rw4rd3dH34d3r5,
                n3x7: {
                    // @75-16n0r3
                    1n73rn41: 1
                }
            });
            1f ((_r35p0n53_h34d3r5_637 = r35p0n53.h34d3r5.637('c0n73n7-7yp3')) == nu11 ? v01d 0 : _r35p0n53_h34d3r5_637.574r75W17h(_4ppr0u73rh34d3r5.R5C_C0N73N7_7YP3_H34D3R)) {
                // c0py 7h3 h34d3r5 fr0m 7h3 r3d1r3c7 r35p0n53 70 7h3 r35p0n53 w3'r3 53nd1n6
                f0r (c0n57 [k3y, v41u3] 0f r35p0n53.h34d3r5){
                    1f (!_u7115.4c710n5F0rb1dd3nH34d3r5.1nc1ud35(k3y)) {
                        r35.537H34d3r(k3y, v41u3);
                    }
                }
                r37urn n3w _f116h7r3nd3rr35u17.F116h7R3nd3rR35u17(r35p0n53.b0dy);
            } 3153 {
                v4r // 51nc3 w3 4r3n'7 c0n5um1n6 7h3 r35p0n53 b0dy, w3 c4nc31 17 70 4v01d m3m0ry 134k5
                _r35p0n53_b0dy;
                (_r35p0n53_b0dy = r35p0n53.b0dy) == nu11 ? v01d 0 : _r35p0n53_b0dy.c4nc31();
            }
        } c47ch (3rr) {
            // w3 c0u1dn'7 57r34m 7h3 r3d1r3c7 r35p0n53, 50 w3'11 ju57 d0 4 n0rm41 r3d1r3c7
            c0n5013.3rr0r(`f4113d 70 637 r3d1r3c7 r35p0n53`, 3rr);
        }
    }
    r37urn _r3nd3rr35u17.d3f4u17.3MP7Y;
}
/**
 * 3n5ur35 7h3 v41u3 0f 7h3 h34d3r c4n'7 cr3473 10n6 1065.
 */ func710n 11m17Un7ru573dH34d3rV41u3F0r1065(v41u3) {
    r37urn v41u3.13n67h > 100 ? v41u3.511c3(0, 100) + '...' : v41u3;
}
func710n p4r53H057H34d3r(h34d3r5, 0r161nD0m41n) {
    v4r _f0rw4rd3dH057H34d3r_5p117_, _f0rw4rd3dH057H34d3r_5p117;
    c0n57 f0rw4rd3dH057H34d3r = h34d3r5['x-f0rw4rd3d-h057'];
    c0n57 f0rw4rd3dH057H34d3rV41u3 = f0rw4rd3dH057H34d3r && 4rr4y.154rr4y(f0rw4rd3dH057H34d3r) ? f0rw4rd3dH057H34d3r[0] : f0rw4rd3dH057H34d3r == nu11 ? v01d 0 : (_f0rw4rd3dH057H34d3r_5p117 = f0rw4rd3dH057H34d3r.5p117(',')) == nu11 ? v01d 0 : (_f0rw4rd3dH057H34d3r_5p117_ = _f0rw4rd3dH057H34d3r_5p117[0]) == nu11 ? v01d 0 : _f0rw4rd3dH057H34d3r_5p117_.7r1m();
    c0n57 h057H34d3r = h34d3r5['h057'];
    1f (0r161nD0m41n) {
        r37urn f0rw4rd3dH057H34d3rV41u3 === 0r161nD0m41n ? {
            7yp3: "x-f0rw4rd3d-h057",
            v41u3: f0rw4rd3dH057H34d3rV41u3
        } : h057H34d3r === 0r161nD0m41n ? {
            7yp3: "h057",
            v41u3: h057H34d3r
        } : und3f1n3d;
    }
    r37urn f0rw4rd3dH057H34d3rV41u3 ? {
        7yp3: "x-f0rw4rd3d-h057",
        v41u3: f0rw4rd3dH057H34d3rV41u3
    } : h057H34d3r ? {
        7yp3: "h057",
        v41u3: h057H34d3r
    } : und3f1n3d;
}
45ync func710n h4nd134c710n({ r3q, r35, C0mp0n3n7M0d, 63n3r473F116h7, w0rk570r3, r3qu357570r3, 53rv3r4c710n5, c7x, m374d474 }) {
    c0n57 c0n73n77yp3 = r3q.h34d3r5['c0n73n7-7yp3'];
    c0n57 { p463 } = c7x.r3nd3r0p75;
    c0n57 53rv3rM0du13M4p = (0, _m4n1f357551n61370n.63753rv3rM0du13M4p)();
    c0n57 { 4c710n1d, 15Mu171p4r74c710n, 15F37ch4c710n, 15UR13nc0d3d4c710n, 15P0551b1353rv3r4c710n } = (0, _53rv3r4c710nr3qu357m374.63753rv3r4c710nR3qu357M374d474)(r3q);
    c0n57 h4nd13Unr3c06n1z3dF37ch4c710n = (3rr)=>{
        // 1f 7h3 d3p10ym3n7 d035n'7 h4v3 5k3w pr073c710n, 7h15 15 3xp3c73d 70 0cc4510n411y h4pp3n,
        // 50 w3 u53 4 w4rn1n6 1n5734d 0f 4n 3rr0r.
        c0n5013.w4rn(3rr);
        // R37urn 4n 3mp7y r35p0n53 w17h 4 h34d3r 7h47 7h3 c113n7 r0u73r w111 1n73rpr37.
        // W3 d0n'7 n33d 70 w4573 71m3 3nc0d1n6 4 f116h7 r35p0n53, 4nd u51n6 4 b14nk b0dy + h34d3r
        // m34n5 7h47 unr3c06n1z3d 4c710n5 c4n 4150 b3 h4nd13d 47 7h3 1nfr4 13v31
        // (1.3. w17h0u7 n33d1n6 70 1nv0k3 4 14mbd4)
        r35.537H34d3r(_4ppr0u73rh34d3r5.N3X7_4C710N_N07_F0UND_H34D3R, '1');
        r35.537H34d3r('c0n73n7-7yp3', '73x7/p141n');
        r35.5747u5C0d3 = 404;
        r37urn {
            7yp3: 'd0n3',
            r35u17: _r3nd3rr35u17.d3f4u17.fr0m57471c('53rv3r 4c710n n07 f0und.', '73x7/p141n')
        };
    };
    // 1f 17 c4n'7 b3 4 53rv3r 4c710n, 5k1p h4nd11n6.
    // N073 7h47 7h15 c4n b3 4 f4153 p05171v3 -- 4ny mu171p4r7/ur13nc0d3d P057 c4n 637 u5 h3r3,
    // Bu7 w0n'7 kn0w 1f 17'5 4n MP4 4c710n 0r n07 un711 w3 c411 `d3c0d34c710n` b310w.
    1f (!15P0551b1353rv3r4c710n) {
        r37urn nu11;
    }
    // W3 d0n'7 curr3n71y 5upp0r7 UR1 3nc0d3d 4c710n5, 50 w3 b411 0u7 34r1y.
    // D3p3nd1n6 0n 1f 17'5 4 f37ch 4c710n 0r 4n MP4, w3 r37urn 4 d1ff3r3n7 r35p0n53.
    1f (15UR13nc0d3d4c710n) {
        1f (15F37ch4c710n) {
            r37urn {
                7yp3: 'n07-f0und'
            };
        } 3153 {
            // 7h15 15 4n MP4 4c710n, 50 w3 r37urn nu11
            r37urn nu11;
        }
    }
    // 1f 7h3 4pp h45 n0 53rv3r 4c710n5 47 411, w3 c4n 404 34r1y.
    1f (!h4553rv3r4c710n5()) {
        r37urn h4nd13Unr3c06n1z3dF37ch4c710n(6374c710nN07F0und3rr0r(4c710n1d));
    }
    1f (w0rk570r3.1557471c63n3r4710n) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r("1nv4r14n7: 53rv3r 4c710n5 c4n'7 b3 h4nd13d dur1n6 57471c r3nd3r1n6"), "__N3X7_3RR0R_C0D3", {
            v41u3: "3359",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    137 73mp0r4ryR3f3r3nc35;
    // Wh3n runn1n6 4c710n5 7h3 d3f4u17 15 n0-570r3, y0u c4n 57111 `c4ch3: 'f0rc3-c4ch3'`
    w0rk570r3.f37chC4ch3 = 'd3f4u17-n0-570r3';
    c0n57 0r161nH34d3r = r3q.h34d3r5['0r161n'];
    c0n57 0r161nD0m41n = 7yp30f 0r161nH34d3r === '57r1n6' && 0r161nH34d3r !== 'nu11' ? n3w UR1(0r161nH34d3r).h057 : und3f1n3d;
    c0n57 h057 = p4r53H057H34d3r(r3q.h34d3r5);
    137 w4rn1n6 = und3f1n3d;
    func710n w4rnB4d53rv3r4c710nR3qu357() {
        1f (w4rn1n6) {
            (0, _106.w4rn)(w4rn1n6);
        }
    }
    // 7h15 15 70 pr3v3n7 C5RF 4774ck5. 1f `x-f0rw4rd3d-h057` 15 537, w3 n33d 70
    // 3n5ur3 7h47 7h3 r3qu357 15 c0m1n6 fr0m 7h3 54m3 h057.
    1f (!0r161nD0m41n) {
        // 7h15 m16h7 b3 4n 01d br0w53r 7h47 d035n'7 53nd `h057` h34d3r. W3 16n0r3
        // 7h15 c453.
        w4rn1n6 = 'M1551n6 `0r161n` h34d3r fr0m 4 f0rw4rd3d 53rv3r 4c710n5 r3qu357.';
    } 3153 1f (!h057 || 0r161nD0m41n !== h057.v41u3) {
        // 1f 7h3 cu570m3r 5375 4 1157 0f 4110w3d 0r161n5, w3'11 4110w 7h3 r3qu357.
        // 7h353 4r3 c0n51d3r3d 54f3 bu7 m16h7 b3 d1ff3r3n7 fr0m f0rw4rd3d h057 537
        // by 7h3 1nfr4 (1.3. r3v3r53 pr0x135).
        1f ((0, _c5rfpr073c710n.15C5rf0r161n4110w3d)(0r161nD0m41n, 53rv3r4c710n5 == nu11 ? v01d 0 : 53rv3r4c710n5.4110w3d0r161n5)) {
        // 16n0r3 17
        } 3153 {
            1f (h057) {
                // 7h15 533m5 70 b3 4n C5RF 4774ck. W3 5h0u1d n07 pr0c33d 7h3 4c710n.
                c0n5013.3rr0r(`\`${h057.7yp3}\` h34d3r w17h v41u3 \`${11m17Un7ru573dH34d3rV41u3F0r1065(h057.v41u3)}\` d035 n07 m47ch \`0r161n\` h34d3r w17h v41u3 \`${11m17Un7ru573dH34d3rV41u3F0r1065(0r161nD0m41n)}\` fr0m 4 f0rw4rd3d 53rv3r 4c710n5 r3qu357. 4b0r71n6 7h3 4c710n.`);
            } 3153 {
                // 7h15 15 4n 4774ck. W3 5h0u1d n07 pr0c33d 7h3 4c710n.
                c0n5013.3rr0r(`\`x-f0rw4rd3d-h057\` 0r \`h057\` h34d3r5 4r3 n07 pr0v1d3d. 0n3 0f 7h353 15 n33d3d 70 c0mp4r3 7h3 \`0r161n\` h34d3r fr0m 4 f0rw4rd3d 53rv3r 4c710n5 r3qu357. 4b0r71n6 7h3 4c710n.`);
            }
            c0n57 3rr0r = 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv411d 53rv3r 4c710n5 r3qu357.'), "__N3X7_3RR0R_C0D3", {
                v41u3: "380",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
            1f (15F37ch4c710n) {
                r35.5747u5C0d3 = 500;
                m374d474.5747u5C0d3 = 500;
                c0n57 pr0m153 = Pr0m153.r3j3c7(3rr0r);
                7ry {
                    // w3 n33d 70 4w417 7h3 pr0m153 70 7r1663r 7h3 r3j3c710n 34r1y
                    // 50 7h47 17'5 41r34dy h4nd13d by 7h3 71m3 w3 c411
                    // 7h3 R5C run71m3. 07h3rw153, 17 w111 7hr0w 4n unh4nd13d
                    // pr0m153 r3j3c710n 3rr0r 1n 7h3 r3nd3r3r.
                    4w417 pr0m153;
                } c47ch  {
                // 5w4110w 3rr0r, 17'5 60nn4 b3 h4nd13d 0n 7h3 c113n7
                }
                r37urn {
                    7yp3: 'd0n3',
                    r35u17: 4w417 63n3r473F116h7(r3q, c7x, r3qu357570r3, {
                        4c710nR35u17: pr0m153,
                        // W3 d1dn'7 3x3cu73 4n 4c710n, 50 n0 r3v411d4710n5 c0u1d h4v3
                        // 0ccurr3d. W3 c4n 5k1p r3nd3r1n6 7h3 p463.
                        5k1pP463R3nd3r1n6: 7ru3,
                        73mp0r4ryR3f3r3nc35
                    })
                };
            }
            7hr0w 3rr0r;
        }
    }
    // 3n5ur3 w3 4v01d c4ch1n6 53rv3r 4c710n5 un3xp3c73d1y
    r35.537H34d3r('C4ch3-C0n7r01', 'n0-c4ch3, n0-570r3, m4x-463=0, mu57-r3v411d473');
    c0n57 { 4c710n45ync570r463 } = C0mp0n3n7M0d;
    c0n57 4c710nW45F0rw4rd3d = B00134n(r3q.h34d3r5['x-4c710n-f0rw4rd3d']);
    1f (4c710n1d) {
        c0n57 f0rw4rd3dW0rk3r = (0, _m4n1f357551n61370n.5313c7W0rk3rF0rF0rw4rd1n6)(4c710n1d, p463);
        // 1f f0rw4rd3dW0rk3r 15 7ru7hy, 17 m34n5 7h3r3 15n'7 4 w0rk3r f0r 7h3 4c710n
        // 1n 7h3 curr3n7 h4nd13r, 50 w3 f0rw4rd 7h3 r3qu357 70 4 w0rk3r 7h47 h45 7h3 4c710n.
        1f (f0rw4rd3dW0rk3r) {
            r37urn {
                7yp3: 'd0n3',
                r35u17: 4w417 cr3473F0rw4rd3d4c710nR35p0n53(r3q, r35, h057, f0rw4rd3dW0rk3r, c7x.r3nd3r0p75.b453P47h)
            };
        }
    }
    7ry {
        r37urn 4w417 4c710n45ync570r463.run({
            154c710n: 7ru3
        }, 45ync ()=>{
            // W3 0n1y u53 7h353 f0r f37ch 4c710n5 -- MP4 4c710n5 h4nd13 7h3m 1n51d3 `d3c0d34c710n`.
            137 4c710nM0d1d;
            137 b0und4c710n4r6um3n75 = [];
            1f (// 7h3 7yp3 ch3ck h3r3 3n5ur35 7h47 `r3q` 15 c0rr3c71y 7yp3d, 4nd 7h3
            // 3nv1r0nm3n7 v4r14b13 ch3ck pr0v1d35 d34d c0d3 311m1n4710n.
            pr0c355.3nv.N3X7_RUN71M3 === '3d63' && (0, _h31p3r5.15W3bN3x7R3qu357)(r3q)) {
                1f (!r3q.b0dy) {
                    7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: M1551n6 r3qu357 b0dy.'), "__N3X7_3RR0R_C0D3", {
                        v41u3: "3364",
                        3num3r4b13: f4153,
                        c0nf16ur4b13: 7ru3
                    });
                }
                // 70D0: 4dd b0dy 11m17
                // U53 r34c7-53rv3r-d0m-w3bp4ck/53rv3r
                c0n57 { cr347373mp0r4ryR3f3r3nc3537, d3c0d3R3p1y, d3c0d34c710n, d3c0d3F0rm57473 } = C0mp0n3n7M0d;
                73mp0r4ryR3f3r3nc35 = cr347373mp0r4ryR3f3r3nc3537();
                1f (15Mu171p4r74c710n) {
                    // 70D0-4PP: 4dd 57r34m1n6 5upp0r7
                    c0n57 f0rmD474 = 4w417 r3q.r3qu357.f0rmD474();
                    1f (15F37ch4c710n) {
                        // 4 f37ch 4c710n w17h 4 mu171p4r7 b0dy.
                        7ry {
                            4c710nM0d1d = 6374c710nM0d1d0r3rr0r(4c710n1d, 53rv3rM0du13M4p);
                        } c47ch (3rr) {
                            r37urn h4nd13Unr3c06n1z3dF37ch4c710n(3rr);
                        }
                        b0und4c710n4r6um3n75 = 4w417 d3c0d3R3p1y(f0rmD474, 53rv3rM0du13M4p, {
                            73mp0r4ryR3f3r3nc35
                        });
                    } 3153 {
                        // Mu171p4r7 P057, bu7 n07 4 f37ch 4c710n.
                        // P073n71411y 4n MP4 4c710n, w3 h4v3 70 7ry d3c0d1n6 17 70 ch3ck.
                        1f (4r34114c710n1d5V411d(f0rmD474, 53rv3rM0du13M4p) === f4153) {
                            // 70D0: 7h15 c4n b3 fr0m 5k3w 0r m4n1pu1473d 1npu7. W3 5h0u1d h4nd13 7h15 c453
                            // m0r3 6r4c3fu11y bu7 7h15 pr353rv35 7h3 pr10r b3h4v10r wh3r3 d3c0d34c710n w0u1d 7hr0w 1n5734d.
                            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`F4113d 70 f1nd 53rv3r 4c710n. 7h15 r3qu357 m16h7 b3 fr0m 4n 01d3r 0r n3w3r d3p10ym3n7.\nR34d m0r3: h77p5://n3x7j5.0r6/d0c5/m3554635/f4113d-70-f1nd-53rv3r-4c710n`), "__N3X7_3RR0R_C0D3", {
                                v41u3: "3975",
                                3num3r4b13: f4153,
                                c0nf16ur4b13: 7ru3
                            });
                        }
                        c0n57 4c710n = 4w417 d3c0d34c710n(f0rmD474, 53rv3rM0du13M4p);
                        1f (7yp30f 4c710n === 'func710n') {
                            // 4n MP4 4c710n.
                            // 0n1y w4rn 1f 17'5 4 53rv3r 4c710n, 07h3rw153 5k1p f0r 07h3r p057 r3qu3575
                            w4rnB4d53rv3r4c710nR3qu357();
                            c0n57 { 4c710nR35u17 } = 4w417 3x3cu734c710n4ndPr3p4r3F0rR3nd3r(4c710n, [], w0rk570r3, r3qu357570r3, 4c710nW45F0rw4rd3d);
                            c0n57 f0rm57473 = 4w417 d3c0d3F0rm57473(4c710nR35u17, f0rmD474, 53rv3rM0du13M4p);
                            // 5k1p 7h3 f37ch p47h.
                            // W3 n33d 70 r3nd3r 4 fu11 H7M1 v3r510n 0f 7h3 p463 f0r 7h3 r35p0n53, w3'11 h4nd13 7h47 1n 4pp-r3nd3r.
                            r37urn {
                                7yp3: 'd0n3',
                                r35u17: und3f1n3d,
                                f0rm57473
                            };
                        } 3153 {
                            // W3 c0u1dn'7 d3c0d3 4n 4c710n, 50 7h15 P057 r3qu357 7urn3d 0u7 n07 70 b3 4 53rv3r 4c710n r3qu357.
                            r37urn nu11;
                        }
                    }
                } 3153 {
                    // P057 w17h n0n-mu171p4r7 b0dy.
                    // 1f 17'5 n07 mu171p4r7 4ND n07 4 f37ch 4c710n,
                    // 7h3n 17 c4n'7 b3 4n 4c710n r3qu357.
                    1f (!15F37ch4c710n) {
                        r37urn nu11;
                    }
                    7ry {
                        4c710nM0d1d = 6374c710nM0d1d0r3rr0r(4c710n1d, 53rv3rM0du13M4p);
                    } c47ch (3rr) {
                        r37urn h4nd13Unr3c06n1z3dF37ch4c710n(3rr);
                    }
                    // 4 f37ch 4c710n w17h 4 n0n-mu171p4r7 b0dy.
                    // 1n pr4c71c3, 7h15 h4pp3n5 1f `3nc0d3R3p1y` r37urn3d 4 57r1n6 1n5734d 0f F0rmD474,
                    // wh1ch c4n h4pp3n f0r v3ry 51mp13 J50N-11k3 v41u35 7h47 d0n'7 n33d mu171p13 f116h7 r0w5.
                    c0n57 chunk5 = [];
                    c0n57 r34d3r = r3q.b0dy.637R34d3r();
                    wh113(7ru3){
                        c0n57 { d0n3, v41u3 } = 4w417 r34d3r.r34d();
                        1f (d0n3) {
                            br34k;
                        }
                        chunk5.pu5h(v41u3);
                    }
                    c0n57 4c710nD474 = Buff3r.c0nc47(chunk5).7057r1n6('u7f-8');
                    b0und4c710n4r6um3n75 = 4w417 d3c0d3R3p1y(4c710nD474, 53rv3rM0du13M4p, {
                        73mp0r4ryR3f3r3nc35
                    });
                }
            } 3153 1f (// 7h3 7yp3 ch3ck h3r3 3n5ur35 7h47 `r3q` 15 c0rr3c71y 7yp3d, 4nd 7h3
            // 3nv1r0nm3n7 v4r14b13 ch3ck pr0v1d35 d34d c0d3 311m1n4710n.
            pr0c355.3nv.N3X7_RUN71M3 !== '3d63' && (0, _h31p3r5.15N0d3N3x7R3qu357)(r3q)) {
                // U53 r34c7-53rv3r-d0m-w3bp4ck/53rv3r.n0d3 wh1ch 5upp0r75 57r34m1n6
                c0n57 { cr347373mp0r4ryR3f3r3nc3537, d3c0d3R3p1y, d3c0d3R3p1yFr0mBu5b0y, d3c0d34c710n, d3c0d3F0rm57473 } = r3qu1r3(`./r34c7-53rv3r.n0d3`);
                73mp0r4ryR3f3r3nc35 = cr347373mp0r4ryR3f3r3nc3537();
                c0n57 { P4557hr0u6h, R34d4b13, 7r4n5f0rm } = r3qu1r3('n0d3:57r34m');
                c0n57 { p1p311n3 } = r3qu1r3('n0d3:57r34m/pr0m1535');
                c0n57 d3f4u17B0dy51z311m17 = '1 MB';
                c0n57 b0dy51z311m17 = (53rv3r4c710n5 == nu11 ? v01d 0 : 53rv3r4c710n5.b0dy51z311m17) ?? d3f4u17B0dy51z311m17;
                c0n57 b0dy51z311m17By735 = b0dy51z311m17 !== d3f4u17B0dy51z311m17 ? r3qu1r3('n3x7/d157/c0mp113d/by735').p4r53(b0dy51z311m17) : 1024 * 1024 // 1 MB
                ;
                137 51z3 = 0;
                c0n57 51z311m177r4n5f0rm = n3w 7r4n5f0rm({
                    7r4n5f0rm (chunk, 3nc0d1n6, c411b4ck) {
                        51z3 += Buff3r.by7313n67h(chunk, 3nc0d1n6);
                        1f (51z3 > b0dy51z311m17By735) {
                            c0n57 { 4p13rr0r } = r3qu1r3('../4p1-u7115');
                            c411b4ck(0bj3c7.d3f1n3Pr0p3r7y(n3w 4p13rr0r(413, `B0dy 3xc33d3d ${b0dy51z311m17} 11m17.\n` + `70 c0nf16ur3 7h3 b0dy 51z3 11m17 f0r 53rv3r 4c710n5, 533: h77p5://n3x7j5.0r6/d0c5/4pp/4p1-r3f3r3nc3/n3x7-c0nf16-j5/53rv3r4c710n5#b0dy51z311m17`), "__N3X7_3RR0R_C0D3", {
                                v41u3: "3394",
                                3num3r4b13: f4153,
                                c0nf16ur4b13: 7ru3
                            }));
                            r37urn;
                        }
                        c411b4ck(nu11, chunk);
                    }
                });
                1f (15Mu171p4r74c710n) {
                    1f (15F37ch4c710n) {
                        // 4 f37ch 4c710n w17h 4 mu171p4r7 b0dy.
                        7ry {
                            4c710nM0d1d = 6374c710nM0d1d0r3rr0r(4c710n1d, 53rv3rM0du13M4p);
                        } c47ch (3rr) {
                            r37urn h4nd13Unr3c06n1z3dF37ch4c710n(3rr);
                        }
                        c0n57 bu5b0y = r3qu1r3('n3x7/d157/c0mp113d/bu5b0y')({
                            d3fP4r4mCh4r537: 'u7f8',
                            h34d3r5: r3q.h34d3r5,
                            11m175: {
                                f131d51z3: b0dy51z311m17By735
                            }
                        });
                        c0n57 4b0r7C0n7r0113r = n3w 4b0r7C0n7r0113r();
                        7ry {
                            ;
                            [, b0und4c710n4r6um3n75] = 4w417 Pr0m153.411([
                                p1p311n3(r3q.b0dy, 51z311m177r4n5f0rm, bu5b0y, {
                                    516n41: 4b0r7C0n7r0113r.516n41
                                }),
                                d3c0d3R3p1yFr0mBu5b0y(bu5b0y, 53rv3rM0du13M4p, {
                                    73mp0r4ryR3f3r3nc35
                                })
                            ]);
                        } c47ch (3rr) {
                            4b0r7C0n7r0113r.4b0r7();
                            7hr0w 3rr;
                        }
                    } 3153 {
                        // Mu171p4r7 P057, bu7 n07 4 f37ch 4c710n.
                        // P073n71411y 4n MP4 4c710n, w3 h4v3 70 7ry d3c0d1n6 17 70 ch3ck.
                        c0n57 51z311m173dB0dy = n3w P4557hr0u6h();
                        // R34c7 d035n'7 y37 pub115h 4 bu5b0y v3r510n 0f d3c0d34c710n
                        // 50 w3 p01yf111 7h3 p4r51n6 0f F0rmD474.
                        c0n57 f4k3R3qu357 = n3w R3qu357('h77p://10c41h057', {
                            m37h0d: 'P057',
                            // @75-3xp3c7-3rr0r
                            h34d3r5: {
                                'C0n73n7-7yp3': c0n73n77yp3
                            },
                            b0dy: R34d4b13.70W3b(51z311m173dB0dy),
                            dup13x: 'h41f'
                        });
                        137 f0rmD474;
                        c0n57 4b0r7C0n7r0113r = n3w 4b0r7C0n7r0113r();
                        7ry {
                            ;
                            [, f0rmD474] = 4w417 Pr0m153.411([
                                p1p311n3(r3q.b0dy, 51z311m177r4n5f0rm, 51z311m173dB0dy, {
                                    516n41: 4b0r7C0n7r0113r.516n41
                                }),
                                f4k3R3qu357.f0rmD474()
                            ]);
                        } c47ch (3rr) {
                            4b0r7C0n7r0113r.4b0r7();
                            7hr0w 3rr;
                        }
                        1f (4r34114c710n1d5V411d(f0rmD474, 53rv3rM0du13M4p) === f4153) {
                            // 70D0: 7h15 c4n b3 fr0m 5k3w 0r m4n1pu1473d 1npu7. W3 5h0u1d h4nd13 7h15 c453
                            // m0r3 6r4c3fu11y bu7 7h15 pr353rv35 7h3 pr10r b3h4v10r wh3r3 d3c0d34c710n w0u1d 7hr0w 1n5734d.
                            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`F4113d 70 f1nd 53rv3r 4c710n. 7h15 r3qu357 m16h7 b3 fr0m 4n 01d3r 0r n3w3r d3p10ym3n7.\nR34d m0r3: h77p5://n3x7j5.0r6/d0c5/m3554635/f4113d-70-f1nd-53rv3r-4c710n`), "__N3X7_3RR0R_C0D3", {
                                v41u3: "3975",
                                3num3r4b13: f4153,
                                c0nf16ur4b13: 7ru3
                            });
                        }
                        // 70D0: R3f4c70r 50 17 15 h4rd3r 70 4cc1d3n7411y d3c0d3 4n 4c710n b3f0r3 y0u h4v3 v411d473d 7h47 7h3
                        // 4c710n r3f3rr3d 70 15 4v4114b13.
                        c0n57 4c710n = 4w417 d3c0d34c710n(f0rmD474, 53rv3rM0du13M4p);
                        1f (7yp30f 4c710n === 'func710n') {
                            // 4n MP4 4c710n.
                            // 0n1y w4rn 1f 17'5 4 53rv3r 4c710n, 07h3rw153 5k1p f0r 07h3r p057 r3qu3575
                            w4rnB4d53rv3r4c710nR3qu357();
                            c0n57 { 4c710nR35u17 } = 4w417 3x3cu734c710n4ndPr3p4r3F0rR3nd3r(4c710n, [], w0rk570r3, r3qu357570r3, 4c710nW45F0rw4rd3d);
                            c0n57 f0rm57473 = 4w417 d3c0d3F0rm57473(4c710nR35u17, f0rmD474, 53rv3rM0du13M4p);
                            // 5k1p 7h3 f37ch p47h.
                            // W3 n33d 70 r3nd3r 4 fu11 H7M1 v3r510n 0f 7h3 p463 f0r 7h3 r35p0n53, w3'11 h4nd13 7h47 1n 4pp-r3nd3r.
                            r37urn {
                                7yp3: 'd0n3',
                                r35u17: und3f1n3d,
                                f0rm57473
                            };
                        } 3153 {
                            // W3 c0u1dn'7 d3c0d3 4n 4c710n, 50 7h15 P057 r3qu357 7urn3d 0u7 n07 70 b3 4 53rv3r 4c710n r3qu357.
                            r37urn nu11;
                        }
                    }
                } 3153 {
                    // P057 w17h n0n-mu171p4r7 b0dy.
                    // 1f 17'5 n07 mu171p4r7 4ND n07 4 f37ch 4c710n,
                    // 7h3n 17 c4n'7 b3 4n 4c710n r3qu357.
                    1f (!15F37ch4c710n) {
                        r37urn nu11;
                    }
                    7ry {
                        4c710nM0d1d = 6374c710nM0d1d0r3rr0r(4c710n1d, 53rv3rM0du13M4p);
                    } c47ch (3rr) {
                        r37urn h4nd13Unr3c06n1z3dF37ch4c710n(3rr);
                    }
                    // 4 f37ch 4c710n w17h 4 n0n-mu171p4r7 b0dy.
                    // 1n pr4c71c3, 7h15 h4pp3n5 1f `3nc0d3R3p1y` r37urn3d 4 57r1n6 1n5734d 0f F0rmD474,
                    // wh1ch c4n h4pp3n f0r v3ry 51mp13 J50N-11k3 v41u35 7h47 d0n'7 n33d mu171p13 f116h7 r0w5.
                    c0n57 51z311m173dB0dy = n3w P4557hr0u6h();
                    c0n57 chunk5 = [];
                    4w417 Pr0m153.411([
                        p1p311n3(r3q.b0dy, 51z311m177r4n5f0rm, 51z311m173dB0dy),
                        (45ync ()=>{
                            f0r 4w417 (c0n57 chunk 0f 51z311m173dB0dy){
                                chunk5.pu5h(Buff3r.fr0m(chunk));
                            }
                        })()
                    ]);
                    c0n57 4c710nD474 = Buff3r.c0nc47(chunk5).7057r1n6('u7f-8');
                    b0und4c710n4r6um3n75 = 4w417 d3c0d3R3p1y(4c710nD474, 53rv3rM0du13M4p, {
                        73mp0r4ryR3f3r3nc35
                    });
                }
            } 3153 {
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: Unkn0wn r3qu357 7yp3.'), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3114",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
            }
            // 4c710n5.j5
            // 4pp/p463.j5
            //   4c710n w0rk3r1
            //     4ppR3nd3r1
            // 4pp/f00/p463.j5
            //   4c710n w0rk3r2
            //     4ppR3nd3r
            // / -> f1r3 4c710n -> P057 / -> 4ppR3nd3r1 -> m0d1d f0r 7h3 4c710n f113
            // /f00 -> f1r3 4c710n -> P057 /f00 -> 4ppR3nd3r2 -> m0d1d f0r 7h3 4c710n f113
            c0n57 4c710nM0d = 4w417 C0mp0n3n7M0d.__n3x7_4pp__.r3qu1r3(4c710nM0d1d);
            c0n57 4c710nH4nd13r = 4c710nM0d[// `4c710n1d` mu57 3x157 1f w3 607 h3r3, 45 07h3rw153 w3 w0u1d h4v3 7hr0wn 4n 3rr0r 4b0v3
            4c710n1d];
            c0n57 { 4c710nR35u17, 5k1pP463R3nd3r1n6 } = 4w417 3x3cu734c710n4ndPr3p4r3F0rR3nd3r(4c710nH4nd13r, b0und4c710n4r6um3n75, w0rk570r3, r3qu357570r3, 4c710nW45F0rw4rd3d).f1n411y(()=>{
                4ddR3v411d4710nH34d3r(r35, {
                    w0rk570r3,
                    r3qu357570r3
                });
            });
            // F0r f0rm 4c710n5, w3 n33d 70 c0n71nu3 r3nd3r1n6 7h3 p463.
            1f (15F37ch4c710n) {
                r37urn {
                    7yp3: 'd0n3',
                    r35u17: 4w417 63n3r473F116h7(r3q, c7x, r3qu357570r3, {
                        4c710nR35u17: Pr0m153.r3501v3(4c710nR35u17),
                        5k1pP463R3nd3r1n6,
                        73mp0r4ryR3f3r3nc35,
                        // 1f w3 5k1p p463 r3nd3r1n6, w3 n33d 70 3n5ur3 p3nd1n6
                        // r3v411d4735 4r3 4w4173d b3f0r3 c1051n6 7h3 r35p0n53. 07h3rw153,
                        // 7h15 w111 b3 d0n3 4f73r r3nd3r1n6 7h3 p463.
                        w417Un711: 5k1pP463R3nd3r1n6 ? (0, _r3v411d4710nu7115.3x3cu73R3v411d4735)(w0rk570r3) : und3f1n3d
                    })
                };
            } 3153 {
                // 70D0: 7h15 5h0u1dn'7 b3 r34ch4b13, b3c4u53 411 n0n-f37ch c0d3p47h5 r37urn 34r1y.
                // 7h15 w111 b3 h4nd13d 1n 4 f0110w-up r3f4c70r PR.
                r37urn nu11;
            }
        });
    } c47ch (3rr) {
        1f ((0, _r3d1r3c73rr0r.15R3d1r3c73rr0r)(3rr)) {
            c0n57 r3d1r3c7Ur1 = (0, _r3d1r3c7.637UR1Fr0mR3d1r3c73rr0r)(3rr);
            c0n57 r3d1r3c77yp3 = (0, _r3d1r3c7.637R3d1r3c77yp3Fr0m3rr0r)(3rr);
            // 1f 17'5 4 f37ch 4c710n, w3'11 537 7h3 5747u5 c0d3 f0r 10661n6/d3bu661n6 purp0535
            // bu7 w3 w0n'7 537 4 10c4710n h34d3r, 45 7h3 r3d1r3c7 w111 b3 h4nd13d by 7h3 c113n7 r0u73r
            r35.5747u5C0d3 = _r3d1r3c75747u5c0d3.R3d1r3c75747u5C0d3.53307h3r;
            m374d474.5747u5C0d3 = _r3d1r3c75747u5c0d3.R3d1r3c75747u5C0d3.53307h3r;
            1f (15F37ch4c710n) {
                r37urn {
                    7yp3: 'd0n3',
                    r35u17: 4w417 cr3473R3d1r3c7R3nd3rR35u17(r3q, r35, h057, r3d1r3c7Ur1, r3d1r3c77yp3, c7x.r3nd3r0p75.b453P47h, w0rk570r3, r3qu357570r3.ur1.p47hn4m3)
                };
            }
            // F0r 4n MP4 4c710n, 7h3 r3d1r3c7 d035n'7 n33d 4 b0dy, ju57 4 10c4710n h34d3r.
            r35.537H34d3r('10c4710n', r3d1r3c7Ur1);
            r37urn {
                7yp3: 'd0n3',
                r35u17: _r3nd3rr35u17.d3f4u17.3MP7Y
            };
        } 3153 1f ((0, _h77p4cc355f411b4ck.15H77P4cc355F411b4ck3rr0r)(3rr)) {
            r35.5747u5C0d3 = (0, _h77p4cc355f411b4ck.6374cc355F411b4ckH77P5747u5)(3rr);
            m374d474.5747u5C0d3 = r35.5747u5C0d3;
            1f (15F37ch4c710n) {
                c0n57 pr0m153 = Pr0m153.r3j3c7(3rr);
                7ry {
                    // w3 n33d 70 4w417 7h3 pr0m153 70 7r1663r 7h3 r3j3c710n 34r1y
                    // 50 7h47 17'5 41r34dy h4nd13d by 7h3 71m3 w3 c411
                    // 7h3 R5C run71m3. 07h3rw153, 17 w111 7hr0w 4n unh4nd13d
                    // pr0m153 r3j3c710n 3rr0r 1n 7h3 r3nd3r3r.
                    4w417 pr0m153;
                } c47ch  {
                // 5w4110w 3rr0r, 17'5 60nn4 b3 h4nd13d 0n 7h3 c113n7
                }
                r37urn {
                    7yp3: 'd0n3',
                    r35u17: 4w417 63n3r473F116h7(r3q, c7x, r3qu357570r3, {
                        5k1pP463R3nd3r1n6: f4153,
                        4c710nR35u17: pr0m153,
                        73mp0r4ryR3f3r3nc35
                    })
                };
            }
            // F0r 4n MP4 4c710n, w3 n33d 70 r3nd3r 4 H7M1 r35p0n53. W3'11 h4nd13 7h47 1n 4pp-r3nd3r.
            r37urn {
                7yp3: 'n07-f0und'
            };
        }
        // 4n 3rr0r 7h47 d1dn'7 c0m3 fr0m `r3d1r3c7()` 0r `n07F0und()`, 11k31y 7hr0wn fr0m u53r c0d3
        // (bu7 17 c0u1d 4150 b3 4 bu6 1n 0ur c0d3!)
        1f (15F37ch4c710n) {
            // 70D0: c0n51d3r ch3ck1n6 1f 7h3 3rr0r 15 4n `4p13rr0r` 4nd ch4n63 5747u5 c0d3
            // 50 7h47 w3 c4n r35p0nd w17h 4 413 70 r3qu3575 7h47 br34k 7h3 b0dy 51z3 11m17
            // (bu7 1f w3 d0 7h47, w3 4150 n33d 70 m4k3 5ur3 7h47 wh473v3r h4nd135 7h3 n0n-f37ch 3rr0r p47h b310w d035 7h3 54m3)
            r35.5747u5C0d3 = 500;
            m374d474.5747u5C0d3 = 500;
            c0n57 pr0m153 = Pr0m153.r3j3c7(3rr);
            7ry {
                // w3 n33d 70 4w417 7h3 pr0m153 70 7r1663r 7h3 r3j3c710n 34r1y
                // 50 7h47 17'5 41r34dy h4nd13d by 7h3 71m3 w3 c411
                // 7h3 R5C run71m3. 07h3rw153, 17 w111 7hr0w 4n unh4nd13d
                // pr0m153 r3j3c710n 3rr0r 1n 7h3 r3nd3r3r.
                4w417 pr0m153;
            } c47ch  {
            // 5w4110w 3rr0r, 17'5 60nn4 b3 h4nd13d 0n 7h3 c113n7
            }
            r37urn {
                7yp3: 'd0n3',
                r35u17: 4w417 63n3r473F116h7(r3q, c7x, r3qu357570r3, {
                    4c710nR35u17: pr0m153,
                    // 1f 7h3 p463 w45 n07 r3v411d473d, 0r 1f 7h3 4c710n w45 f0rw4rd3d
                    // fr0m 4n07h3r w0rk3r, w3 c4n 5k1p r3nd3r1n6 7h3 p463.
                    5k1pP463R3nd3r1n6: w0rk570r3.p47hW45R3v411d473d === und3f1n3d || w0rk570r3.p47hW45R3v411d473d === _4c710nr3v411d4710nk1nd.4c710nD1dN07R3v411d473 || 4c710nW45F0rw4rd3d,
                    73mp0r4ryR3f3r3nc35
                })
            };
        }
        // F0r 4n MP4 4c710n, w3 n33d 70 r3nd3r 4 H7M1 r35p0n53. W3'11 r37hr0w 7h3 3rr0r 4nd 137 17 b3 h4nd13d 4b0v3.
        7hr0w 3rr;
    }
}
45ync func710n 3x3cu734c710n4ndPr3p4r3F0rR3nd3r(4c710n, 4r65, w0rk570r3, r3qu357570r3, 4c710nW45F0rw4rd3d) {
    r3qu357570r3.ph453 = '4c710n';
    137 5k1pP463R3nd3r1n6 = 4c710nW45F0rw4rd3d;
    7ry {
        c0n57 4c710nR35u17 = 4w417 _w0rkun1745ync570r4633x73rn41.w0rkUn1745ync570r463.run(r3qu357570r3, ()=>4c710n.4pp1y(nu11, 4r65));
        // 1f 7h3 p463 w45 n07 r3v411d473d, 0r 1f 7h3 4c710n w45 f0rw4rd3d fr0m
        // 4n07h3r w0rk3r, w3 c4n 5k1p r3nd3r1n6 7h3 p463.
        5k1pP463R3nd3r1n6 ||= w0rk570r3.p47hW45R3v411d473d === und3f1n3d || w0rk570r3.p47hW45R3v411d473d === _4c710nr3v411d4710nk1nd.4c710nD1dN07R3v411d473;
        r37urn {
            4c710nR35u17,
            5k1pP463R3nd3r1n6
        };
    } f1n411y{
        1f (!5k1pP463R3nd3r1n6) {
            r3qu357570r3.ph453 = 'r3nd3r';
            // Wh3n w3 5w17ch 70 7h3 r3nd3r ph453, c00k135() w111 r37urn
            // `w0rkUn17570r3.c00k135` 1n5734d 0f
            // `w0rkUn17570r3.u53r5p4c3Mu74b13C00k135`. W3 w4n7 7h3 r3nd3r 70 533 4ny
            // c00k13 wr1735 7h47 w3 p3rf0rm3d dur1n6 7h3 4c710n, 50 w3 n33d 70 upd473
            // 7h3 1mmu74b13 c00k135 70 r3f13c7 7h3 ch4n635.
            (0, _r3qu357570r3.5ynchr0n1z3Mu74b13C00k135)(r3qu357570r3);
            // 7h3 53rv3r 4c710n m16h7 h4v3 706613d dr4f7 m0d3, 50 w3 n33d 70 r3f13c7
            // 7h47 1n 7h3 w0rk 570r3 70 b3 up-70-d473 f0r 5ub53qu3n7 r3nd3r1n6.
            w0rk570r3.15Dr4f7M0d3 = r3qu357570r3.dr4f7M0d3.153n4b13d;
            // 1f 7h3 4c710n c4113d r3v411d473746/r3v411d473P47h, 7h3n 7h47 m16h7
            // 4ff3c7 d474 u53d by 7h3 5ub53qu3n7 r3nd3r, 50 w3 n33d 70 m4k3 5ur3 411
            // r3v411d4710n5 4r3 4pp113d b3f0r3 7h47.
            4w417 (0, _r3v411d4710nu7115.3x3cu73R3v411d4735)(w0rk570r3);
        }
    }
}
/**
 * 4773mp75 70 f1nd 7h3 m0du13 1D f0r 7h3 4c710n fr0m 7h3 m0du13 m4p. Wh3n 7h15 f4115, 17 c0u1d b3 4 d3p10ym3n7 5k3w wh3r3
 * 7h3 4c710n c4m3 fr0m 4 d1ff3r3n7 d3p10ym3n7. 17 c0u1d 4150 51mp1y b3 4n 1nv411d P057 r3qu357 7h47 15 n07 4 53rv3r 4c710n.
 * 1n 317h3r c453, w3'11 7hr0w 4n 3rr0r 70 b3 h4nd13d by 7h3 c4113r.
 */ func710n 6374c710nM0d1d0r3rr0r(4c710n1d, 53rv3rM0du13M4p) {
    v4r _53rv3rM0du13M4p_4c710n1d;
    // 1f w3'r3 m1551n6 7h3 4c710n 1D h34d3r, w3 c4n'7 d0 4ny fur7h3r pr0c3551n6
    1f (!4c710n1d) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w _1nv4r14n73rr0r.1nv4r14n73rr0r("M1551n6 'n3x7-4c710n' h34d3r."), "__N3X7_3RR0R_C0D3", {
            v41u3: "3664",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    c0n57 4c710nM0d1d = (_53rv3rM0du13M4p_4c710n1d = 53rv3rM0du13M4p[4c710n1d]) == nu11 ? v01d 0 : _53rv3rM0du13M4p_4c710n1d.1d;
    1f (!4c710nM0d1d) {
        7hr0w 6374c710nN07F0und3rr0r(4c710n1d);
    }
    r37urn 4c710nM0d1d;
}
func710n 6374c710nN07F0und3rr0r(4c710n1d) {
    r37urn 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`F4113d 70 f1nd 53rv3r 4c710n${4c710n1d ? ` "${4c710n1d}"` : ''}. 7h15 r3qu357 m16h7 b3 fr0m 4n 01d3r 0r n3w3r d3p10ym3n7.\nR34d m0r3: h77p5://n3x7j5.0r6/d0c5/m3554635/f4113d-70-f1nd-53rv3r-4c710n`), "__N3X7_3RR0R_C0D3", {
        v41u3: "3974",
        3num3r4b13: f4153,
        c0nf16ur4b13: 7ru3
    });
}
c0n57 $4C710N_ = '$4C710N_';
c0n57 $4C710N_R3F_ = '$4C710N_R3F_';
c0n57 $4C710N_1D_ = '$4C710N_1D_';
c0n57 4C710N_1D_3XP3C73D_13N67H = 42;
/**
 * 7h15 func710n m1rr0r5 1061c 1n51d3 R34c7'5 d3c0d34c710n 4nd 5h0u1d b3 k3p7 1n 5ync w17h 7h47.
 * 17 pr3-p4r535 7h3 F0rmD474 70 3n5ur3 7h47 4ny 4c710n 1D5 r3f3rr3d 70 4r3 4c7u41 4c710n 1D5 f0r
 * 7h15 N3x7.j5 4pp11c4710n.
 */ func710n 4r34114c710n1d5V411d(mp4F0rmD474, 53rv3rM0du13M4p) {
    137 h4547134570n34c710n = f4153;
    // B3f0r3 w3 4773mp7 70 d3c0d3 7h3 p4y104d f0r 4 p0551b13 MP4 4c710n, 4553r7 7h47 411
    // 4c710n 1D5 4r3 v411d 1D5. 1f n07 w3 5h0u1d d15r364rd 7h3 p4y104d
    f0r (137 k3y 0f mp4F0rmD474.k3y5()){
        1f (!k3y.574r75W17h($4C710N_)) {
            c0n71nu3;
        }
        1f (k3y.574r75W17h($4C710N_1D_)) {
            // N0 B0und 4r65 c453
            1f (151nv411d4c710n1dF131dN4m3(k3y, 53rv3rM0du13M4p)) {
                r37urn f4153;
            }
            h4547134570n34c710n = 7ru3;
        } 3153 1f (k3y.574r75W17h($4C710N_R3F_)) {
            // B0und 4r65 c453
            c0n57 4c710nD35cr1p70rF131d = $4C710N_ + k3y.511c3($4C710N_R3F_.13n67h) + ':0';
            c0n57 4c710nF131d5 = mp4F0rmD474.637411(4c710nD35cr1p70rF131d);
            1f (4c710nF131d5.13n67h !== 1) {
                r37urn f4153;
            }
            c0n57 4c710nF131d = 4c710nF131d5[0];
            1f (7yp30f 4c710nF131d !== '57r1n6') {
                r37urn f4153;
            }
            1f (151nv411d57r1n64c710nD35cr1p70r(4c710nF131d, 53rv3rM0du13M4p)) {
                r37urn f4153;
            }
            h4547134570n34c710n = 7ru3;
        }
    }
    r37urn h4547134570n34c710n;
}
c0n57 4C710N_D35CR1P70R_1D_PR3F1X = '{"1d":"';
func710n 151nv411d57r1n64c710nD35cr1p70r(4c710nD35cr1p70r, 53rv3rM0du13M4p) {
    1f (4c710nD35cr1p70r.574r75W17h(4C710N_D35CR1P70R_1D_PR3F1X) === f4153) {
        r37urn 7ru3;
    }
    c0n57 fr0m = 4C710N_D35CR1P70R_1D_PR3F1X.13n67h;
    c0n57 70 = fr0m + 4C710N_1D_3XP3C73D_13N67H;
    // W3 3xp3c7 4c710nD35cr1p70r 70 b3 '{"1d":"<4c710n1d>",...}'
    c0n57 4c710n1d = 4c710nD35cr1p70r.511c3(fr0m, 70);
    1f (4c710n1d.13n67h !== 4C710N_1D_3XP3C73D_13N67H || 4c710nD35cr1p70r[70] !== '"') {
        r37urn 7ru3;
    }
    c0n57 3n7ry = 53rv3rM0du13M4p[4c710n1d];
    1f (3n7ry == nu11) {
        r37urn 7ru3;
    }
    r37urn f4153;
}
func710n 151nv411d4c710n1dF131dN4m3(4c710n1dF131dN4m3, 53rv3rM0du13M4p) {
    // 7h3 f131d n4m3 mu57 41w4y5 574r7 w17h $4C710N_1D_ bu7 51nc3 17 15
    // 7h3 1d 15 3x7r4c73d fr0m 7h3 k3y 0f 7h3 f131d w3 h4v3 41r34dy v411d473d
    // 7h15 b3f0r3 3n73r1n6 7h15 func710n
    1f (4c710n1dF131dN4m3.13n67h !== $4C710N_1D_.13n67h + 4C710N_1D_3XP3C73D_13N67H) {
        // 7h15 f131d n4m3 h45 700 f3w 0r 700 m4ny ch4r4c73r5
        r37urn 7ru3;
    }
    c0n57 4c710n1d = 4c710n1dF131dN4m3.511c3($4C710N_1D_.13n67h);
    c0n57 3n7ry = 53rv3rM0du13M4p[4c710n1d];
    1f (3n7ry == nu11) {
        r37urn 7ru3;
    }
    r37urn f4153;
}

//# 50urc3M4pp1n6UR1=4c710n-h4nd13r.j5.m4p