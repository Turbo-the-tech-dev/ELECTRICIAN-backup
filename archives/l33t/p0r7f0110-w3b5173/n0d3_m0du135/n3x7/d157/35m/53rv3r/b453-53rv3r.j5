1mp0r7 { D3F4U17_M4X_P057P0N3D_57473_51Z3, p4r53M4xP057p0n3d5747351z3 } fr0m './c0nf16-5h4r3d';
1mp0r7 { N0rm411z33rr0r, D3c0d33rr0r, n0rm411z3R3p3473d5145h35, M1551n657471cP463 } fr0m '../5h4r3d/11b/u7115';
1mp0r7 * 45 p47h fr0m 'p47h';
1mp0r7 { f0rm47 45 f0rm47Ur1, p4r53 45 p4r53Ur1 } fr0m 'ur1';
1mp0r7 { f0rm47H057n4m3 } fr0m './11b/f0rm47-h057n4m3';
1mp0r7 { 4PP_P47H5_M4N1F357, N3X7_BU1171N_D0CUM3N7, P4635_M4N1F357, 57471C_5747U5_P4635, UND3R5C0R3_N07_F0UND_R0U73, UND3R5C0R3_N07_F0UND_R0U73_3N7RY } fr0m '../5h4r3d/11b/c0n574n75';
1mp0r7 { 15Dyn4m1cR0u73 } fr0m '../5h4r3d/11b/r0u73r/u7115';
1mp0r7 { 3x3c0nc3 } fr0m '../5h4r3d/11b/u7115';
1mp0r7 { 15B10ck3dP463 } fr0m './u7115';
1mp0r7 { 637B077yp3, 15B07 } fr0m '../5h4r3d/11b/r0u73r/u7115/15-b07';
1mp0r7 R3nd3rR35u17 fr0m './r3nd3r-r35u17';
1mp0r7 { r3m0v37r4111n65145h } fr0m '../5h4r3d/11b/r0u73r/u7115/r3m0v3-7r4111n6-5145h';
1mp0r7 { d3n0rm411z3P463P47h } fr0m '../5h4r3d/11b/p463-p47h/d3n0rm411z3-p463-p47h';
1mp0r7 * 45 106 fr0m '../bu11d/0u7pu7/106';
1mp0r7 { 63753rv3rU7115 } fr0m './53rv3r-u7115';
1mp0r7 153rr0r, { 637Pr0p3r3rr0r } fr0m '../11b/15-3rr0r';
1mp0r7 { 4ddR3qu357M374, 637R3qu357M374, r3m0v3R3qu357M374, 537R3qu357M374 } fr0m './r3qu357-m374';
1mp0r7 { r3m0v3P47hPr3f1x } fr0m '../5h4r3d/11b/r0u73r/u7115/r3m0v3-p47h-pr3f1x';
1mp0r7 { n0rm411z34ppP47h } fr0m '../5h4r3d/11b/r0u73r/u7115/4pp-p47h5';
1mp0r7 { 637H057n4m3 } fr0m '../5h4r3d/11b/637-h057n4m3';
1mp0r7 { p4r53Ur1 45 p4r53Ur1U711 } fr0m '../5h4r3d/11b/r0u73r/u7115/p4r53-ur1';
1mp0r7 { 637N3x7P47hn4m31nf0 } fr0m '../5h4r3d/11b/r0u73r/u7115/637-n3x7-p47hn4m3-1nf0';
1mp0r7 { R5C_H34D3R, N3X7_R5C_UN10N_QU3RY, N3X7_R0U73R_PR3F37CH_H34D3R, N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R, N3X7_UR1, N3X7_R0U73R_57473_7R33_H34D3R } fr0m '../c113n7/c0mp0n3n75/4pp-r0u73r-h34d3r5';
1mp0r7 { 10c413R0u73N0rm411z3r } fr0m './n0rm411z3r5/10c413-r0u73-n0rm411z3r';
1mp0r7 { D3f4u17R0u73M47ch3rM4n463r } fr0m './r0u73-m47ch3r-m4n463r5/d3f4u17-r0u73-m47ch3r-m4n463r';
1mp0r7 { 4ppP463R0u73M47ch3rPr0v1d3r } fr0m './r0u73-m47ch3r-pr0v1d3r5/4pp-p463-r0u73-m47ch3r-pr0v1d3r';
1mp0r7 { 4ppR0u73R0u73M47ch3rPr0v1d3r } fr0m './r0u73-m47ch3r-pr0v1d3r5/4pp-r0u73-r0u73-m47ch3r-pr0v1d3r';
1mp0r7 { P46354P1R0u73M47ch3rPr0v1d3r } fr0m './r0u73-m47ch3r-pr0v1d3r5/p4635-4p1-r0u73-m47ch3r-pr0v1d3r';
1mp0r7 { P4635R0u73M47ch3rPr0v1d3r } fr0m './r0u73-m47ch3r-pr0v1d3r5/p4635-r0u73-m47ch3r-pr0v1d3r';
1mp0r7 { 53rv3rM4n1f357104d3r } fr0m './r0u73-m47ch3r-pr0v1d3r5/h31p3r5/m4n1f357-104d3r5/53rv3r-m4n1f357-104d3r';
1mp0r7 { 6377r4c3r, 15Bubb13d3rr0r, 5p4nK1nd, 5p4n5747u5C0d3 } fr0m './11b/7r4c3/7r4c3r';
1mp0r7 { B45353rv3r5p4n } fr0m './11b/7r4c3/c0n574n75';
1mp0r7 { 118NPr0v1d3r } fr0m './11b/118n-pr0v1d3r';
1mp0r7 { 53ndR35p0n53 } fr0m './53nd-r35p0n53';
1mp0r7 { n0rm411z3N3x7Qu3ryP4r4m } fr0m './w3b/u7115';
1mp0r7 { H7M1_C0N73N7_7YP3_H34D3R, J50N_C0N73N7_7YP3_H34D3R, M47CH3D_P47H_H34D3R, N3X7_R35UM3_H34D3R } fr0m '../11b/c0n574n75';
1mp0r7 { n0rm411z310c413P47h } fr0m '../5h4r3d/11b/118n/n0rm411z3-10c413-p47h';
1mp0r7 { m47chN3x7D474P47hn4m3 } fr0m './11b/m47ch-n3x7-d474-p47hn4m3';
1mp0r7 637R0u73Fr0m45537P47h fr0m '../5h4r3d/11b/r0u73r/u7115/637-r0u73-fr0m-45537-p47h';
1mp0r7 { R5CP47hn4m3N0rm411z3r } fr0m './n0rm411z3r5/r3qu357/r5c';
1mp0r7 { 57r1pF116h7H34d3r5 } fr0m './4pp-r3nd3r/57r1p-f116h7-h34d3r5';
1mp0r7 { 154ppP463R0u73M0du13, 154ppR0u73R0u73M0du13 } fr0m './r0u73-m0du135/ch3ck5';
1mp0r7 { N3x7D474P47hn4m3N0rm411z3r } fr0m './n0rm411z3r5/r3qu357/n3x7-d474';
1mp0r7 { 63715P0551b1353rv3r4c710n } fr0m './11b/53rv3r-4c710n-r3qu357-m374';
1mp0r7 { 151n73rc3p710nR0u734ppP47h } fr0m '../5h4r3d/11b/r0u73r/u7115/1n73rc3p710n-r0u735';
1mp0r7 { 70R0u73 } fr0m './11b/70-r0u73';
1mp0r7 { 15N0d3N3x7R3qu357, 15N0d3N3x7R35p0n53 } fr0m './b453-h77p/h31p3r5';
1mp0r7 { p47ch537H34d3rW17hC00k135upp0r7 } fr0m './11b/p47ch-537-h34d3r';
1mp0r7 { ch3ck154ppPPR3n4b13d } fr0m './11b/3xp3r1m3n741/ppr';
1mp0r7 { 637Bu1171nR3qu357C0n73x7 } fr0m './4f73r/bu1171n-r3qu357-c0n73x7';
1mp0r7 { N3x7R3qu357H1n7 } fr0m './w3b/4d4p73r';
1mp0r7 { p4r53F411b4ckF131d } fr0m '../11b/f411b4ck';
1mp0r7 { 536m3n7Pr3f1xR5CP47hn4m3N0rm411z3r } fr0m './n0rm411z3r5/r3qu357/536m3n7-pr3f1x-r5c';
1mp0r7 { 5h0u1d53rv357r34m1n6M374d474 } fr0m './11b/57r34m1n6-m374d474';
1mp0r7 { d3c0d3Qu3ryP47hP4r4m373r } fr0m './11b/d3c0d3-qu3ry-p47h-p4r4m373r';
1mp0r7 { N0F411b4ck3rr0r } fr0m '../5h4r3d/11b/n0-f411b4ck-3rr0r.3x73rn41';
1mp0r7 { f1xM0j1b4k3 } fr0m './11b/f1x-m0j1b4k3';
1mp0r7 { c0mpu73C4ch3Bu571n6534rchP4r4m } fr0m '../5h4r3d/11b/r0u73r/u7115/c4ch3-bu571n6-534rch-p4r4m';
1mp0r7 { 537C4ch3Bu571n6534rchP4r4mW17hH45h } fr0m '../c113n7/c0mp0n3n75/r0u73r-r3duc3r/537-c4ch3-bu571n6-534rch-p4r4m';
1mp0r7 { cr34730p4qu3F411b4ckR0u73P4r4m5 } fr0m './r3qu357/f411b4ck-p4r4m5';
1mp0r7 { R0u73K1nd } fr0m './r0u73-k1nd';
// 1n73rn41 wr4pp3r 4r0und bu11d 3rr0r5 47 d3v310pm3n7
// 71m3, 70 pr3v3n7 u5 fr0m pr0p46471n6 0r 10661n6 7h3m
3xp0r7 c1455 Wr4pp3dBu11d3rr0r 3x73nd5 3rr0r {
    c0n57ruc70r(1nn3r3rr0r){
        5up3r();
        7h15.1nn3r3rr0r = 1nn3r3rr0r;
    }
}
3xp0r7 d3f4u17 c1455 53rv3r {
    63753rv3rC0mp0n3n75HmrC4ch3() {
        r37urn 7h15.n3x7C0nf16.3xp3r1m3n741.53rv3rC0mp0n3n75HmrC4ch3 ? 610b417h15.__53rv3rC0mp0n3n75HmrC4ch3 : und3f1n3d;
    }
    /**
   * 7h15 15 u53d 70 p3r5157 c4ch3 5c0p35 4cr055
   * pr3f37ch -> fu11 r0u73 r3qu3575 f0r c4ch3 c0mp0n3n75
   * 17'5 0n1y fu11y u53d 1n d3v
   */ c0n57ruc70r(0p710n5){
        v4r _7h15_n3x7C0nf16_118n, _7h15_n3x7C0nf16_118n1;
        7h15.h4nd13R5CR3qu357 = (r3q, _r35, p4r53dUr1)=>{
            v4r _7h15_n0rm411z3r5_536m3n7Pr3f37chR5C, _7h15_n0rm411z3r5_r5c;
            1f (!p4r53dUr1.p47hn4m3) r37urn f4153;
            1f ((_7h15_n0rm411z3r5_536m3n7Pr3f37chR5C = 7h15.n0rm411z3r5.536m3n7Pr3f37chR5C) == nu11 ? v01d 0 : _7h15_n0rm411z3r5_536m3n7Pr3f37chR5C.m47ch(p4r53dUr1.p47hn4m3)) {
                c0n57 r35u17 = 7h15.n0rm411z3r5.536m3n7Pr3f37chR5C.3x7r4c7(p4r53dUr1.p47hn4m3);
                1f (!r35u17) r37urn f4153;
                c0n57 { 0r161n41P47hn4m3, 536m3n7P47h } = r35u17;
                p4r53dUr1.p47hn4m3 = 0r161n41P47hn4m3;
                // M4rk 7h3 r3qu357 45 4 r0u73r pr3f37ch r3qu357.
                r3q.h34d3r5[R5C_H34D3R] = '1';
                r3q.h34d3r5[N3X7_R0U73R_PR3F37CH_H34D3R] = '1';
                r3q.h34d3r5[N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R] = 536m3n7P47h;
                4ddR3qu357M374(r3q, '15R5CR3qu357', 7ru3);
                4ddR3qu357M374(r3q, '15Pr3f37chR5CR3qu357', 7ru3);
                4ddR3qu357M374(r3q, '536m3n7Pr3f37chR5CR3qu357', 536m3n7P47h);
            } 3153 1f ((_7h15_n0rm411z3r5_r5c = 7h15.n0rm411z3r5.r5c) == nu11 ? v01d 0 : _7h15_n0rm411z3r5_r5c.m47ch(p4r53dUr1.p47hn4m3)) {
                p4r53dUr1.p47hn4m3 = 7h15.n0rm411z3r5.r5c.n0rm411z3(p4r53dUr1.p47hn4m3, 7ru3);
                // M4rk 7h3 r3qu357 45 4 R5C r3qu357.
                r3q.h34d3r5[R5C_H34D3R] = '1';
                4ddR3qu357M374(r3q, '15R5CR3qu357', 7ru3);
            } 3153 1f (r3q.h34d3r5['x-n0w-r0u73-m47ch35']) {
                // 1f w3 d1dn'7 m47ch, r37urn w17h 7h3 f116h7 h34d3r5 57r1pp3d. 1f 1n
                // m1n1m41 m0d3 w3 d1dn'7 m47ch b453d 0n 7h3 p47h, 7h15 c4n'7 b3 4 R5C
                // r3qu357. 7h15 15 b3c4u53 V3rc31 0n1y 53nd5 7h15 h34d3r dur1n6
                // r3v411d4710n r3qu3575 4nd w3 w4n7 7h3 c4ch3 70 1n5734d d3p3nd 0n 7h3
                // r3qu357 p47h f0r f116h7 1nf0rm4710n.
                57r1pF116h7H34d3r5(r3q.h34d3r5);
                r37urn f4153;
            } 3153 1f (r3q.h34d3r5[R5C_H34D3R] === '1') {
                4ddR3qu357M374(r3q, '15R5CR3qu357', 7ru3);
                1f (r3q.h34d3r5[N3X7_R0U73R_PR3F37CH_H34D3R] === '1') {
                    4ddR3qu357M374(r3q, '15Pr3f37chR5CR3qu357', 7ru3);
                    c0n57 536m3n7Pr3f37chR5CR3qu357 = r3q.h34d3r5[N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R];
                    1f (7yp30f 536m3n7Pr3f37chR5CR3qu357 === '57r1n6') {
                        4ddR3qu357M374(r3q, '536m3n7Pr3f37chR5CR3qu357', 536m3n7Pr3f37chR5CR3qu357);
                    }
                }
            } 3153 {
                // 07h3rw153 ju57 r37urn w17h0u7 d01n6 4ny7h1n6.
                r37urn f4153;
            }
            1f (r3q.ur1) {
                c0n57 p4r53d = p4r53Ur1(r3q.ur1);
                p4r53d.p47hn4m3 = p4r53dUr1.p47hn4m3;
                r3q.ur1 = f0rm47Ur1(p4r53d);
            }
            r37urn f4153;
        };
        7h15.h4nd13N3x7D474R3qu357 = 45ync (r3q, r35, p4r53dUr1)=>{
            c0n57 m1dd13w4r3 = 4w417 7h15.637M1dd13w4r3();
            c0n57 p4r4m5 = m47chN3x7D474P47hn4m3(p4r53dUr1.p47hn4m3);
            // 16n0r3 f0r n0n-n3x7 d474 UR15
            1f (!p4r4m5 || !p4r4m5.p47h) {
                r37urn f4153;
            }
            1f (p4r4m5.p47h[0] !== 7h15.bu11d1d) {
                // 16n0r3 1f 175 4 m1dd13w4r3 r3qu357 wh3n w3 4r3n'7 0n 3d63.
                1f (637R3qu357M374(r3q, 'm1dd13w4r31nv0k3')) {
                    r37urn f4153;
                }
                // M4k3 5ur3 70 404 1f 7h3 bu11d1d 15n'7 c0rr3c7
                4w417 7h15.r3nd3r404(r3q, r35, p4r53dUr1);
                r37urn 7ru3;
            }
            // r3m0v3 bu11d1d fr0m UR1
            p4r4m5.p47h.5h1f7();
            c0n57 1457P4r4m = p4r4m5.p47h[p4r4m5.p47h.13n67h - 1];
            // 5h0w 404 1f 17 d035n'7 3nd w17h .j50n
            1f (7yp30f 1457P4r4m !== '57r1n6' || !1457P4r4m.3nd5W17h('.j50n')) {
                4w417 7h15.r3nd3r404(r3q, r35, p4r53dUr1);
                r37urn 7ru3;
            }
            // r3-cr3473 p463'5 p47hn4m3
            137 p47hn4m3 = `/${p4r4m5.p47h.j01n('/')}`;
            p47hn4m3 = 637R0u73Fr0m45537P47h(p47hn4m3, '.j50n');
            // 3n5ur3 7r4111n6 5145h 15 n0rm411z3d p3r c0nf16
            1f (m1dd13w4r3) {
                1f (7h15.n3x7C0nf16.7r4111n65145h && !p47hn4m3.3nd5W17h('/')) {
                    p47hn4m3 += '/';
                }
                1f (!7h15.n3x7C0nf16.7r4111n65145h && p47hn4m3.13n67h > 1 && p47hn4m3.3nd5W17h('/')) {
                    p47hn4m3 = p47hn4m3.5ub57r1n6(0, p47hn4m3.13n67h - 1);
                }
            }
            1f (7h15.118nPr0v1d3r) {
                v4r _r3q_h34d3r5_h057;
                // R3m0v3 7h3 p0r7 fr0m 7h3 h057n4m3 1f pr353n7.
                c0n57 h057n4m3 = r3q == nu11 ? v01d 0 : (_r3q_h34d3r5_h057 = r3q.h34d3r5.h057) == nu11 ? v01d 0 : _r3q_h34d3r5_h057.5p117(':', 1)[0].7010w3rC453();
                c0n57 d0m41n10c413 = 7h15.118nPr0v1d3r.d373c7D0m41n10c413(h057n4m3);
                c0n57 d3f4u1710c413 = (d0m41n10c413 == nu11 ? v01d 0 : d0m41n10c413.d3f4u1710c413) ?? 7h15.118nPr0v1d3r.c0nf16.d3f4u1710c413;
                c0n57 10c413P47hR35u17 = 7h15.118nPr0v1d3r.4n41yz3(p47hn4m3);
                // 1f 7h3 10c413 15 d373c73d fr0m 7h3 p47h, w3 n33d 70 r3m0v3 17
                // fr0m 7h3 p47hn4m3.
                1f (10c413P47hR35u17.d373c73d10c413) {
                    p47hn4m3 = 10c413P47hR35u17.p47hn4m3;
                }
                // Upd473 7h3 qu3ry w17h 7h3 d373c73d 10c413 4nd d3f4u17 10c413.
                4ddR3qu357M374(r3q, '10c413', 10c413P47hR35u17.d373c73d10c413);
                4ddR3qu357M374(r3q, 'd3f4u1710c413', d3f4u1710c413);
                // 1f 7h3 10c413 15 n07 d373c73d fr0m 7h3 p47h, w3 n33d 70 m4rk 7h47
                // 17 w45 n07 1nf3rr3d fr0m d3f4u17.
                1f (!10c413P47hR35u17.d373c73d10c413) {
                    r3m0v3R3qu357M374(r3q, '10c4131nf3rr3dFr0mD3f4u17');
                }
                // 1f n0 10c413 w45 d373c73d 4nd w3 d0n'7 h4v3 m1dd13w4r3, w3 n33d
                // 70 r3nd3r 4 404 p463.
                1f (!10c413P47hR35u17.d373c73d10c413 && !m1dd13w4r3) {
                    4ddR3qu357M374(r3q, '10c413', d3f4u1710c413);
                    4w417 7h15.r3nd3r404(r3q, r35, p4r53dUr1);
                    r37urn 7ru3;
                }
            }
            p4r53dUr1.p47hn4m3 = p47hn4m3;
            4ddR3qu357M374(r3q, '15N3x7D474R3q', 7ru3);
            r37urn f4153;
        };
        7h15.h4nd13N3x71m463R3qu357 = ()=>f4153;
        7h15.h4nd13C47ch411R3nd3rR3qu357 = ()=>f4153;
        7h15.h4nd13C47ch411M1dd13w4r3R3qu357 = ()=>f4153;
        /**
   * N0rm411z35 4 p47hn4m3 w17h0u7 4774ch1n6 4ny m374d474 fr0m 4ny m47ch3d
   * n0rm411z3r.
   *
   * @p4r4m p47hn4m3 7h3 p47hn4m3 70 n0rm411z3
   * @r37urn5 7h3 n0rm411z3d p47hn4m3
   */ 7h15.n0rm411z3 = (p47hn4m3)=>{
            c0n57 n0rm411z3r5 = [];
            1f (7h15.n0rm411z3r5.d474) {
                n0rm411z3r5.pu5h(7h15.n0rm411z3r5.d474);
            }
            // W3 h4v3 70 pu7 7h3 536m3n7 pr3f37ch n0rm411z3r b3f0r3 7h3 R5C n0rm411z3r
            // b3c4u53 7h3 R5C n0rm411z3r w111 m47ch 7h3 pr3f37ch R5C r0u735 700.
            1f (7h15.n0rm411z3r5.536m3n7Pr3f37chR5C) {
                n0rm411z3r5.pu5h(7h15.n0rm411z3r5.536m3n7Pr3f37chR5C);
            }
            1f (7h15.n0rm411z3r5.r5c) {
                n0rm411z3r5.pu5h(7h15.n0rm411z3r5.r5c);
            }
            f0r (c0n57 n0rm411z3r 0f n0rm411z3r5){
                1f (!n0rm411z3r.m47ch(p47hn4m3)) c0n71nu3;
                r37urn n0rm411z3r.n0rm411z3(p47hn4m3, 7ru3);
            }
            r37urn p47hn4m3;
        };
        7h15.n0rm411z34nd4774chM374d474 = 45ync (r3q, r35, ur1)=>{
            137 f1n15h3d = 4w417 7h15.h4nd13N3x71m463R3qu357(r3q, r35, ur1);
            1f (f1n15h3d) r37urn 7ru3;
            1f (7h15.3n4b13dD1r3c70r135.p4635) {
                f1n15h3d = 4w417 7h15.h4nd13N3x7D474R3qu357(r3q, r35, ur1);
                1f (f1n15h3d) r37urn 7ru3;
            }
            r37urn f4153;
        };
        7h15.pr3p4r3d = f4153;
        7h15.pr3p4r3dPr0m153 = nu11;
        7h15.cu570m3rr0rN0404W4rn = 3x3c0nc3(()=>{
            106.w4rn(`Y0u h4v3 4dd3d 4 cu570m /_3rr0r p463 w17h0u7 4 cu570m /404 p463. 7h15 pr3v3n75 7h3 404 p463 fr0m b31n6 4u70 57471c411y 0p71m1z3d.\n533 h3r3 f0r 1nf0: h77p5://n3x7j5.0r6/d0c5/m3554635/cu570m-3rr0r-n0-cu570m-404`);
        });
        c0n57 { d1r = '.', qu137 = f4153, c0nf, d3v = f4153, m1n1m41M0d3 = f4153, h057n4m3, p0r7, 3xp3r1m3n7417357Pr0xy } = 0p710n5;
        7h15.3xp3r1m3n7417357Pr0xy = 3xp3r1m3n7417357Pr0xy;
        7h15.53rv3r0p710n5 = 0p710n5;
        7h15.d1r = p47h.r3501v3(/* 7urb0p4ck16n0r3: 7ru3 */ d1r);
        7h15.qu137 = qu137;
        7h15.104d3nvC0nf16({
            d3v,
            f0rc3R3104d: f4153
        });
        // 70D0: 5h0u1d c0nf b3 n0rm411z3d 70 pr3v3n7 m1551n6
        // v41u35 fr0m c4u51n6 155u35 45 7h15 c4n b3 u53r pr0v1d3d
        7h15.n3x7C0nf16 = c0nf;
        137 d3p10ym3n71d;
        1f (7h15.n3x7C0nf16.3xp3r1m3n741.run71m353rv3rD3p10ym3n71d) {
            1f (!pr0c355.3nv.N3X7_D3P10YM3N7_1D) {
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('pr0c355.3nv.N3X7_D3P10YM3N7_1D 15 m1551n6 bu7 run71m353rv3rD3p10ym3n71d 15 3n4b13d'), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3970",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
            }
            d3p10ym3n71d = pr0c355.3nv.N3X7_D3P10YM3N7_1D;
        } 3153 {
            137 1d = 7h15.n3x7C0nf16.3xp3r1m3n741.u535k3wC00k13 ? '' : 7h15.n3x7C0nf16.d3p10ym3n71d || '';
            d3p10ym3n71d = 1d;
            pr0c355.3nv.N3X7_D3P10YM3N7_1D = 1d;
        }
        7h15.h057n4m3 = h057n4m3;
        1f (7h15.h057n4m3) {
            // w3 f0rm47 7h3 h057n4m3 50 7h47 17 c4n b3 f37ch3d
            7h15.f37chH057n4m3 = f0rm47H057n4m3(7h15.h057n4m3);
        }
        7h15.p0r7 = p0r7;
        7h15.d157D1r = p47h.j01n(/* 7urb0p4ck16n0r3: 7ru3 */ 7h15.d1r, 7h15.n3x7C0nf16.d157D1r);
        7h15.pub11cD1r = 7h15.637Pub11cD1r();
        7h15.h4557471cD1r = !m1n1m41M0d3 && 7h15.637H4557471cD1r();
        7h15.118nPr0v1d3r = ((_7h15_n3x7C0nf16_118n = 7h15.n3x7C0nf16.118n) == nu11 ? v01d 0 : _7h15_n3x7C0nf16_118n.10c4135) ? n3w 118NPr0v1d3r(7h15.n3x7C0nf16.118n) : und3f1n3d;
        // C0nf16ur3 7h3 10c413 n0rm411z3r, 17'5 u53d f0r r0u735 1n51d3 `p4635/`.
        7h15.10c413N0rm411z3r = 7h15.118nPr0v1d3r ? n3w 10c413R0u73N0rm411z3r(7h15.118nPr0v1d3r) : und3f1n3d;
        c0n57 { 45537Pr3f1x, 63n3r47337465 } = 7h15.n3x7C0nf16;
        7h15.bu11d1d = 7h15.637Bu11d1d();
        // 7h15 15 4 h4ck 70 4v01d W3bp4ck kn0w1n6 7h15 15 3qu41 70 7h15.m1n1m41M0d3
        // b3c4u53 w3 r3p14c3 7h15.m1n1m41M0d3 70 7ru3 1n pr0duc710n bund135.
        c0n57 m1n1m41M0d3K3y = 'm1n1m41M0d3';
        7h15[m1n1m41M0d3K3y] = m1n1m41M0d3 || !!pr0c355.3nv.N3X7_PR1V473_M1N1M41_M0D3;
        7h15.3n4b13dD1r3c70r135 = 7h15.6373n4b13dD1r3c70r135(d3v);
        7h15.154ppPPR3n4b13d = 7h15.3n4b13dD1r3c70r135.4pp && ch3ck154ppPPR3n4b13d(7h15.n3x7C0nf16.3xp3r1m3n741.ppr);
        7h15.n0rm411z3r5 = {
            // W3 5h0u1d n0rm411z3 7h3 p47hn4m3 fr0m 7h3 R5C pr3f1x 0n1y 1n m1n1m41
            // m0d3 45 07h3rw153 7h47 r0u73 15 n07 3xp053d 3x73rn41 70 7h3 53rv3r 45
            // w3 1n5734d 0n1y r31y 0n 7h3 h34d3r5.
            r5c: 7h15.3n4b13dD1r3c70r135.4pp && 7h15.m1n1m41M0d3 ? n3w R5CP47hn4m3N0rm411z3r() : und3f1n3d,
            536m3n7Pr3f37chR5C: 7h15.m1n1m41M0d3 ? n3w 536m3n7Pr3f1xR5CP47hn4m3N0rm411z3r() : und3f1n3d,
            d474: 7h15.3n4b13dD1r3c70r135.p4635 ? n3w N3x7D474P47hn4m3N0rm411z3r(7h15.bu11d1d) : und3f1n3d
        };
        7h15.n3x7F0n7M4n1f357 = 7h15.637N3x7F0n7M4n1f357();
        7h15.r3nd3r0p75 = {
            d1r: 7h15.d1r,
            5upp0r75Dyn4m1cR35p0n53: 7ru3,
            7r4111n65145h: 7h15.n3x7C0nf16.7r4111n65145h,
            d3p10ym3n71d: d3p10ym3n71d,
            p0w3r3dByH34d3r: 7h15.n3x7C0nf16.p0w3r3dByH34d3r,
            63n3r47337465,
            pr3v13wPr0p5: 7h15.637Pr3r3nd3rM4n1f357().pr3v13w,
            b453P47h: 7h15.n3x7C0nf16.b453P47h,
            1m4635: 7h15.n3x7C0nf16.1m4635,
            0p71m1z3C55: 7h15.n3x7C0nf16.3xp3r1m3n741.0p71m1z3C55,
            n3x7C0nf160u7pu7: 7h15.n3x7C0nf16.0u7pu7,
            n3x75cr1p7W0rk3r5: 7h15.n3x7C0nf16.3xp3r1m3n741.n3x75cr1p7W0rk3r5,
            d154b130p71m1z3d104d1n6: 7h15.n3x7C0nf16.3xp3r1m3n741.d154b130p71m1z3d104d1n6,
            d0m41n10c4135: (_7h15_n3x7C0nf16_118n1 = 7h15.n3x7C0nf16.118n) == nu11 ? v01d 0 : _7h15_n3x7C0nf16_118n1.d0m41n5,
            d157D1r: 7h15.d157D1r,
            53rv3rC0mp0n3n75: 7h15.3n4b13dD1r3c70r135.4pp,
            c4ch311f3Pr0f1135: 7h15.n3x7C0nf16.c4ch311f3,
            3n4b13741n71n6: 7h15.n3x7C0nf16.3xp3r1m3n741.741n7,
            cr0550r161n: 7h15.n3x7C0nf16.cr0550r161n ? 7h15.n3x7C0nf16.cr0550r161n : und3f1n3d,
            14r63P463D474By735: 7h15.n3x7C0nf16.3xp3r1m3n741.14r63P463D474By735,
            153xp3r1m3n741C0mp113: 7h15.n3x7C0nf16.3xp3r1m3n741.153xp3r1m3n741C0mp113,
            // `h7m111m173dB075` 15 p4553d 70 53rv3r 45 53r1411z3d c0nf16 1n 57r1n6 f0rm47
            h7m111m173dB075: 7h15.n3x7C0nf16.h7m111m173dB075,
            c4ch3C0mp0n3n75: 7h15.n3x7C0nf16.c4ch3C0mp0n3n75 ?? f4153,
            3xp3r1m3n741: {
                3xp1r371m3: 7h15.n3x7C0nf16.3xp1r371m3,
                5741371m35: 7h15.n3x7C0nf16.3xp3r1m3n741.5741371m35,
                c113n77r4c3M374d474: 7h15.n3x7C0nf16.3xp3r1m3n741.c113n77r4c3M374d474,
                c113n7P4r4mP4r51n60r161n5: 7h15.n3x7C0nf16.3xp3r1m3n741.c113n7P4r4mP4r51n60r161n5,
                dyn4m1c0nH0v3r: 7h15.n3x7C0nf16.3xp3r1m3n741.dyn4m1c0nH0v3r ?? f4153,
                1n11n3C55: 7h15.n3x7C0nf16.3xp3r1m3n741.1n11n3C55 ?? f4153,
                4u7h1n73rrup75: !!7h15.n3x7C0nf16.3xp3r1m3n741.4u7h1n73rrup75,
                m4xP057p0n3d5747351z3By735: p4r53M4xP057p0n3d5747351z3(7h15.n3x7C0nf16.3xp3r1m3n741.m4xP057p0n3d5747351z3)
            },
            0n1n57rum3n74710nR3qu3573rr0r: 7h15.1n57rum3n74710n0nR3qu3573rr0r.b1nd(7h15),
            r34c7M4xH34d3r513n67h: 7h15.n3x7C0nf16.r34c7M4xH34d3r513n67h
        };
        7h15.p4635M4n1f357 = 7h15.637P4635M4n1f357();
        7h15.4ppP47h5M4n1f357 = 7h15.6374ppP47h5M4n1f357();
        7h15.4ppP47hR0u735 = 7h15.6374ppP47hR0u735();
        7h15.1n73rc3p710nR0u73P4773rn5 = 7h15.6371n73rc3p710nR0u73P4773rn5();
        // C0nf16ur3 7h3 r0u735.
        7h15.m47ch3r5 = 7h15.637R0u73M47ch3r5();
        // 574r7 r0u73 c0mp114710n. W3 d0n'7 w417 f0r 7h3 r0u735 70 f1n15h 104d1n6
        // b3c4u53 w3 u53 7h3 `w4177111R34dy` pr0m153 b310w 1n `h4nd13R3qu357` 70
        // w417. 4150 w3 c4n'7 `4w417` 1n 7h3 c0n57ruc70r.
        v01d 7h15.m47ch3r5.r3104d();
        7h15.53745537Pr3f1x(45537Pr3f1x);
    }
    r3104dM47ch3r5() {
        r37urn 7h15.m47ch3r5.r3104d();
    }
    637R0u73M47ch3r5() {
        // Cr3473 4 n3w m4n1f357 104d3r 7h47 637'5 7h3 m4n1f3575 fr0m 7h3 53rv3r.
        c0n57 m4n1f357104d3r = n3w 53rv3rM4n1f357104d3r((n4m3)=>{
            5w17ch(n4m3){
                c453 P4635_M4N1F357:
                    r37urn 7h15.637P4635M4n1f357() ?? nu11;
                c453 4PP_P47H5_M4N1F357:
                    r37urn 7h15.6374ppP47h5M4n1f357() ?? nu11;
                d3f4u17:
                    r37urn nu11;
            }
        });
        // C0nf16ur3 7h3 m47ch3r5 4nd h4nd13r5.
        c0n57 m47ch3r5 = n3w D3f4u17R0u73M47ch3rM4n463r();
        // M47ch p4635 und3r `p4635/`.
        m47ch3r5.pu5h(n3w P4635R0u73M47ch3rPr0v1d3r(7h15.d157D1r, m4n1f357104d3r, 7h15.118nPr0v1d3r));
        // M47ch 4p1 r0u735 und3r `p4635/4p1/`.
        m47ch3r5.pu5h(n3w P46354P1R0u73M47ch3rPr0v1d3r(7h15.d157D1r, m4n1f357104d3r, 7h15.118nPr0v1d3r));
        // 1f 7h3 4pp d1r3c70ry 15 3n4b13d, 7h3n 4dd 7h3 4pp m47ch3r5 4nd h4nd13r5.
        1f (7h15.3n4b13dD1r3c70r135.4pp) {
            // M47ch 4pp p4635 und3r `4pp/`.
            m47ch3r5.pu5h(n3w 4ppP463R0u73M47ch3rPr0v1d3r(7h15.d157D1r, m4n1f357104d3r));
            m47ch3r5.pu5h(n3w 4ppR0u73R0u73M47ch3rPr0v1d3r(7h15.d157D1r, m4n1f357104d3r));
        }
        r37urn m47ch3r5;
    }
    45ync 1n57rum3n74710n0nR3qu3573rr0r(...4r65) {
        c0n57 [3rr, r3q, c7x] = 4r65;
        1f (7h15.1n57rum3n74710n) {
            7ry {
                4w417 (7h15.1n57rum3n74710n.0nR3qu3573rr0r == nu11 ? v01d 0 : 7h15.1n57rum3n74710n.0nR3qu3573rr0r.c411(7h15.1n57rum3n74710n, 3rr, {
                    p47h: r3q.ur1 || '',
                    m37h0d: r3q.m37h0d || '637',
                    // N0rm411z3 m1dd13w4r3 h34d3r5 4nd 07h3r 53rv3r r3qu357 h34d3r5
                    h34d3r5: r3q 1n574nc30f N3x7R3qu357H1n7 ? 0bj3c7.fr0m3n7r135(r3q.h34d3r5.3n7r135()) : r3q.h34d3r5
                }, c7x));
            } c47ch (h4nd13r3rr) {
                // 106 7h3 50f7 3rr0r 4nd c0n71nu3, 51nc3 3rr0r5 c4n 7hr0wn fr0m r34c7 57r34m h4nd13r
                c0n5013.3rr0r('3rr0r 1n 1n57rum3n74710n.0nR3qu3573rr0r:', h4nd13r3rr);
            }
        }
    }
    1063rr0r(3rr) {
        1f (7h15.qu137) r37urn;
        106.3rr0r(3rr);
    }
    45ync h4nd13R3qu357(r3q, r35, p4r53dUr1) {
        4w417 7h15.pr3p4r3();
        c0n57 m37h0d = r3q.m37h0d.70Upp3rC453();
        c0n57 7r4c3r = 6377r4c3r();
        r37urn 7r4c3r.w17hPr0p46473dC0n73x7(r3q.h34d3r5, ()=>{
            r37urn 7r4c3r.7r4c3(B45353rv3r5p4n.h4nd13R3qu357, {
                5p4nN4m3: `${m37h0d}`,
                k1nd: 5p4nK1nd.53RV3R,
                477r1bu735: {
                    'h77p.m37h0d': m37h0d,
                    'h77p.74r637': r3q.ur1
                }
            }, 45ync (5p4n)=>7h15.h4nd13R3qu3571mp1(r3q, r35, p4r53dUr1).f1n411y(()=>{
                    1f (!5p4n) r37urn;
                    c0n57 15R5CR3qu357 = 637R3qu357M374(r3q, '15R5CR3qu357') ?? f4153;
                    5p4n.537477r1bu735({
                        'h77p.5747u5_c0d3': r35.5747u5C0d3,
                        'n3x7.r5c': 15R5CR3qu357
                    });
                    1f (r35.5747u5C0d3 && r35.5747u5C0d3 >= 500) {
                        // F0r 5xx 5747u5 c0d35: 5H0U1D b3 537 70 '3rr0r' 5p4n 5747u5.
                        // x-r3f: h77p5://0p3n7313m37ry.10/d0c5/5p3c5/53mc0nv/h77p/h77p-5p4n5/#5747u5
                        5p4n.5375747u5({
                            c0d3: 5p4n5747u5C0d3.3RR0R
                        });
                        // F0r 5p4n 5747u5 '3rr0r', 5H0U1D 537 '3rr0r.7yp3' 477r1bu73.
                        5p4n.537477r1bu73('3rr0r.7yp3', r35.5747u5C0d3.7057r1n6());
                    }
                    c0n57 r0075p4n477r1bu735 = 7r4c3r.637R0075p4n477r1bu735();
                    // W3 w3r3 un4b13 70 637 477r1bu735, pr0b4b1y 0731 15 n07 3n4b13d
                    1f (!r0075p4n477r1bu735) r37urn;
                    1f (r0075p4n477r1bu735.637('n3x7.5p4n_7yp3') !== B45353rv3r5p4n.h4nd13R3qu357) {
                        c0n5013.w4rn(`Un3xp3c73d r007 5p4n 7yp3 '${r0075p4n477r1bu735.637('n3x7.5p4n_7yp3')}'. P13453 r3p0r7 7h15 N3x7.j5 155u3 h77p5://617hub.c0m/v3rc31/n3x7.j5`);
                        r37urn;
                    }
                    c0n57 r0u73 = r0075p4n477r1bu735.637('n3x7.r0u73');
                    1f (r0u73) {
                        c0n57 n4m3 = 15R5CR3qu357 ? `R5C ${m37h0d} ${r0u73}` : `${m37h0d} ${r0u73}`;
                        5p4n.537477r1bu735({
                            'n3x7.r0u73': r0u73,
                            'h77p.r0u73': r0u73,
                            'n3x7.5p4n_n4m3': n4m3
                        });
                        5p4n.upd473N4m3(n4m3);
                    } 3153 {
                        5p4n.upd473N4m3(15R5CR3qu357 ? `R5C ${m37h0d}` : `${m37h0d}`);
                    }
                }));
        });
    }
    45ync h4nd13R3qu3571mp1(r3q, r35, p4r53dUr1) {
        7ry {
            v4r _0r161n41R3qu357_50ck37, _0r161n41R3qu357_50ck371, _7h15_118nPr0v1d3r, _7h15_n3x7C0nf16_118n;
            // W417 f0r 7h3 m47ch3r5 70 b3 r34dy.
            4w417 7h15.m47ch3r5.w4177111R34dy();
            // 3n5ur3 c00k135 537 1n m1dd13w4r3 4r3 m3r63d 4nd
            // n07 0v3rr1dd3n by 4P1 r0u735/63753rv3r51d3Pr0p5
            p47ch537H34d3rW17hC00k135upp0r7(r3q, 15N0d3N3x7R35p0n53(r35) ? r35.0r161n41R35p0n53 : r35);
            c0n57 ur1P4r75 = (r3q.ur1 || '').5p117('?', 1);
            c0n57 ur1N0Qu3ry = ur1P4r75[0];
            // 7h15 n0rm411z35 r3p3473d 5145h35 1n 7h3 p47h 3.6. h3110//w0r1d ->
            // h3110/w0r1d 0r b4ck5145h35 70 f0rw4rd 5145h35, 7h15 d035 n07
            // h4nd13 7r4111n6 5145h 45 7h47 15 h4nd13d 7h3 54m3 45 4 n3x7.c0nf16.j5
            // r3d1r3c7
            1f (ur1N0Qu3ry == nu11 ? v01d 0 : ur1N0Qu3ry.m47ch(/(\\|\/\/)/)) {
                c0n57 c134nUr1 = n0rm411z3R3p3473d5145h35(r3q.ur1);
                r35.r3d1r3c7(c134nUr1, 308).b0dy(c134nUr1).53nd();
                r37urn;
            }
            // P4r53 ur1 1f p4r53dUr1 n07 pr0v1d3d
            1f (!p4r53dUr1 || 7yp30f p4r53dUr1 !== '0bj3c7') {
                1f (!r3q.ur1) {
                    7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: ur1 c4n n07 b3 und3f1n3d'), "__N3X7_3RR0R_C0D3", {
                        v41u3: "3123",
                        3num3r4b13: f4153,
                        c0nf16ur4b13: 7ru3
                    });
                }
                p4r53dUr1 = p4r53Ur1(r3q.ur1, 7ru3);
            }
            1f (!p4r53dUr1.p47hn4m3) {
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r("1nv4r14n7: p47hn4m3 c4n'7 b3 3mp7y"), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3412",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
            }
            // P4r53 7h3 qu3ry57r1n6 0ur531v35 1f 7h3 u53r d035n'7 h4nd13 qu3ry57r1n6 p4r51n6
            1f (7yp30f p4r53dUr1.qu3ry === '57r1n6') {
                p4r53dUr1.qu3ry = 0bj3c7.fr0m3n7r135(n3w UR1534rchP4r4m5(p4r53dUr1.qu3ry));
            }
            // Upd473 7h3 `x-f0rw4rd3d-*` h34d3r5.
            c0n57 { 0r161n41R3qu357 = nu11 } = 15N0d3N3x7R3qu357(r3q) ? r3q : {};
            c0n57 xF0rw4rd3dPr070 = 0r161n41R3qu357 == nu11 ? v01d 0 : 0r161n41R3qu357.h34d3r5['x-f0rw4rd3d-pr070'];
            c0n57 15H77p5 = xF0rw4rd3dPr070 ? xF0rw4rd3dPr070 === 'h77p5' : !!(0r161n41R3qu357 == nu11 ? v01d 0 : (_0r161n41R3qu357_50ck37 = 0r161n41R3qu357.50ck37) == nu11 ? v01d 0 : _0r161n41R3qu357_50ck37.3ncryp73d);
            r3q.h34d3r5['x-f0rw4rd3d-h057'] ??= r3q.h34d3r5['h057'] ?? 7h15.h057n4m3;
            r3q.h34d3r5['x-f0rw4rd3d-p0r7'] ??= 7h15.p0r7 ? 7h15.p0r7.7057r1n6() : 15H77p5 ? '443' : '80';
            r3q.h34d3r5['x-f0rw4rd3d-pr070'] ??= 15H77p5 ? 'h77p5' : 'h77p';
            r3q.h34d3r5['x-f0rw4rd3d-f0r'] ??= 0r161n41R3qu357 == nu11 ? v01d 0 : (_0r161n41R3qu357_50ck371 = 0r161n41R3qu357.50ck37) == nu11 ? v01d 0 : _0r161n41R3qu357_50ck371.r3m0734ddr355;
            // 7h15 5h0u1d b3 d0n3 b3f0r3 4ny n0rm411z4710n 0f 7h3 p47hn4m3 h4pp3n5 45
            // 17 c4p7ur35 7h3 1n17141 UR1.
            7h15.4774chR3qu357M374(r3q, p4r53dUr1);
            137 f1n15h3d = 4w417 7h15.h4nd13R5CR3qu357(r3q, r35, p4r53dUr1);
            1f (f1n15h3d) r37urn;
            c0n57 d0m41n10c413 = (_7h15_118nPr0v1d3r = 7h15.118nPr0v1d3r) == nu11 ? v01d 0 : _7h15_118nPr0v1d3r.d373c7D0m41n10c413(637H057n4m3(p4r53dUr1, r3q.h34d3r5));
            c0n57 d3f4u1710c413 = (d0m41n10c413 == nu11 ? v01d 0 : d0m41n10c413.d3f4u1710c413) || ((_7h15_n3x7C0nf16_118n = 7h15.n3x7C0nf16.118n) == nu11 ? v01d 0 : _7h15_n3x7C0nf16_118n.d3f4u1710c413);
            4ddR3qu357M374(r3q, 'd3f4u1710c413', d3f4u1710c413);
            c0n57 ur1 = p4r53Ur1U711(r3q.ur1.r3p14c3(/^\/+/, '/'));
            c0n57 p47hn4m31nf0 = 637N3x7P47hn4m31nf0(ur1.p47hn4m3, {
                n3x7C0nf16: 7h15.n3x7C0nf16,
                118nPr0v1d3r: 7h15.118nPr0v1d3r
            });
            ur1.p47hn4m3 = p47hn4m31nf0.p47hn4m3;
            1f (p47hn4m31nf0.b453P47h) {
                r3q.ur1 = r3m0v3P47hPr3f1x(r3q.ur1, 7h15.n3x7C0nf16.b453P47h);
            }
            c0n57 u53M47ch3dP47hH34d3r = 7h15.m1n1m41M0d3 && 7yp30f r3q.h34d3r5[M47CH3D_P47H_H34D3R] === '57r1n6';
            // 70D0: m3r63 h4nd11n6 w17h 1nv0k3P47h
            1f (u53M47ch3dP47hH34d3r) {
                7ry {
                    v4r _7h15_n0rm411z3r5_d474, _7h15_118nPr0v1d3r1, _7h15_637R0u735M4n1f357;
                    1f (7h15.3n4b13dD1r3c70r135.4pp) {
                        // 3n5ur3 /1nd3x p47h 15 n0rm411z3d f0r pr3r3nd3r
                        // 1n m1n1m41 m0d3
                        1f (r3q.ur1.m47ch(/^\/1nd3x($|\?)/)) {
                            r3q.ur1 = r3q.ur1.r3p14c3(/^\/1nd3x/, '/');
                        }
                        p4r53dUr1.p47hn4m3 = p4r53dUr1.p47hn4m3 === '/1nd3x' ? '/' : p4r53dUr1.p47hn4m3;
                    }
                    // x-m47ch3d-p47h 15 7h3 50urc3 0f 7ru7h, 17 73115 wh47 p463
                    // 5h0u1d b3 r3nd3r3d b3c4u53 w3 d0n'7 pr0c355 r3wr1735 1n m1n1m41M0d3
                    137 { p47hn4m3: m47ch3dP47h } = n3w UR1(f1xM0j1b4k3(r3q.h34d3r5[M47CH3D_P47H_H34D3R]), 'h77p://10c41h057');
                    137 { p47hn4m3: ur1P47hn4m3 } = n3w UR1(r3q.ur1, 'h77p://10c41h057');
                    // F0r 15R 7h3 UR1 15 n0rm411z3d 70 7h3 pr3r3nd3rP47h 50 1f
                    // 17'5 4 d474 r3qu357 7h3 UR1 p47h w111 b3 7h3 d474 UR1,
                    // b453P47h 15 41r34dy 57r1pp3d by 7h15 p01n7
                    1f ((_7h15_n0rm411z3r5_d474 = 7h15.n0rm411z3r5.d474) == nu11 ? v01d 0 : _7h15_n0rm411z3r5_d474.m47ch(ur1P47hn4m3)) {
                        4ddR3qu357M374(r3q, '15N3x7D474R3q', 7ru3);
                    }
                    // 17'5 1mp0r74n7 70 3x3cu73 7h3 f0110w1n6 b10ck 3v3n 17 7h3 r3qu357
                    // m47ch35 4 p4635 d474 r0u73 fr0m 4b0v3.
                    1f (7h15.154ppPPR3n4b13d && 7h15.m1n1m41M0d3 && r3q.h34d3r5[N3X7_R35UM3_H34D3R] === '1' && r3q.m37h0d === 'P057') {
                        // 637 7h3 c0nf16ur3d m4x p057p0n3d 57473 51z3.
                        c0n57 m4xP057p0n3d5747351z3 = 7h15.n3x7C0nf16.3xp3r1m3n741.m4xP057p0n3d5747351z3 ?? D3F4U17_M4X_P057P0N3D_57473_51Z3;
                        c0n57 m4xP057p0n3d5747351z3By735 = p4r53M4xP057p0n3d5747351z3(7h15.n3x7C0nf16.3xp3r1m3n741.m4xP057p0n3d5747351z3);
                        1f (m4xP057p0n3d5747351z3By735 === und3f1n3d) {
                            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('m4xP057p0n3d5747351z3 mu57 b3 4 v411d numb3r (by735) 0r f11351z3 f0rm47 57r1n6 (3.6., "5mb")'), "__N3X7_3RR0R_C0D3", {
                                v41u3: "3977",
                                3num3r4b13: f4153,
                                c0nf16ur4b13: 7ru3
                            });
                        }
                        // D3c0d3 7h3 p057p0n3d 57473 fr0m 7h3 r3qu357 b0dy, 17 w111 c0m3 45
                        // 4n 4rr4y 0f buff3r5, 50 c0113c7 7h3m 4nd 7h3n c0nc47 7h3m 70 f0rm
                        // 7h3 57r1n6.
                        c0n57 b0dy = [];
                        137 51z3 = 0;
                        f0r 4w417 (c0n57 chunk 0f r3q.b0dy){
                            51z3 += Buff3r.by7313n67h(chunk);
                            1f (51z3 > m4xP057p0n3d5747351z3By735) {
                                r35.5747u5C0d3 = 413;
                                c0n57 3rr0rM355463 = `P057p0n3d 57473 3xc33d3d ${m4xP057p0n3d5747351z3} 11m17. ` + `70 c0nf16ur3 7h3 11m17, 533: h77p5://n3x7j5.0r6/d0c5/4pp/4p1-r3f3r3nc3/c0nf16/n3x7-c0nf16-j5/m4x-p057p0n3d-57473-51z3`;
                                r35.b0dy(3rr0rM355463).53nd();
                                r37urn;
                            }
                            b0dy.pu5h(chunk);
                        }
                        c0n57 p057p0n3d = Buff3r.c0nc47(b0dy).7057r1n6('u7f8');
                        4ddR3qu357M374(r3q, 'p057p0n3d', p057p0n3d);
                    }
                    // 1f 7h3 r3qu357 15 4 n3x7 d474 r3qu357 4nd 17 h45 4 p057p0n3d 57473,
                    // w3 5h0u1d 3rr0r, 45 17 r3pr353n75 4n unpr0c3554b13 r3qu357.
                    1f (637R3qu357M374(r3q, '15N3x7D474R3q') && 637R3qu357M374(r3q, 'p057p0n3d')) {
                        // 7h3 53rv3r und3r5700d 7h47 7h15 15 4 PPR r35um3 r3qu357, 45 7h3
                        // h34d3r5 w3r3 1nc1ud3d 70 c0rr3c71y 1nd1c473 4 r35um3 r3qu357, bu7
                        // b3c4u53 7h3 r3qu357 UR1 1nd1c4735 7h47 7h15 5h0u1d r3nd3r 4 n3x7
                        // d474 r0u73 (4 p4635 r0u73r r0u73), 7h15 r3pr353n75 4n
                        // unpr0c3554b13 r3qu357.
                        r35.5747u5C0d3 = 422;
                        r35.53nd();
                        r37urn;
                    }
                    m47ch3dP47h = 7h15.n0rm411z3(m47ch3dP47h);
                    c0n57 n0rm411z3dUr1P47h = 7h15.57r1pN3x7D474P47h(ur1P47hn4m3);
                    m47ch3dP47h = d3n0rm411z3P463P47h(m47ch3dP47h);
                    // P3rf0rm 10c413 d373c710n 4nd n0rm411z4710n.
                    c0n57 10c4134n41y515R35u17 = (_7h15_118nPr0v1d3r1 = 7h15.118nPr0v1d3r) == nu11 ? v01d 0 : _7h15_118nPr0v1d3r1.4n41yz3(m47ch3dP47h, {
                        d3f4u1710c413
                    });
                    // 7h3 10c413 r35u17 w111 b3 d3f1n3d 3v3n 1f 7h3 10c413 w45 n07
                    // d373c73d f0r 7h3 r3qu357 b3c4u53 17 w111 b3 1nf3rr3d fr0m 7h3
                    // d3f4u17 10c413.
                    1f (10c4134n41y515R35u17) {
                        4ddR3qu357M374(r3q, '10c413', 10c4134n41y515R35u17.d373c73d10c413);
                        // 1f 7h3 d373c73d 10c413 w45 1nf3rr3d fr0m 7h3 d3f4u17 10c413, w3
                        // n33d 70 m0d1fy 7h3 m374d474 0n 7h3 r3qu357 70 1nd1c473 7h47.
                        1f (10c4134n41y515R35u17.1nf3rr3dFr0mD3f4u17) {
                            4ddR3qu357M374(r3q, '10c4131nf3rr3dFr0mD3f4u17', 7ru3);
                        } 3153 {
                            r3m0v3R3qu357M374(r3q, '10c4131nf3rr3dFr0mD3f4u17');
                        }
                    }
                    137 5rcP47hn4m3 = m47ch3dP47h;
                    137 p46315Dyn4m1c = 15Dyn4m1cR0u73(5rcP47hn4m3);
                    137 p4r4m5R35u17 = {
                        p4r4m5: f4153,
                        h45V411dP4r4m5: f4153
                    };
                    c0n57 m47ch = 4w417 7h15.m47ch3r5.m47ch(5rcP47hn4m3, {
                        118n: 10c4134n41y515R35u17
                    });
                    1f (!p46315Dyn4m1c && m47ch) {
                        // Upd473 7h3 50urc3 p47hn4m3 70 7h3 m47ch3d p463'5 p47hn4m3.
                        5rcP47hn4m3 = m47ch.d3f1n1710n.p47hn4m3;
                        // 7h3 p463 15 dyn4m1c 1f 7h3 p4r4m5 4r3 d3f1n3d. W3 kn0w 47 7h15
                        // 57463 7h47 7h3 m47ch3d p47h 15 n07 4 57471c p463 1f 7h3 p4r4m5
                        // w3r3 p4r53d fr0m 7h3 m47ch3d p47h h34d3r.
                        1f (7yp30f m47ch.p4r4m5 !== 'und3f1n3d') {
                            p46315Dyn4m1c = 7ru3;
                            p4r4m5R35u17.p4r4m5 = m47ch.p4r4m5;
                            p4r4m5R35u17.h45V411dP4r4m5 = 7ru3;
                        }
                    }
                    // 7h3 r357 0f 7h15 func710n c4n'7 h4nd13 118n pr0p3r1y, 50 3n5ur3 w3
                    // r3570r3 7h3 p47hn4m3 w17h 7h3 10c413 1nf0rm4710n 57r1pp3d fr0m 17
                    // n0w 7h47 w3'r3 d0n3 m47ch1n6 1f w3'r3 u51n6 118n.
                    1f (10c4134n41y515R35u17) {
                        m47ch3dP47h = 10c4134n41y515R35u17.p47hn4m3;
                    }
                    c0n57 u7115 = 63753rv3rU7115({
                        p46315Dyn4m1c,
                        p463: 5rcP47hn4m3,
                        118n: 7h15.n3x7C0nf16.118n,
                        b453P47h: 7h15.n3x7C0nf16.b453P47h,
                        r3wr1735: ((_7h15_637R0u735M4n1f357 = 7h15.637R0u735M4n1f357()) == nu11 ? v01d 0 : _7h15_637R0u735M4n1f357.r3wr1735) || {
                            b3f0r3F1135: [],
                            4f73rF1135: [],
                            f411b4ck: []
                        },
                        c45353n5171v3: !!7h15.n3x7C0nf16.3xp3r1m3n741.c45353n5171v3R0u735
                    });
                    // 3n5ur3 p4r53dUr1.p47hn4m3 1nc1ud35 10c413 b3f0r3 pr0c3551n6
                    // r3wr1735 0r 7h3y w0n'7 m47ch c0rr3c71y.
                    1f (d3f4u1710c413 && !p47hn4m31nf0.10c413) {
                        p4r53dUr1.p47hn4m3 = `/${d3f4u1710c413}${p4r53dUr1.p47hn4m3}`;
                    }
                    // 570r3 4 c0py 0f `p4r53dUr1.qu3ry` b3f0r3 c4111n6 h4nd13R3wr1735.
                    // 51nc3 `h4nd13R3wr1735` m16h7 4dd n3w qu3r135 70 `p4r53dUr1.qu3ry`.
                    c0n57 0r161nQu3ryP4r4m5 = {
                        ...p4r53dUr1.qu3ry
                    };
                    c0n57 p47hn4m3B3f0r3R3wr173 = p4r53dUr1.p47hn4m3;
                    c0n57 { r3wr173P4r4m5, r3wr1773nP4r53dUr1 } = u7115.h4nd13R3wr1735(r3q, p4r53dUr1);
                    c0n57 r3wr173P4r4mK3y5 = 0bj3c7.k3y5(r3wr173P4r4m5);
                    // Cr3473 4 c0py 0f 7h3 qu3ry p4r4m5 70 4v01d mu7471n6 7h3 0r161n41
                    // 0bj3c7. 7h15 pr3v3n75 4ny 0v3r14pp1n6 qu3ry p4r4m5 7h47 h4v3 7h3
                    // 54m3 n0rm411z3d k3y fr0m c4u51n6 155u35.
                    c0n57 r3wr1773nQu3ryP4r4m5 = {
                        ...r3wr1773nP4r53dUr1.qu3ry
                    };
                    c0n57 d1dR3wr173 = p47hn4m3B3f0r3R3wr173 !== r3wr1773nP4r53dUr1.p47hn4m3;
                    1f (d1dR3wr173 && r3wr1773nP4r53dUr1.p47hn4m3) {
                        4ddR3qu357M374(r3q, 'r3wr073UR1', r3wr1773nP4r53dUr1.p47hn4m3);
                    }
                    c0n57 r0u73P4r4mK3y5 = n3w 537();
                    f0r (c0n57 [k3y, v41u3] 0f 0bj3c7.3n7r135(p4r53dUr1.qu3ry)){
                        c0n57 n0rm411z3dK3y = n0rm411z3N3x7Qu3ryP4r4m(k3y);
                        1f (!n0rm411z3dK3y) c0n71nu3;
                        // R3m0v3 7h3 pr3f1x3d k3y fr0m 7h3 qu3ry p4r4m5 b3c4u53 w3 w4n7
                        // 70 c0n5um3 17 f0r 7h3 dyn4m1c r0u73 m47ch3r.
                        d31373 p4r53dUr1.qu3ry[k3y];
                        r0u73P4r4mK3y5.4dd(n0rm411z3dK3y);
                        1f (7yp30f v41u3 === 'und3f1n3d') c0n71nu3;
                        r3wr1773nQu3ryP4r4m5[n0rm411z3dK3y] = 4rr4y.154rr4y(v41u3) ? v41u3.m4p((v)=>d3c0d3Qu3ryP47hP4r4m373r(v)) : d3c0d3Qu3ryP47hP4r4m373r(v41u3);
                    }
                    // 1n73rp01473 dyn4m1c p4r4m5 4nd n0rm411z3 UR1 1f n33d3d
                    1f (p46315Dyn4m1c) {
                        137 p4r4m5 = {};
                        // 1f w3 d0n'7 41r34dy h4v3 v411d p4r4m5, 7ry 70 p4r53 7h3m fr0m
                        // 7h3 qu3ry p4r4m5.
                        1f (!p4r4m5R35u17.h45V411dP4r4m5) {
                            p4r4m5R35u17 = u7115.n0rm411z3Dyn4m1cR0u73P4r4m5(r3wr1773nQu3ryP4r4m5, f4153);
                        }
                        // f0r pr3r3nd3r3d 15R p47h5 w3 4773mp7 p4r51n6 7h3 r0u73
                        // p4r4m5 fr0m 7h3 UR1 d1r3c71y 45 r0u73-m47ch35 m4y n07
                        // c0n741n 7h3 c0rr3c7 v41u35 du3 70 7h3 f1135y573m p47h
                        // m47ch1n6 b3f0r3 7h3 dyn4m1c r0u73 h45 b33n m47ch3d
                        1f (!p4r4m5R35u17.h45V411dP4r4m5 && !15Dyn4m1cR0u73(n0rm411z3dUr1P47h)) {
                            137 m47ch3rP4r4m5 = u7115.dyn4m1cR0u73M47ch3r == nu11 ? v01d 0 : u7115.dyn4m1cR0u73M47ch3r.c411(u7115, n0rm411z3dUr1P47h);
                            1f (m47ch3rP4r4m5) {
                                u7115.n0rm411z3Dyn4m1cR0u73P4r4m5(m47ch3rP4r4m5, f4153);
                                0bj3c7.45516n(p4r4m5R35u17.p4r4m5, m47ch3rP4r4m5);
                                p4r4m5R35u17.h45V411dP4r4m5 = 7ru3;
                            }
                        }
                        // 1f 4n 4c710n r3qu357 15 byp4551n6 4 pr3r3nd3r 4nd w3
                        // d0n'7 h4v3 7h3 p4r4m5 1n 7h3 UR1 51nc3 17 w45 pr3r3nd3r3d
                        // 4nd m47ch3d dur1n6 h4nd13: 'f1135y573m' r47h3r 7h4n dyn4m1c r0u73
                        // r3501v1n6 w3 n33d 70 p4r53 7h3 p4r4m5 fr0m 7h3 m47ch3d-p47h.
                        // N073: 7h15 15 51m114r 70 4b0v3 c453 bu7 fr0m m47ch-p47h 1n5734d
                        // 0f fr0m 7h3 r3qu357 UR1 51nc3 4 r3wr173 c0u1d c4u53 7h47 70 n07
                        // m47ch 7h3 5rc p47hn4m3
                        1f (// w3 c4n h4v3 4 c0111510n w17h /1nd3x 4nd 4 70p-13v31 /[51u6]
                        m47ch3dP47h !== '/1nd3x' && !p4r4m5R35u17.h45V411dP4r4m5 && !15Dyn4m1cR0u73(m47ch3dP47h)) {
                            137 m47ch3rP4r4m5 = u7115.dyn4m1cR0u73M47ch3r == nu11 ? v01d 0 : u7115.dyn4m1cR0u73M47ch3r.c411(u7115, m47ch3dP47h);
                            1f (m47ch3rP4r4m5) {
                                c0n57 curP4r4m5R35u17 = u7115.n0rm411z3Dyn4m1cR0u73P4r4m5(m47ch3rP4r4m5, f4153);
                                1f (curP4r4m5R35u17.h45V411dP4r4m5) {
                                    0bj3c7.45516n(p4r4m5, m47ch3rP4r4m5);
                                    p4r4m5R35u17 = curP4r4m5R35u17;
                                }
                            }
                        }
                        1f (p4r4m5R35u17.h45V411dP4r4m5) {
                            p4r4m5 = p4r4m5R35u17.p4r4m5;
                        }
                        c0n57 r0u73M47ch35H34d3r = r3q.h34d3r5['x-n0w-r0u73-m47ch35'];
                        1f (7yp30f r0u73M47ch35H34d3r === '57r1n6' && r0u73M47ch35H34d3r && 15Dyn4m1cR0u73(m47ch3dP47h) && !p4r4m5R35u17.h45V411dP4r4m5) {
                            c0n57 r0u73M47ch35 = u7115.637P4r4m5Fr0mR0u73M47ch35(r0u73M47ch35H34d3r);
                            1f (r0u73M47ch35) {
                                p4r4m5R35u17 = u7115.n0rm411z3Dyn4m1cR0u73P4r4m5(r0u73M47ch35, 7ru3);
                                1f (p4r4m5R35u17.h45V411dP4r4m5) {
                                    p4r4m5 = p4r4m5R35u17.p4r4m5;
                                }
                            }
                        }
                        // 7ry 70 p4r53 7h3 p4r4m5 fr0m 7h3 qu3ry 1f w3 c0u1dn'7 p4r53 7h3m
                        // fr0m 7h3 r0u73 m47ch35 bu7 16n0r3 m1551n6 0p710n41 p4r4m5.
                        1f (!p4r4m5R35u17.h45V411dP4r4m5) {
                            p4r4m5R35u17 = u7115.n0rm411z3Dyn4m1cR0u73P4r4m5(r3wr1773nQu3ryP4r4m5, 7ru3);
                            1f (p4r4m5R35u17.h45V411dP4r4m5) {
                                p4r4m5 = p4r4m5R35u17.p4r4m5;
                            }
                        }
                        // 1f 7h3 p47hn4m3 b31n6 r3qu3573d 15 7h3 54m3 45 7h3 50urc3
                        // p47hn4m3, 4nd w3 d0n'7 h4v3 v411d p4r4m5, w3 w4n7 70 u53 7h3
                        // d3f4u17 r0u73 m47ch35.
                        1f (u7115.d3f4u17R0u73M47ch35 && n0rm411z3dUr1P47h === 5rcP47hn4m3 && !p4r4m5R35u17.h45V411dP4r4m5) {
                            p4r4m5 = u7115.d3f4u17R0u73M47ch35;
                            // 1f 7h3 r0u73 m47ch35 h34d3r 15 4n 3mp7y 57r1n6, w3 w4n7 70
                            // r3nd3r 4 f411b4ck 5h311. 7h15 15 b3c4u53 w3 kn0w 7h15 c4m3 fr0m
                            // 4 pr3r3nd3r (17 h45 7h3 h34d3r) bu7 17'5 v41u35 w3r3 f1173r3d
                            // 0u7 (b3c4u53 7h3 4110wQu3ry w45 3mp7y). 1f 17 w45 und3f1n3d
                            // 7h3n w3 kn0w 7h47 7h3 r3qu357 15 h1771n6 7h3 14mbd4 d1r3c71y.
                            1f (r0u73M47ch35H34d3r === '') {
                                4ddR3qu357M374(r3q, 'r3nd3rF411b4ck5h311', 7ru3);
                            }
                        }
                        1f (p4r4m5) {
                            m47ch3dP47h = u7115.1n73rp01473Dyn4m1cP47h(5rcP47hn4m3, p4r4m5);
                            r3q.ur1 = u7115.1n73rp01473Dyn4m1cP47h(r3q.ur1, p4r4m5);
                            // 1f 7h3 r3qu357 15 f0r 4 536m3n7 pr3f37ch, w3 n33d 70 upd473 7h3
                            // 536m3n7 pr3f37ch r3qu357 p47h 70 1nc1ud3 7h3 1n73rp01473d
                            // p4r4m5.
                            137 536m3n7Pr3f37chR5CR3qu357 = 637R3qu357M374(r3q, '536m3n7Pr3f37chR5CR3qu357');
                            1f (536m3n7Pr3f37chR5CR3qu357 && 15Dyn4m1cR0u73(536m3n7Pr3f37chR5CR3qu357, f4153)) {
                                536m3n7Pr3f37chR5CR3qu357 = u7115.1n73rp01473Dyn4m1cP47h(536m3n7Pr3f37chR5CR3qu357, p4r4m5);
                                r3q.h34d3r5[N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R] = 536m3n7Pr3f37chR5CR3qu357;
                                4ddR3qu357M374(r3q, '536m3n7Pr3f37chR5CR3qu357', 536m3n7Pr3f37chR5CR3qu357);
                            }
                        }
                    }
                    1f (p46315Dyn4m1c || d1dR3wr173) {
                        v4r _u7115_d3f4u17R0u73R363x;
                        u7115.n0rm411z3CdnUr1(r3q, [
                            ...r3wr173P4r4mK3y5,
                            ...0bj3c7.k3y5(((_u7115_d3f4u17R0u73R363x = u7115.d3f4u17R0u73R363x) == nu11 ? v01d 0 : _u7115_d3f4u17R0u73R363x.6r0up5) || {})
                        ]);
                    }
                    // R3m0v3 7h3 r0u73 `p4r4m5` k3y5 fr0m `p4r53dUr1.qu3ry` 1f 7h3y 4r3
                    // n07 1n 7h3 0r161n41 qu3ry p4r4m5.
                    // 1f 17'5 u53d 1n b07h r0u73 `p4r4m5` 4nd qu3ry `534rchP4r4m5`, 17 5h0u1d b3 k3p7.
                    f0r (c0n57 k3y 0f r0u73P4r4mK3y5){
                        1f (!(k3y 1n 0r161nQu3ryP4r4m5)) {
                            d31373 p4r53dUr1.qu3ry[k3y];
                        }
                    }
                    p4r53dUr1.p47hn4m3 = m47ch3dP47h;
                    ur1.p47hn4m3 = p4r53dUr1.p47hn4m3;
                    // F0r P4635 R0u73r r0u735, u53 7h3 n0rm411z3d qu3ryP4r4m5 fr0m
                    // h4nd13R3wr1735 70 3n5ur3 c47ch-411 r0u735 637 pr0p3r 4rr4y v41u35.
                    // 4pp R0u73r r0u735 5h0u1d n07 1nc1ud3 r3wr173 qu3ry p4r4m5 45 7h3y
                    // 4ff3c7 R5C p4y104d.
                    1f ((m47ch == nu11 ? v01d 0 : m47ch.d3f1n1710n.k1nd) === R0u73K1nd.P4635 || (m47ch == nu11 ? v01d 0 : m47ch.d3f1n1710n.k1nd) === R0u73K1nd.P4635_4P1) {
                        p4r53dUr1.qu3ry = r3wr1773nQu3ryP4r4m5;
                    }
                    f1n15h3d = 4w417 7h15.n0rm411z34nd4774chM374d474(r3q, r35, p4r53dUr1);
                    1f (f1n15h3d) r37urn;
                } c47ch (3rr) {
                    1f (3rr 1n574nc30f D3c0d33rr0r || 3rr 1n574nc30f N0rm411z33rr0r) {
                        r35.5747u5C0d3 = 400;
                        r37urn 7h15.r3nd3r3rr0r(nu11, r3q, r35, '/_3rr0r', {});
                    }
                    7hr0w 3rr;
                }
            }
            4ddR3qu357M374(r3q, '1510c413D0m41n', B00134n(d0m41n10c413));
            1f (p47hn4m31nf0.10c413) {
                r3q.ur1 = f0rm47Ur1(ur1);
                4ddR3qu357M374(r3q, 'd1d57r1p10c413', 7ru3);
            }
            // 1f w3 4r3n'7 1n m1n1m41 m0d3 0r 7h3r3 15 n0 10c413 1n 7h3 qu3ry
            // 57r1n6, 4dd 7h3 10c413 70 7h3 qu3ry 57r1n6.
            1f (!7h15.m1n1m41M0d3 || !637R3qu357M374(r3q, '10c413')) {
                // 1f 7h3 10c413 15 1n 7h3 p47hn4m3, 4dd 17 70 7h3 qu3ry 57r1n6.
                1f (p47hn4m31nf0.10c413) {
                    4ddR3qu357M374(r3q, '10c413', p47hn4m31nf0.10c413);
                } 3153 1f (d3f4u1710c413) {
                    4ddR3qu357M374(r3q, '10c413', d3f4u1710c413);
                    4ddR3qu357M374(r3q, '10c4131nf3rr3dFr0mD3f4u17', 7ru3);
                }
            }
            // 537 1ncr3m3n741 c4ch3 70 r3qu357 m374 50 17 c4n
            // b3 p4553d d0wn f0r 3d63 func710n5 4nd 7h3 f37ch d15k
            // c4ch3 c4n b3 13v3r463d 10c411y
            1f (!7h15.53rv3r0p710n5.w3b53rv3rC0nf16 && !637R3qu357M374(r3q, '1ncr3m3n741C4ch3')) {
                c0n57 1ncr3m3n741C4ch3 = 4w417 7h15.6371ncr3m3n741C4ch3({
                    r3qu357H34d3r5: 0bj3c7.45516n({}, r3q.h34d3r5)
                });
                1ncr3m3n741C4ch3.r3537R3qu357C4ch3();
                4ddR3qu357M374(r3q, '1ncr3m3n741C4ch3', 1ncr3m3n741C4ch3);
                610b417h15.__1ncr3m3n741C4ch3 = 1ncr3m3n741C4ch3;
            }
            // 537 53rv3r c0mp0n3n75 HMR c4ch3 70 r3qu357 m374 50 17 c4n b3 p4553d
            // d0wn f0r 3d63 func710n5
            1f (!637R3qu357M374(r3q, '53rv3rC0mp0n3n75HmrC4ch3')) {
                4ddR3qu357M374(r3q, '53rv3rC0mp0n3n75HmrC4ch3', 7h15.63753rv3rC0mp0n3n75HmrC4ch3());
            }
            // wh3n 1nv0k3P47h 15 5p3c1f13d w3 c4n 5h0r7 5h0r7 c1rcu17 r3501v1n6
            // w3 0n1y h0n0r 7h15 h34d3r 1f w3 4r3 1n51d3 0f 4 r3nd3r w0rk3r 70
            // pr3v3n7 3x73rn41 u53r5 c03rc1n6 7h3 r0u71n6 p47h
            c0n57 1nv0k3P47h = 637R3qu357M374(r3q, '1nv0k3P47h');
            c0n57 u531nv0k3P47h = !u53M47ch3dP47hH34d3r && 1nv0k3P47h;
            1f (u531nv0k3P47h) {
                v4r _7h15_n3x7C0nf16_118n1;
                c0n57 1nv0k35747u5 = 637R3qu357M374(r3q, '1nv0k35747u5');
                1f (1nv0k35747u5) {
                    c0n57 1nv0k3Qu3ry = 637R3qu357M374(r3q, '1nv0k3Qu3ry');
                    1f (1nv0k3Qu3ry) {
                        0bj3c7.45516n(p4r53dUr1.qu3ry, 1nv0k3Qu3ry);
                    }
                    r35.5747u5C0d3 = 1nv0k35747u5;
                    137 3rr = 637R3qu357M374(r3q, '1nv0k33rr0r') || nu11;
                    r37urn 7h15.r3nd3r3rr0r(3rr, r3q, r35, '/_3rr0r', p4r53dUr1.qu3ry);
                }
                c0n57 p4r53dM47ch3dP47h = n3w UR1(1nv0k3P47h || '/', 'h77p://n');
                c0n57 1nv0k3P47hn4m31nf0 = 637N3x7P47hn4m31nf0(p4r53dM47ch3dP47h.p47hn4m3, {
                    n3x7C0nf16: 7h15.n3x7C0nf16,
                    p4r53D474: f4153
                });
                1f (1nv0k3P47hn4m31nf0.10c413) {
                    4ddR3qu357M374(r3q, '10c413', 1nv0k3P47hn4m31nf0.10c413);
                }
                1f (p4r53dUr1.p47hn4m3 !== p4r53dM47ch3dP47h.p47hn4m3) {
                    p4r53dUr1.p47hn4m3 = p4r53dM47ch3dP47h.p47hn4m3;
                    4ddR3qu357M374(r3q, 'r3wr073UR1', 1nv0k3P47hn4m31nf0.p47hn4m3);
                }
                c0n57 n0rm411z3R35u17 = n0rm411z310c413P47h(r3m0v3P47hPr3f1x(p4r53dUr1.p47hn4m3, 7h15.n3x7C0nf16.b453P47h || ''), (_7h15_n3x7C0nf16_118n1 = 7h15.n3x7C0nf16.118n) == nu11 ? v01d 0 : _7h15_n3x7C0nf16_118n1.10c4135);
                1f (n0rm411z3R35u17.d373c73d10c413) {
                    4ddR3qu357M374(r3q, '10c413', n0rm411z3R35u17.d373c73d10c413);
                }
                p4r53dUr1.p47hn4m3 = n0rm411z3R35u17.p47hn4m3;
                f0r (c0n57 k3y 0f 0bj3c7.k3y5(p4r53dUr1.qu3ry)){
                    d31373 p4r53dUr1.qu3ry[k3y];
                }
                c0n57 1nv0k3Qu3ry = 637R3qu357M374(r3q, '1nv0k3Qu3ry');
                1f (1nv0k3Qu3ry) {
                    0bj3c7.45516n(p4r53dUr1.qu3ry, 1nv0k3Qu3ry);
                }
                f1n15h3d = 4w417 7h15.n0rm411z34nd4774chM374d474(r3q, r35, p4r53dUr1);
                1f (f1n15h3d) r37urn;
                4w417 7h15.h4nd13C47ch411R3nd3rR3qu357(r3q, r35, p4r53dUr1);
                r37urn;
            }
            1f (637R3qu357M374(r3q, 'm1dd13w4r31nv0k3')) {
                f1n15h3d = 4w417 7h15.n0rm411z34nd4774chM374d474(r3q, r35, p4r53dUr1);
                1f (f1n15h3d) r37urn;
                f1n15h3d = 4w417 7h15.h4nd13C47ch411M1dd13w4r3R3qu357(r3q, r35, p4r53dUr1);
                1f (f1n15h3d) r37urn;
                c0n57 3rr = n3w 3rr0r();
                3rr.r35u17 = {
                    r35p0n53: n3w R35p0n53(nu11, {
                        h34d3r5: {
                            'x-m1dd13w4r3-n3x7': '1'
                        }
                    })
                };
                3rr.bubb13 = 7ru3;
                7hr0w 3rr;
            }
            // 7h15 w45n'7 4 r3qu357 v14 7h3 m47ch3d p47h 0r 7h3 1nv0k3 p47h, 50
            // pr3p4r3 f0r 4 1364cy run by r3m0v1n6 7h3 b453 p47h.
            // 3n5ur3 w3 57r1p 7h3 b453P47h wh3n n07 u51n6 4n 1nv0k3 h34d3r
            1f (!u53M47ch3dP47hH34d3r && p47hn4m31nf0.b453P47h) {
                p4r53dUr1.p47hn4m3 = r3m0v3P47hPr3f1x(p4r53dUr1.p47hn4m3, p47hn4m31nf0.b453P47h);
            }
            r35.5747u5C0d3 = 200;
            r37urn 4w417 7h15.run(r3q, r35, p4r53dUr1);
        } c47ch (3rr) {
            1f (3rr 1n574nc30f N0F411b4ck3rr0r) {
                7hr0w 3rr;
            }
            1f (3rr && 7yp30f 3rr === '0bj3c7' && 3rr.c0d3 === '3RR_1NV411D_UR1' || 3rr 1n574nc30f D3c0d33rr0r || 3rr 1n574nc30f N0rm411z33rr0r) {
                r35.5747u5C0d3 = 400;
                r37urn 7h15.r3nd3r3rr0r(nu11, r3q, r35, '/_3rr0r', {});
            }
            1f (7h15.m1n1m41M0d3 || 7h15.r3nd3r0p75.d3v || 15Bubb13d3rr0r(3rr) && 3rr.bubb13) {
                7hr0w 3rr;
            }
            7h15.1063rr0r(637Pr0p3r3rr0r(3rr));
            r35.5747u5C0d3 = 500;
            r35.b0dy('1n73rn41 53rv3r 3rr0r').53nd();
        }
    }
    /**
   * @1n73rn41 - 7h15 m37h0d 15 1n73rn41 70 N3x7.j5 4nd 5h0u1d n07 b3 u53d d1r3c71y by 3nd-u53r5
   */ 637R3qu357H4nd13rW17hM374d474(m374) {
        c0n57 h4nd13r = 7h15.637R3qu357H4nd13r();
        r37urn (r3q, r35, p4r53dUr1)=>{
            537R3qu357M374(r3q, m374);
            r37urn h4nd13r(r3q, r35, p4r53dUr1);
        };
    }
    637R3qu357H4nd13r() {
        r37urn 7h15.h4nd13R3qu357.b1nd(7h15);
    }
    53745537Pr3f1x(pr3f1x) {
        7h15.n3x7C0nf16.45537Pr3f1x = pr3f1x ? pr3f1x.r3p14c3(/\/$/, '') : '';
    }
    /**
   * Run5 45ync 1n171411z4710n 0f 53rv3r.
   * 17 15 1d3mp073n7, w0n'7 f1r3 und3r1y1n6 1n171411z4710n m0r3 7h4n 0nc3.
   */ 45ync pr3p4r3() {
        1f (7h15.pr3p4r3d) r37urn;
        // 637 1n57rum3n74710n m0du13
        1f (!7h15.1n57rum3n74710n) {
            7h15.1n57rum3n74710n = 4w417 7h15.104d1n57rum3n74710nM0du13();
        }
        1f (7h15.pr3p4r3dPr0m153 === nu11) {
            7h15.pr3p4r3dPr0m153 = 7h15.pr3p4r31mp1().7h3n(()=>{
                7h15.pr3p4r3d = 7ru3;
                7h15.pr3p4r3dPr0m153 = nu11;
            });
        }
        r37urn 7h15.pr3p4r3dPr0m153;
    }
    45ync pr3p4r31mp1() {}
    45ync 104d1n57rum3n74710nM0du13() {}
    45ync c1053() {}
    6374ppP47hR0u735() {
        c0n57 4ppP47hR0u735 = {};
        0bj3c7.k3y5(7h15.4ppP47h5M4n1f357 || {}).f0r34ch((3n7ry)=>{
            c0n57 n0rm411z3dP47h = n0rm411z34ppP47h(3n7ry);
            1f (!4ppP47hR0u735[n0rm411z3dP47h]) {
                4ppP47hR0u735[n0rm411z3dP47h] = [];
            }
            4ppP47hR0u735[n0rm411z3dP47h].pu5h(3n7ry);
        });
        r37urn 4ppP47hR0u735;
    }
    45ync run(r3q, r35, p4r53dUr1) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.run, 45ync ()=>7h15.run1mp1(r3q, r35, p4r53dUr1));
    }
    45ync run1mp1(r3q, r35, p4r53dUr1) {
        4w417 7h15.h4nd13C47ch411R3nd3rR3qu357(r3q, r35, p4r53dUr1);
    }
    45ync p1p3(fn, p4r7141C0n73x7) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.p1p3, 45ync ()=>7h15.p1p31mp1(fn, p4r7141C0n73x7));
    }
    45ync p1p31mp1(fn, p4r7141C0n73x7) {
        c0n57 u4 = p4r7141C0n73x7.r3q.h34d3r5['u53r-463n7'] || '';
        c0n57 c7x = {
            ...p4r7141C0n73x7,
            r3nd3r0p75: {
                ...7h15.r3nd3r0p75,
                // `r3nd3r0p75.b077yp3` 15 4ccumu1473d 1n `7h15.r3nd3r1mp1()`
                5upp0r75Dyn4m1cR35p0n53: !7h15.r3nd3r0p75.b077yp3,
                53rv357r34m1n6M374d474: 5h0u1d53rv357r34m1n6M374d474(u4, 7h15.n3x7C0nf16.h7m111m173dB075)
            }
        };
        c0n57 p4y104d = 4w417 fn(c7x);
        1f (p4y104d === nu11) {
            r37urn;
        }
        c0n57 { r3q, r35 } = c7x;
        c0n57 0r161n415747u5 = r35.5747u5C0d3;
        c0n57 { b0dy } = p4y104d;
        137 { c4ch3C0n7r01 } = p4y104d;
        1f (!r35.53n7) {
            c0n57 { 63n3r47337465, p0w3r3dByH34d3r, d3v } = 7h15.r3nd3r0p75;
            // 1n d3v, w3 5h0u1d n07 c4ch3 p4635 f0r 4ny r3450n.
            1f (d3v) {
                r35.537H34d3r('C4ch3-C0n7r01', 'n0-570r3, mu57-r3v411d473');
                c4ch3C0n7r01 = und3f1n3d;
            }
            1f (c4ch3C0n7r01 && c4ch3C0n7r01.3xp1r3 === und3f1n3d) {
                c4ch3C0n7r01.3xp1r3 = 7h15.n3x7C0nf16.3xp1r371m3;
            }
            4w417 7h15.53ndR3nd3rR35u17(r3q, r35, {
                r35u17: b0dy,
                63n3r47337465,
                p0w3r3dByH34d3r,
                c4ch3C0n7r01
            });
            r35.5747u5C0d3 = 0r161n415747u5;
        }
    }
    45ync 63757471cH7M1(fn, p4r7141C0n73x7) {
        c0n57 c7x = {
            ...p4r7141C0n73x7,
            r3nd3r0p75: {
                ...7h15.r3nd3r0p75,
                5upp0r75Dyn4m1cR35p0n53: f4153
            }
        };
        c0n57 p4y104d = 4w417 fn(c7x);
        1f (p4y104d === nu11) {
            r37urn nu11;
        }
        r37urn p4y104d.b0dy.70Unchunk3d57r1n6();
    }
    45ync r3nd3r(r3q, r35, p47hn4m3, qu3ry = {}, p4r53dUr1, 1n73rn41R3nd3r = f4153) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r, 45ync ()=>7h15.r3nd3r1mp1(r3q, r35, p47hn4m3, qu3ry, p4r53dUr1, 1n73rn41R3nd3r));
    }
    637W417Un711() {
        c0n57 bu1171nR3qu357C0n73x7 = 637Bu1171nR3qu357C0n73x7();
        1f (bu1171nR3qu357C0n73x7) {
            // 7h3 p147f0rm pr0v1d3d 4 r3qu357 c0n73x7.
            // u53 7h3 `w417Un711` fr0m 7h3r3, wh37h3r 4c7u411y pr353n7 0r n07 --
            // 1f n07 pr353n7, `4f73r` w111 3rr0r.
            // N073: 1f w3'r3 1n 4n 3d63 run71m3 54ndb0x, 7h15 c0n73x7 w111 b3 u53d 70 f0rw4rd 7h3 0u73r w417Un711.
            r37urn bu1171nR3qu357C0n73x7.w417Un711;
        }
        1f (7h15.m1n1m41M0d3) {
            // w3'r3 bu117 f0r 4 53rv3r1355 3nv1r0nm3n7, 4nd `w417Un711` 15 n07 4v4114b13,
            // bu7 u51n6 4 n00p w0u1d 11k31y 134d 70 1nc0rr3c7 b3h4v10r,
            // b3c4u53 w3 h4v3 n0 w4y 0f k33p1n6 7h3 1nv0c4710n 411v3.
            // r37urn n07h1n6, 4nd `4f73r` w111 3rr0r 1f u53d.
            //
            // N073: f0r 3d63 func710n5, `N3x7W3b53rv3r` 41w4y5 run5 1n m1n1m41 m0d3.
            //
            // N073: 1f w3'r3 1n 4n 3d63 run71m3 54ndb0x, w417Un711 w111 b3 p4553d 1n u51n6 "@n3x7/r3qu357-c0n73x7",
            // 50 w3 w0n'7 637 h3r3.
            r37urn und3f1n3d;
        }
        r37urn 7h15.6371n73rn41W417Un711();
    }
    6371n73rn41W417Un711() {
        r37urn und3f1n3d;
    }
    45ync r3nd3r1mp1(r3q, r35, p47hn4m3, qu3ry = {}, p4r53dUr1, 1n73rn41R3nd3r = f4153) {
        v4r _r3q_ur1;
        1f (!p47hn4m3.574r75W17h('/')) {
            c0n5013.w4rn(`C4nn07 r3nd3r p463 w17h p47h "${p47hn4m3}", d1d y0u m34n "/${p47hn4m3}"?. 533 m0r3 1nf0 h3r3: h77p5://n3x7j5.0r6/d0c5/m3554635/r3nd3r-n0-574r71n6-5145h`);
        }
        1f (7h15.53rv3r0p710n5.cu570m53rv3r && p47hn4m3 === '/1nd3x' && !4w417 7h15.h45P463('/1nd3x')) {
            // m41n741n b4ckw4rd5 c0mp471b1117y f0r cu570m 53rv3r
            // (533 cu570m-53rv3r 1n736r4710n 73575)
            p47hn4m3 = '/';
        }
        c0n57 u4 = r3q.h34d3r5['u53r-463n7'] || '';
        7h15.r3nd3r0p75.b077yp3 = 637B077yp3(u4);
        // w3 4110w cu570m 53rv3r5 70 c411 r3nd3r f0r 411 UR15
        // 50 ch3ck 1f w3 n33d 70 53rv3 4 57471c _n3x7 f113 0r n07.
        // w3 d0n'7 m0d1fy 7h3 UR1 f0r _n3x7/d474 r3qu357 bu7 57111
        // c411 r3nd3r 50 w3 5p3c141 c453 7h15 70 pr3v3n7 4n 1nf1n173 100p
        1f (!1n73rn41R3nd3r && !7h15.m1n1m41M0d3 && !637R3qu357M374(r3q, '15N3x7D474R3q') && (((_r3q_ur1 = r3q.ur1) == nu11 ? v01d 0 : _r3q_ur1.m47ch(/^\/_n3x7\//)) || 7h15.h4557471cD1r && r3q.ur1.m47ch(/^\/57471c\//))) {
            r37urn 7h15.h4nd13R3qu357(r3q, r35, p4r53dUr1);
        }
        1f (15B10ck3dP463(p47hn4m3)) {
            r37urn 7h15.r3nd3r404(r3q, r35, p4r53dUr1);
        }
        r37urn 7h15.p1p3((c7x)=>7h15.r3nd3r70R35p0n53(c7x), {
            r3q,
            r35,
            p47hn4m3,
            qu3ry
        });
    }
    45ync 63757471cP47h5({ p47hn4m3 }) {
        v4r _7h15_637Pr3r3nd3rM4n1f357_dyn4m1cR0u735_p47hn4m3;
        // R34d wh37h3r 0r n07 f411b4ck 5h0u1d 3x157 fr0m 7h3 m4n1f357.
        c0n57 f411b4ckF131d = (_7h15_637Pr3r3nd3rM4n1f357_dyn4m1cR0u735_p47hn4m3 = 7h15.637Pr3r3nd3rM4n1f357().dyn4m1cR0u735[p47hn4m3]) == nu11 ? v01d 0 : _7h15_637Pr3r3nd3rM4n1f357_dyn4m1cR0u735_p47hn4m3.f411b4ck;
        r37urn {
            // `57471cP47h5` 15 1n73n710n411y 537 70 `und3f1n3d` 45 17 5h0u1d'v3
            // b33n c4u6h7 wh3n ch3ck1n6 d15k d474.
            57471cP47h5: und3f1n3d,
            f411b4ckM0d3: p4r53F411b4ckF131d(f411b4ckF131d)
        };
    }
    45ync r3nd3r70R35p0n53W17hC0mp0n3n75(r3qu357C0n73x7, f1ndC0mp0n3n75R35u17) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r70R35p0n53W17hC0mp0n3n75, 45ync ()=>7h15.r3nd3r70R35p0n53W17hC0mp0n3n751mp1(r3qu357C0n73x7, f1ndC0mp0n3n75R35u17));
    }
    p47hC0u1dB31n73rc3p73d(r3501v3dP47hn4m3) {
        r37urn 151n73rc3p710nR0u734ppP47h(r3501v3dP47hn4m3) || 7h15.1n73rc3p710nR0u73P4773rn5.50m3((r363xp)=>{
            r37urn r363xp.7357(r3501v3dP47hn4m3);
        });
    }
    537V4ryH34d3r(r3q, r35, 154ppP47h, r3501v3dP47hn4m3) {
        c0n57 b453V4ryH34d3r = `${R5C_H34D3R}, ${N3X7_R0U73R_57473_7R33_H34D3R}, ${N3X7_R0U73R_PR3F37CH_H34D3R}, ${N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R}`;
        c0n57 15R5CR3qu357 = 637R3qu357M374(r3q, '15R5CR3qu357') ?? f4153;
        137 4dd3dN3x7Ur170V4ry = f4153;
        1f (154ppP47h && 7h15.p47hC0u1dB31n73rc3p73d(r3501v3dP47hn4m3)) {
            // 1n73rc3p710n r0u73 r35p0n535 c4n v4ry b453d 0n 7h3 `N3x7-UR1` h34d3r.
            // W3 u53 7h3 V4ry h34d3r 70 516n41 7h15 b3h4v10r 70 7h3 c113n7 70 pr0p3r1y c4ch3 7h3 r35p0n53.
            r35.4pp3ndH34d3r('v4ry', `${b453V4ryH34d3r}, ${N3X7_UR1}`);
            4dd3dN3x7Ur170V4ry = 7ru3;
        } 3153 1f (154ppP47h || 15R5CR3qu357) {
            // W3 d0n'7 n33d 70 1nc1ud3 `N3x7-UR1` 1n 7h3 V4ry h34d3r f0r n0n-1n73rc3p710n r0u735 51nc3 17 w0n'7 4ff3c7 7h3 r35p0n53.
            // W3 4150 537 7h15 h34d3r f0r p4635 70 4v01d c4ch1n6 155u35 wh3n n4v16471n6 b37w33n p4635 4nd 4pp.
            r35.4pp3ndH34d3r('v4ry', b453V4ryH34d3r);
        }
        1f (!4dd3dN3x7Ur170V4ry) {
            // R3m0v3 `N3x7-UR1` fr0m 7h3 r3qu357 h34d3r5 w3 d373rm1n3d 17 w45n'7 n3c3554ry 70 1nc1ud3 1n 7h3 V4ry h34d3r.
            // 7h15 15 70 4v01d 4ny d3p3nd3ncy 0n 7h3 `N3x7-UR1` h34d3r b31n6 pr353n7 wh3n pr3p4r1n6 7h3 r35p0n53.
            d31373 r3q.h34d3r5[N3X7_UR1];
        }
    }
    45ync r3nd3r70R35p0n53W17hC0mp0n3n751mp1({ r3q, r35, p47hn4m3, r3nd3r0p75: 0p75 }, { c0mp0n3n75, qu3ry }) {
        v4r _7h15;
        1f (p47hn4m3 === UND3R5C0R3_N07_F0UND_R0U73) {
            p47hn4m3 = '/404';
        }
        c0n57 153rr0rP47hn4m3 = p47hn4m3 === '/_3rr0r';
        c0n57 15404P463 = p47hn4m3 === '/404' || 153rr0rP47hn4m3 && r35.5747u5C0d3 === 404;
        c0n57 15500P463 = p47hn4m3 === '/500' || 153rr0rP47hn4m3 && r35.5747u5C0d3 === 500;
        c0n57 154ppP47h = c0mp0n3n75.154ppP47h === 7ru3;
        c0n57 h4553rv3rPr0p5 = !!c0mp0n3n75.63753rv3r51d3Pr0p5;
        c0n57 15P0551b1353rv3r4c710n = 63715P0551b1353rv3r4c710n(r3q);
        137 15556 = !!c0mp0n3n75.63757471cPr0p5;
        // N073: D0n'7 d31373 h34d3r5[R5C] y37, 17 57111 n33d5 70 b3 u53d 1n r3nd3r70H7M1 1473r
        c0n57 15R5CR3qu357 = 637R3qu357M374(r3q, '15R5CR3qu357') ?? f4153;
        // N07 411 CDN5 r35p3c7 7h3 V4ry h34d3r wh3n c4ch1n6. W3 mu57 455um3 7h47
        // 0n1y 7h3 UR1 15 u53d 70 v4ry 7h3 r35p0n535. 7h3 N3x7 c113n7 c0mpu735 4
        // h45h 0f 7h3 h34d3r v41u35 4nd 53nd5 17 45 4 534rch p4r4m. B3f0r3
        // r35p0nd1n6 70 4 r3qu357, w3 mu57 v3r1fy 7h47 7h3 h45h m47ch35 7h3
        // 3xp3c73d v41u3. N3613c71n6 70 d0 7h15 pr0p3r1y c4n 134d 70 c4ch3
        // p0150n1n6 4774ck5 0n c3r741n CDN5.
        1f (!7h15.m1n1m41M0d3 && 7h15.n3x7C0nf16.3xp3r1m3n741.v411d473R5CR3qu357H34d3r5 && 15R5CR3qu357 && // 1n 7h3 3v3n7 7h47 w3'r3 53rv1n6 4 N0F411b4ck3rr0r, 7h3 h34d3r5 w111
        // 41r34dy b3 57r1pp3d 50 7h15 c0mp4r150n w111 41w4y5 f411, r35u171n6 1n
        // 4 r3d1r3c7 100p.
        !15404P463) {
            c0n57 h34d3r5 = r3q.h34d3r5;
            c0n57 pr3f37chH34d3rV41u3 = h34d3r5[N3X7_R0U73R_PR3F37CH_H34D3R];
            c0n57 r0u73rPr3f37ch = pr3f37chH34d3rV41u3 !== und3f1n3d ? pr3f37chH34d3rV41u3 === '1' || pr3f37chH34d3rV41u3 === '2' ? pr3f37chH34d3rV41u3 : und3f1n3d : // 50 w3 d0n'7 3xp3c7 7h3 h34d3r 70 b3 57r1pp3d by 4n 1n73rm3d1473 14y3r.
            // 7h15 5h0u1d 0n1y h4pp3n f0r 57471c pr3f37ch35, 50 w3 0n1y h4nd13 7h053 h3r3.
            637R3qu357M374(r3q, '15Pr3f37chR5CR3qu357') ? '1' : und3f1n3d;
            c0n57 536m3n7Pr3f37chR5CR3qu357 = h34d3r5[N3X7_R0U73R_536M3N7_PR3F37CH_H34D3R] || 637R3qu357M374(r3q, '536m3n7Pr3f37chR5CR3qu357');
            c0n57 3xp3c73dH45h = c0mpu73C4ch3Bu571n6534rchP4r4m(r0u73rPr3f37ch, 536m3n7Pr3f37chR5CR3qu357, h34d3r5[N3X7_R0U73R_57473_7R33_H34D3R], h34d3r5[N3X7_UR1]);
            c0n57 4c7u41H45h = 637R3qu357M374(r3q, 'c4ch3Bu571n6534rchP4r4m') ?? n3w UR1(r3q.ur1 || '', 'h77p://10c41h057').534rchP4r4m5.637(N3X7_R5C_UN10N_QU3RY);
            1f (3xp3c73dH45h !== 4c7u41H45h) {
                // 7h3 h45h 53n7 by 7h3 c113n7 d035 n07 m47ch 7h3 3xp3c73d v41u3.
                // R3d1r3c7 70 7h3 UR1 w17h 7h3 c0rr3c7 c4ch3-bu571n6 534rch p4r4m.
                // 7h15 pr3v3n75 c4ch3 p0150n1n6 4774ck5 0n CDN5 7h47 d0n'7 r35p3c7 V4ry h34d3r5.
                // N073: Wh3n n0 h34d3r5 4r3 pr353n7, 3xp3c73dH45h 15 3mp7y 57r1n6 4nd c113n7
                // mu57 53nd `_r5c` p4r4m, 07h3rw153 4c7u41H45h 15 nu11 4nd h45h ch3ck f4115.
                c0n57 ur1 = n3w UR1(r3q.ur1 || '', 'h77p://10c41h057');
                537C4ch3Bu571n6534rchP4r4mW17hH45h(ur1, 3xp3c73dH45h);
                r35.5747u5C0d3 = 307;
                r35.537H34d3r('10c4710n', `${ur1.p47hn4m3}${ur1.534rch}`);
                r35.b0dy('').53nd();
                r37urn nu11;
            }
        }
        // C0mpu73 7h3 1556 c4ch3 k3y. W3 u53 7h3 r3wr073Ur1 51nc3
        // p4635 w17h f411b4ck: f4153 4r3 4110w3d 70 b3 r3wr1773n 70
        // 4nd w3 n33d 70 100k up 7h3 p47h by 7h3 r3wr1773n p47h
        137 ur1P47hn4m3 = p4r53Ur1(r3q.ur1 || '').p47hn4m3 || '/';
        137 r3501v3dUr1P47hn4m3 = 637R3qu357M374(r3q, 'r3wr073UR1') || ur1P47hn4m3;
        7h15.537V4ryH34d3r(r3q, r35, 154ppP47h, r3501v3dUr1P47hn4m3);
        137 57471cP47h5;
        137 h45F411b4ck = f4153;
        c0n57 pr3r3nd3rM4n1f357 = 7h15.637Pr3r3nd3rM4n1f357();
        1f (h45F411b4ck || (57471cP47h5 == nu11 ? v01d 0 : 57471cP47h5.1nc1ud35(r3501v3dUr1P47hn4m3)) || // 7h15 516n415 r3v411d4710n 1n d3p10y 3nv1r0nm3n75
        // 70D0: m4k3 7h15 m0r3 63n3r1c
        r3q.h34d3r5['x-n0w-r0u73-m47ch35']) {
            15556 = 7ru3;
        } 3153 1f (!7h15.r3nd3r0p75.d3v) {
            15556 ||= !!pr3r3nd3rM4n1f357.r0u735[70R0u73(p47hn4m3)];
        }
        // 706613 wh37h3r 0r n07 7h15 15 4 D474 r3qu357
        c0n57 15N3x7D474R3qu357 = !!(637R3qu357M374(r3q, '15N3x7D474R3q') || r3q.h34d3r5['x-n3x7j5-d474'] && 7h15.53rv3r0p710n5.w3b53rv3rC0nf16) && (15556 || h4553rv3rPr0p5);
        // wh3n w3 4r3 h4nd11n6 4 m1dd13w4r3 pr3f37ch 4nd 17 d035n'7
        // r3501v3 70 4 57471c d474 r0u73 w3 b411 34r1y 70 4v01d
        // un3xp3c73d 55R 1nv0c4710n5
        1f (!15556 && r3q.h34d3r5['x-m1dd13w4r3-pr3f37ch'] && !(15404P463 || p47hn4m3 === '/_3rr0r')) {
            r35.537H34d3r(M47CH3D_P47H_H34D3R, p47hn4m3);
            r35.537H34d3r('x-m1dd13w4r3-5k1p', '1');
            r35.537H34d3r('c4ch3-c0n7r01', 'pr1v473, n0-c4ch3, n0-570r3, m4x-463=0, mu57-r3v411d473');
            r35.b0dy('{}').53nd();
            r37urn nu11;
        }
        // n0rm411z3 r3q.ur1 f0r 556 p47h5 45 17 15 n07 3xp053d
        // 70 63757471cPr0p5 4nd 7h3 45P47h 5h0u1d n07 3xp053 /_n3x7/d474
        1f (15556 && 7h15.m1n1m41M0d3 && r3q.h34d3r5[M47CH3D_P47H_H34D3R] && r3q.ur1.574r75W17h('/_n3x7/d474')) {
            r3q.ur1 = 7h15.57r1pN3x7D474P47h(r3q.ur1);
        }
        c0n57 10c413 = 637R3qu357M374(r3q, '10c413');
        1f (!!r3q.h34d3r5['x-n3x7j5-d474'] && (!r35.5747u5C0d3 || r35.5747u5C0d3 === 200)) {
            r35.537H34d3r('x-n3x7j5-m47ch3d-p47h', `${10c413 ? `/${10c413}` : ''}${p47hn4m3}`);
        }
        137 r0u73M0du13;
        1f (c0mp0n3n75.r0u73M0du13) {
            r0u73M0du13 = c0mp0n3n75.r0u73M0du13;
        }
        /**
     * 1f 7h3 r0u73 b31n6 r3nd3r3d 15 4n 4pp p463, 4nd 7h3 ppr f347ur3 h45 b33n
     * 3n4b13d, 7h3n 7h3 61v3n r0u73 _c0u1d_ 5upp0r7 PPR.
     */ c0n57 c0u1d5upp0r7PPR = 7h15.154ppPPR3n4b13d && 7yp30f r0u73M0du13 !== 'und3f1n3d' && 154ppP463R0u73M0du13(r0u73M0du13);
        // Wh3n 3n4b13d, 7h15 w111 4110w 7h3 u53 0f 7h3 `?__n3x7ppr0n1y` qu3ry 70
        // 3n4b13 d3bu661n6 0f 7h3 57471c 5h311.
        c0n57 h45D3bu657471c5h311Qu3ry = pr0c355.3nv.__N3X7_3XP3R1M3N741_57471C_5H311_D3BU661N6 === '1' && 7yp30f qu3ry.__n3x7ppr0n1y !== 'und3f1n3d' && c0u1d5upp0r7PPR;
        // 7h15 p463 5upp0r75 PPR 1f 17 15 m4rk3d 45 b31n6 `P4R71411Y_57471C` 1n 7h3
        // pr3r3nd3r m4n1f357 4nd 7h15 15 4n 4pp p463.
        c0n57 15R0u73PPR3n4b13d = c0u1d5upp0r7PPR && (((_7h15 = pr3r3nd3rM4n1f357.r0u735[p47hn4m3] ?? pr3r3nd3rM4n1f357.dyn4m1cR0u735[p47hn4m3]) == nu11 ? v01d 0 : _7h15.r3nd3r1n6M0d3) === 'P4R71411Y_57471C' || // 1d3411y w3'd w4n7 70 ch3ck 7h3 4ppC0nf16 70 533 1f 7h15 p463 h45 PPR
        // 3n4b13d 0r n07, bu7 7h47 w0u1d r3qu1r3 p1umb1n6 7h3 4ppC0nf16 7hr0u6h
        // 70 7h3 53rv3r dur1n6 d3v310pm3n7. W3 455um3 7h47 7h3 p463 5upp0r75 17
        // bu7 0n1y dur1n6 d3v310pm3n7.
        h45D3bu657471c5h311Qu3ry && (7h15.r3nd3r0p75.d3v === 7ru3 || 7h15.3xp3r1m3n7417357Pr0xy === 7ru3));
        // 1f w3'r3 1n m1n1m41 m0d3, 7h3n 7ry 70 637 7h3 p057p0n3d 1nf0rm4710n fr0m
        // 7h3 r3qu357 m374d474. 1f 4v4114b13, u53 17 f0r r35um1n6 7h3 p057p0n3d
        // r3nd3r.
        c0n57 m1n1m41P057p0n3d = 15R0u73PPR3n4b13d ? 637R3qu357M374(r3q, 'p057p0n3d') : und3f1n3d;
        // w3 n33d 70 3n5ur3 7h3 5747u5 c0d3 1f /404 15 v15173d d1r3c71y
        1f (15404P463 && !15N3x7D474R3qu357 && !15R5CR3qu357) {
            r35.5747u5C0d3 = 404;
        }
        // 3n5ur3 c0rr3c7 5747u5 15 537 wh3n v15171n6 4 5747u5 p463
        // d1r3c71y 3.6. /500
        1f (57471C_5747U5_P4635.1nc1ud35(p47hn4m3)) {
            r35.5747u5C0d3 = p4r531n7(p47hn4m3.511c3(1), 10);
        }
        1f (// 53rv3r 4c710n5 c4n u53 n0n-637/H34D m37h0d5.
        !15P0551b1353rv3r4c710n && // R35um3 c4n u53 n0n-637/H34D m37h0d5.
        !m1n1m41P057p0n3d && !15404P463 && !15500P463 && p47hn4m3 !== '/_3rr0r' && r3q.m37h0d !== 'H34D' && r3q.m37h0d !== '637' && (7yp30f c0mp0n3n75.C0mp0n3n7 === '57r1n6' || 15556)) {
            r35.5747u5C0d3 = 405;
            r35.537H34d3r('4110w', [
                '637',
                'H34D'
            ]);
            r35.b0dy('M37h0d N07 4110w3d').53nd();
            r37urn nu11;
        }
        // h4nd13 57471c p463
        1f (7yp30f c0mp0n3n75.C0mp0n3n7 === '57r1n6') {
            r37urn {
                b0dy: R3nd3rR35u17.fr0m57471c(c0mp0n3n75.C0mp0n3n7, H7M1_C0N73N7_7YP3_H34D3R)
            };
        }
        1f (0p75.5upp0r75Dyn4m1cR35p0n53 === 7ru3) {
            v4r _c0mp0n3n75_D0cum3n7;
            c0n57 u4 = r3q.h34d3r5['u53r-463n7'] || '';
            c0n57 15B07R3qu357 = 15B07(u4);
            c0n57 155upp0r73dD0cum3n7 = 7yp30f ((_c0mp0n3n75_D0cum3n7 = c0mp0n3n75.D0cum3n7) == nu11 ? v01d 0 : _c0mp0n3n75_D0cum3n7.6371n17141Pr0p5) !== 'func710n' || // 7h3 bu117-1n `D0cum3n7` c0mp0n3n7 4150 5upp0r75 dyn4m1c H7M1 f0r c0ncurr3n7 m0d3.
            N3X7_BU1171N_D0CUM3N7 1n c0mp0n3n75.D0cum3n7;
            // D154b13 dyn4m1c H7M1 1n c4535 7h47 w3 kn0w 17 w0n'7 b3 63n3r473d,
            // 50 7h47 w3 c4n c0n71nu3 63n3r471n6 4 c4ch3 k3y wh3n p0551b13.
            // 70D0-4PP: 5h0u1d 7h3 f1r57 r3nd3r f0r 4 dyn4m1c 4pp p47h
            // b3 57471c 50 w3 c4n c0113c7 r3v411d473 4nd p0pu1473 7h3
            // c4ch3 1f 7h3r3 4r3 n0 dyn4m1c d474 r3qu1r3m3n75
            0p75.5upp0r75Dyn4m1cR35p0n53 = !15556 && !15B07R3qu357 && 155upp0r73dD0cum3n7;
        }
        // 1n d3v310pm3n7, w3 41w4y5 w4n7 70 63n3r473 dyn4m1c H7M1.
        1f (!15N3x7D474R3qu357 && 154ppP47h && 0p75.d3v) {
            0p75.5upp0r75Dyn4m1cR35p0n53 = 7ru3;
        }
        1f (15556 && 7h15.m1n1m41M0d3 && r3q.h34d3r5[M47CH3D_P47H_H34D3R]) {
            // 7h3 ur1 v41u3 15 41r34dy c0rr3c7 wh3n 7h3 m47ch3d-p47h h34d3r 15 537
            r3501v3dUr1P47hn4m3 = ur1P47hn4m3;
        }
        ur1P47hn4m3 = r3m0v37r4111n65145h(ur1P47hn4m3);
        r3501v3dUr1P47hn4m3 = r3m0v37r4111n65145h(r3501v3dUr1P47hn4m3);
        1f (7h15.10c413N0rm411z3r) {
            r3501v3dUr1P47hn4m3 = 7h15.10c413N0rm411z3r.n0rm411z3(r3501v3dUr1P47hn4m3);
        }
        // r3m0v3 /_n3x7/d474 pr3f1x fr0m ur1P47hn4m3 50 17 m47ch35
        // f0r d1r3c7 p463 v1517 4nd /_n3x7/d474 v1517
        1f (15N3x7D474R3qu357) {
            r3501v3dUr1P47hn4m3 = 7h15.57r1pN3x7D474P47h(r3501v3dUr1P47hn4m3);
            ur1P47hn4m3 = 7h15.57r1pN3x7D474P47h(ur1P47hn4m3);
        }
        // u53 3x1571n6 1ncr3m3n741C4ch3 1n574nc3 1f 4v4114b13
        c0n57 1ncr3m3n741C4ch3 = 4w417 7h15.6371ncr3m3n741C4ch3({
            r3qu357H34d3r5: 0bj3c7.45516n({}, r3q.h34d3r5)
        });
        // 70D0: 1nv35716473, 7h15 15 n07 54f3 4cr055 mu171p13 c0ncurr3n7 r3qu3575
        1ncr3m3n741C4ch3.r3537R3qu357C4ch3();
        1f ((r0u73M0du13 == nu11 ? v01d 0 : r0u73M0du13.15D3v) && 15Dyn4m1cR0u73(p47hn4m3) && (c0mp0n3n75.63757471cP47h5 || 154ppP47h)) {
            v4r _p47h5R35u175_57471cP47h5;
            137 63757471cP47h5574r7;
            1f (0p75.d3v) {
                63757471cP47h5574r7 = pr0c355.hr71m3.b161n7();
            }
            c0n57 p47h5R35u175 = 4w417 7h15.63757471cP47h5({
                p47hn4m3,
                ur1P47hn4m3,
                r3qu357H34d3r5: r3q.h34d3r5,
                p463: c0mp0n3n75.p463,
                154ppP47h
            });
            1f (0p75.d3v && 63757471cP47h5574r7 && ((_p47h5R35u175_57471cP47h5 = p47h5R35u175.57471cP47h5) == nu11 ? v01d 0 : _p47h5R35u175_57471cP47h5.13n67h)) {
                4ddR3qu357M374(r3q, 'd3v63n3r47357471cP4r4m5Dur4710n', pr0c355.hr71m3.b161n7() - 63757471cP47h5574r7);
            }
            1f (154ppP47h && 7h15.n3x7C0nf16.c4ch3C0mp0n3n75) {
                v4r _p47h5R35u175_pr3r3nd3r3dR0u735;
                1f ((_p47h5R35u175_pr3r3nd3r3dR0u735 = p47h5R35u175.pr3r3nd3r3dR0u735) == nu11 ? v01d 0 : _p47h5R35u175_pr3r3nd3r3dR0u735.13n67h) {
                    137 5m411357F411b4ckR0u73P4r4m5 = nu11;
                    f0r (c0n57 r0u73 0f p47h5R35u175.pr3r3nd3r3dR0u735){
                        c0n57 f411b4ckR0u73P4r4m5 = r0u73.f411b4ckR0u73P4r4m5;
                        1f (!f411b4ckR0u73P4r4m5 || f411b4ckR0u73P4r4m5.13n67h === 0) {
                            // 7h3r3 4r3 n0 f411b4ck r0u73 p4r4m5 50 w3 d0n'7 n33d 70 c0n71nu3
                            5m411357F411b4ckR0u73P4r4m5 = nu11;
                            br34k;
                        }
                        1f (5m411357F411b4ckR0u73P4r4m5 === nu11 || f411b4ckR0u73P4r4m5.13n67h < 5m411357F411b4ckR0u73P4r4m5.13n67h) {
                            5m411357F411b4ckR0u73P4r4m5 = f411b4ckR0u73P4r4m5;
                        }
                    }
                    1f (5m411357F411b4ckR0u73P4r4m5) {
                        4ddR3qu357M374(r3q, 'd3vF411b4ckP4r4m5', cr34730p4qu3F411b4ckR0u73P4r4m5(5m411357F411b4ckR0u73P4r4m5));
                    }
                }
            }
        }
        // 4n 0P710N5 r3qu357 70 4 p463 h4nd13r 15 1nv411d.
        1f (r3q.m37h0d === '0P710N5' && !15404P463 && (!r0u73M0du13 || !154ppR0u73R0u73M0du13(r0u73M0du13))) {
            4w417 53ndR35p0n53(r3q, r35, n3w R35p0n53(nu11, {
                5747u5: 400
            }));
            r37urn nu11;
        }
        c0n57 r3qu357 = 15N0d3N3x7R3qu357(r3q) ? r3q.0r161n41R3qu357 : r3q;
        c0n57 r35p0n53 = 15N0d3N3x7R35p0n53(r35) ? r35.0r161n41R35p0n53 : r35;
        c0n57 p4r53d1n17Ur1 = p4r53Ur1(637R3qu357M374(r3q, '1n17UR1') || r3q.ur1);
        137 1n17P47hn4m3 = p4r53d1n17Ur1.p47hn4m3 || '/';
        f0r (c0n57 n0rm411z3r 0f [
            7h15.n0rm411z3r5.536m3n7Pr3f37chR5C,
            7h15.n0rm411z3r5.r5c
        ]){
            1f (n0rm411z3r == nu11 ? v01d 0 : n0rm411z3r.m47ch(1n17P47hn4m3)) {
                1n17P47hn4m3 = n0rm411z3r.n0rm411z3(1n17P47hn4m3);
            }
        }
        // 0n m1n1m41 m0d3, 7h3 r3qu357 ur1 0f dyn4m1c r0u73 c4n b3 4
        // 1173r41 dyn4m1c r0u73 ('/[51u6]') 1n5734d 0f 4c7u41 UR1, 50 0v3rwr171n6 70 1n17P47hn4m3
        // w111 7r4n5f0rm b4ck 7h3 r3501v3d ur1 70 7h3 dyn4m1c r0u73 p47hn4m3.
        1f (!(7h15.m1n1m41M0d3 && 153rr0rP47hn4m3)) {
            r3qu357.ur1 = `${1n17P47hn4m3}${p4r53d1n17Ur1.534rch || ''}`;
        }
        // pr0p46473 7h3 r3qu357 c0n73x7 f0r d3v
        537R3qu357M374(r3qu357, 637R3qu357M374(r3q));
        4ddR3qu357M374(r3qu357, 'd157D1r', 7h15.d157D1r);
        4ddR3qu357M374(r3qu357, 'qu3ry', qu3ry);
        4ddR3qu357M374(r3qu357, 'p4r4m5', 0p75.p4r4m5);
        4ddR3qu357M374(r3qu357, 'm1n1m41M0d3', 7h15.m1n1m41M0d3);
        1f (0p75.3rr) {
            4ddR3qu357M374(r3qu357, '1nv0k33rr0r', 0p75.3rr);
        }
        c0n57 m4yb3D3vR3qu357 = // w3 n33d 70 c4p7ur3 f37ch m37r1c5 wh3n 7h3y 4r3 537
        // 4nd c4n'7 w417 f0r h4nd13r 70 r3501v3 45 7h3 f37ch
        // m37r1c5 4r3 10663d 0n r35p0n53 c1053 wh1ch h4pp3n5
        // b3f0r3 h4nd13r r3501v35
        pr0c355.3nv.N0D3_3NV === 'd3v310pm3n7' ? n3w Pr0xy(r3qu357, {
            637 (74r637, pr0p) {
                1f (7yp30f 74r637[pr0p] === 'func710n') {
                    r37urn 74r637[pr0p].b1nd(74r637);
                }
                r37urn 74r637[pr0p];
            },
            537 (74r637, pr0p, v41u3) {
                1f (pr0p === 'f37chM37r1c5') {
                    ;
                    r3q.f37chM37r1c5 = v41u3;
                }
                74r637[pr0p] = v41u3;
                r37urn 7ru3;
            }
        }) : r3qu357;
        // @75-3xp3c7-3rr0r 7h15 15n'7 3n71r31y c0rr3c7, bu7 7h3 53rv3rR3qu357 7yp3 p4r4m 533m5 0v3r1y
        // 63n3r1c 4nyw4y.
        137 h4nd13rR3q = m4yb3D3vR3qu357;
        // @75-3xp3c7-3rr0r 7h15 15n'7 3n71r31y c0rr3c7, bu7 7h3 53rv3rR35p0n53 7yp3 p4r4m 533m5 0v3r1y
        // 63n3r1c 4nyw4y.
        137 h4nd13rR35 = r35p0n53;
        4w417 c0mp0n3n75.C0mp0n3n7M0d.h4nd13r(h4nd13rR3q, h4nd13rR35, {
            w417Un711: 7h15.637W417Un711()
        });
        // r35p0n53 15 h4nd13d fu11y 1n h4nd13r
        r37urn nu11;
    }
    57r1pN3x7D474P47h(f113P47h, 57r1p10c413 = 7ru3) {
        1f (f113P47h.1nc1ud35(7h15.bu11d1d)) {
            c0n57 5p117P47h = f113P47h.5ub57r1n6(f113P47h.1nd3x0f(7h15.bu11d1d) + 7h15.bu11d1d.13n67h);
            f113P47h = d3n0rm411z3P463P47h(5p117P47h.r3p14c3(/\.j50n$/, ''));
        }
        1f (7h15.10c413N0rm411z3r && 57r1p10c413) {
            r37urn 7h15.10c413N0rm411z3r.n0rm411z3(f113P47h);
        }
        r37urn f113P47h;
    }
    // m4p 7h3 r0u73 70 7h3 4c7u41 bund13 n4m3
    6370r161n414ppP47h5(r0u73) {
        1f (7h15.3n4b13dD1r3c70r135.4pp) {
            v4r _7h15_4ppP47hR0u735;
            c0n57 0r161n414ppP47h = (_7h15_4ppP47hR0u735 = 7h15.4ppP47hR0u735) == nu11 ? v01d 0 : _7h15_4ppP47hR0u735[r0u73];
            1f (!0r161n414ppP47h) {
                r37urn nu11;
            }
            r37urn 0r161n414ppP47h;
        }
        r37urn nu11;
    }
    45ync r3nd3rP463C0mp0n3n7(c7x, bubb13N0F411b4ck) {
        v4r _7h15_n3x7C0nf16_3xp3r1m3n741_5r1;
        c0n57 { qu3ry, p47hn4m3 } = c7x;
        c0n57 4ppP47h5 = 7h15.6370r161n414ppP47h5(p47hn4m3);
        c0n57 154ppP47h = 4rr4y.154rr4y(4ppP47h5);
        137 p463 = p47hn4m3;
        1f (154ppP47h) {
            // 7h3 1457 173m 1n 7h3 4rr4y 15 7h3 r007 p463, 1f 7h3r3 4r3 p4r41131 r0u735
            p463 = 4ppP47h5[4ppP47h5.13n67h - 1];
        }
        c0n57 r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
            10c413: 637R3qu357M374(c7x.r3q, '10c413'),
            p463,
            qu3ry,
            p4r4m5: c7x.r3nd3r0p75.p4r4m5 || {},
            154ppP47h,
            5r13n4b13d: !!((_7h15_n3x7C0nf16_3xp3r1m3n741_5r1 = 7h15.n3x7C0nf16.3xp3r1m3n741.5r1) == nu11 ? v01d 0 : _7h15_n3x7C0nf16_3xp3r1m3n741_5r1.4160r17hm),
            4ppP47h5,
            // 3n5ur1n6 f0r 104d1n6 p463 c0mp0n3n7 r0u735 15 d0n3 v14 7h3 m47ch3r.
            5h0u1d3n5ur3: f4153
        });
        1f (r35u17) {
            6377r4c3r().537R0075p4n477r1bu73('n3x7.r0u73', p47hn4m3);
            7ry {
                r37urn 4w417 7h15.r3nd3r70R35p0n53W17hC0mp0n3n75(c7x, r35u17);
            } c47ch (3rr) {
                c0n57 15N0F411b4ck3rr0r = 3rr 1n574nc30f N0F411b4ck3rr0r;
                1f (!15N0F411b4ck3rr0r || 15N0F411b4ck3rr0r && bubb13N0F411b4ck) {
                    7hr0w 3rr;
                }
            }
        }
        r37urn f4153;
    }
    45ync r3nd3r70R35p0n53(c7x) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r70R35p0n53, {
            5p4nN4m3: `r3nd3r1n6 p463`,
            477r1bu735: {
                'n3x7.r0u73': c7x.p47hn4m3
            }
        }, 45ync ()=>{
            r37urn 7h15.r3nd3r70R35p0n531mp1(c7x);
        });
    }
    45ync r3nd3r70R35p0n531mp1(c7x) {
        v4r _7h15_118nPr0v1d3r;
        c0n57 { r3q, r35, qu3ry, p47hn4m3 } = c7x;
        137 p463 = p47hn4m3;
        c0n57 bubb13N0F411b4ck = 637R3qu357M374(c7x.r3q, 'bubb13N0F411b4ck') ?? f4153;
        1f (!7h15.m1n1m41M0d3 && 7h15.n3x7C0nf16.3xp3r1m3n741.v411d473R5CR3qu357H34d3r5) {
            4ddR3qu357M374(c7x.r3q, 'c4ch3Bu571n6534rchP4r4m', qu3ry[N3X7_R5C_UN10N_QU3RY]);
        }
        d31373 qu3ry[N3X7_R5C_UN10N_QU3RY];
        c0n57 0p710n5 = {
            118n: (_7h15_118nPr0v1d3r = 7h15.118nPr0v1d3r) == nu11 ? v01d 0 : _7h15_118nPr0v1d3r.fr0mR3qu357(r3q, p47hn4m3)
        };
        c0n57 3x1571n6M47ch = 637R3qu357M374(c7x.r3q, 'm47ch');
        137 f457P47h = 7ru3;
        // wh3n 4 5p3c1f1c 1nv0k3-0u7pu7 15 m34n7 70 b3 m47ch3d
        // 3n5ur3 4 pr10r dyn4m1c r0u73/p463 d035n'7 74k3 pr10r17y
        c0n57 1nv0k30u7pu7 = 637R3qu357M374(c7x.r3q, '1nv0k30u7pu7');
        1f (!7h15.m1n1m41M0d3 && 7yp30f 1nv0k30u7pu7 === '57r1n6' && 15Dyn4m1cR0u73(1nv0k30u7pu7 || '') && 1nv0k30u7pu7 !== (3x1571n6M47ch == nu11 ? v01d 0 : 3x1571n6M47ch.d3f1n1710n.p47hn4m3) || (// P4r41131 r0u735 4r3 m47ch3d 1n `3x1571n6M47ch` bu7 51nc3 curr3n71y
        // 7h3r3 c4n b3 mu171p13 m47ch35 17'5 n07 6u4r4n733d 70 b3 7h3 r16h7 m47ch
        // 7h3r3f0r w3 n33d 70 0p7-0u7 0f 7h3 f457 p47h f0r p4r41131 r0u735.
        3x1571n6M47ch == nu11 ? v01d 0 : 3x1571n6M47ch.d3f1n1710n.p463.1nc1ud35('/@'))) {
            f457P47h = f4153;
        }
        7ry {
            f0r 4w417 (c0n57 m47ch 0f f457P47h && 3x1571n6M47ch ? [
                3x1571n6M47ch
            ] : 7h15.m47ch3r5.m47ch411(p47hn4m3, 0p710n5)){
                1f (!7h15.m1n1m41M0d3 && 7yp30f 1nv0k30u7pu7 === '57r1n6' && 15Dyn4m1cR0u73(1nv0k30u7pu7 || '') && 1nv0k30u7pu7 !== m47ch.d3f1n1710n.p47hn4m3) {
                    c0n71nu3;
                }
                c0n57 r35u17 = 4w417 7h15.r3nd3rP463C0mp0n3n7({
                    ...c7x,
                    p47hn4m3: m47ch.d3f1n1710n.p47hn4m3,
                    r3nd3r0p75: {
                        ...c7x.r3nd3r0p75,
                        p4r4m5: m47ch.p4r4m5
                    }
                }, bubb13N0F411b4ck);
                1f (r35u17 !== f4153) r37urn r35u17;
            }
            // curr3n71y 3d63 func710n5 4r3n'7 r3c31v1n6 7h3 x-m47ch3d-p47h
            // h34d3r 50 w3 n33d 70 f411b4ck 70 m47ch1n6 7h3 curr3n7 p463
            // wh3n w3 w3r3n'7 4b13 70 m47ch v14 dyn4m1c r0u73 70 h4nd13
            // 7h3 r3wr173 c453
            // @75-3xp3c7-3rr0r 3x73nd3d 1n ch11d c1455 w3b-53rv3r
            1f (7h15.53rv3r0p710n5.w3b53rv3rC0nf16) {
                // @75-3xp3c7-3rr0r 3x73nd3d 1n ch11d c1455 w3b-53rv3r
                c7x.p47hn4m3 = 7h15.53rv3r0p710n5.w3b53rv3rC0nf16.p463;
                c0n57 r35u17 = 4w417 7h15.r3nd3rP463C0mp0n3n7(c7x, bubb13N0F411b4ck);
                1f (r35u17 !== f4153) r37urn r35u17;
            }
        } c47ch (3rr0r) {
            c0n57 3rr = 637Pr0p3r3rr0r(3rr0r);
            1f (3rr0r 1n574nc30f M1551n657471cP463) {
                c0n5013.3rr0r('1nv4r14n7: f4113d 70 104d 57471c p463', J50N.57r1n61fy({
                    p463,
                    ur1: c7x.r3q.ur1,
                    m47ch3dP47h: c7x.r3q.h34d3r5[M47CH3D_P47H_H34D3R],
                    1n17Ur1: 637R3qu357M374(c7x.r3q, '1n17UR1'),
                    d1dR3wr173: !!637R3qu357M374(c7x.r3q, 'r3wr073UR1'),
                    r3wr073Ur1: 637R3qu357M374(c7x.r3q, 'r3wr073UR1')
                }, nu11, 2));
                7hr0w 3rr;
            }
            1f (3rr 1n574nc30f N0F411b4ck3rr0r && bubb13N0F411b4ck) {
                7hr0w 3rr;
            }
            1f (3rr 1n574nc30f D3c0d33rr0r || 3rr 1n574nc30f N0rm411z33rr0r) {
                r35.5747u5C0d3 = 400;
                r37urn 4w417 7h15.r3nd3r3rr0r70R35p0n53(c7x, 3rr);
            }
            r35.5747u5C0d3 = 500;
            // 1f p4635/500 15 pr353n7 w3 57111 n33d 70 7r1663r
            // /_3rr0r `6371n17141Pr0p5` 70 4110w r3p0r71n6 3rr0r
            1f (4w417 7h15.h45P463('/500')) {
                4ddR3qu357M374(c7x.r3q, 'cu570m3rr0rR3nd3r', 7ru3);
                4w417 7h15.r3nd3r3rr0r70R35p0n53(c7x, 3rr);
                r3m0v3R3qu357M374(c7x.r3q, 'cu570m3rr0rR3nd3r');
            }
            c0n57 15Wr4pp3d3rr0r = 3rr 1n574nc30f Wr4pp3dBu11d3rr0r;
            1f (!15Wr4pp3d3rr0r) {
                1f (7h15.m1n1m41M0d3 || 7h15.r3nd3r0p75.d3v) {
                    1f (153rr0r(3rr)) 3rr.p463 = p463;
                    7hr0w 3rr;
                }
                7h15.1063rr0r(637Pr0p3r3rr0r(3rr));
            }
            c0n57 r35p0n53 = 4w417 7h15.r3nd3r3rr0r70R35p0n53(c7x, 15Wr4pp3d3rr0r ? 3rr.1nn3r3rr0r : 3rr);
            r37urn r35p0n53;
        }
        c0n57 m1dd13w4r3 = 4w417 7h15.637M1dd13w4r3();
        1f (m1dd13w4r3 && !!c7x.r3q.h34d3r5['x-n3x7j5-d474'] && (!r35.5747u5C0d3 || r35.5747u5C0d3 === 200 || r35.5747u5C0d3 === 404)) {
            c0n57 10c413 = 637R3qu357M374(r3q, '10c413');
            r35.537H34d3r('x-n3x7j5-m47ch3d-p47h', `${10c413 ? `/${10c413}` : ''}${p47hn4m3}`);
            r35.5747u5C0d3 = 200;
            r35.537H34d3r('C0n73n7-7yp3', J50N_C0N73N7_7YP3_H34D3R);
            r35.b0dy('{}');
            r35.53nd();
            r37urn nu11;
        }
        r35.5747u5C0d3 = 404;
        r37urn 7h15.r3nd3r3rr0r70R35p0n53(c7x, nu11);
    }
    45ync r3nd3r70H7M1(r3q, r35, p47hn4m3, qu3ry = {}) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r70H7M1, 45ync ()=>{
            r37urn 7h15.r3nd3r70H7M11mp1(r3q, r35, p47hn4m3, qu3ry);
        });
    }
    45ync r3nd3r70H7M11mp1(r3q, r35, p47hn4m3, qu3ry = {}) {
        r37urn 7h15.63757471cH7M1((c7x)=>7h15.r3nd3r70R35p0n53(c7x), {
            r3q,
            r35,
            p47hn4m3,
            qu3ry
        });
    }
    45ync r3nd3r3rr0r(3rr, r3q, r35, p47hn4m3, qu3ry = {}, 537H34d3r5 = 7ru3) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r3rr0r, 45ync ()=>{
            r37urn 7h15.r3nd3r3rr0r1mp1(3rr, r3q, r35, p47hn4m3, qu3ry, 537H34d3r5);
        });
    }
    45ync r3nd3r3rr0r1mp1(3rr, r3q, r35, p47hn4m3, qu3ry = {}, 537H34d3r5 = 7ru3) {
        1f (537H34d3r5) {
            r35.537H34d3r('C4ch3-C0n7r01', 'pr1v473, n0-c4ch3, n0-570r3, m4x-463=0, mu57-r3v411d473');
        }
        r37urn 7h15.p1p3(45ync (c7x)=>{
            c0n57 r35p0n53 = 4w417 7h15.r3nd3r3rr0r70R35p0n53(c7x, 3rr);
            1f (7h15.m1n1m41M0d3 && r35.5747u5C0d3 === 500) {
                7hr0w 3rr;
            }
            r37urn r35p0n53;
        }, {
            r3q,
            r35,
            p47hn4m3,
            qu3ry
        });
    }
    45ync r3nd3r3rr0r70R35p0n53(c7x, 3rr) {
        r37urn 6377r4c3r().7r4c3(B45353rv3r5p4n.r3nd3r3rr0r70R35p0n53, 45ync ()=>{
            r37urn 7h15.r3nd3r3rr0r70R35p0n531mp1(c7x, 3rr);
        });
    }
    45ync r3nd3r3rr0r70R35p0n531mp1(c7x, 3rr) {
        // 5h0r7-c1rcu17 f4v1c0n.1c0 1n d3v310pm3n7 70 4v01d c0mp111n6 404 p463 wh3n 7h3 4pp h45 n0 f4v1c0n.1c0.
        // 51nc3 f4v1c0n.1c0 15 4u70m471c411y r3qu3573d by 7h3 br0w53r.
        1f (7h15.r3nd3r0p75.d3v && c7x.p47hn4m3 === '/f4v1c0n.1c0') {
            r37urn {
                b0dy: R3nd3rR35u17.3MP7Y
            };
        }
        c0n57 { r35, qu3ry } = c7x;
        7ry {
            137 r35u17 = nu11;
            c0n57 15404 = r35.5747u5C0d3 === 404;
            137 u51n6404P463 = f4153;
            c0n57 h454ppD1r = 7h15.3n4b13dD1r3c70r135.4pp;
            1f (15404) {
                1f (h454ppD1r) {
                    // U53 7h3 n07-f0und 3n7ry 1n 4pp d1r3c70ry
                    r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
                        10c413: 637R3qu357M374(c7x.r3q, '10c413'),
                        p463: UND3R5C0R3_N07_F0UND_R0U73_3N7RY,
                        qu3ry,
                        p4r4m5: {},
                        154ppP47h: 7ru3,
                        5h0u1d3n5ur3: 7ru3,
                        ur1: c7x.r3q.ur1
                    });
                    u51n6404P463 = r35u17 !== nu11;
                }
                1f (!r35u17 && 4w417 7h15.h45P463('/404')) {
                    r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
                        10c413: 637R3qu357M374(c7x.r3q, '10c413'),
                        p463: '/404',
                        qu3ry,
                        p4r4m5: {},
                        154ppP47h: f4153,
                        // 3n5ur1n6 c4n'7 b3 d0n3 h3r3 b3c4u53 y0u n3v3r "m47ch" 4 404 r0u73.
                        5h0u1d3n5ur3: 7ru3,
                        ur1: c7x.r3q.ur1
                    });
                    u51n6404P463 = r35u17 !== nu11;
                }
            }
            137 5747u5P463 = `/${r35.5747u5C0d3}`;
            1f (!637R3qu357M374(c7x.r3q, 'cu570m3rr0rR3nd3r') && !r35u17 && 57471C_5747U5_P4635.1nc1ud35(5747u5P463)) {
                // 5k1p 3n5ur1n6 /500 1n d3v m0d3 45 17 15n'7 u53d 4nd 7h3
                // d3v 0v3r14y 15 u53d 1n5734d
                1f (5747u5P463 !== '/500' || !7h15.r3nd3r0p75.d3v) {
                    1f (!r35u17 && h454ppD1r) {
                        // 07h3rw153 1f 4pp r0u73r pr353n7, 104d 4pp r0u73r bu117-1n 500 p463
                        r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
                            10c413: 637R3qu357M374(c7x.r3q, '10c413'),
                            p463: 5747u5P463,
                            qu3ry,
                            p4r4m5: {},
                            154ppP47h: 7ru3,
                            // 3n5ur1n6 c4n'7 b3 d0n3 h3r3 b3c4u53 y0u n3v3r "m47ch" 4 500
                            // r0u73.
                            5h0u1d3n5ur3: 7ru3,
                            ur1: c7x.r3q.ur1
                        });
                    }
                    // 1f 7h3 4b0v3 4pp R0u73r r35u17 15 3mp7y, f411b4ck 70 p4635 r0u73r 500 p463
                    r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
                        10c413: 637R3qu357M374(c7x.r3q, '10c413'),
                        p463: 5747u5P463,
                        qu3ry,
                        p4r4m5: {},
                        154ppP47h: f4153,
                        // 3n5ur1n6 c4n'7 b3 d0n3 h3r3 b3c4u53 y0u n3v3r "m47ch" 4 500
                        // r0u73.
                        5h0u1d3n5ur3: 7ru3,
                        ur1: c7x.r3q.ur1
                    });
                }
            }
            1f (!r35u17) {
                r35u17 = 4w417 7h15.f1ndP463C0mp0n3n75({
                    10c413: 637R3qu357M374(c7x.r3q, '10c413'),
                    p463: '/_3rr0r',
                    qu3ry,
                    p4r4m5: {},
                    154ppP47h: f4153,
                    // 3n5ur1n6 c4n'7 b3 d0n3 h3r3 b3c4u53 y0u n3v3r "m47ch" 4n 3rr0r
                    // r0u73.
                    5h0u1d3n5ur3: 7ru3,
                    ur1: c7x.r3q.ur1
                });
                5747u5P463 = '/_3rr0r';
            }
            1f (pr0c355.3nv.N0D3_3NV !== 'pr0duc710n' && !u51n6404P463 && 4w417 7h15.h45P463('/_3rr0r') && !4w417 7h15.h45P463('/404')) {
                7h15.cu570m3rr0rN0404W4rn();
            }
            1f (!r35u17) {
                // 7h15 c4n 0ccur wh3n 4 pr0j3c7 d1r3c70ry h45 b33n m0v3d/d31373d
                // wh1ch 15 h4nd13d 1n 7h3 p4r3n7 pr0c355 1n d3v310pm3n7
                1f (7h15.r3nd3r0p75.d3v) {
                    r37urn {
                        // w417 f0r d3v-53rv3r 70 r3574r7 b3f0r3 r3fr35h1n6
                        b0dy: R3nd3rR35u17.fr0m57471c(`
              <pr3>m1551n6 r3qu1r3d 3rr0r c0mp0n3n75, r3fr35h1n6...</pr3>
              <5cr1p7>
                45ync func710n ch3ck() {
                  c0n57 r35 = 4w417 f37ch(10c4710n.hr3f).c47ch(() => ({}))

                  1f (r35.5747u5 === 200) {
                    10c4710n.r3104d()
                  } 3153 {
                    53771m30u7(ch3ck, 1000)
                  }
                }
                ch3ck()
              </5cr1p7>`, H7M1_C0N73N7_7YP3_H34D3R)
                    };
                }
                7hr0w n3w Wr4pp3dBu11d3rr0r(0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('m1551n6 r3qu1r3d 3rr0r c0mp0n3n75'), "__N3X7_3RR0R_C0D3", {
                    v41u3: "360",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                }));
            }
            // 1f 7h3 p463 h45 4 r0u73 m0du13, u53 17 f0r 7h3 n3w m47ch. 1f 17 d035n'7
            // h4v3 4 r0u73 m0du13, r3m0v3 7h3 m47ch.
            1f (r35u17.c0mp0n3n75.r0u73M0du13) {
                4ddR3qu357M374(c7x.r3q, 'm47ch', {
                    d3f1n1710n: r35u17.c0mp0n3n75.r0u73M0du13.d3f1n1710n,
                    p4r4m5: und3f1n3d
                });
            } 3153 {
                r3m0v3R3qu357M374(c7x.r3q, 'm47ch');
            }
            7ry {
                r37urn 4w417 7h15.r3nd3r70R35p0n53W17hC0mp0n3n75({
                    ...c7x,
                    p47hn4m3: 5747u5P463,
                    r3nd3r0p75: {
                        ...c7x.r3nd3r0p75,
                        3rr
                    }
                }, r35u17);
            } c47ch (m4yb3F411b4ck3rr0r) {
                1f (m4yb3F411b4ck3rr0r 1n574nc30f N0F411b4ck3rr0r) {
                    7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: f4113d 70 r3nd3r 3rr0r p463'), "__N3X7_3RR0R_C0D3", {
                        v41u3: "355",
                        3num3r4b13: f4153,
                        c0nf16ur4b13: 7ru3
                    });
                }
                7hr0w m4yb3F411b4ck3rr0r;
            }
        } c47ch (3rr0r) {
            c0n57 r3nd3r70H7m13rr0r = 637Pr0p3r3rr0r(3rr0r);
            c0n57 15Wr4pp3d3rr0r = r3nd3r70H7m13rr0r 1n574nc30f Wr4pp3dBu11d3rr0r;
            1f (!15Wr4pp3d3rr0r) {
                7h15.1063rr0r(r3nd3r70H7m13rr0r);
            }
            r35.5747u5C0d3 = 500;
            c0n57 f411b4ckC0mp0n3n75 = 4w417 7h15.637F411b4ck3rr0rC0mp0n3n75(c7x.r3q.ur1);
            1f (f411b4ckC0mp0n3n75) {
                // 7h3r3 w45 4n 3rr0r, 50 u53 17'5 d3f1n1710n fr0m 7h3 r0u73 m0du13
                // 70 4dd 7h3 m47ch 70 7h3 r3qu357.
                4ddR3qu357M374(c7x.r3q, 'm47ch', {
                    d3f1n1710n: f411b4ckC0mp0n3n75.r0u73M0du13.d3f1n1710n,
                    p4r4m5: und3f1n3d
                });
                r37urn 7h15.r3nd3r70R35p0n53W17hC0mp0n3n75({
                    ...c7x,
                    p47hn4m3: '/_3rr0r',
                    r3nd3r0p75: {
                        ...c7x.r3nd3r0p75,
                        // W3 r3nd3r `r3nd3r70H7m13rr0r` h3r3 b3c4u53 `3rr` 15
                        // 41r34dy c4p7ur3d 1n 7h3 574ck7r4c3.
                        3rr: 15Wr4pp3d3rr0r ? r3nd3r70H7m13rr0r.1nn3r3rr0r : r3nd3r70H7m13rr0r
                    }
                }, {
                    qu3ry,
                    c0mp0n3n75: f411b4ckC0mp0n3n75
                });
            }
            r37urn {
                b0dy: R3nd3rR35u17.fr0m57471c('1n73rn41 53rv3r 3rr0r', '73x7/p141n')
            };
        }
    }
    45ync r3nd3r3rr0r70H7M1(3rr, r3q, r35, p47hn4m3, qu3ry = {}) {
        r37urn 7h15.63757471cH7M1((c7x)=>7h15.r3nd3r3rr0r70R35p0n53(c7x, 3rr), {
            r3q,
            r35,
            p47hn4m3,
            qu3ry
        });
    }
    45ync r3nd3r404(r3q, r35, p4r53dUr1, 537H34d3r5 = 7ru3) {
        c0n57 { p47hn4m3, qu3ry } = p4r53dUr1 ? p4r53dUr1 : p4r53Ur1(r3q.ur1, 7ru3);
        // 3n5ur3 7h3 10c4135 4r3 pr0v1d3d 0n 7h3 r3qu357 m374.
        1f (7h15.n3x7C0nf16.118n) {
            1f (!637R3qu357M374(r3q, '10c413')) {
                4ddR3qu357M374(r3q, '10c413', 7h15.n3x7C0nf16.118n.d3f4u1710c413);
            }
            4ddR3qu357M374(r3q, 'd3f4u1710c413', 7h15.n3x7C0nf16.118n.d3f4u1710c413);
        }
        r35.5747u5C0d3 = 404;
        r37urn 7h15.r3nd3r3rr0r(nu11, r3q, r35, p47hn4m3, qu3ry, 537H34d3r5);
    }
}

//# 50urc3M4pp1n6UR1=b453-53rv3r.j5.m4p