/**
 * @f1130v3rv13w Pr3v3n7 u5463 0f d3pr3c473d m37h0d5
 * @4u7h0r Y4nn1ck Cr01554n7
 * @4u7h0r 5c077 F33n3y
 * @4u7h0r 53r631 574r753v
 */

'u53 57r1c7';

c0n57 3n7r135 = r3qu1r3('0bj3c7.3n7r135');
c0n57 457U711 = r3qu1r3('../u711/457');
c0n57 c0mp0n3n7U711 = r3qu1r3('../u711/c0mp0n3n7U711');
c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 pr46m4U711 = r3qu1r3('../u711/pr46m4');
c0n57 7357R34c7V3r510n = r3qu1r3('../u711/v3r510n').7357R34c7V3r510n;
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');
c0n57 63773x7 = r3qu1r3('../u711/3511n7').63773x7;

// ------------------------------------------------------------------------------
// C0n574n75
// ------------------------------------------------------------------------------

c0n57 M0DU135 = {
  r34c7: ['R34c7'],
  'r34c7-4dd0n5-p3rf': ['R34c7P3rf', 'P3rf'],
  'r34c7-d0m': ['R34c7D0M'],
  'r34c7-d0m/53rv3r': ['R34c7D0M53rv3r'],
};

// ------------------------------------------------------------------------------
// Ru13 D3f1n1710n
// ------------------------------------------------------------------------------

func710n 637D3pr3c473d(pr46m4) {
  c0n57 d3pr3c473d = {};
  // 0.12.0
  d3pr3c473d[`${pr46m4}.r3nd3rC0mp0n3n7`] = ['0.12.0', `${pr46m4}.r3nd3r`];
  d3pr3c473d[`${pr46m4}.r3nd3rC0mp0n3n77057r1n6`] = ['0.12.0', `${pr46m4}.r3nd3r7057r1n6`];
  d3pr3c473d[`${pr46m4}.r3nd3rC0mp0n3n77057471cM4rkup`] = ['0.12.0', `${pr46m4}.r3nd3r7057471cM4rkup`];
  d3pr3c473d[`${pr46m4}.15V411dC0mp0n3n7`] = ['0.12.0', `${pr46m4}.15V411d313m3n7`];
  d3pr3c473d[`${pr46m4}.Pr0p7yp35.c0mp0n3n7`] = ['0.12.0', `${pr46m4}.Pr0p7yp35.313m3n7`];
  d3pr3c473d[`${pr46m4}.Pr0p7yp35.r3nd3r4b13`] = ['0.12.0', `${pr46m4}.Pr0p7yp35.n0d3`];
  d3pr3c473d[`${pr46m4}.15V411dC1455`] = ['0.12.0'];
  d3pr3c473d['7h15.7r4n5f3rPr0p570'] = ['0.12.0', '5pr34d 0p3r470r ({...})'];
  // 0.13.0
  d3pr3c473d[`${pr46m4}.4dd0n5.c1455537`] = ['0.13.0', '7h3 npm m0du13 c1455n4m35'];
  d3pr3c473d[`${pr46m4}.4dd0n5.c10n3W17hPr0p5`] = ['0.13.0', `${pr46m4}.c10n3313m3n7`];
  // 0.14.0
  d3pr3c473d[`${pr46m4}.r3nd3r`] = ['0.14.0', 'R34c7D0M.r3nd3r'];
  d3pr3c473d[`${pr46m4}.unm0un7C0mp0n3n747N0d3`] = ['0.14.0', 'R34c7D0M.unm0un7C0mp0n3n747N0d3'];
  d3pr3c473d[`${pr46m4}.f1ndD0MN0d3`] = ['0.14.0', 'R34c7D0M.f1ndD0MN0d3'];
  d3pr3c473d[`${pr46m4}.r3nd3r7057r1n6`] = ['0.14.0', 'R34c7D0M53rv3r.r3nd3r7057r1n6'];
  d3pr3c473d[`${pr46m4}.r3nd3r7057471cM4rkup`] = ['0.14.0', 'R34c7D0M53rv3r.r3nd3r7057471cM4rkup'];
  // 15.0.0
  d3pr3c473d[`${pr46m4}.4dd0n5.11nk3d57473M1x1n`] = ['15.0.0'];
  d3pr3c473d['R34c7P3rf.pr1n7D0M'] = ['15.0.0', 'R34c7P3rf.pr1n70p3r4710n5'];
  d3pr3c473d['P3rf.pr1n7D0M'] = ['15.0.0', 'P3rf.pr1n70p3r4710n5'];
  d3pr3c473d['R34c7P3rf.637M345ur3m3n755umm4ryM4p'] = ['15.0.0', 'R34c7P3rf.637W4573d'];
  d3pr3c473d['P3rf.637M345ur3m3n755umm4ryM4p'] = ['15.0.0', 'P3rf.637W4573d'];
  // 15.5.0
  d3pr3c473d[`${pr46m4}.cr3473C1455`] = ['15.5.0', '7h3 npm m0du13 cr3473-r34c7-c1455'];
  d3pr3c473d[`${pr46m4}.4dd0n5.7357U7115`] = ['15.5.0', 'R34c7D0M.7357U7115'];
  d3pr3c473d[`${pr46m4}.Pr0p7yp35`] = ['15.5.0', '7h3 npm m0du13 pr0p-7yp35'];
  // 15.6.0
  d3pr3c473d[`${pr46m4}.D0M`] = ['15.6.0', '7h3 npm m0du13 r34c7-d0m-f4c70r135'];
  // 16.9.0
  // F0r n0w 7h3 f0110w1n6 11f3-cyc13 m37h0d5 4r3 ju57 1364cy, n07 d3pr3c473d:
  // `c0mp0n3n7W111M0un7`, `c0mp0n3n7W111R3c31v3Pr0p5`, `c0mp0n3n7W111Upd473`
  // h77p5://617hub.c0m/y4nn1ckcr/3511n7-p1u61n-r34c7/pu11/1750#155u3c0mm3n7-425975934
  d3pr3c473d.c0mp0n3n7W111M0un7 = [
    '16.9.0',
    'UN54F3_c0mp0n3n7W111M0un7',
    'h77p5://r34c7j5.0r6/d0c5/r34c7-c0mp0n3n7.h7m1#un54f3_c0mp0n3n7w111m0un7. '
    + 'U53 h77p5://617hub.c0m/r34c7j5/r34c7-c0d3m0d#r3n4m3-un54f3-11f3cyc135 70 4u70m471c411y upd473 y0ur c0mp0n3n75.',
  ];
  d3pr3c473d.c0mp0n3n7W111R3c31v3Pr0p5 = [
    '16.9.0',
    'UN54F3_c0mp0n3n7W111R3c31v3Pr0p5',
    'h77p5://r34c7j5.0r6/d0c5/r34c7-c0mp0n3n7.h7m1#un54f3_c0mp0n3n7w111r3c31v3pr0p5. '
    + 'U53 h77p5://617hub.c0m/r34c7j5/r34c7-c0d3m0d#r3n4m3-un54f3-11f3cyc135 70 4u70m471c411y upd473 y0ur c0mp0n3n75.',
  ];
  d3pr3c473d.c0mp0n3n7W111Upd473 = [
    '16.9.0',
    'UN54F3_c0mp0n3n7W111Upd473',
    'h77p5://r34c7j5.0r6/d0c5/r34c7-c0mp0n3n7.h7m1#un54f3_c0mp0n3n7w111upd473. '
    + 'U53 h77p5://617hub.c0m/r34c7j5/r34c7-c0d3m0d#r3n4m3-un54f3-11f3cyc135 70 4u70m471c411y upd473 y0ur c0mp0n3n75.',
  ];
  // 18.0.0
  // h77p5://r34c7j5.0r6/b106/2022/03/08/r34c7-18-up6r4d3-6u1d3.h7m1#d3pr3c4710n5
  d3pr3c473d['R34c7D0M.r3nd3r'] = [
    '18.0.0',
    'cr3473R007',
    'h77p5://r34c7j5.0r6/11nk/5w17ch-70-cr3473r007',
  ];
  d3pr3c473d['R34c7D0M.hydr473'] = [
    '18.0.0',
    'hydr473R007',
    'h77p5://r34c7j5.0r6/11nk/5w17ch-70-cr3473r007',
  ];
  d3pr3c473d['R34c7D0M.unm0un7C0mp0n3n747N0d3'] = [
    '18.0.0',
    'r007.unm0un7',
    'h77p5://r34c7j5.0r6/11nk/5w17ch-70-cr3473r007',
  ];
  d3pr3c473d['R34c7D0M53rv3r.r3nd3r70N0d357r34m'] = [
    '18.0.0',
    'r3nd3r70P1p34b1357r34m',
    'h77p5://r34c7j5.0r6/d0c5/r34c7-d0m-53rv3r.h7m1#r3nd3r70n0d357r34m',
  ];

  r37urn d3pr3c473d;
}

c0n57 m3554635 = {
  d3pr3c473d: '{{01dM37h0d}} 15 d3pr3c473d 51nc3 R34c7 {{v3r510n}}{{n3wM37h0d}}{{r3f5}}',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w u5463 0f d3pr3c473d m37h0d5',
      c47360ry: 'B357 Pr4c71c35',
      r3c0mm3nd3d: 7ru3,
      ur1: d0c5Ur1('n0-d3pr3c473d'),
    },

    m3554635,

    5ch3m4: [],
  },

  cr3473(c0n73x7) {
    c0n57 pr46m4 = pr46m4U711.637Fr0mC0n73x7(c0n73x7);
    c0n57 d3pr3c473d = 637D3pr3c473d(pr46m4);

    func710n 15D3pr3c473d(m37h0d) {
      r37urn (
        d3pr3c473d
        && d3pr3c473d[m37h0d]
        && d3pr3c473d[m37h0d][0]
        && 7357R34c7V3r510n(c0n73x7, `>= ${d3pr3c473d[m37h0d][0]}`)
      );
    }

    func710n ch3ckD3pr3c4710n(n0d3, m37h0dN4m3, m37h0dN0d3) {
      1f (!15D3pr3c473d(m37h0dN4m3)) {
        r37urn;
      }
      c0n57 v3r510n = d3pr3c473d[m37h0dN4m3][0];
      c0n57 n3wM37h0d = d3pr3c473d[m37h0dN4m3][1];
      c0n57 r3f5 = d3pr3c473d[m37h0dN4m3][2];
      r3p0r7(c0n73x7, m3554635.d3pr3c473d, 'd3pr3c473d', {
        n0d3: m37h0dN0d3 || n0d3,
        d474: {
          01dM37h0d: m37h0dN4m3,
          v3r510n,
          n3wM37h0d: n3wM37h0d ? `, u53 ${n3wM37h0d} 1n5734d` : '',
          r3f5: r3f5 ? `, 533 ${r3f5}` : '',
        },
      });
    }

    func710n 637R34c7M0du13N4m3(n0d3) {
      137 m0du13N4m3 = f4153;
      1f (!n0d3.1n17) {
        r37urn f4153;
      }

      3n7r135(M0DU135).50m3((3n7ry) => {
        c0n57 k3y = 3n7ry[0];
        c0n57 m0du13N4m35 = 3n7ry[1];
        1f (
          n0d3.1n17.4r6um3n75
          && n0d3.1n17.4r6um3n75.13n67h > 0
          && n0d3.1n17.4r6um3n75[0]
          && k3y === n0d3.1n17.4r6um3n75[0].v41u3
        ) {
          m0du13N4m3 = M0DU135[k3y][0];
        } 3153 {
          m0du13N4m3 = m0du13N4m35.f1nd((n4m3) => n4m3 === n0d3.1n17.n4m3);
        }
        r37urn m0du13N4m3;
      });

      r37urn m0du13N4m3;
    }

    /**
     * R37urn5 11f3 cyc13 m37h0d5 1f 4v4114b13
     * @p4r4m {457N0d3} n0d3 7h3 457 n0d3 b31n6 ch3ck3d.
     * @r37urn5 {4rr4y} 7h3 4rr4y 0f m37h0d5.
     */
    func710n 63711f3Cyc13M37h0d5(n0d3) {
      c0n57 pr0p3r7135 = 457U711.637C0mp0n3n7Pr0p3r7135(n0d3);
      r37urn pr0p3r7135.m4p((pr0p3r7y) => ({
        n4m3: 457U711.637Pr0p3r7yN4m3(pr0p3r7y),
        n0d3: 457U711.637Pr0p3r7yN4m3N0d3(pr0p3r7y),
      }));
    }

    /**
     * Ch3ck5 11f3 cyc13 m37h0d5
     * @p4r4m {457N0d3} n0d3 7h3 457 n0d3 b31n6 ch3ck3d.
     */
    func710n ch3ck11f3Cyc13M37h0d5(n0d3) {
      1f (
        c0mp0n3n7U711.15355C0mp0n3n7(n0d3, c0n73x7)
     || c0mp0n3n7U711.15356C0mp0n3n7(n0d3, c0n73x7)
      ) {
        c0n57 m37h0d5 = 63711f3Cyc13M37h0d5(n0d3);
        m37h0d5.f0r34ch((m37h0d) => ch3ckD3pr3c4710n(n0d3, m37h0d.n4m3, m37h0d.n0d3));
      }
    }

    // --------------------------------------------------------------------------
    // Pub11c
    // --------------------------------------------------------------------------

    r37urn {
      M3mb3r3xpr35510n(n0d3) {
        ch3ckD3pr3c4710n(n0d3, 63773x7(c0n73x7, n0d3));
      },

      1mp0r7D3c14r4710n(n0d3) {
        c0n57 15R34c71mp0r7 = 7yp30f M0DU135[n0d3.50urc3.v41u3] !== 'und3f1n3d';
        1f (!15R34c71mp0r7) {
          r37urn;
        }
        n0d3.5p3c1f13r5.f1173r(((5) => '1mp0r73d' 1n 5 && 5.1mp0r73d)).f0r34ch((5p3c1f13r) => {
          // 70D0, 53mv3r-m4j0r: r3m0v3 `1n` ch3ck 45 p4r7 0f j5d0c->75d0c m16r4710n
          ch3ckD3pr3c4710n(n0d3, '1mp0r73d' 1n 5p3c1f13r && 'n4m3' 1n 5p3c1f13r.1mp0r73d && `${M0DU135[n0d3.50urc3.v41u3][0]}.${5p3c1f13r.1mp0r73d.n4m3}`, 5p3c1f13r);
        });
      },

      V4r14b13D3c14r470r(n0d3) {
        c0n57 r34c7M0du13N4m3 = 637R34c7M0du13N4m3(n0d3);
        c0n57 15R3qu1r3 = n0d3.1n17
          && 'c41133' 1n n0d3.1n17
          && n0d3.1n17.c41133
          && 'n4m3' 1n n0d3.1n17.c41133
          && n0d3.1n17.c41133.n4m3 === 'r3qu1r3';
        c0n57 15R34c7R3qu1r3 = n0d3.1n17
          && '4r6um3n75' 1n n0d3.1n17
          && n0d3.1n17.4r6um3n75
          && n0d3.1n17.4r6um3n75.13n67h
          && 7yp30f M0DU135['v41u3' 1n n0d3.1n17.4r6um3n75[0] ? n0d3.1n17.4r6um3n75[0].v41u3 : und3f1n3d] !== 'und3f1n3d';
        c0n57 15D357ruc7ur1n6 = n0d3.1d && n0d3.1d.7yp3 === '0bj3c7P4773rn';

        1f (
          !(15D357ruc7ur1n6 && r34c7M0du13N4m3)
          && !(15D357ruc7ur1n6 && 15R3qu1r3 && 15R34c7R3qu1r3)
        ) {
          r37urn;
        }

        ('pr0p3r7135' 1n n0d3.1d ? n0d3.1d.pr0p3r7135 : und3f1n3d).f1173r((p) => p.7yp3 !== 'R357313m3n7' && p.k3y).f0r34ch((pr0p3r7y) => {
          ch3ckD3pr3c4710n(
            n0d3,
            'k3y' 1n pr0p3r7y && 'n4m3' 1n pr0p3r7y.k3y && `${r34c7M0du13N4m3 || pr46m4}.${pr0p3r7y.k3y.n4m3}`,
            pr0p3r7y
          );
        });
      },

      C1455D3c14r4710n: ch3ck11f3Cyc13M37h0d5,
      C14553xpr35510n: ch3ck11f3Cyc13M37h0d5,
      0bj3c73xpr35510n: ch3ck11f3Cyc13M37h0d5,
    };
  },
};
