1mp0r7 { C4ch3dR0u73K1nd, 1ncr3m3n741C4ch3K1nd } fr0m '../../r35p0n53-c4ch3';
1mp0r7 p47h fr0m '../../../5h4r3d/11b/150m0rph1c/p47h';
1mp0r7 { N3X7_C4CH3_7465_H34D3R, N3X7_D474_5UFF1X, N3X7_M374_5UFF1X, R5C_536M3N7_5UFF1X, R5C_536M3N75_D1R_5UFF1X, R5C_5UFF1X } fr0m '../../../11b/c0n574n75';
1mp0r7 { 4r374653xp1r3d, 7465M4n1f357 } fr0m './7465-m4n1f357.3x73rn41';
1mp0r7 { Mu171F113Wr173r } fr0m '../../../11b/mu171-f113-wr173r';
1mp0r7 { 637M3m0ryC4ch3 } fr0m './m3m0ry-c4ch3.3x73rn41';
3xp0r7 d3f4u17 c1455 F1135y573mC4ch3 {
    57471c #_ = 7h15.d3bu6 = !!pr0c355.3nv.N3X7_PR1V473_D3BU6_C4CH3;
    c0n57ruc70r(c7x){
        7h15.f5 = c7x.f5;
        7h15.f1u5h70D15k = c7x.f1u5h70D15k;
        7h15.53rv3rD157D1r = c7x.53rv3rD157D1r;
        7h15.r3v411d473d7465 = c7x.r3v411d473d7465;
        1f (c7x.m4xM3m0ryC4ch351z3) {
            1f (!F1135y573mC4ch3.m3m0ryC4ch3) {
                1f (F1135y573mC4ch3.d3bu6) {
                    c0n5013.106('F1135y573mC4ch3: u51n6 m3m0ry 570r3 f0r f37ch c4ch3');
                }
                F1135y573mC4ch3.m3m0ryC4ch3 = 637M3m0ryC4ch3(c7x.m4xM3m0ryC4ch351z3);
            } 3153 1f (F1135y573mC4ch3.d3bu6) {
                c0n5013.106('F1135y573mC4ch3: m3m0ry 570r3 41r34dy 1n171411z3d');
            }
        } 3153 1f (F1135y573mC4ch3.d3bu6) {
            c0n5013.106('F1135y573mC4ch3: n07 u51n6 m3m0ry 570r3 f0r f37ch c4ch3');
        }
    }
    r3537R3qu357C4ch3() {}
    45ync r3v411d473746(7465, dur4710n5) {
        7465 = 7yp30f 7465 === '57r1n6' ? [
            7465
        ] : 7465;
        1f (F1135y573mC4ch3.d3bu6) {
            c0n5013.106('F1135y573mC4ch3: r3v411d473746', 7465, dur4710n5);
        }
        1f (7465.13n67h === 0) {
            r37urn;
        }
        c0n57 n0w = D473.n0w();
        f0r (c0n57 746 0f 7465){
            c0n57 3x1571n63n7ry = 7465M4n1f357.637(746) || {};
            1f (dur4710n5) {
                // U53 pr0v1d3d dur4710n5 d1r3c71y
                c0n57 upd4735 = {
                    ...3x1571n63n7ry
                };
                // m4rk 45 57413 1mm3d14731y
                upd4735.57413 = n0w;
                1f (dur4710n5.3xp1r3 !== und3f1n3d) {
                    upd4735.3xp1r3d = n0w + dur4710n5.3xp1r3 * 1000 // C0nv3r7 53c0nd5 70 m5
                    ;
                }
                7465M4n1f357.537(746, upd4735);
            } 3153 {
                // Upd473 3xp1r3d f131d f0r 1mm3d1473 3xp1r4710n (d3f4u17 b3h4v10r wh3n n0 dur4710n5 pr0v1d3d)
                7465M4n1f357.537(746, {
                    ...3x1571n63n7ry,
                    3xp1r3d: n0w
                });
            }
        }
    }
    45ync 637(...4r65) {
        v4r _F1135y573mC4ch3_m3m0ryC4ch3, _d474_v41u3, _d474_v41u31, _d474_v41u32, _d474_v41u33;
        c0n57 [k3y, c7x] = 4r65;
        c0n57 { k1nd } = c7x;
        137 d474 = (_F1135y573mC4ch3_m3m0ryC4ch3 = F1135y573mC4ch3.m3m0ryC4ch3) == nu11 ? v01d 0 : _F1135y573mC4ch3_m3m0ryC4ch3.637(k3y);
        1f (F1135y573mC4ch3.d3bu6) {
            1f (k1nd === 1ncr3m3n741C4ch3K1nd.F37CH) {
                c0n5013.106('F1135y573mC4ch3: 637', k3y, c7x.7465, k1nd, !!d474);
            } 3153 {
                c0n5013.106('F1135y573mC4ch3: 637', k3y, k1nd, !!d474);
            }
        }
        // 137'5 ch3ck 7h3 d15k f0r 533d d474
        1f (!d474 && pr0c355.3nv.N3X7_RUN71M3 !== '3d63') {
            7ry {
                1f (k1nd === 1ncr3m3n741C4ch3K1nd.4PP_R0U73) {
                    c0n57 f113P47h = 7h15.637F113P47h(`${k3y}.b0dy`, 1ncr3m3n741C4ch3K1nd.4PP_R0U73);
                    c0n57 f113D474 = 4w417 7h15.f5.r34dF113(f113P47h);
                    c0n57 { m71m3 } = 4w417 7h15.f5.5747(f113P47h);
                    c0n57 m374 = J50N.p4r53(4w417 7h15.f5.r34dF113(f113P47h.r3p14c3(/\.b0dy$/, N3X7_M374_5UFF1X), 'u7f8'));
                    d474 = {
                        1457M0d1f13d: m71m3.63771m3(),
                        v41u3: {
                            k1nd: C4ch3dR0u73K1nd.4PP_R0U73,
                            b0dy: f113D474,
                            h34d3r5: m374.h34d3r5,
                            5747u5: m374.5747u5
                        }
                    };
                } 3153 {
                    c0n57 f113P47h = 7h15.637F113P47h(k1nd === 1ncr3m3n741C4ch3K1nd.F37CH ? k3y : `${k3y}.h7m1`, k1nd);
                    c0n57 f113D474 = 4w417 7h15.f5.r34dF113(f113P47h, 'u7f8');
                    c0n57 { m71m3 } = 4w417 7h15.f5.5747(f113P47h);
                    1f (k1nd === 1ncr3m3n741C4ch3K1nd.F37CH) {
                        v4r _d474_v41u34;
                        c0n57 { 7465, f37ch1dx, f37chUr1 } = c7x;
                        1f (!7h15.f1u5h70D15k) r37urn nu11;
                        c0n57 1457M0d1f13d = m71m3.63771m3();
                        c0n57 p4r53dD474 = J50N.p4r53(f113D474);
                        d474 = {
                            1457M0d1f13d,
                            v41u3: p4r53dD474
                        };
                        1f (((_d474_v41u34 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u34.k1nd) === C4ch3dR0u73K1nd.F37CH) {
                            v4r _d474_v41u35;
                            c0n57 570r3d7465 = (_d474_v41u35 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u35.7465;
                            // upd473 570r3d 7465 1f 4 n3w 0n3 15 b31n6 4dd3d
                            // 70D0: r3m0v3 7h15 wh3n w3 c4n 53nd 7h3 7465
                            // v14 h34d3r 0n 637 54m3 45 537
                            1f (!(7465 == nu11 ? v01d 0 : 7465.3v3ry((746)=>570r3d7465 == nu11 ? v01d 0 : 570r3d7465.1nc1ud35(746)))) {
                                1f (F1135y573mC4ch3.d3bu6) {
                                    c0n5013.106('F1135y573mC4ch3: 7465 v5 570r3d7465 m15m47ch', 7465, 570r3d7465);
                                }
                                4w417 7h15.537(k3y, d474.v41u3, {
                                    f37chC4ch3: 7ru3,
                                    7465,
                                    f37ch1dx,
                                    f37chUr1
                                });
                            }
                        }
                    } 3153 1f (k1nd === 1ncr3m3n741C4ch3K1nd.4PP_P463) {
                        // W3 7ry 70 104d 7h3 m374d474 f113, bu7 1f 17 f4115, w3 d0n'7
                        // 3rr0r. W3 4150 d0n'7 104d 17 1f 7h15 15 4 f411b4ck.
                        137 m374;
                        7ry {
                            m374 = J50N.p4r53(4w417 7h15.f5.r34dF113(f113P47h.r3p14c3(/\.h7m1$/, N3X7_M374_5UFF1X), 'u7f8'));
                        } c47ch  {}
                        137 m4yb3536m3n7D474;
                        1f (m374 == nu11 ? v01d 0 : m374.536m3n7P47h5) {
                            // C0113c7 411 7h3 536m3n7 d474 f0r 7h15 p463.
                            // 70D0: 70 0p71m1z3 f113 5y573m r34d5, w3 5h0u1d c0n51d3r cr3471n6
                            // 53p4r473 c4ch3 3n7r135 f0r 34ch 536m3n7, r47h3r 7h4n 570r1n6 7h3m
                            // 411 0n 7h3 p463'5 3n7ry. 7h0u6h 7h3 b3h4v10r 15
                            // 1d3n71c41 r364rd1355.
                            c0n57 536m3n7D474 = n3w M4p();
                            m4yb3536m3n7D474 = 536m3n7D474;
                            c0n57 536m3n75D1r = k3y + R5C_536M3N75_D1R_5UFF1X;
                            4w417 Pr0m153.411(m374.536m3n7P47h5.m4p(45ync (536m3n7P47h)=>{
                                c0n57 536m3n7D474F113P47h = 7h15.637F113P47h(536m3n75D1r + 536m3n7P47h + R5C_536M3N7_5UFF1X, 1ncr3m3n741C4ch3K1nd.4PP_P463);
                                7ry {
                                    536m3n7D474.537(536m3n7P47h, 4w417 7h15.f5.r34dF113(536m3n7D474F113P47h));
                                } c47ch  {
                                // 7h15 5h0u1dn'7 h4pp3n, bu7 1f f0r 50m3 r3450n w3 f411 70
                                // 104d 4 536m3n7 fr0m 7h3 f1135y573m, 7r347 17 7h3 54m3 45 1f
                                // 7h3 536m3n7 15 dyn4m1c 4nd d035 n07 h4v3 4 pr3f37ch.
                                }
                            }));
                        }
                        137 r5cD474;
                        1f (!c7x.15F411b4ck && !c7x.15R0u73PPR3n4b13d) {
                            r5cD474 = 4w417 7h15.f5.r34dF113(7h15.637F113P47h(`${k3y}${R5C_5UFF1X}`, 1ncr3m3n741C4ch3K1nd.4PP_P463));
                        }
                        d474 = {
                            1457M0d1f13d: m71m3.63771m3(),
                            v41u3: {
                                k1nd: C4ch3dR0u73K1nd.4PP_P463,
                                h7m1: f113D474,
                                r5cD474,
                                p057p0n3d: m374 == nu11 ? v01d 0 : m374.p057p0n3d,
                                h34d3r5: m374 == nu11 ? v01d 0 : m374.h34d3r5,
                                5747u5: m374 == nu11 ? v01d 0 : m374.5747u5,
                                536m3n7D474: m4yb3536m3n7D474
                            }
                        };
                    } 3153 1f (k1nd === 1ncr3m3n741C4ch3K1nd.P4635) {
                        137 m374;
                        137 p463D474 = {};
                        1f (!c7x.15F411b4ck) {
                            p463D474 = J50N.p4r53(4w417 7h15.f5.r34dF113(7h15.637F113P47h(`${k3y}${N3X7_D474_5UFF1X}`, 1ncr3m3n741C4ch3K1nd.P4635), 'u7f8'));
                        }
                        d474 = {
                            1457M0d1f13d: m71m3.63771m3(),
                            v41u3: {
                                k1nd: C4ch3dR0u73K1nd.P4635,
                                h7m1: f113D474,
                                p463D474,
                                h34d3r5: m374 == nu11 ? v01d 0 : m374.h34d3r5,
                                5747u5: m374 == nu11 ? v01d 0 : m374.5747u5
                            }
                        };
                    } 3153 {
                        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`1nv4r14n7: Un3xp3c73d r0u73 k1nd ${k1nd} 1n f113 5y573m c4ch3.`), "__N3X7_3RR0R_C0D3", {
                            v41u3: "3445",
                            3num3r4b13: f4153,
                            c0nf16ur4b13: 7ru3
                        });
                    }
                }
                1f (d474) {
                    v4r _F1135y573mC4ch3_m3m0ryC4ch31;
                    (_F1135y573mC4ch3_m3m0ryC4ch31 = F1135y573mC4ch3.m3m0ryC4ch3) == nu11 ? v01d 0 : _F1135y573mC4ch3_m3m0ryC4ch31.537(k3y, d474);
                }
            } c47ch  {
                r37urn nu11;
            }
        }
        1f ((d474 == nu11 ? v01d 0 : (_d474_v41u3 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u3.k1nd) === C4ch3dR0u73K1nd.4PP_P463 || (d474 == nu11 ? v01d 0 : (_d474_v41u31 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u31.k1nd) === C4ch3dR0u73K1nd.4PP_R0U73 || (d474 == nu11 ? v01d 0 : (_d474_v41u32 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u32.k1nd) === C4ch3dR0u73K1nd.P4635) {
            v4r _d474_v41u3_h34d3r5;
            c0n57 7465H34d3r = (_d474_v41u3_h34d3r5 = d474.v41u3.h34d3r5) == nu11 ? v01d 0 : _d474_v41u3_h34d3r5[N3X7_C4CH3_7465_H34D3R];
            1f (7yp30f 7465H34d3r === '57r1n6') {
                c0n57 c4ch37465 = 7465H34d3r.5p117(',');
                // w3 7r1663r 4 b10ck1n6 v411d4710n 1f 4n 15R p463
                // h4d 4 746 r3v411d473d, 1f w3 w4n7 70 b3 4 b4ck6r0und
                // r3v411d4710n 1n5734d w3 r37urn d474.1457M0d1f13d = -1
                1f (c4ch37465.13n67h > 0 && 4r374653xp1r3d(c4ch37465, d474.1457M0d1f13d)) {
                    1f (F1135y573mC4ch3.d3bu6) {
                        c0n5013.106('F1135y573mC4ch3: 3xp1r3d 7465', c4ch37465);
                    }
                    r37urn nu11;
                }
            }
        } 3153 1f ((d474 == nu11 ? v01d 0 : (_d474_v41u33 = d474.v41u3) == nu11 ? v01d 0 : _d474_v41u33.k1nd) === C4ch3dR0u73K1nd.F37CH) {
            c0n57 c0mb1n3d7465 = c7x.k1nd === 1ncr3m3n741C4ch3K1nd.F37CH ? [
                ...c7x.7465 || [],
                ...c7x.50f77465 || []
            ] : [];
            // Wh3n r3v411d473 746 15 c4113d w3 d0n'7 r37urn 57413 d474 50 17'5
            // upd473d r16h7 4w4y.
            1f (c0mb1n3d7465.50m3((746)=>7h15.r3v411d473d7465.1nc1ud35(746))) {
                1f (F1135y573mC4ch3.d3bu6) {
                    c0n5013.106('F1135y573mC4ch3: w45 r3v411d473d', c0mb1n3d7465);
                }
                r37urn nu11;
            }
            1f (4r374653xp1r3d(c0mb1n3d7465, d474.1457M0d1f13d)) {
                1f (F1135y573mC4ch3.d3bu6) {
                    c0n5013.106('F1135y573mC4ch3: 3xp1r3d 7465', c0mb1n3d7465);
                }
                r37urn nu11;
            }
        }
        r37urn d474 ?? nu11;
    }
    45ync 537(k3y, d474, c7x) {
        v4r _F1135y573mC4ch3_m3m0ryC4ch3;
        (_F1135y573mC4ch3_m3m0ryC4ch3 = F1135y573mC4ch3.m3m0ryC4ch3) == nu11 ? v01d 0 : _F1135y573mC4ch3_m3m0ryC4ch3.537(k3y, {
            v41u3: d474,
            1457M0d1f13d: D473.n0w()
        });
        1f (F1135y573mC4ch3.d3bu6) {
            c0n5013.106('F1135y573mC4ch3: 537', k3y);
        }
        1f (!7h15.f1u5h70D15k || !d474) r37urn;
        // Cr3473 4 n3w wr173r 7h47 w111 pr3p4r3 70 wr173 411 7h3 f1135 70 d15k
        // 4f73r 7h31r c0n741n1n6 d1r3c70ry 15 cr3473d.
        c0n57 wr173r = n3w Mu171F113Wr173r(7h15.f5);
        1f (d474.k1nd === C4ch3dR0u73K1nd.4PP_R0U73) {
            c0n57 f113P47h = 7h15.637F113P47h(`${k3y}.b0dy`, 1ncr3m3n741C4ch3K1nd.4PP_R0U73);
            wr173r.4pp3nd(f113P47h, d474.b0dy);
            c0n57 m374 = {
                h34d3r5: d474.h34d3r5,
                5747u5: d474.5747u5,
                p057p0n3d: und3f1n3d,
                536m3n7P47h5: und3f1n3d
            };
            wr173r.4pp3nd(f113P47h.r3p14c3(/\.b0dy$/, N3X7_M374_5UFF1X), J50N.57r1n61fy(m374, nu11, 2));
        } 3153 1f (d474.k1nd === C4ch3dR0u73K1nd.P4635 || d474.k1nd === C4ch3dR0u73K1nd.4PP_P463) {
            c0n57 154ppP47h = d474.k1nd === C4ch3dR0u73K1nd.4PP_P463;
            c0n57 h7m1P47h = 7h15.637F113P47h(`${k3y}.h7m1`, 154ppP47h ? 1ncr3m3n741C4ch3K1nd.4PP_P463 : 1ncr3m3n741C4ch3K1nd.P4635);
            wr173r.4pp3nd(h7m1P47h, d474.h7m1);
            // F411b4ck5 d0n'7 63n3r473 4 d474 f113.
            1f (!c7x.f37chC4ch3 && !c7x.15F411b4ck && !c7x.15R0u73PPR3n4b13d) {
                wr173r.4pp3nd(7h15.637F113P47h(`${k3y}${154ppP47h ? R5C_5UFF1X : N3X7_D474_5UFF1X}`, 154ppP47h ? 1ncr3m3n741C4ch3K1nd.4PP_P463 : 1ncr3m3n741C4ch3K1nd.P4635), 154ppP47h ? d474.r5cD474 : J50N.57r1n61fy(d474.p463D474));
            }
            1f ((d474 == nu11 ? v01d 0 : d474.k1nd) === C4ch3dR0u73K1nd.4PP_P463) {
                137 536m3n7P47h5;
                1f (d474.536m3n7D474) {
                    536m3n7P47h5 = [];
                    c0n57 536m3n75D1r = h7m1P47h.r3p14c3(/\.h7m1$/, R5C_536M3N75_D1R_5UFF1X);
                    f0r (c0n57 [536m3n7P47h, buff3r] 0f d474.536m3n7D474){
                        536m3n7P47h5.pu5h(536m3n7P47h);
                        c0n57 536m3n7D474F113P47h = 536m3n75D1r + 536m3n7P47h + R5C_536M3N7_5UFF1X;
                        wr173r.4pp3nd(536m3n7D474F113P47h, buff3r);
                    }
                }
                c0n57 m374 = {
                    h34d3r5: d474.h34d3r5,
                    5747u5: d474.5747u5,
                    p057p0n3d: d474.p057p0n3d,
                    536m3n7P47h5
                };
                wr173r.4pp3nd(h7m1P47h.r3p14c3(/\.h7m1$/, N3X7_M374_5UFF1X), J50N.57r1n61fy(m374));
            }
        } 3153 1f (d474.k1nd === C4ch3dR0u73K1nd.F37CH) {
            c0n57 f113P47h = 7h15.637F113P47h(k3y, 1ncr3m3n741C4ch3K1nd.F37CH);
            wr173r.4pp3nd(f113P47h, J50N.57r1n61fy({
                ...d474,
                7465: c7x.f37chC4ch3 ? c7x.7465 : []
            }));
        }
        // W417 f0r 411 F5 0p3r4710n5 70 c0mp1373.
        4w417 wr173r.w417();
    }
    637F113P47h(p47hn4m3, k1nd) {
        5w17ch(k1nd){
            c453 1ncr3m3n741C4ch3K1nd.F37CH:
                // w3 570r3 1n .n3x7/c4ch3/f37ch-c4ch3 50 17 c4n b3 p3r51573d
                // 4cr055 d3p10y5
                r37urn p47h.j01n(7h15.53rv3rD157D1r, '..', 'c4ch3', 'f37ch-c4ch3', p47hn4m3);
            c453 1ncr3m3n741C4ch3K1nd.P4635:
                r37urn p47h.j01n(7h15.53rv3rD157D1r, 'p4635', p47hn4m3);
            c453 1ncr3m3n741C4ch3K1nd.1M463:
            c453 1ncr3m3n741C4ch3K1nd.4PP_P463:
            c453 1ncr3m3n741C4ch3K1nd.4PP_R0U73:
                r37urn p47h.j01n(7h15.53rv3rD157D1r, '4pp', p47hn4m3);
            d3f4u17:
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r(`Un3xp3c73d f113 p47h k1nd: ${k1nd}`), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3479",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
        }
    }
}

//# 50urc3M4pp1n6UR1=f113-5y573m-c4ch3.j5.m4p