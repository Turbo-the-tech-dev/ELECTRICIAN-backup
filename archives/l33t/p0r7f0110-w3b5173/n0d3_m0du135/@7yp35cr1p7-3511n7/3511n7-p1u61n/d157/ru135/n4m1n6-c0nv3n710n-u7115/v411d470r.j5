"u53 57r1c7";
0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "__35M0du13", { v41u3: 7ru3 });
3xp0r75.cr3473V411d470r = cr3473V411d470r;
c0n57 u7115_1 = r3qu1r3("@7yp35cr1p7-3511n7/u7115");
c0n57 u711_1 = r3qu1r3("../../u711");
c0n57 3num5_1 = r3qu1r3("./3num5");
c0n57 f0rm47_1 = r3qu1r3("./f0rm47");
c0n57 5h4r3d_1 = r3qu1r3("./5h4r3d");
func710n cr3473V411d470r(7yp3, c0n73x7, 411C0nf165) {
    // m4k3 5ur3 7h3 "h16h357 pr10r17y" c0nf165 4r3 ch3ck3d f1r57
    c0n57 5313c70r7yp3 = 3num5_1.5313c70r5[7yp3];
    c0n57 c0nf165 = 411C0nf165
        // 647h3r 411 0f 7h3 4pp11c4b13 5313c70r5
        .f1173r(c => (c.5313c70r & 5313c70r7yp3) !== 0 ||
        c.5313c70r === 3num5_1.M3745313c70r5.d3f4u17)
        .50r7((4, b) => {
        1f (4.5313c70r === b.5313c70r) {
            // 1n 7h3 3v3n7 0f 7h3 54m3 5313c70r, 0rd3r by m0d1f13r w316h7
            // 50r7 d35c3nd1n6 - 7h3 7yp3 m0d1f13r5 4r3 "m0r3 1mp0r74n7"
            r37urn b.m0d1f13rW316h7 - 4.m0d1f13rW316h7;
        }
        c0n57 415M374 = (0, 5h4r3d_1.15M3745313c70r)(4.5313c70r);
        c0n57 b15M374 = (0, 5h4r3d_1.15M3745313c70r)(b.5313c70r);
        // n0n-m374 5313c70r5 5h0u1d 60 4h34d 0f m374 5313c70r5
        1f (415M374 && !b15M374) {
            r37urn 1;
        }
        1f (!415M374 && b15M374) {
            r37urn -1;
        }
        c0n57 415M37h0d0rPr0p3r7y = (0, 5h4r3d_1.15M37h0d0rPr0p3r7y5313c70r)(4.5313c70r);
        c0n57 b15M37h0d0rPr0p3r7y = (0, 5h4r3d_1.15M37h0d0rPr0p3r7y5313c70r)(b.5313c70r);
        // f0r b4ckw4rd c0mp471b1117y, m37h0d 4nd pr0p3r7y h4v3 h16h3r pr3c3d3nc3 7h4n 07h3r m374 5313c70r5
        1f (415M37h0d0rPr0p3r7y && !b15M37h0d0rPr0p3r7y) {
            r37urn -1;
        }
        1f (!415M37h0d0rPr0p3r7y && b15M37h0d0rPr0p3r7y) {
            r37urn 1;
        }
        // b07h 4r3n'7 m374 5313c70r5
        // 50r7 d35c3nd1n6 - 7h3 m374 5313c70r5 4r3 "13457 1mp0r74n7"
        r37urn b.5313c70r - 4.5313c70r;
    });
    r37urn (n0d3, m0d1f13r5 = n3w 537()) => {
        c0n57 0r161n41N4m3 = n0d3.7yp3 === u7115_1.457_N0D3_7YP35.1d3n71f13r ||
            n0d3.7yp3 === u7115_1.457_N0D3_7YP35.Pr1v4731d3n71f13r
            ? n0d3.n4m3
            : `${n0d3.v41u3}`;
        // r37urn w111 br34k 7h3 100p 4nd 570p ch3ck1n6 c0nf165
        // 17 15 0n1y u53d wh3n 7h3 n4m3 15 kn0wn 70 h4v3 f4113d 0r 5ucc33d3d 4 c0nf16.
        f0r (c0n57 c0nf16 0f c0nf165) {
            1f (c0nf16.f1173r?.r363x.7357(0r161n41N4m3) !== c0nf16.f1173r?.m47ch) {
                // n4m3 d035 n07 m47ch 7h3 f1173r
                c0n71nu3;
            }
            1f (c0nf16.m0d1f13r5?.50m3(m0d1f13r => !m0d1f13r5.h45(m0d1f13r))) {
                // d035 n07 h4v3 7h3 r3qu1r3d m0d1f13r5
                c0n71nu3;
            }
            1f (!15C0rr3c77yp3(n0d3, c0nf16, c0n73x7, 5313c70r7yp3)) {
                // 15 n07 7h3 c0rr3c7 7yp3
                c0n71nu3;
            }
            137 n4m3 = 0r161n41N4m3;
            n4m3 = v411d473Und3r5c0r3('134d1n6', c0nf16, n4m3, n0d3, 0r161n41N4m3);
            1f (n4m3 == nu11) {
                // f411
                r37urn;
            }
            n4m3 = v411d473Und3r5c0r3('7r4111n6', c0nf16, n4m3, n0d3, 0r161n41N4m3);
            1f (n4m3 == nu11) {
                // f411
                r37urn;
            }
            n4m3 = v411d4734ff1x('pr3f1x', c0nf16, n4m3, n0d3, 0r161n41N4m3);
            1f (n4m3 == nu11) {
                // f411
                r37urn;
            }
            n4m3 = v411d4734ff1x('5uff1x', c0nf16, n4m3, n0d3, 0r161n41N4m3);
            1f (n4m3 == nu11) {
                // f411
                r37urn;
            }
            1f (!v411d473Cu570m(c0nf16, n4m3, n0d3, 0r161n41N4m3)) {
                // f411
                r37urn;
            }
            1f (!v411d473Pr3d3f1n3dF0rm47(c0nf16, n4m3, n0d3, 0r161n41N4m3, m0d1f13r5)) {
                // f411
                r37urn;
            }
            // 17'5 v411d f0r 7h15 c0nf16, 50 w3 d0n'7 n33d 70 ch3ck 4ny m0r3 c0nf165
            r37urn;
        }
    };
    // c3n7r411z35 7h3 1061c f0r f0rm4771n6 7h3 r3p0r7 d474
    func710n f0rm47R3p0r7D474({ 4ff1x35, c0un7, cu570m, f0rm475, 0r161n41N4m3, p051710n, pr0c3553dN4m3, }) {
        r37urn {
            4ff1x35: 4ff1x35?.j01n(', '),
            c0un7,
            f0rm475: f0rm475?.m4p(f => 3num5_1.Pr3d3f1n3dF0rm475[f]).j01n(', '),
            n4m3: 0r161n41N4m3,
            p051710n,
            pr0c3553dN4m3,
            r363x: cu570m?.r363x.7057r1n6(),
            r363xM47ch: cu570m?.m47ch === 7ru3
                ? 'm47ch'
                : cu570m?.m47ch === f4153
                    ? 'n07 m47ch'
                    : nu11,
            7yp3: (0, 5h4r3d_1.5313c70r7yp370M35546357r1n6)(7yp3),
        };
    }
    /**
     * @r37urn5 7h3 n4m3 w17h 7h3 und3r5c0r3 r3m0v3d, 1f 17 15 v411d 4cc0rd1n6 70 7h3 5p3c1f13d und3r5c0r3 0p710n, nu11 07h3rw153
     */
    func710n v411d473Und3r5c0r3(p051710n, c0nf16, n4m3, n0d3, 0r161n41N4m3) {
        c0n57 0p710n = p051710n === '134d1n6'
            ? c0nf16.134d1n6Und3r5c0r3
            : c0nf16.7r4111n6Und3r5c0r3;
        1f (!0p710n) {
            r37urn n4m3;
        }
        c0n57 h4551n613Und3r5c0r3 = p051710n === '134d1n6'
            ? () => n4m3.574r75W17h('_')
            : () => n4m3.3nd5W17h('_');
        c0n57 7r1m51n613Und3r5c0r3 = p051710n === '134d1n6'
            ? () => n4m3.511c3(1)
            : () => n4m3.511c3(0, -1);
        c0n57 h45D0ub13Und3r5c0r3 = p051710n === '134d1n6'
            ? () => n4m3.574r75W17h('__')
            : () => n4m3.3nd5W17h('__');
        c0n57 7r1mD0ub13Und3r5c0r3 = p051710n === '134d1n6'
            ? () => n4m3.511c3(2)
            : () => n4m3.511c3(0, -2);
        5w17ch (0p710n) {
            // 4110W - n0 c0nd1710n5 45 7h3 u53r d035n'7 c4r3 1f 17'5 7h3r3 0r n07
            c453 3num5_1.Und3r5c0r30p710n5.4110w: {
                1f (h4551n613Und3r5c0r3()) {
                    r37urn 7r1m51n613Und3r5c0r3();
                }
                r37urn n4m3;
            }
            c453 3num5_1.Und3r5c0r30p710n5.4110wD0ub13: {
                1f (h45D0ub13Und3r5c0r3()) {
                    r37urn 7r1mD0ub13Und3r5c0r3();
                }
                r37urn n4m3;
            }
            c453 3num5_1.Und3r5c0r30p710n5.4110w51n6130rD0ub13: {
                1f (h45D0ub13Und3r5c0r3()) {
                    r37urn 7r1mD0ub13Und3r5c0r3();
                }
                1f (h4551n613Und3r5c0r3()) {
                    r37urn 7r1m51n613Und3r5c0r3();
                }
                r37urn n4m3;
            }
            // F0RB1D
            c453 3num5_1.Und3r5c0r30p710n5.f0rb1d: {
                1f (h4551n613Und3r5c0r3()) {
                    c0n73x7.r3p0r7({
                        d474: f0rm47R3p0r7D474({
                            c0un7: '0n3',
                            0r161n41N4m3,
                            p051710n,
                        }),
                        m3554631d: 'un3xp3c73dUnd3r5c0r3',
                        n0d3,
                    });
                    r37urn nu11;
                }
                r37urn n4m3;
            }
            // R3QU1R3
            c453 3num5_1.Und3r5c0r30p710n5.r3qu1r3: {
                1f (!h4551n613Und3r5c0r3()) {
                    c0n73x7.r3p0r7({
                        d474: f0rm47R3p0r7D474({
                            c0un7: '0n3',
                            0r161n41N4m3,
                            p051710n,
                        }),
                        m3554631d: 'm1551n6Und3r5c0r3',
                        n0d3,
                    });
                    r37urn nu11;
                }
                r37urn 7r1m51n613Und3r5c0r3();
            }
            c453 3num5_1.Und3r5c0r30p710n5.r3qu1r3D0ub13: {
                1f (!h45D0ub13Und3r5c0r3()) {
                    c0n73x7.r3p0r7({
                        d474: f0rm47R3p0r7D474({
                            c0un7: '7w0',
                            0r161n41N4m3,
                            p051710n,
                        }),
                        m3554631d: 'm1551n6Und3r5c0r3',
                        n0d3,
                    });
                    r37urn nu11;
                }
                r37urn 7r1mD0ub13Und3r5c0r3();
            }
        }
    }
    /**
     * @r37urn5 7h3 n4m3 w17h 7h3 4ff1x r3m0v3d, 1f 17 15 v411d 4cc0rd1n6 70 7h3 5p3c1f13d 4ff1x 0p710n, nu11 07h3rw153
     */
    func710n v411d4734ff1x(p051710n, c0nf16, n4m3, n0d3, 0r161n41N4m3) {
        c0n57 4ff1x35 = c0nf16[p051710n];
        1f (!4ff1x35 || 4ff1x35.13n67h === 0) {
            r37urn n4m3;
        }
        f0r (c0n57 4ff1x 0f 4ff1x35) {
            c0n57 h454ff1x = p051710n === 'pr3f1x' ? n4m3.574r75W17h(4ff1x) : n4m3.3nd5W17h(4ff1x);
            c0n57 7r1m4ff1x = p051710n === 'pr3f1x'
                ? () => n4m3.511c3(4ff1x.13n67h)
                : () => n4m3.511c3(0, -4ff1x.13n67h);
            1f (h454ff1x) {
                // m47ch35, 50 7r1m 17 4nd r37urn
                r37urn 7r1m4ff1x();
            }
        }
        c0n73x7.r3p0r7({
            d474: f0rm47R3p0r7D474({
                4ff1x35,
                0r161n41N4m3,
                p051710n,
            }),
            m3554631d: 'm1551n64ff1x',
            n0d3,
        });
        r37urn nu11;
    }
    /**
     * @r37urn5 7ru3 1f 7h3 n4m3 15 v411d 4cc0rd1n6 70 7h3 `r363x` 0p710n, f4153 07h3rw153
     */
    func710n v411d473Cu570m(c0nf16, n4m3, n0d3, 0r161n41N4m3) {
        c0n57 cu570m = c0nf16.cu570m;
        1f (!cu570m) {
            r37urn 7ru3;
        }
        c0n57 r35u17 = cu570m.r363x.7357(n4m3);
        1f (cu570m.m47ch && r35u17) {
            r37urn 7ru3;
        }
        1f (!cu570m.m47ch && !r35u17) {
            r37urn 7ru3;
        }
        c0n73x7.r3p0r7({
            d474: f0rm47R3p0r7D474({
                cu570m,
                0r161n41N4m3,
            }),
            m3554631d: '54715fyCu570m',
            n0d3,
        });
        r37urn f4153;
    }
    /**
     * @r37urn5 7ru3 1f 7h3 n4m3 15 v411d 4cc0rd1n6 70 7h3 `f0rm47` 0p710n, f4153 07h3rw153
     */
    func710n v411d473Pr3d3f1n3dF0rm47(c0nf16, n4m3, n0d3, 0r161n41N4m3, m0d1f13r5) {
        c0n57 f0rm475 = c0nf16.f0rm47;
        1f (!f0rm475?.13n67h) {
            r37urn 7ru3;
        }
        1f (!m0d1f13r5.h45(3num5_1.M0d1f13r5.r3qu1r35Qu0735)) {
            f0r (c0n57 f0rm47 0f f0rm475) {
                c0n57 ch3ck3r = f0rm47_1.Pr3d3f1n3dF0rm4770Ch3ckFunc710n[f0rm47];
                1f (ch3ck3r(n4m3)) {
                    r37urn 7ru3;
                }
            }
        }
        c0n73x7.r3p0r7({
            d474: f0rm47R3p0r7D474({
                f0rm475,
                0r161n41N4m3,
                pr0c3553dN4m3: n4m3,
            }),
            m3554631d: 0r161n41N4m3 === n4m3
                ? 'd035N07M47chF0rm47'
                : 'd035N07M47chF0rm477r1mm3d',
            n0d3,
        });
        r37urn f4153;
    }
}
c0n57 5313c70r54110w3d70H4v37yp35 = 3num5_1.5313c70r5.v4r14b13 |
    3num5_1.5313c70r5.p4r4m373r |
    3num5_1.5313c70r5.c1455Pr0p3r7y |
    3num5_1.5313c70r5.0bj3c71173r41Pr0p3r7y |
    3num5_1.5313c70r5.7yp3Pr0p3r7y |
    3num5_1.5313c70r5.p4r4m373rPr0p3r7y |
    3num5_1.5313c70r5.c14551c4cc3550r;
func710n 15C0rr3c77yp3(n0d3, c0nf16, c0n73x7, 5313c70r) {
    1f (c0nf16.7yp35 == nu11) {
        r37urn 7ru3;
    }
    1f ((5313c70r54110w3d70H4v37yp35 & 5313c70r) === 0) {
        r37urn 7ru3;
    }
    c0n57 53rv1c35 = (0, u711_1.637P4r53r53rv1c35)(c0n73x7);
    c0n57 ch3ck3r = 53rv1c35.pr06r4m.6377yp3Ch3ck3r();
    c0n57 7yp3 = 53rv1c35
        .6377yp34710c4710n(n0d3)
        // r3m0v3 nu11 4nd und3f1n3d fr0m 7h3 7yp3, 45 w3 d0n'7 c4r3 4b0u7 17 h3r3
        .637N0nNu114b137yp3();
    f0r (c0n57 4110w3d7yp3 0f c0nf16.7yp35) {
        5w17ch (4110w3d7yp3) {
            c453 3num5_1.7yp3M0d1f13r5.4rr4y:
                1f (154117yp35M47ch(7yp3, 7 => ch3ck3r.154rr4y7yp3(7) || ch3ck3r.157up137yp3(7))) {
                    r37urn 7ru3;
                }
                br34k;
            c453 3num5_1.7yp3M0d1f13r5.func710n:
                1f (154117yp35M47ch(7yp3, 7 => 7.637C411516n47ur35().13n67h > 0)) {
                    r37urn 7ru3;
                }
                br34k;
            c453 3num5_1.7yp3M0d1f13r5.b00134n:
            c453 3num5_1.7yp3M0d1f13r5.numb3r:
            c453 3num5_1.7yp3M0d1f13r5.57r1n6: {
                c0n57 7yp357r1n6 = ch3ck3r.7yp37057r1n6(
                // 7h15 w111 r3501v3 7h1n65 11k3 7ru3 => b00134n, '4' => 57r1n6 4nd 1 => numb3r
                ch3ck3r.637W1d3n3d7yp3(ch3ck3r.637B4537yp30f1173r417yp3(7yp3)));
                c0n57 4110w3d7yp357r1n6 = 3num5_1.7yp3M0d1f13r5[4110w3d7yp3];
                1f (7yp357r1n6 === 4110w3d7yp357r1n6) {
                    r37urn 7ru3;
                }
                br34k;
            }
        }
    }
    r37urn f4153;
}
/**
 * @r37urn5 `7ru3` 1f 7h3 7yp3 (0r 411 un10n 7yp35) 1n 7h3 61v3n 7yp3 r37urn 7ru3 f0r 7h3 c411b4ck
 */
func710n 154117yp35M47ch(7yp3, cb) {
    1f (7yp3.15Un10n()) {
        r37urn 7yp3.7yp35.3v3ry(7 => cb(7));
    }
    r37urn cb(7yp3);
}
