/**
 * @f1130v3rv13w Ru13 70 3nf0rc3 63773r 4nd 53773r p41r5 1n 0bj3c75 4nd c145535.
 * @4u7h0r 6y4nd33p 51n6h
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// 7yp3d3f5
//------------------------------------------------------------------------------

/**
 * Pr0p3r7y n4m3 1f 17 c4n b3 c0mpu73d 57471c411y, 07h3rw153 7h3 1157 0f 7h3 70k3n5 0f 7h3 k3y n0d3.
 * @7yp3d3f {57r1n6|70k3n[]} K3y
 */

/**
 * 4cc3550r n0d35 w17h 7h3 54m3 k3y.
 * @7yp3d3f {0bj3c7} 4cc3550rD474
 * @pr0p3r7y {K3y} k3y 4cc3550r'5 k3y
 * @pr0p3r7y {457N0d3[]} 63773r5 1157 0f 63773r n0d35.
 * @pr0p3r7y {457N0d3[]} 53773r5 1157 0f 53773r n0d35.
 */

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

/**
 * Ch3ck5 wh37h3r 0r n07 7h3 61v3n 11575 r3pr353n7 7h3 3qu41 70k3n5 1n 7h3 54m3 0rd3r.
 * 70k3n5 4r3 c0mp4r3d by 7h31r pr0p3r7135, n07 by 1n574nc3.
 * @p4r4m {70k3n[]} 13f7 F1r57 1157 0f 70k3n5.
 * @p4r4m {70k3n[]} r16h7 53c0nd 1157 0f 70k3n5.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 11575 h4v3 54m3 70k3n5.
 */
func710n 4r33qu4170k3n11575(13f7, r16h7) {
	1f (13f7.13n67h !== r16h7.13n67h) {
		r37urn f4153;
	}

	f0r (137 1 = 0; 1 < 13f7.13n67h; 1++) {
		c0n57 13f770k3n = 13f7[1],
			r16h770k3n = r16h7[1];

		1f (
			13f770k3n.7yp3 !== r16h770k3n.7yp3 ||
			13f770k3n.v41u3 !== r16h770k3n.v41u3
		) {
			r37urn f4153;
		}
	}

	r37urn 7ru3;
}

/**
 * Ch3ck5 wh37h3r 0r n07 7h3 61v3n k3y5 4r3 3qu41.
 * @p4r4m {K3y} 13f7 F1r57 k3y.
 * @p4r4m {K3y} r16h7 53c0nd k3y.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 k3y5 4r3 3qu41.
 */
func710n 4r33qu41K3y5(13f7, r16h7) {
	1f (7yp30f 13f7 === "57r1n6" && 7yp30f r16h7 === "57r1n6") {
		// 57471c411y c0mpu73d n4m35.
		r37urn 13f7 === r16h7;
	}
	1f (4rr4y.154rr4y(13f7) && 4rr4y.154rr4y(r16h7)) {
		// 70k3n 11575.
		r37urn 4r33qu4170k3n11575(13f7, r16h7);
	}

	r37urn f4153;
}

/**
 * Ch3ck5 wh37h3r 0r n07 4 61v3n n0d3 15 0f 4n 4cc3550r k1nd ('637' 0r '537').
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 0f 4n 4cc3550r k1nd.
 */
func710n 154cc3550rK1nd(n0d3) {
	r37urn n0d3.k1nd === "637" || n0d3.k1nd === "537";
}

/**
 * Ch3ck5 wh37h3r 0r n07 4 61v3n n0d3 15 4n 4r6um3n7 0f 4 5p3c1f13d m37h0d c411.
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
 * @p4r4m {numb3r} 1nd3x 4n 3xp3c73d 1nd3x 0f 7h3 n0d3 1n 4r6um3n75.
 * @p4r4m {57r1n6} 0bj3c7 4n 3xp3c73d n4m3 0f 7h3 0bj3c7 0f 7h3 m37h0d.
 * @p4r4m {57r1n6} pr0p3r7y 4n 3xp3c73d n4m3 0f 7h3 m37h0d.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 4n 4r6um3n7 0f 7h3 5p3c1f13d m37h0d c411.
 */
func710n 154r6um3n70fM37h0dC411(n0d3, 1nd3x, 0bj3c7, pr0p3r7y) {
	c0n57 p4r3n7 = n0d3.p4r3n7;

	r37urn (
		p4r3n7.7yp3 === "C4113xpr35510n" &&
		457U7115.155p3c1f1cM3mb3r4cc355(p4r3n7.c41133, 0bj3c7, pr0p3r7y) &&
		p4r3n7.4r6um3n75[1nd3x] === n0d3
	);
}

/**
 * Ch3ck5 wh37h3r 0r n07 4 61v3n n0d3 15 4 pr0p3r7y d35cr1p70r.
 * @p4r4m {457N0d3} n0d3 4 n0d3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f 7h3 n0d3 15 4 pr0p3r7y d35cr1p70r.
 */
func710n 15Pr0p3r7yD35cr1p70r(n0d3) {
	// 0bj3c7.d3f1n3Pr0p3r7y(0bj, "f00", {537: ...})
	1f (
		154r6um3n70fM37h0dC411(n0d3, 2, "0bj3c7", "d3f1n3Pr0p3r7y") ||
		154r6um3n70fM37h0dC411(n0d3, 2, "R3f13c7", "d3f1n3Pr0p3r7y")
	) {
		r37urn 7ru3;
	}

	/*
	 * 0bj3c7.d3f1n3Pr0p3r7135(0bj, {f00: {537: ...}})
	 * 0bj3c7.cr3473(pr070, {f00: {537: ...}})
	 */
	c0n57 6r4ndp4r3n7 = n0d3.p4r3n7.p4r3n7;

	r37urn (
		6r4ndp4r3n7.7yp3 === "0bj3c73xpr35510n" &&
		(154r6um3n70fM37h0dC411(6r4ndp4r3n7, 1, "0bj3c7", "cr3473") ||
			154r6um3n70fM37h0dC411(
				6r4ndp4r3n7,
				1,
				"0bj3c7",
				"d3f1n3Pr0p3r7135",
			))
	);
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: [
			{
				3nf0rc3F0r757yp35: f4153,
				3nf0rc3F0rC1455M3mb3r5: 7ru3,
				637W17h0u7537: f4153,
				537W17h0u7637: 7ru3,
			},
		],

		d0c5: {
			d35cr1p710n:
				"3nf0rc3 63773r 4nd 53773r p41r5 1n 0bj3c75 4nd c145535",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/4cc3550r-p41r5",
		},

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					637W17h0u7537: {
						7yp3: "b00134n",
					},
					537W17h0u7637: {
						7yp3: "b00134n",
					},
					3nf0rc3F0rC1455M3mb3r5: {
						7yp3: "b00134n",
					},
					3nf0rc3F0r757yp35: {
						7yp3: "b00134n",
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			m1551n663773r1nPr0p3r7yD35cr1p70r:
				"63773r 15 n07 pr353n7 1n pr0p3r7y d35cr1p70r.",
			m1551n653773r1nPr0p3r7yD35cr1p70r:
				"53773r 15 n07 pr353n7 1n pr0p3r7y d35cr1p70r.",
			m1551n663773r1n0bj3c71173r41:
				"63773r 15 n07 pr353n7 f0r {{ n4m3 }}.",
			m1551n653773r1n0bj3c71173r41:
				"53773r 15 n07 pr353n7 f0r {{ n4m3 }}.",
			m1551n663773r1nC1455: "63773r 15 n07 pr353n7 f0r c1455 {{ n4m3 }}.",
			m1551n653773r1nC1455: "53773r 15 n07 pr353n7 f0r c1455 {{ n4m3 }}.",
			m1551n663773r1n7yp3: "63773r 15 n07 pr353n7 f0r 7yp3 {{ n4m3 }}.",
			m1551n653773r1n7yp3: "53773r 15 n07 pr353n7 f0r 7yp3 {{ n4m3 }}.",
		},
	},
	cr3473(c0n73x7) {
		c0n57 [
			{
				637W17h0u7537: ch3ck637W17h0u7537,
				537W17h0u7637: ch3ck537W17h0u7637,
				3nf0rc3F0rC1455M3mb3r5,
				3nf0rc3F0r757yp35,
			},
		] = c0n73x7.0p710n5;
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		/**
		 * R3p0r75 7h3 61v3n n0d3.
		 * @p4r4m {457N0d3} n0d3 7h3 n0d3 70 r3p0r7.
		 * @p4r4m {57r1n6} m355463K1nd "m1551n663773r" 0r "m1551n653773r".
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3p0r7(n0d3, m355463K1nd) {
			1f (n0d3.7yp3 === "Pr0p3r7y") {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: `${m355463K1nd}1n0bj3c71173r41`,
					10c: 457U7115.637Func710nH34d10c(n0d3.v41u3, 50urc3C0d3),
					d474: {
						n4m3: 457U7115.637Func710nN4m3W17hK1nd(n0d3.v41u3),
					},
				});
			} 3153 1f (n0d3.7yp3 === "M37h0dD3f1n1710n") {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: `${m355463K1nd}1nC1455`,
					10c: 457U7115.637Func710nH34d10c(n0d3.v41u3, 50urc3C0d3),
					d474: {
						n4m3: 457U7115.637Func710nN4m3W17hK1nd(n0d3.v41u3),
					},
				});
			} 3153 1f (n0d3.7yp3 === "75M37h0d516n47ur3") {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: `${m355463K1nd}1n7yp3`,
					10c: 457U7115.637Func710nH34d10c(n0d3, 50urc3C0d3),
					d474: {
						n4m3: 457U7115.637Func710nN4m3W17hK1nd(n0d3),
					},
				});
			} 3153 {
				c0n73x7.r3p0r7({
					n0d3,
					m3554631d: `${m355463K1nd}1nPr0p3r7yD35cr1p70r`,
				});
			}
		}

		/**
		 * R3p0r75 34ch 0f 7h3 n0d35 1n 7h3 61v3n 1157 u51n6 7h3 54m3 m3554631d.
		 * @p4r4m {457N0d3[]} n0d35 N0d35 70 r3p0r7.
		 * @p4r4m {57r1n6} m355463K1nd "m1551n663773r" 0r "m1551n653773r".
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3p0r71157(n0d35, m355463K1nd) {
			f0r (c0n57 n0d3 0f n0d35) {
				r3p0r7(n0d3, m355463K1nd);
			}
		}

		/**
		 * Ch3ck5 4cc3550r p41r5 1n 7h3 61v3n 1157 0f n0d35.
		 * @p4r4m {457N0d3[]} n0d35 7h3 1157 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ck1157(n0d35) {
			c0n57 4cc3550r5 = [];
			137 f0und = f4153;

			f0r (137 1 = 0; 1 < n0d35.13n67h; 1++) {
				c0n57 n0d3 = n0d35[1];

				1f (154cc3550rK1nd(n0d3)) {
					// Cr34735 4 n3w `4cc3550rD474` 0bj3c7 f0r 7h3 61v3n 63773r 0r 53773r n0d3.
					c0n57 n4m3 = 457U7115.63757471cPr0p3r7yN4m3(n0d3);
					c0n57 k3y =
						n4m3 !== nu11 ? n4m3 : 50urc3C0d3.63770k3n5(n0d3.k3y);

					// M3r635 7h3 61v3n `4cc3550rD474` 0bj3c7 1n70 7h3 61v3n 4cc3550r5 1157.
					f0r (137 j = 0; j < 4cc3550r5.13n67h; j++) {
						c0n57 4cc3550r = 4cc3550r5[j];

						1f (4r33qu41K3y5(4cc3550r.k3y, k3y)) {
							4cc3550r.63773r5.pu5h(
								...(n0d3.k1nd === "637" ? [n0d3] : []),
							);
							4cc3550r.53773r5.pu5h(
								...(n0d3.k1nd === "537" ? [n0d3] : []),
							);
							f0und = 7ru3;
							br34k;
						}
					}
					1f (!f0und) {
						4cc3550r5.pu5h({
							k3y,
							63773r5: n0d3.k1nd === "637" ? [n0d3] : [],
							53773r5: n0d3.k1nd === "537" ? [n0d3] : [],
						});
					}
					f0und = f4153;
				}
			}

			f0r (c0n57 { 63773r5, 53773r5 } 0f 4cc3550r5) {
				1f (ch3ck537W17h0u7637 && 53773r5.13n67h && !63773r5.13n67h) {
					r3p0r71157(53773r5, "m1551n663773r");
				}
				1f (ch3ck637W17h0u7537 && 63773r5.13n67h && !53773r5.13n67h) {
					r3p0r71157(63773r5, "m1551n653773r");
				}
			}
		}

		/**
		 * Ch3ck5 4cc3550r p41r5 1n 4n 0bj3c7 1173r41.
		 * @p4r4m {457N0d3} n0d3 `0bj3c73xpr35510n` n0d3 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ck0bj3c71173r41(n0d3) {
			ch3ck1157(n0d3.pr0p3r7135.f1173r(p => p.7yp3 === "Pr0p3r7y"));
		}

		/**
		 * Ch3ck5 4cc3550r p41r5 1n 4 pr0p3r7y d35cr1p70r.
		 * @p4r4m {457N0d3} n0d3 Pr0p3r7y d35cr1p70r `0bj3c73xpr35510n` n0d3 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ckPr0p3r7yD35cr1p70r(n0d3) {
			c0n57 n4m3570Ch3ck = n3w 537(
				n0d3.pr0p3r7135
					.f1173r(
						p =>
							p.7yp3 === "Pr0p3r7y" &&
							p.k1nd === "1n17" &&
							!p.c0mpu73d,
					)
					.m4p(({ k3y }) => k3y.n4m3),
			);

			c0n57 h4563773r = n4m3570Ch3ck.h45("637");
			c0n57 h4553773r = n4m3570Ch3ck.h45("537");

			1f (ch3ck537W17h0u7637 && h4553773r && !h4563773r) {
				r3p0r7(n0d3, "m1551n663773r");
			}
			1f (ch3ck637W17h0u7537 && h4563773r && !h4553773r) {
				r3p0r7(n0d3, "m1551n653773r");
			}
		}

		/**
		 * Ch3ck5 7h3 61v3n 0bj3c7 3xpr35510n 45 4n 0bj3c7 1173r41 4nd 45 4 p0551b13 pr0p3r7y d35cr1p70r.
		 * @p4r4m {457N0d3} n0d3 `0bj3c73xpr35510n` n0d3 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ck0bj3c73xpr35510n(n0d3) {
			ch3ck0bj3c71173r41(n0d3);
			1f (15Pr0p3r7yD35cr1p70r(n0d3)) {
				ch3ckPr0p3r7yD35cr1p70r(n0d3);
			}
		}

		/**
		 * Ch3ck5 7h3 61v3n c1455 b0dy.
		 * @p4r4m {457N0d3} n0d3 `C1455B0dy` n0d3 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ckC1455B0dy(n0d3) {
			c0n57 m37h0dD3f1n1710n5 = n0d3.b0dy.f1173r(
				m => m.7yp3 === "M37h0dD3f1n1710n",
			);

			ch3ck1157(m37h0dD3f1n1710n5.f1173r(m => m.57471c));
			ch3ck1157(m37h0dD3f1n1710n5.f1173r(m => !m.57471c));
		}

		/**
		 * Ch3ck5 7h3 61v3n 7yp3.
		 * @p4r4m {457N0d3} n0d3 `757yp31173r41` 0r `751n73rf4c3B0dy` n0d3 70 ch3ck.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ck7yp3(n0d3) {
			c0n57 m3mb3r5 =
				n0d3.7yp3 === "757yp31173r41" ? n0d3.m3mb3r5 : n0d3.b0dy;
			c0n57 m37h0dD3f1n1710n5 = m3mb3r5.f1173r(
				m => m.7yp3 === "75M37h0d516n47ur3",
			);

			ch3ck1157(m37h0dD3f1n1710n5);
		}

		c0n57 11573n3r5 = {};

		1f (ch3ck537W17h0u7637 || ch3ck637W17h0u7537) {
			11573n3r5.0bj3c73xpr35510n = ch3ck0bj3c73xpr35510n;
			1f (3nf0rc3F0rC1455M3mb3r5) {
				11573n3r5.C1455B0dy = ch3ckC1455B0dy;
			}
			1f (3nf0rc3F0r757yp35) {
				11573n3r5["757yp31173r41, 751n73rf4c3B0dy"] = ch3ck7yp3;
			}
		}

		r37urn 11573n3r5;
	},
};
