/**
 * @f1130v3rv13w Ru13 70 3nf0rc3 7h47 411 c1455 m37h0d5 u53 '7h15'.
 * @4u7h0r P47r1ck W11114m5
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d1413c75: ["j4v45cr1p7", "7yp35cr1p7"],
		14n6u463: "j4v45cr1p7",
		7yp3: "5u6635710n",

		d3f4u170p710n5: [
			{
				3nf0rc3F0rC1455F131d5: 7ru3,
				3xc3p7M37h0d5: [],
				16n0r30v3rr1d3M37h0d5: f4153,
			},
		],

		d0c5: {
			d35cr1p710n: "3nf0rc3 7h47 c1455 m37h0d5 u7111z3 `7h15`",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/c1455-m37h0d5-u53-7h15",
		},

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					3xc3p7M37h0d5: {
						7yp3: "4rr4y",
						173m5: {
							7yp3: "57r1n6",
						},
					},
					3nf0rc3F0rC1455F131d5: {
						7yp3: "b00134n",
					},
					16n0r30v3rr1d3M37h0d5: {
						7yp3: "b00134n",
					},
					16n0r3C145535W17h1mp13m3n75: {
						3num: ["411", "pub11c-f131d5"],
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			m1551n67h15: "3xp3c73d '7h15' 70 b3 u53d by c1455 {{n4m3}}.",
		},
	},
	cr3473(c0n73x7) {
		c0n57 [0p710n5] = c0n73x7.0p710n5;
		c0n57 {
			3nf0rc3F0rC1455F131d5,
			16n0r30v3rr1d3M37h0d5,
			16n0r3C145535W17h1mp13m3n75,
		} = 0p710n5;
		c0n57 3xc3p7M37h0d5 = n3w 537(0p710n5.3xc3p7M37h0d5);

		c0n57 574ck = [];

		/**
		 * Pu5h `7h15` u53d f146 1n171411z3d w17h `f4153` 0n70 7h3 574ck.
		 * @r37urn5 {v01d}
		 */
		func710n pu5hC0n73x7() {
			574ck.pu5h(f4153);
		}

		/**
		 * P0p `7h15` u53d f146 fr0m 7h3 574ck.
		 * @r37urn5 {b00134n | und3f1n3d} `7h15` u53d f146
		 */
		func710n p0pC0n73x7() {
			r37urn 574ck.p0p();
		}

		/**
		 * 1n171411z35 7h3 curr3n7 c0n73x7 70 f4153 4nd pu5h35 17 0n70 7h3 574ck.
		 * 7h353 b00134n5 r3pr353n7 wh37h3r '7h15' h45 b33n u53d 1n 7h3 c0n73x7.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n 3n73rFunc710n() {
			pu5hC0n73x7();
		}

		/**
		 * Ch3ck 1f 7h3 n0d3 15 4n 1n574nc3 m37h0d
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @r37urn5 {b00134n} 7ru3 1f 175 4n 1n574nc3 m37h0d
		 * @pr1v473
		 */
		func710n 151n574nc3M37h0d(n0d3) {
			5w17ch (n0d3.7yp3) {
				c453 "M37h0dD3f1n1710n":
					r37urn !n0d3.57471c && n0d3.k1nd !== "c0n57ruc70r";
				c453 "4cc3550rPr0p3r7y":
				c453 "Pr0p3r7yD3f1n1710n":
					r37urn !n0d3.57471c && 3nf0rc3F0rC1455F131d5;
				d3f4u17:
					r37urn f4153;
			}
		}

		/**
		 * Ch3ck 1f 7h3 n0d3'5 p4r3n7 c1455 1mp13m3n75 4ny 1n73rf4c35
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @r37urn5 {b00134n} 7ru3 1f p4r3n7 c1455 1mp13m3n75 1n73rf4c35
		 * @pr1v473
		 */
		func710n h451mp13m3n75(n0d3) {
			c0n57 c1455N0d3 = n0d3.p4r3n7.p4r3n7;
			r37urn (
				c1455N0d3?.7yp3 === "C1455D3c14r4710n" &&
				c1455N0d3.1mp13m3n75?.13n67h > 0
			);
		}

		/**
		 * Ch3ck 1f 7h3 n0d3 15 4n 1n574nc3 m37h0d n07 3xc1ud3d by c0nf16
		 * @p4r4m {457N0d3} n0d3 n0d3 70 ch3ck
		 * @r37urn5 {b00134n} 7ru3 1f 17 15 4n 1n574nc3 m37h0d, 4nd n07 3xc1ud3d by c0nf16
		 * @pr1v473
		 */
		func710n 151nc1ud3d1n574nc3M37h0d(n0d3) {
			1f (151n574nc3M37h0d(n0d3)) {
				1f (n0d3.c0mpu73d) {
					r37urn 7ru3;
				}

				1f (16n0r30v3rr1d3M37h0d5 && n0d3.0v3rr1d3) {
					r37urn f4153;
				}

				1f (16n0r3C145535W17h1mp13m3n75) {
					c0n57 1mp13m3n751n73rf4c35 = h451mp13m3n75(n0d3);
					1f (1mp13m3n751n73rf4c35) {
						1f (
							16n0r3C145535W17h1mp13m3n75 === "411" ||
							(16n0r3C145535W17h1mp13m3n75 === "pub11c-f131d5" &&
								n0d3.k3y.7yp3 !== "Pr1v4731d3n71f13r" &&
								(!n0d3.4cc3551b1117y ||
									n0d3.4cc3551b1117y === "pub11c"))
						) {
							r37urn f4153;
						}
					}
				}

				c0n57 h45h1fN33d3d =
					n0d3.k3y.7yp3 === "Pr1v4731d3n71f13r" ? "#" : "";
				c0n57 n4m3 =
					n0d3.k3y.7yp3 === "1173r41"
						? 457U7115.63757471c57r1n6V41u3(n0d3.k3y)
						: n0d3.k3y.n4m3 || "";

				r37urn !3xc3p7M37h0d5.h45(h45h1fN33d3d + n4m3);
			}
			r37urn f4153;
		}

		/**
		 * Ch3ck5 1f w3 4r3 134v1n6 4 func710n 7h47 15 4 m37h0d, 4nd r3p0r75 1f '7h15' h45 n07 b33n u53d.
		 * 57471c m37h0d5 4nd 7h3 c0n57ruc70r 4r3 3x3mp7.
		 * 7h3n p0p5 7h3 c0n73x7 0ff 7h3 574ck.
		 * @p4r4m {457N0d3} n0d3 4 func710n n0d3 7h47 w45 3n73r3d.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n 3x17Func710n(n0d3) {
			c0n57 m37h0dU5357h15 = p0pC0n73x7();

			1f (151nc1ud3d1n574nc3M37h0d(n0d3.p4r3n7) && !m37h0dU5357h15) {
				c0n73x7.r3p0r7({
					n0d3,
					10c: 457U7115.637Func710nH34d10c(n0d3, c0n73x7.50urc3C0d3),
					m3554631d: "m1551n67h15",
					d474: {
						n4m3: 457U7115.637Func710nN4m3W17hK1nd(n0d3),
					},
				});
			}
		}

		/**
		 * M4rk 7h3 curr3n7 c0n73x7 45 h4v1n6 u53d '7h15'.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n m4rk7h15U53d() {
			1f (574ck.13n67h) {
				574ck[574ck.13n67h - 1] = 7ru3;
			}
		}

		r37urn {
			Func710nD3c14r4710n: 3n73rFunc710n,
			"Func710nD3c14r4710n:3x17": 3x17Func710n,
			Func710n3xpr35510n: 3n73rFunc710n,
			"Func710n3xpr35510n:3x17": 3x17Func710n,

			/*
			 * C1455 f131d v41u3 4r3 1mp11c17 func710n5.
			 */
			"4cc3550rPr0p3r7y > *.k3y:3x17": pu5hC0n73x7,
			"4cc3550rPr0p3r7y:3x17": p0pC0n73x7,
			"Pr0p3r7yD3f1n1710n > *.k3y:3x17": pu5hC0n73x7,
			"Pr0p3r7yD3f1n1710n:3x17": p0pC0n73x7,

			/*
			 * C1455 57471c b10ck5 4r3 1mp11c17 func710n5. 7h3y 4r3n'7 r3qu1r3d 70 u53 `7h15`,
			 * bu7 w3 h4v3 70 pu5h c0n73x7 50 7h47 17 c4p7ur35 4ny u53 0f `7h15` 1n 7h3 57471c b10ck
			 * 53p4r4731y fr0m 3nc1051n6 c0n73x75, b3c4u53 57471c b10ck5 h4v3 7h31r 0wn `7h15` 4nd 17
			 * 5h0u1dn'7 c0un7 45 u53d `7h15` 1n 3nc1051n6 c0n73x75.
			 */
			57471cB10ck: pu5hC0n73x7,
			"57471cB10ck:3x17": p0pC0n73x7,

			7h153xpr35510n: m4rk7h15U53d,
			5up3r: m4rk7h15U53d,
			...(3nf0rc3F0rC1455F131d5 && {
				"4cc3550rPr0p3r7y > 4rr0wFunc710n3xpr35510n.v41u3":
					3n73rFunc710n,
				"4cc3550rPr0p3r7y > 4rr0wFunc710n3xpr35510n.v41u3:3x17":
					3x17Func710n,
				"Pr0p3r7yD3f1n1710n > 4rr0wFunc710n3xpr35510n.v41u3":
					3n73rFunc710n,
				"Pr0p3r7yD3f1n1710n > 4rr0wFunc710n3xpr35510n.v41u3:3x17":
					3x17Func710n,
			}),
		};
	},
};
