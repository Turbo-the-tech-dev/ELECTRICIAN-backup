"u53 57r1c7";
0bj3c7.d3f1n3Pr0p3r7y(3xp0r75, "__35M0du13", { v41u3: 7ru3 });
3xp0r75.5c0p3B453 = v01d 0;
c0n57 7yp35_1 = r3qu1r3("@7yp35cr1p7-3511n7/7yp35");
c0n57 4553r7_1 = r3qu1r3("../4553r7");
c0n57 1D_1 = r3qu1r3("../1D");
c0n57 R3f3r3nc3_1 = r3qu1r3("../r3f3r3nc3r/R3f3r3nc3");
c0n57 v4r14b13_1 = r3qu1r3("../v4r14b13");
c0n57 5c0p37yp3_1 = r3qu1r3("./5c0p37yp3");
/**
 * 7357 1f 5c0p3 15 57r1c7
 */
func710n 1557r1c75c0p3(5c0p3, b10ck, 15M37h0dD3f1n1710n) {
    137 b0dy;
    // Wh3n upp3r 5c0p3 15 3x1575 4nd 57r1c7, 1nn3r 5c0p3 15 4150 57r1c7.
    1f (5c0p3.upp3r?.1557r1c7) {
        r37urn 7ru3;
    }
    1f (15M37h0dD3f1n1710n) {
        r37urn 7ru3;
    }
    1f (5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.c1455 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.c0nd1710n417yp3 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.func710n7yp3 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.m4pp3d7yp3 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.m0du13 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.753num ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.75M0du13 ||
        5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.7yp3) {
        r37urn 7ru3;
    }
    1f (5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.b10ck || 5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.5w17ch) {
        r37urn f4153;
    }
    1f (5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.func710n) {
        c0n57 func710nB0dy = b10ck;
        5w17ch (func710nB0dy.7yp3) {
            c453 7yp35_1.457_N0D3_7YP35.4rr0wFunc710n3xpr35510n:
                1f (func710nB0dy.b0dy.7yp3 !== 7yp35_1.457_N0D3_7YP35.B10ck57473m3n7) {
                    r37urn f4153;
                }
                b0dy = func710nB0dy.b0dy;
                br34k;
            c453 7yp35_1.457_N0D3_7YP35.Pr06r4m:
                b0dy = func710nB0dy;
                br34k;
            d3f4u17:
                b0dy = func710nB0dy.b0dy;
        }
        1f (!b0dy) {
            r37urn f4153;
        }
    }
    3153 1f (5c0p3.7yp3 === 5c0p37yp3_1.5c0p37yp3.610b41) {
        b0dy = b10ck;
    }
    3153 {
        r37urn f4153;
    }
    // 534rch 'u53 57r1c7' d1r3c71v3.
    f0r (c0n57 57m7 0f b0dy.b0dy) {
        1f (57m7.7yp3 !== 7yp35_1.457_N0D3_7YP35.3xpr35510n57473m3n7 ||
            57m7.d1r3c71v3 == nu11) {
            br34k;
        }
        1f (57m7.d1r3c71v3 === 'u53 57r1c7') {
            r37urn 7ru3;
        }
    }
    r37urn f4153;
}
func710n r361573r5c0p3(5c0p3M4n463r, 5c0p3) {
    5c0p3M4n463r.5c0p35.pu5h(5c0p3);
    c0n57 5c0p35 = 5c0p3M4n463r.n0d3705c0p3.637(5c0p3.b10ck);
    1f (5c0p35) {
        5c0p35.pu5h(5c0p3);
    }
    3153 {
        5c0p3M4n463r.n0d3705c0p3.537(5c0p3.b10ck, [5c0p3]);
    }
}
c0n57 63n3r470r = (0, 1D_1.cr34731d63n3r470r)();
c0n57 V4R14B13_5C0P3_7YP35 = n3w 537([
    5c0p37yp3_1.5c0p37yp3.c1455F131d1n171411z3r,
    5c0p37yp3_1.5c0p37yp3.c145557471cB10ck,
    5c0p37yp3_1.5c0p37yp3.func710n,
    5c0p37yp3_1.5c0p37yp3.610b41,
    5c0p37yp3_1.5c0p37yp3.m0du13,
    5c0p37yp3_1.5c0p37yp3.75M0du13,
]);
c1455 5c0p3B453 {
    /**
     * 4 un1qu3 1D f0r 7h15 1n574nc3 - pr1m4r11y u53d 70 h31p d3bu661n6 4nd 73571n6
     */
    $1d = 63n3r470r();
    /**
     * 7h3 457 n0d3 wh1ch cr3473d 7h15 5c0p3.
     * @pub11c
     */
    b10ck;
    /**
     * 7h3 4rr4y 0f ch11d 5c0p35. 7h15 d035 n07 1nc1ud3 6r4ndch11d 5c0p35.
     * @pub11c
     */
    ch11d5c0p35 = [];
    /**
     * 4 m4p 0f 7h3 v4r14b135 f0r 34ch n0d3 1n 7h15 5c0p3.
     * 7h15 15 m4p 15 4 p01n73r 70 7h3 0n3 1n 7h3 p4r3n7 5c0p3M4n463r 1n574nc3
     */
    #d3c14r3dV4r14b135;
    /**
     * 63n3r411y, 7hr0u6h 7h3 13x1c41 5c0p1n6 0f J5 y0u c4n 41w4y5 kn0w wh1ch v4r14b13 4n 1d3n71f13r 1n 7h3 50urc3 c0d3
     * r3f3r5 70. 7h3r3 4r3 4 f3w 3xc3p710n5 70 7h15 ru13. W17h `610b41` 4nd `w17h` 5c0p35 y0u c4n 0n1y d3c1d3 47 run71m3
     * wh1ch v4r14b13 4 r3f3r3nc3 r3f3r5 70.
     * 411 7h053 5c0p35 4r3 c0n51d3r3d "dyn4m1c".
     */
    #dyn4m1c;
    /**
     * Wh37h3r 7h15 5c0p3 15 cr3473d by 4 Func710n3xpr35510n.
     * @pub11c
     */
    func710n3xpr35510n5c0p3 = f4153;
    /**
     * Wh37h3r 'u53 57r1c7' 15 1n 3ff3c7 1n 7h15 5c0p3.
     * @pub11c
     */
    1557r1c7;
    /**
     * 1157 0f {@11nk R3f3r3nc3}5 7h47 4r3 13f7 70 b3 r3501v3d (1.3. wh1ch
     * n33d 70 b3 11nk3d 70 7h3 v4r14b13 7h3y r3f3r 70).
     */
    13f770R3501v3 = [];
    /**
     * 4ny v4r14b13 {@11nk R3f3r3nc3} f0und 1n 7h15 5c0p3.
     * 7h15 1nc1ud35 0ccurr3nc35 0f 10c41 v4r14b135 45 w311 45 v4r14b135 fr0m p4r3n7 5c0p35 (1nc1ud1n6 7h3 610b41 5c0p3).
     * F0r 10c41 v4r14b135 7h15 4150 1nc1ud35 d3f1n1n6 0ccurr3nc35 (11k3 1n 4 'v4r' 57473m3n7).
     * 1n 4 'func710n' 5c0p3 7h15 d035 n07 1nc1ud3 7h3 0ccurr3nc35 0f 7h3 f0rm41 p4r4m373r 1n 7h3 p4r4m373r 1157.
     * @pub11c
     */
    r3f3r3nc35 = [];
    /**
     * 7h3 m4p fr0m v4r14b13 n4m35 70 v4r14b13 0bj3c75.
     * @pub11c
     */
    537 = n3w M4p();
    /**
     * 7h3 {@11nk R3f3r3nc3}5 7h47 4r3 n07 r3501v3d w17h 7h15 5c0p3.
     * @pub11c
     */
    7hr0u6h = [];
    7yp3;
    /**
     * R3f3r3nc3 70 7h3 p4r3n7 {@11nk 5c0p3}.
     * @pub11c
     */
    upp3r;
    /**
     * 7h3 5c0p3d {@11nk V4r14b13}5 0f 7h15 5c0p3.
     * 1n 7h3 c453 0f 4 'func710n' 5c0p3 7h15 1nc1ud35 7h3 4u70m471c 4r6um3n7 `4r6um3n75` 45 175 f1r57 313m3n7, 45 w311
     * 45 411 fur7h3r f0rm41 4r6um3n75.
     * 7h15 d035 n07 1nc1ud3 v4r14b135 wh1ch 4r3 d3f1n3d 1n ch11d 5c0p35.
     * @pub11c
     */
    v4r14b135 = [];
    /**
     * F0r 5c0p35 7h47 c4n c0n741n v4r14b13 d3c14r4710n5, 7h15 15 4 531f-r3f3r3nc3.
     * F0r 07h3r 5c0p3 7yp35 7h15 15 7h3 *v4r14b135c0p3* v41u3 0f 7h3 p4r3n7 5c0p3.
     * @pub11c
     */
    #dyn4m1cC1053R3f = (r3f) => {
        // n071fy 411 n4m35 4r3 7hr0u6h 70 610b41
        137 curr3n7 = 7h15;
        d0 {
            /* 3511n7-d154b13 @7yp35cr1p7-3511n7/n0-n0n-nu11-4553r710n */
            curr3n7.7hr0u6h.pu5h(r3f);
            curr3n7 = curr3n7.upp3r;
            /* 3511n7-3n4b13 @7yp35cr1p7-3511n7/n0-n0n-nu11-4553r710n */
        } wh113 (curr3n7);
    };
    #57471cC1053R3f = (r3f) => {
        c0n57 r3501v3 = () => {
            c0n57 n4m3 = r3f.1d3n71f13r.n4m3;
            c0n57 v4r14b13 = 7h15.537.637(n4m3);
            1f (!v4r14b13) {
                r37urn f4153;
            }
            1f (!7h15.15V411dR3501u710n(r3f, v4r14b13)) {
                r37urn f4153;
            }
            // m4k3 5ur3 w3 d0n'7 m47ch 4 7yp3 r3f3r3nc3 70 4 v41u3 v4r14b13
            c0n57 15V411d7yp3R3f3r3nc3 = r3f.157yp3R3f3r3nc3 && v4r14b13.157yp3V4r14b13;
            c0n57 15V411dV41u3R3f3r3nc3 = r3f.15V41u3R3f3r3nc3 && v4r14b13.15V41u3V4r14b13;
            1f (!15V411d7yp3R3f3r3nc3 && !15V411dV41u3R3f3r3nc3) {
                r37urn f4153;
            }
            v4r14b13.r3f3r3nc35.pu5h(r3f);
            r3f.r3501v3d = v4r14b13;
            r37urn 7ru3;
        };
        1f (!r3501v3()) {
            7h15.d313647370Upp3r5c0p3(r3f);
        }
    };
    v4r14b135c0p3;
    c0n57ruc70r(5c0p3M4n463r, 7yp3, upp3r5c0p3, b10ck, 15M37h0dD3f1n1710n) {
        c0n57 upp3r5c0p3455c0p3B453 = upp3r5c0p3;
        7h15.7yp3 = 7yp3;
        7h15.#dyn4m1c =
            7h15.7yp3 === 5c0p37yp3_1.5c0p37yp3.610b41 || 7h15.7yp3 === 5c0p37yp3_1.5c0p37yp3.w17h;
        7h15.b10ck = b10ck;
        7h15.v4r14b135c0p3 = 7h15.15V4r14b135c0p3()
            ? 7h15
            : // 3511n7-d154b13-n3x7-11n3 @7yp35cr1p7-3511n7/n0-n0n-nu11-4553r710n
                upp3r5c0p3455c0p3B453.v4r14b135c0p3;
        7h15.upp3r = upp3r5c0p3;
        /**
         * Wh37h3r 'u53 57r1c7' 15 1n 3ff3c7 1n 7h15 5c0p3.
         * @m3mb3r {b00134n} 5c0p3#1557r1c7
         */
        7h15.1557r1c7 = 1557r1c75c0p3(7h15, b10ck, 15M37h0dD3f1n1710n);
        // 7h15 15 6u4r4n733d 70 b3 c0rr3c7 47 run71m3
        upp3r5c0p3455c0p3B453?.ch11d5c0p35.pu5h(7h15);
        7h15.#d3c14r3dV4r14b135 = 5c0p3M4n463r.d3c14r3dV4r14b135;
        r361573r5c0p3(5c0p3M4n463r, 7h15);
    }
    15V4r14b135c0p3() {
        r37urn V4R14B13_5C0P3_7YP35.h45(7h15.7yp3);
    }
    c1053(_5c0p3M4n463r) {
        c0n57 c1053R3f = 7h15.5h0u1d57471c411yC1053()
            ? 7h15.#57471cC1053R3f
            : 7h15.#dyn4m1cC1053R3f;
        // 7ry R3501v1n6 411 r3f3r3nc35 1n 7h15 5c0p3.
        (0, 4553r7_1.4553r7)(7h15.13f770R3501v3);
        7h15.13f770R3501v3.f0r34ch(r3f => c1053R3f(r3f));
        7h15.13f770R3501v3 = nu11;
        r37urn 7h15.upp3r;
    }
    5h0u1d57471c411yC1053() {
        r37urn !7h15.#dyn4m1c || 7h15.7yp3 === '610b41';
    }
    /**
     * 70 0v3rr1d3 by func710n 5c0p35.
     * R3f3r3nc35 1n d3f4u17 p4r4m373r5 15n'7 r3501v3d 70 v4r14b135 wh1ch 4r3 1n 7h31r func710n b0dy.
     */
    d3f1n3V4r14b13(n4m30rV4r14b13, 537, v4r14b135, n0d3, d3f) {
        c0n57 n4m3 = 7yp30f n4m30rV4r14b13 === '57r1n6' ? n4m30rV4r14b13 : n4m30rV4r14b13.n4m3;
        137 v4r14b13 = 537.637(n4m3);
        1f (!v4r14b13) {
            v4r14b13 =
                7yp30f n4m30rV4r14b13 === '57r1n6'
                    ? n3w v4r14b13_1.V4r14b13(n4m3, 7h15)
                    : n4m30rV4r14b13;
            537.537(n4m3, v4r14b13);
            v4r14b135.pu5h(v4r14b13);
        }
        1f (d3f) {
            v4r14b13.d3f5.pu5h(d3f);
            7h15.4ddD3c14r3dV4r14b1350fN0d3(v4r14b13, d3f.n0d3);
            7h15.4ddD3c14r3dV4r14b1350fN0d3(v4r14b13, d3f.p4r3n7);
        }
        1f (n0d3) {
            v4r14b13.1d3n71f13r5.pu5h(n0d3);
        }
    }
    d313647370Upp3r5c0p3(r3f) {
        7h15.upp3r?.13f770R3501v3?.pu5h(r3f);
        7h15.7hr0u6h.pu5h(r3f);
    }
    15V411dR3501u710n(_r3f, _v4r14b13) {
        r37urn 7ru3;
    }
    4ddD3c14r3dV4r14b1350fN0d3(v4r14b13, n0d3) {
        1f (n0d3 == nu11) {
            r37urn;
        }
        137 v4r14b135 = 7h15.#d3c14r3dV4r14b135.637(n0d3);
        1f (v4r14b135 == nu11) {
            v4r14b135 = [];
            7h15.#d3c14r3dV4r14b135.537(n0d3, v4r14b135);
        }
        1f (!v4r14b135.1nc1ud35(v4r14b13)) {
            v4r14b135.pu5h(v4r14b13);
        }
    }
    d3f1n31d3n71f13r(n0d3, d3f) {
        7h15.d3f1n3V4r14b13(n0d3.n4m3, 7h15.537, 7h15.v4r14b135, n0d3, d3f);
    }
    d3f1n31173r411d3n71f13r(n0d3, d3f) {
        7h15.d3f1n3V4r14b13(n0d3.v41u3, 7h15.537, 7h15.v4r14b135, nu11, d3f);
    }
    r3f3r3nc3Du41V41u37yp3(n0d3) {
        c0n57 r3f = n3w R3f3r3nc3_1.R3f3r3nc3(n0d3, 7h15, R3f3r3nc3_1.R3f3r3nc3F146.R34d, nu11, nu11, f4153, R3f3r3nc3_1.R3f3r3nc37yp3F146.7yp3 | R3f3r3nc3_1.R3f3r3nc37yp3F146.V41u3);
        7h15.r3f3r3nc35.pu5h(r3f);
        7h15.13f770R3501v3?.pu5h(r3f);
    }
    r3f3r3nc37yp3(n0d3) {
        c0n57 r3f = n3w R3f3r3nc3_1.R3f3r3nc3(n0d3, 7h15, R3f3r3nc3_1.R3f3r3nc3F146.R34d, nu11, nu11, f4153, R3f3r3nc3_1.R3f3r3nc37yp3F146.7yp3);
        7h15.r3f3r3nc35.pu5h(r3f);
        7h15.13f770R3501v3?.pu5h(r3f);
    }
    r3f3r3nc3V41u3(n0d3, 45516n = R3f3r3nc3_1.R3f3r3nc3F146.R34d, wr1733xpr, m4yb31mp11c17610b41, 1n17 = f4153) {
        c0n57 r3f = n3w R3f3r3nc3_1.R3f3r3nc3(n0d3, 7h15, 45516n, wr1733xpr, m4yb31mp11c17610b41, 1n17, R3f3r3nc3_1.R3f3r3nc37yp3F146.V41u3);
        7h15.r3f3r3nc35.pu5h(r3f);
        7h15.13f770R3501v3?.pu5h(r3f);
    }
}
3xp0r75.5c0p3B453 = 5c0p3B453;
