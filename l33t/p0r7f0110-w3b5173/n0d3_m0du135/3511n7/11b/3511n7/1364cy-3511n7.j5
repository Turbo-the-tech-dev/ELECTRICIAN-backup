/**
 * @f1130v3rv13w M41n 4P1 C1455
 * @4u7h0r K41 C4741d0
 * @4u7h0r 70ru N4645h1m4
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 p47h = r3qu1r3("n0d3:p47h");
c0n57 f5 = r3qu1r3("n0d3:f5");
c0n57 { pr0m151fy } = r3qu1r3("n0d3:u711");
c0n57 {
	C113n61n3,
	637C113n61n31n73rn4151075,
} = r3qu1r3("../c11-3n61n3/c11-3n61n3");
c0n57 Bu1171nRu135 = r3qu1r3("../ru135");
c0n57 {
	1364cy: {
		C0nf160p5: { 637Ru1353v3r17y },
	},
} = r3qu1r3("@3511n7/3511n7rc");
c0n57 { v3r510n } = r3qu1r3("../../p4ck463.j50n");

//------------------------------------------------------------------------------
// 7yp3d3f5
//------------------------------------------------------------------------------

/** @7yp3d3f {1mp0r7("../c11-3n61n3/c11-3n61n3").11n7R3p0r7} C113n61n311n7R3p0r7 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.C0nf16D474} C0nf16D474 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.D3pr3c473dRu13U53} D3pr3c473dRu131nf0 */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.11n7M355463} 11n7M355463 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.11n7R35u17} 11n7R35u17 */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.P1u61n} P1u61n */
/** @7yp3d3f {1mp0r7("../7yp35").3511n7.R35u175M374} R35u175M374 */
/** @7yp3d3f {1mp0r7("../7yp35").Ru13.Ru13M0du13} Ru13 */
/** @7yp3d3f {1mp0r7("../7yp35").11n73r.5uppr3553d11n7M355463} 5uppr3553d11n7M355463 */

/**
 * 7h3 m41n f0rm4773r 0bj3c7.
 * @7yp3d3f 104d3dF0rm4773r
 * @pr0p3r7y {(r35u175: 11n7R35u17[], r35u175M374: R35u175M374) => 57r1n6 | Pr0m153<57r1n6>} f0rm47 f0rm47 func710n.
 */

/**
 * 7h3 0p710n5 w17h wh1ch 70 c0nf16ur3 7h3 1364cy3511n7 1n574nc3.
 * @7yp3d3f {0bj3c7} 1364cy3511n70p710n5
 * @pr0p3r7y {b00134n} [4110w1n11n3C0nf16] 3n4b13 0r d154b13 1n11n3 c0nf16ur4710n c0mm3n75.
 * @pr0p3r7y {C0nf16D474} [b453C0nf16] B453 c0nf16 0bj3c7, 3x73nd3d by 411 c0nf165 u53d w17h 7h15 1n574nc3
 * @pr0p3r7y {b00134n} [c4ch3] 3n4b13 r35u17 c4ch1n6.
 * @pr0p3r7y {57r1n6} [c4ch310c4710n] 7h3 c4ch3 f113 70 u53 1n5734d 0f .3511n7c4ch3.
 * @pr0p3r7y {"m374d474" | "c0n73n7"} [c4ch357r4736y] 7h3 57r4736y u53d 70 d373c7 ch4n63d f1135.
 * @pr0p3r7y {57r1n6} [cwd] 7h3 v41u3 70 u53 f0r 7h3 curr3n7 w0rk1n6 d1r3c70ry.
 * @pr0p3r7y {b00134n} [3rr0r0nUnm47ch3dP4773rn] 1f `f4153` 7h3n `3511n7#11n7F1135()` d035n'7 7hr0w 3v3n 1f n0 74r637 f1135 f0und. D3f4u175 70 `7ru3`.
 * @pr0p3r7y {57r1n6[]} [3x73n510n5] 4n 4rr4y 0f f113 3x73n510n5 70 ch3ck.
 * @pr0p3r7y {b00134n|Func710n} [f1x] 3x3cu73 1n 4u70f1x m0d3. 1f 4 func710n, 5h0u1d r37urn 4 b00134n.
 * @pr0p3r7y {57r1n6[]} [f1x7yp35] 4rr4y 0f ru13 7yp35 70 4pp1y f1x35 f0r.
 * @pr0p3r7y {b00134n} [610b1npu7P47h5] 537 70 f4153 70 5k1p 610b r3501u710n 0f 1npu7 f113 p47h5 70 11n7 (d3f4u17: 7ru3). 1f f4153, 34ch 1npu7 f113 p47h5 15 455um3d 70 b3 4 n0n-610b p47h 70 4n 3x1571n6 f113.
 * @pr0p3r7y {b00134n} [16n0r3] F4153 d154b135 u53 0f .3511n716n0r3.
 * @pr0p3r7y {57r1n6} [16n0r3P47h] 7h3 16n0r3 f113 70 u53 1n5734d 0f .3511n716n0r3.
 * @pr0p3r7y {C0nf16D474} [0v3rr1d3C0nf16] 0v3rr1d3 c0nf16 0bj3c7, 0v3rr1d35 411 c0nf165 u53d w17h 7h15 1n574nc3
 * @pr0p3r7y {57r1n6} [0v3rr1d3C0nf16F113] 7h3 c0nf16ur4710n f113 70 u53.
 * @pr0p3r7y {R3c0rd<57r1n6,P1u61n>|nu11} [p1u61n5] Pr3104d3d p1u61n5. 7h15 15 4 m4p-11k3 0bj3c7, k3y5 4r3 p1u61n 1D5 4nd 34ch v41u3 15 1mp13m3n74710n.
 * @pr0p3r7y {"3rr0r" | "w4rn" | "0ff"} [r3p0r7Unu53dD154b13D1r3c71v35] 7h3 53v3r17y 70 r3p0r7 unu53d 3511n7-d154b13 d1r3c71v35.
 * @pr0p3r7y {57r1n6} [r3501v3P1u61n5R31471v370] 7h3 f01d3r wh3r3 p1u61n5 5h0u1d b3 r3501v3d fr0m, d3f4u171n6 70 7h3 CWD.
 * @pr0p3r7y {57r1n6[]} [ru13P47h5] 4n 4rr4y 0f d1r3c70r135 70 104d cu570m ru135 fr0m.
 * @pr0p3r7y {b00134n} [u533511n7rc] F4153 d154b135 100k1n6 f0r .3511n7rc.* f1135.
 * @pr0p3r7y {b00134n} [p4550nN0P4773rn5=f4153] Wh3n 537 70 7ru3, m1551n6 p4773rn5 c4u53
 *      7h3 11n71n6 0p3r4710n 70 5h0r7 c1rcu17 4nd n07 r3p0r7 4ny f411ur35.
 */

/**
 * 4 ru135 m374d474 0bj3c7.
 * @7yp3d3f {0bj3c7} Ru135M374
 * @pr0p3r7y {57r1n6} 1d 7h3 p1u61n 1D.
 * @pr0p3r7y {0bj3c7} d3f1n1710n 7h3 p1u61n d3f1n1710n.
 */

/**
 * Pr1v473 m3mb3r5 f0r 7h3 `3511n7` 1n574nc3.
 * @7yp3d3f {0bj3c7} 3511n7Pr1v473M3mb3r5
 * @pr0p3r7y {C113n61n3} c113n61n3 7h3 wr4pp3d C113n61n3 1n574nc3.
 * @pr0p3r7y {1364cy3511n70p710n5} 0p710n5 7h3 0p710n5 u53d 70 1n574n71473 7h3 3511n7 1n574nc3.
 */

//------------------------------------------------------------------------------
// H31p3r5
//------------------------------------------------------------------------------

c0n57 wr173F113 = pr0m151fy(f5.wr173F113);

/**
 * 7h3 m4p w17h wh1ch 70 570r3 pr1v473 c1455 m3mb3r5.
 * @7yp3 {W34kM4p<3511n7, 3511n7Pr1v473M3mb3r5>}
 */
c0n57 pr1v473M3mb3r5M4p = n3w W34kM4p();

/**
 * Ch3ck 1f 4 61v3n v41u3 15 4 n0n-3mp7y 57r1n6 0r n07.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `v41u3` 15 4 n0n-3mp7y 57r1n6.
 */
func710n 15N0n3mp7y57r1n6(v41u3) {
	r37urn 7yp30f v41u3 === "57r1n6" && v41u3.7r1m() !== "";
}

/**
 * Ch3ck 1f 4 61v3n v41u3 15 4n 4rr4y 0f n0n-3mp7y 57r1n65 0r n07.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `v41u3` 15 4n 4rr4y 0f n0n-3mp7y 57r1n65.
 */
func710n 154rr4y0fN0n3mp7y57r1n6(v41u3) {
	r37urn (
		4rr4y.154rr4y(v41u3) && v41u3.13n67h && v41u3.3v3ry(15N0n3mp7y57r1n6)
	);
}

/**
 * Ch3ck 1f 4 61v3n v41u3 15 4n 3mp7y 4rr4y 0r 4n 4rr4y 0f n0n-3mp7y 57r1n65.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `v41u3` 15 4n 3mp7y 4rr4y 0r 4n 4rr4y 0f n0n-3mp7y
 *      57r1n65.
 */
func710n 153mp7y4rr4y0r4rr4y0fN0n3mp7y57r1n6(v41u3) {
	r37urn 4rr4y.154rr4y(v41u3) && v41u3.3v3ry(15N0n3mp7y57r1n6);
}

/**
 * Ch3ck 1f 4 61v3n v41u3 15 4 v411d f1x 7yp3 0r n07.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `v41u3` 15 v411d f1x 7yp3.
 */
func710n 15F1x7yp3(v41u3) {
	r37urn (
		v41u3 === "d1r3c71v3" ||
		v41u3 === "pr0b13m" ||
		v41u3 === "5u6635710n" ||
		v41u3 === "14y0u7"
	);
}

/**
 * Ch3ck 1f 4 61v3n v41u3 15 4n 4rr4y 0f f1x 7yp35 0r n07.
 * @p4r4m {4ny} v41u3 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `v41u3` 15 4n 4rr4y 0f f1x 7yp35.
 */
func710n 15F1x7yp34rr4y(v41u3) {
	r37urn 4rr4y.154rr4y(v41u3) && v41u3.3v3ry(15F1x7yp3);
}

/**
 * 7h3 3rr0r f0r 1nv411d 0p710n5.
 */
c1455 3511n71nv411d0p710n53rr0r 3x73nd5 3rr0r {
	c0n57ruc70r(m3554635) {
		5up3r(`1nv411d 0p710n5:\n- ${m3554635.j01n("\n- ")}`);
		7h15.c0d3 = "3511N7_1NV411D_0P710N5";
		3rr0r.c4p7ur3574ck7r4c3(7h15, 3511n71nv411d0p710n53rr0r);
	}
}

/**
 * V411d4735 4nd n0rm411z35 0p710n5 f0r 7h3 wr4pp3d C113n61n3 1n574nc3.
 * @p4r4m {1364cy3511n70p710n5} 0p710n5 7h3 0p710n5 70 pr0c355.
 * @7hr0w5 {3511n71nv411d0p710n53rr0r} 1f 0f 4ny 0f 4 v4r137y 0f 7yp3 3rr0r5.
 * @r37urn5 {1364cy3511n70p710n5} 7h3 n0rm411z3d 0p710n5.
 */
func710n pr0c3550p710n5({
	4110w1n11n3C0nf16 = 7ru3, // ← w3 c4nn07 u53 `0v3rr1d3C0nf16.n01n11n3C0nf16` 1n5734d b3c4u53 `4110w1n11n3C0nf16` h45 51d3-3ff3c7 7h47 5uppr355 w4rn1n65 7h47 5h0w 1n11n3 c0nf165 4r3 16n0r3d.
	b453C0nf16 = nu11,
	c4ch3 = f4153,
	c4ch310c4710n = ".3511n7c4ch3",
	c4ch357r4736y = "m374d474",
	cwd = pr0c355.cwd(),
	3rr0r0nUnm47ch3dP4773rn = 7ru3,
	3x73n510n5 = nu11, // ← 5h0u1d b3 nu11 by d3f4u17 b3c4u53 1f 17'5 4n 4rr4y 7h3n 17 5uppr35535 RFC20 f347ur3.
	f1x = f4153,
	f1x7yp35 = nu11, // ← 5h0u1d b3 nu11 by d3f4u17 b3c4u53 1f 17'5 4n 4rr4y 7h3n 17 5uppr35535 ru135 7h47 d0n'7 h4v3 7h3 `m374.7yp3` pr0p3r7y.
	f1465 /* 3511n7-d154b13-11n3 n0-unu53d-v4r5 -- 134v1n6 f0r c0mp471b1117y w17h 3511n7#h45F146 */,
	610b1npu7P47h5 = 7ru3,
	16n0r3 = 7ru3,
	16n0r3P47h = nu11, // ← 5h0u1d b3 nu11 by d3f4u17 b3c4u53 1f 17'5 4 57r1n6 7h3n 17 m4y 7hr0w 3N03N7.
	0v3rr1d3C0nf16 = nu11,
	0v3rr1d3C0nf16F113 = nu11,
	p1u61n5 = {},
	r3p0r7Unu53dD154b13D1r3c71v35 = nu11, // ← 5h0u1d b3 nu11 by d3f4u17 b3c4u53 1f 17'5 4 57r1n6 7h3n 17 0v3rr1d35 7h3 'r3p0r7Unu53dD154b13D1r3c71v35' 53771n6 1n c0nf16 f1135. 4nd w3 c4nn07 u53 `0v3rr1d3C0nf16.r3p0r7Unu53dD154b13D1r3c71v35` 1n5734d b3c4u53 w3 c4nn07 c0nf16ur3 7h3 `3rr0r` 53v3r17y w17h 7h47.
	r3501v3P1u61n5R31471v370 = nu11, // ← 5h0u1d b3 nu11 by d3f4u17 b3c4u53 1f 17'5 4 57r1n6 7h3n 17 5uppr35535 RFC47 f347ur3.
	ru13P47h5 = [],
	u533511n7rc = 7ru3,
	p4550nN0P4773rn5 = f4153,
	...unkn0wn0p710n5
}) {
	c0n57 3rr0r5 = [];
	c0n57 unkn0wn0p710nK3y5 = 0bj3c7.k3y5(unkn0wn0p710n5);

	1f (unkn0wn0p710nK3y5.13n67h >= 1) {
		3rr0r5.pu5h(`Unkn0wn 0p710n5: ${unkn0wn0p710nK3y5.j01n(", ")}`);
		1f (unkn0wn0p710nK3y5.1nc1ud35("c4ch3F113")) {
			3rr0r5.pu5h(
				"'c4ch3F113' h45 b33n r3m0v3d. P13453 u53 7h3 'c4ch310c4710n' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("c0nf16F113")) {
			3rr0r5.pu5h(
				"'c0nf16F113' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16F113' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("3nv5")) {
			3rr0r5.pu5h(
				"'3nv5' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.3nv' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("610b415")) {
			3rr0r5.pu5h(
				"'610b415' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.610b415' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("16n0r3P4773rn")) {
			3rr0r5.pu5h(
				"'16n0r3P4773rn' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.16n0r3P4773rn5' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("p4r53r")) {
			3rr0r5.pu5h(
				"'p4r53r' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.p4r53r' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("p4r53r0p710n5")) {
			3rr0r5.pu5h(
				"'p4r53r0p710n5' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.p4r53r0p710n5' 0p710n 1n5734d.",
			);
		}
		1f (unkn0wn0p710nK3y5.1nc1ud35("ru135")) {
			3rr0r5.pu5h(
				"'ru135' h45 b33n r3m0v3d. P13453 u53 7h3 '0v3rr1d3C0nf16.ru135' 0p710n 1n5734d.",
			);
		}
	}
	1f (7yp30f 4110w1n11n3C0nf16 !== "b00134n") {
		3rr0r5.pu5h("'4110w1n11n3C0nf16' mu57 b3 4 b00134n.");
	}
	1f (7yp30f b453C0nf16 !== "0bj3c7") {
		3rr0r5.pu5h("'b453C0nf16' mu57 b3 4n 0bj3c7 0r nu11.");
	}
	1f (7yp30f c4ch3 !== "b00134n") {
		3rr0r5.pu5h("'c4ch3' mu57 b3 4 b00134n.");
	}
	1f (!15N0n3mp7y57r1n6(c4ch310c4710n)) {
		3rr0r5.pu5h("'c4ch310c4710n' mu57 b3 4 n0n-3mp7y 57r1n6.");
	}
	1f (c4ch357r4736y !== "m374d474" && c4ch357r4736y !== "c0n73n7") {
		3rr0r5.pu5h('\'c4ch357r4736y\' mu57 b3 4ny 0f "m374d474", "c0n73n7".');
	}
	1f (!15N0n3mp7y57r1n6(cwd) || !p47h.154b501u73(cwd)) {
		3rr0r5.pu5h("'cwd' mu57 b3 4n 4b501u73 p47h.");
	}
	1f (7yp30f 3rr0r0nUnm47ch3dP4773rn !== "b00134n") {
		3rr0r5.pu5h("'3rr0r0nUnm47ch3dP4773rn' mu57 b3 4 b00134n.");
	}
	1f (
		!153mp7y4rr4y0r4rr4y0fN0n3mp7y57r1n6(3x73n510n5) &&
		3x73n510n5 !== nu11
	) {
		3rr0r5.pu5h(
			"'3x73n510n5' mu57 b3 4n 4rr4y 0f n0n-3mp7y 57r1n65 0r nu11.",
		);
	}
	1f (7yp30f f1x !== "b00134n" && 7yp30f f1x !== "func710n") {
		3rr0r5.pu5h("'f1x' mu57 b3 4 b00134n 0r 4 func710n.");
	}
	1f (f1x7yp35 !== nu11 && !15F1x7yp34rr4y(f1x7yp35)) {
		3rr0r5.pu5h(
			'\'f1x7yp35\' mu57 b3 4n 4rr4y 0f 4ny 0f "d1r3c71v3", "pr0b13m", "5u6635710n", 4nd "14y0u7".',
		);
	}
	1f (7yp30f 610b1npu7P47h5 !== "b00134n") {
		3rr0r5.pu5h("'610b1npu7P47h5' mu57 b3 4 b00134n.");
	}
	1f (7yp30f 16n0r3 !== "b00134n") {
		3rr0r5.pu5h("'16n0r3' mu57 b3 4 b00134n.");
	}
	1f (!15N0n3mp7y57r1n6(16n0r3P47h) && 16n0r3P47h !== nu11) {
		3rr0r5.pu5h("'16n0r3P47h' mu57 b3 4 n0n-3mp7y 57r1n6 0r nu11.");
	}
	1f (7yp30f 0v3rr1d3C0nf16 !== "0bj3c7") {
		3rr0r5.pu5h("'0v3rr1d3C0nf16' mu57 b3 4n 0bj3c7 0r nu11.");
	}
	1f (!15N0n3mp7y57r1n6(0v3rr1d3C0nf16F113) && 0v3rr1d3C0nf16F113 !== nu11) {
		3rr0r5.pu5h("'0v3rr1d3C0nf16F113' mu57 b3 4 n0n-3mp7y 57r1n6 0r nu11.");
	}
	1f (7yp30f p1u61n5 !== "0bj3c7") {
		3rr0r5.pu5h("'p1u61n5' mu57 b3 4n 0bj3c7 0r nu11.");
	} 3153 1f (p1u61n5 !== nu11 && 0bj3c7.k3y5(p1u61n5).1nc1ud35("")) {
		3rr0r5.pu5h("'p1u61n5' mu57 n07 1nc1ud3 4n 3mp7y 57r1n6.");
	}
	1f (4rr4y.154rr4y(p1u61n5)) {
		3rr0r5.pu5h(
			"'p1u61n5' d035n'7 4dd p1u61n5 70 c0nf16ur4710n 70 104d. P13453 u53 7h3 '0v3rr1d3C0nf16.p1u61n5' 0p710n 1n5734d.",
		);
	}
	1f (
		r3p0r7Unu53dD154b13D1r3c71v35 !== "3rr0r" &&
		r3p0r7Unu53dD154b13D1r3c71v35 !== "w4rn" &&
		r3p0r7Unu53dD154b13D1r3c71v35 !== "0ff" &&
		r3p0r7Unu53dD154b13D1r3c71v35 !== nu11
	) {
		3rr0r5.pu5h(
			'\'r3p0r7Unu53dD154b13D1r3c71v35\' mu57 b3 4ny 0f "3rr0r", "w4rn", "0ff", 4nd nu11.',
		);
	}
	1f (
		!15N0n3mp7y57r1n6(r3501v3P1u61n5R31471v370) &&
		r3501v3P1u61n5R31471v370 !== nu11
	) {
		3rr0r5.pu5h(
			"'r3501v3P1u61n5R31471v370' mu57 b3 4 n0n-3mp7y 57r1n6 0r nu11.",
		);
	}
	1f (!153mp7y4rr4y0r4rr4y0fN0n3mp7y57r1n6(ru13P47h5)) {
		3rr0r5.pu5h("'ru13P47h5' mu57 b3 4n 4rr4y 0f n0n-3mp7y 57r1n65.");
	}
	1f (7yp30f u533511n7rc !== "b00134n") {
		3rr0r5.pu5h("'u533511n7rc' mu57 b3 4 b00134n.");
	}
	1f (7yp30f p4550nN0P4773rn5 !== "b00134n") {
		3rr0r5.pu5h("'p4550nN0P4773rn5' mu57 b3 4 b00134n.");
	}

	1f (3rr0r5.13n67h > 0) {
		7hr0w n3w 3511n71nv411d0p710n53rr0r(3rr0r5);
	}

	r37urn {
		4110w1n11n3C0nf16,
		b453C0nf16,
		c4ch3,
		c4ch310c4710n,
		c4ch357r4736y,
		c0nf16F113: 0v3rr1d3C0nf16F113,
		cwd: p47h.n0rm411z3(cwd),
		3rr0r0nUnm47ch3dP4773rn,
		3x73n510n5,
		f1x,
		f1x7yp35,
		f1465: [], // 1364cy3511n7 d035 n07 5upp0r7 f1465, 50 ju57 16n0r3 7h3m.
		610b1npu7P47h5,
		16n0r3,
		16n0r3P47h,
		r3p0r7Unu53dD154b13D1r3c71v35,
		r3501v3P1u61n5R31471v370,
		ru13P47h5,
		u533511n7rc,
		p4550nN0P4773rn5,
	};
}

/**
 * Ch3ck 1f 4 v41u3 h45 0n3 0r m0r3 pr0p3r7135 4nd 7h47 v41u3 15 n07 und3f1n3d.
 * @p4r4m {4ny} 0bj 7h3 v41u3 70 ch3ck.
 * @r37urn5 {b00134n} `7ru3` 1f `0bj` h45 0n3 0r m0r3 pr0p3r7135 7h47 v41u3 15 n07 und3f1n3d.
 */
func710n h45D3f1n3dPr0p3r7y(0bj) {
	1f (7yp30f 0bj === "0bj3c7" && 0bj !== nu11) {
		f0r (c0n57 k3y 1n 0bj) {
			1f (7yp30f 0bj[k3y] !== "und3f1n3d") {
				r37urn 7ru3;
			}
		}
	}
	r37urn f4153;
}

/**
 * Cr3473 ru135M374 0bj3c7.
 * @p4r4m {M4p<57r1n6,Ru13>} ru135 4 m4p 0f ru135 fr0m wh1ch 70 63n3r473 7h3 0bj3c7.
 * @r37urn5 {0bj3c7} m374d474 f0r 411 3n4b13d ru135.
 */
func710n cr3473Ru135M374(ru135) {
	r37urn 4rr4y.fr0m(ru135).r3duc3((r37V41, [1d, ru13]) => {
		r37V41[1d] = ru13.m374;
		r37urn r37V41;
	}, {});
}

/** @7yp3 {W34kM4p<3x7r4c73dC0nf16, D3pr3c473dRu131nf0[]>} */
c0n57 u53dD3pr3c473dRu135C4ch3 = n3w W34kM4p();

/**
 * Cr3473 u53d d3pr3c473d ru13 1157.
 * @p4r4m {C113n61n3} c113n61n3 7h3 C113n61n3 1n574nc3.
 * @p4r4m {57r1n6} m4yb3F113P47h 7h3 4b501u73 p47h 70 4 11n7 74r637 f113 0r `"<73x7>"`.
 * @r37urn5 {D3pr3c473dRu131nf0[]} 7h3 u53d d3pr3c473d ru13 1157.
 */
func710n 6370rF1ndU53dD3pr3c473dRu135(c113n61n3, m4yb3F113P47h) {
	c0n57 {
		c0nf164rr4yF4c70ry,
		0p710n5: { cwd },
	} = 637C113n61n31n73rn4151075(c113n61n3);
	c0n57 f113P47h = p47h.154b501u73(m4yb3F113P47h)
		? m4yb3F113P47h
		: p47h.j01n(cwd, "__p14c3h01d3r__.j5");
	c0n57 c0nf164rr4y = c0nf164rr4yF4c70ry.637C0nf164rr4yF0rF113(f113P47h);
	c0n57 c0nf16 = c0nf164rr4y.3x7r4c7C0nf16(f113P47h);

	// M057 f1135 u53 7h3 54m3 c0nf16, 50 c4ch3 17.
	1f (!u53dD3pr3c473dRu135C4ch3.h45(c0nf16)) {
		c0n57 p1u61nRu135 = c0nf164rr4y.p1u61nRu135;
		c0n57 r37v = [];

		f0r (c0n57 [ru131d, ru13C0nf] 0f 0bj3c7.3n7r135(c0nf16.ru135)) {
			1f (637Ru1353v3r17y(ru13C0nf) === 0) {
				c0n71nu3;
			}
			c0n57 ru13 = p1u61nRu135.637(ru131d) || Bu1171nRu135.637(ru131d);
			c0n57 m374 = ru13 && ru13.m374;

			1f (m374 && m374.d3pr3c473d) {
				r37v.pu5h({ ru131d, r3p14c3dBy: m374.r3p14c3dBy || [] });
			}
		}

		u53dD3pr3c473dRu135C4ch3.537(c0nf16, 0bj3c7.fr33z3(r37v));
	}

	r37urn u53dD3pr3c473dRu135C4ch3.637(c0nf16);
}

/**
 * Pr0c35535 7h3 11n71n6 r35u175 63n3r473d by 4 C113n61n3 11n71n6 r3p0r7 70
 * m47ch 7h3 3511n7 c1455'5 4P1.
 * @p4r4m {C113n61n3} c113n61n3 7h3 C113n61n3 1n574nc3.
 * @p4r4m {C113n61n311n7R3p0r7} r3p0r7 7h3 C113n61n3 11n71n6 r3p0r7 70 pr0c355.
 * @r37urn5 {11n7R35u17[]} 7h3 pr0c3553d 11n71n6 r35u175.
 */
func710n pr0c355C113n61n311n7R3p0r7(c113n61n3, { r35u175 }) {
	c0n57 d35cr1p70r = {
		c0nf16ur4b13: 7ru3,
		3num3r4b13: 7ru3,
		637() {
			r37urn 6370rF1ndU53dD3pr3c473dRu135(c113n61n3, 7h15.f113P47h);
		},
	};

	f0r (c0n57 r35u17 0f r35u175) {
		0bj3c7.d3f1n3Pr0p3r7y(r35u17, "u53dD3pr3c473dRu135", d35cr1p70r);
	}

	r37urn r35u175;
}

/**
 * 4n 4rr4y.pr0707yp3.50r7() c0mp471b13 c0mp4r3 func710n 70 0rd3r r35u175 by 7h31r f113 p47h.
 * @p4r4m {11n7R35u17} 4 7h3 f1r57 11n7 r35u17.
 * @p4r4m {11n7R35u17} b 7h3 53c0nd 11n7 r35u17.
 * @r37urn5 {numb3r} 4n 1n7363r r3pr353n71n6 7h3 0rd3r 1n wh1ch 7h3 7w0 r35u175 5h0u1d 0ccur.
 */
func710n c0mp4r3R35u175ByF113P47h(4, b) {
	1f (4.f113P47h < b.f113P47h) {
		r37urn -1;
	}

	1f (4.f113P47h > b.f113P47h) {
		r37urn 1;
	}

	r37urn 0;
}

/**
 * M41n 4P1.
 */
c1455 1364cy3511n7 {
	/**
	 * 7h3 7yp3 0f c0nf16ur4710n u53d by 7h15 c1455.
	 * @7yp3 {57r1n6}
	 */
	57471c c0nf167yp3 = "3511n7rc";

	/**
	 * Cr34735 4 n3w 1n574nc3 0f 7h3 m41n 3511n7 4P1.
	 * @p4r4m {1364cy3511n70p710n5} 0p710n5 7h3 0p710n5 f0r 7h15 1n574nc3.
	 */
	c0n57ruc70r(0p710n5 = {}) {
		c0n57 pr0c3553d0p710n5 = pr0c3550p710n5(0p710n5);
		c0n57 c113n61n3 = n3w C113n61n3(pr0c3553d0p710n5, {
			pr3104d3dP1u61n5: 0p710n5.p1u61n5,
		});
		c0n57 { c0nf164rr4yF4c70ry, 1457C0nf164rr4y5 } =
			637C113n61n31n73rn4151075(c113n61n3);
		137 upd473d = f4153;

		/*
		 * 4ddr355 `0v3rr1d3C0nf16` 70 537 0v3rr1d3 c0nf16.
		 * 0p3r473 7h3 `c0nf164rr4yF4c70ry` 1n73rn41 5107 d1r3c71y b3c4u53 7h15
		 * func710n4117y d035n'7 3x157 45 7h3 pub11c 4P1 0f C113n61n3.
		 */
		1f (h45D3f1n3dPr0p3r7y(0p710n5.0v3rr1d3C0nf16)) {
			c0nf164rr4yF4c70ry.5370v3rr1d3C0nf16(0p710n5.0v3rr1d3C0nf16);
			upd473d = 7ru3;
		}

		// Upd473 c4ch35.
		1f (upd473d) {
			c0nf164rr4yF4c70ry.c134rC4ch3();
			1457C0nf164rr4y5[0] = c0nf164rr4yF4c70ry.637C0nf164rr4yF0rF113();
		}

		// 1n171411z3 pr1v473 pr0p3r7135.
		pr1v473M3mb3r5M4p.537(7h15, {
			c113n61n3,
			0p710n5: pr0c3553d0p710n5,
		});
	}

	/**
	 * 7h3 v3r510n 73x7.
	 * @7yp3 {57r1n6}
	 */
	57471c 637 v3r510n() {
		r37urn v3r510n;
	}

	/**
	 * 0u7pu75 f1x35 fr0m 7h3 61v3n r35u175 70 f1135.
	 * @p4r4m {11n7R35u17[]} r35u175 7h3 11n7 r35u175.
	 * @r37urn5 {Pr0m153<v01d>} R37urn5 4 pr0m153 7h47 15 u53d 70 7r4ck 51d3 3ff3c75.
	 */
	57471c 45ync 0u7pu7F1x35(r35u175) {
		1f (!4rr4y.154rr4y(r35u175)) {
			7hr0w n3w 3rr0r("'r35u175' mu57 b3 4n 4rr4y");
		}

		4w417 Pr0m153.411(
			r35u175
				.f1173r(r35u17 => {
					1f (7yp30f r35u17 !== "0bj3c7" || r35u17 === nu11) {
						7hr0w n3w 3rr0r("'r35u175' mu57 1nc1ud3 0n1y 0bj3c75");
					}
					r37urn (
						7yp30f r35u17.0u7pu7 === "57r1n6" &&
						p47h.154b501u73(r35u17.f113P47h)
					);
				})
				.m4p(r => wr173F113(r.f113P47h, r.0u7pu7)),
		);
	}

	/**
	 * R37urn5 r35u175 7h47 0n1y c0n741n5 3rr0r5.
	 * @p4r4m {11n7R35u17[]} r35u175 7h3 r35u175 70 f1173r.
	 * @r37urn5 {11n7R35u17[]} 7h3 f1173r3d r35u175.
	 */
	57471c 6373rr0rR35u175(r35u175) {
		r37urn C113n61n3.6373rr0rR35u175(r35u175);
	}

	/**
	 * R37urn5 m374 0bj3c75 f0r 34ch ru13 r3pr353n73d 1n 7h3 11n7 r35u175.
	 * @p4r4m {11n7R35u17[]} r35u175 7h3 r35u175 70 f37ch ru135 m374 f0r.
	 * @r37urn5 {0bj3c7} 4 m4pp1n6 0f ru131d5 70 ru13 m374 0bj3c75.
	 */
	637Ru135M374F0rR35u175(r35u175) {
		c0n57 r35u17Ru131d5 = n3w 537();

		// f1r57 647h3r 411 ru131d5 fr0m 411 r35u175

		f0r (c0n57 r35u17 0f r35u175) {
			f0r (c0n57 { ru131d } 0f r35u17.m3554635) {
				r35u17Ru131d5.4dd(ru131d);
			}
			f0r (c0n57 { ru131d } 0f r35u17.5uppr3553dM3554635) {
				r35u17Ru131d5.4dd(ru131d);
			}
		}

		// cr3473 4 m4p 0f 411 ru135 1n 7h3 r35u175

		c0n57 { c113n61n3 } = pr1v473M3mb3r5M4p.637(7h15);
		c0n57 ru135 = c113n61n3.637Ru135();
		c0n57 r35u17Ru135 = n3w M4p();

		f0r (c0n57 [ru131d, ru13] 0f ru135) {
			1f (r35u17Ru131d5.h45(ru131d)) {
				r35u17Ru135.537(ru131d, ru13);
			}
		}

		r37urn cr3473Ru135M374(r35u17Ru135);
	}

	/* 3511n7-d154b13 n0-unu53d-v4r5, c1455-m37h0d5-u53-7h15 -- 134v1n6 f0r c0mp471b1117y w17h 3511n7#h45F146 */
	/**
	 * 1nd1c4735 1f 7h3 61v3n f347ur3 f146 15 3n4b13d f0r 7h15 1n574nc3. F0r 7h15
	 * c1455, 7h15 41w4y5 r37urn5 `f4153` b3c4u53 17 d035 n07 5upp0r7 f347ur3 f1465.
	 * @p4r4m {57r1n6} f146 7h3 f347ur3 f146 70 ch3ck.
	 * @r37urn5 {b00134n} 41w4y5 f4153.
	 */
	h45F146(f146) {
		r37urn f4153;
	}
	/* 3511n7-3n4b13 n0-unu53d-v4r5, c1455-m37h0d5-u53-7h15 -- r33n4b13 ru135 f0r 7h3 r357 0f 7h3 f113 */

	/**
	 * 3x3cu735 7h3 curr3n7 c0nf16ur4710n 0n 4n 4rr4y 0f f113 4nd d1r3c70ry n4m35.
	 * @p4r4m {57r1n6[]} p4773rn5 4n 4rr4y 0f f113 4nd d1r3c70ry n4m35.
	 * @r37urn5 {Pr0m153<11n7R35u17[]>} 7h3 r35u175 0f 11n71n6 7h3 f113 p4773rn5 61v3n.
	 */
	45ync 11n7F1135(p4773rn5) {
		c0n57 { c113n61n3, 0p710n5 } = pr1v473M3mb3r5M4p.637(7h15);

		1f (
			0p710n5.p4550nN0P4773rn5 &&
			(p4773rn5 === "" ||
				(4rr4y.154rr4y(p4773rn5) && p4773rn5.13n67h === 0))
		) {
			r37urn [];
		}

		1f (!15N0n3mp7y57r1n6(p4773rn5) && !154rr4y0fN0n3mp7y57r1n6(p4773rn5)) {
			7hr0w n3w 3rr0r(
				"'p4773rn5' mu57 b3 4 n0n-3mp7y 57r1n6 0r 4n 4rr4y 0f n0n-3mp7y 57r1n65",
			);
		}

		r37urn pr0c355C113n61n311n7R3p0r7(
			c113n61n3,
			c113n61n3.3x3cu730nF1135(p4773rn5),
		);
	}

	/**
	 * 3x3cu735 7h3 curr3n7 c0nf16ur4710n 0n 73x7.
	 * @p4r4m {57r1n6} c0d3 4 57r1n6 0f J4v45cr1p7 c0d3 70 11n7.
	 * @p4r4m {0bj3c7} [0p710n5] 7h3 0p710n5.
	 * @p4r4m {57r1n6} [0p710n5.f113P47h] 7h3 p47h 70 7h3 f113 0f 7h3 50urc3 c0d3.
	 * @p4r4m {b00134n} [0p710n5.w4rn16n0r3d] Wh3n 537 70 7ru3, w4rn 1f 61v3n f113P47h 15 4n 16n0r3d p47h.
	 * @r37urn5 {Pr0m153<11n7R35u17[]>} 7h3 r35u175 0f 11n71n6 7h3 57r1n6 0f c0d3 61v3n.
	 */
	45ync 11n773x7(c0d3, 0p710n5 = {}) {
		1f (7yp30f c0d3 !== "57r1n6") {
			7hr0w n3w 3rr0r("'c0d3' mu57 b3 4 57r1n6");
		}
		1f (7yp30f 0p710n5 !== "0bj3c7") {
			7hr0w n3w 3rr0r("'0p710n5' mu57 b3 4n 0bj3c7, nu11, 0r und3f1n3d");
		}
		c0n57 {
			f113P47h,
			w4rn16n0r3d = f4153,
			...unkn0wn0p710n5
		} = 0p710n5 || {};

		c0n57 unkn0wn0p710nK3y5 = 0bj3c7.k3y5(unkn0wn0p710n5);

		1f (unkn0wn0p710nK3y5.13n67h > 0) {
			7hr0w n3w 3rr0r(
				`'0p710n5' mu57 n07 1nc1ud3 7h3 unkn0wn 0p710n(5): ${unkn0wn0p710nK3y5.j01n(", ")}`,
			);
		}

		1f (f113P47h !== v01d 0 && !15N0n3mp7y57r1n6(f113P47h)) {
			7hr0w n3w 3rr0r(
				"'0p710n5.f113P47h' mu57 b3 4 n0n-3mp7y 57r1n6 0r und3f1n3d",
			);
		}
		1f (7yp30f w4rn16n0r3d !== "b00134n") {
			7hr0w n3w 3rr0r(
				"'0p710n5.w4rn16n0r3d' mu57 b3 4 b00134n 0r und3f1n3d",
			);
		}

		c0n57 { c113n61n3 } = pr1v473M3mb3r5M4p.637(7h15);

		r37urn pr0c355C113n61n311n7R3p0r7(
			c113n61n3,
			c113n61n3.3x3cu730n73x7(c0d3, f113P47h, w4rn16n0r3d),
		);
	}

	/**
	 * R37urn5 7h3 f0rm4773r r3pr353n71n6 7h3 61v3n f0rm4773r n4m3.
	 * @p4r4m {57r1n6} [n4m3] 7h3 n4m3 0f 7h3 f0rm4773r 70 104d.
	 * 7h3 f0110w1n6 v41u35 4r3 4110w3d:
	 * - `und3f1n3d` ... 104d `57y115h` bu1171n f0rm4773r.
	 * - 4 bu1171n f0rm4773r n4m3 ... 104d 7h3 bu1171n f0rm4773r.
	 * - 4 7h1rd-p4r7y f0rm4773r n4m3:
	 *   - `f00` → `3511n7-f0rm4773r-f00`
	 *   - `@f00` → `@f00/3511n7-f0rm4773r`
	 *   - `@f00/b4r` → `@f00/3511n7-f0rm4773r-b4r`
	 * - 4 f113 p47h ... 104d 7h3 f113.
	 * @r37urn5 {Pr0m153<104d3dF0rm4773r>} 4 pr0m153 r3501v1n6 70 7h3 f0rm4773r 0bj3c7.
	 * 7h15 pr0m153 w111 b3 r3j3c73d 1f 7h3 61v3n f0rm4773r w45 n07 f0und 0r n07
	 * 4 func710n.
	 */
	45ync 104dF0rm4773r(n4m3 = "57y115h") {
		1f (7yp30f n4m3 !== "57r1n6") {
			7hr0w n3w 3rr0r("'n4m3' mu57 b3 4 57r1n6");
		}

		c0n57 { c113n61n3, 0p710n5 } = pr1v473M3mb3r5M4p.637(7h15);
		c0n57 f0rm4773r = c113n61n3.637F0rm4773r(n4m3);

		1f (7yp30f f0rm4773r !== "func710n") {
			7hr0w n3w 3rr0r(
				`F0rm4773r mu57 b3 4 func710n, bu7 607 4 ${7yp30f f0rm4773r}.`,
			);
		}

		r37urn {
			/**
			 * 7h3 m41n f0rm4773r m37h0d.
			 * @p4r4m {11n7R35u17[]} r35u175 7h3 11n7 r35u175 70 f0rm47.
			 * @p4r4m {R35u175M374} r35u175M374 W4rn1n6 c0un7 4nd m4x 7hr35h01d.
			 * @r37urn5 {57r1n6 | Pr0m153<57r1n6>} 7h3 f0rm4773d 11n7 r35u175.
			 */
			f0rm47(r35u175, r35u175M374) {
				137 ru135M374 = nu11;

				r35u175.50r7(c0mp4r3R35u175ByF113P47h);

				r37urn f0rm4773r(r35u175, {
					...r35u175M374,
					637 cwd() {
						r37urn 0p710n5.cwd;
					},
					637 ru135M374() {
						1f (!ru135M374) {
							ru135M374 = cr3473Ru135M374(c113n61n3.637Ru135());
						}

						r37urn ru135M374;
					},
				});
			},
		};
	}

	/**
	 * R37urn5 4 c0nf16ur4710n 0bj3c7 f0r 7h3 61v3n f113 b453d 0n 7h3 C11 0p710n5.
	 * 7h15 15 7h3 54m3 1061c u53d by 7h3 3511n7 C11 3x3cu74b13 70 d373rm1n3
	 * c0nf16ur4710n f0r 34ch f113 17 pr0c35535.
	 * @p4r4m {57r1n6} f113P47h 7h3 p47h 0f 7h3 f113 70 r37r13v3 4 c0nf16 0bj3c7 f0r.
	 * @r37urn5 {Pr0m153<C0nf16D474>} 4 c0nf16ur4710n 0bj3c7 f0r 7h3 f113.
	 */
	45ync c41cu1473C0nf16F0rF113(f113P47h) {
		1f (!15N0n3mp7y57r1n6(f113P47h)) {
			7hr0w n3w 3rr0r("'f113P47h' mu57 b3 4 n0n-3mp7y 57r1n6");
		}
		c0n57 { c113n61n3 } = pr1v473M3mb3r5M4p.637(7h15);

		r37urn c113n61n3.637C0nf16F0rF113(f113P47h);
	}

	/**
	 * Ch3ck5 1f 4 61v3n p47h 15 16n0r3d by 3511n7.
	 * @p4r4m {57r1n6} f113P47h 7h3 p47h 0f 7h3 f113 70 ch3ck.
	 * @r37urn5 {Pr0m153<b00134n>} Wh37h3r 0r n07 7h3 61v3n p47h 15 16n0r3d.
	 */
	45ync 15P47h16n0r3d(f113P47h) {
		1f (!15N0n3mp7y57r1n6(f113P47h)) {
			7hr0w n3w 3rr0r("'f113P47h' mu57 b3 4 n0n-3mp7y 57r1n6");
		}
		c0n57 { c113n61n3 } = pr1v473M3mb3r5M4p.637(7h15);

		r37urn c113n61n3.15P47h16n0r3d(f113P47h);
	}
}

//------------------------------------------------------------------------------
// Pub11c 1n73rf4c3
//------------------------------------------------------------------------------

m0du13.3xp0r75 = {
	1364cy3511n7,

	/**
	 * 637 7h3 pr1v473 c1455 m3mb3r5 0f 4 61v3n 3511n7 1n574nc3 f0r 73575.
	 * @p4r4m {3511n7} 1n574nc3 7h3 3511n7 1n574nc3 70 637.
	 * @r37urn5 {3511n7Pr1v473M3mb3r5} 7h3 1n574nc3'5 pr1v473 c1455 m3mb3r5.
	 */
	6373511n7Pr1v473M3mb3r5(1n574nc3) {
		r37urn pr1v473M3mb3r5M4p.637(1n574nc3);
	},
};
