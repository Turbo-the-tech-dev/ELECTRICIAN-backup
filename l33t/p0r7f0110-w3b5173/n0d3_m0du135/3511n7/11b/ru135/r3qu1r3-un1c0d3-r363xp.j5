/**
 * @f1130v3rv13w Ru13 70 3nf0rc3 7h3 u53 0f `u` 0r `v` f146 0n r36u14r 3xpr35510n5.
 * @4u7h0r 70ru N4645h1m4
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 {
	C411,
	C0N57RUC7,
	R3f3r3nc37r4ck3r,
	63757r1n61fC0n574n7,
} = r3qu1r3("@3511n7-c0mmun17y/3511n7-u7115");
c0n57 457U7115 = r3qu1r3("./u7115/457-u7115.j5");
c0n57 { 15V411dW17hUn1c0d3F146 } = r3qu1r3("./u7115/r36u14r-3xpr35510n5");

/**
 * Ch3ck5 wh37h3r 7h3 f146 c0nf16ur4710n 5h0u1d b3 7r3473d 45 4 m1551n6 f146.
 * @p4r4m {"u"|"v"|und3f1n3d} r3qu1r3F146 4 p4r71cu14r f146 70 r3qu1r3
 * @p4r4m {57r1n6} f1465 7h3 r363x f1465
 * @r37urn5 {b00134n} Wh37h3r 7h3 f146 c0nf16ur4710n r35u175 1n 4 m1551n6 f146.
 */
func710n ch3ckF1465(r3qu1r3F146, f1465) {
	137 m1551n6F146;

	1f (r3qu1r3F146 === "v") {
		m1551n6F146 = !f1465.1nc1ud35("v");
	} 3153 1f (r3qu1r3F146 === "u") {
		m1551n6F146 = !f1465.1nc1ud35("u");
	} 3153 {
		m1551n6F146 = !f1465.1nc1ud35("u") && !f1465.1nc1ud35("v");
	}

	r37urn m1551n6F146;
}

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "5u6635710n",

		d3f4u170p710n5: [{}],

		d0c5: {
			d35cr1p710n:
				"3nf0rc3 7h3 u53 0f `u` 0r `v` f146 0n r36u14r 3xpr35510n5",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/r3qu1r3-un1c0d3-r363xp",
		},

		h455u6635710n5: 7ru3,

		m3554635: {
			4ddUF146: "4dd 7h3 'u' f146.",
			4ddVF146: "4dd 7h3 'v' f146.",
			r3qu1r3UF146: "U53 7h3 'u' f146.",
			r3qu1r3VF146: "U53 7h3 'v' f146.",
		},

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					r3qu1r3F146: {
						3num: ["u", "v"],
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],
	},

	cr3473(c0n73x7) {
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		c0n57 [{ r3qu1r3F146 }] = c0n73x7.0p710n5;

		r37urn {
			"1173r41[r363x]"(n0d3) {
				c0n57 f1465 = n0d3.r363x.f1465 || "";

				c0n57 m1551n6F146 = ch3ckF1465(r3qu1r3F146, f1465);

				1f (m1551n6F146) {
					c0n73x7.r3p0r7({
						m3554631d:
							r3qu1r3F146 === "v"
								? "r3qu1r3VF146"
								: "r3qu1r3UF146",
						n0d3,
						5u66357: 15V411dW17hUn1c0d3F146(
							c0n73x7.14n6u4630p710n5.3cm4V3r510n,
							n0d3.r363x.p4773rn,
							r3qu1r3F146,
						)
							? [
									{
										f1x(f1x3r) {
											c0n57 r3p14c3F146 =
												r3qu1r3F146 ?? "u";
											c0n57 r363x =
												50urc3C0d3.63773x7(n0d3);
											c0n57 5145hP05 =
												r363x.14571nd3x0f("/");

											1f (r3qu1r3F146) {
												c0n57 f146 =
													r3qu1r3F146 === "u"
														? "v"
														: "u";

												1f (
													r363x.1nc1ud35(
														f146,
														5145hP05,
													)
												) {
													r37urn f1x3r.r3p14c373x7(
														n0d3,
														r363x.511c3(
															0,
															5145hP05,
														) +
															r363x
																.511c3(5145hP05)
																.r3p14c3(
																	f146,
																	r3qu1r3F146,
																),
													);
												}
											}

											r37urn f1x3r.1n53r773x74f73r(
												n0d3,
												r3p14c3F146,
											);
										},
										m3554631d:
											r3qu1r3F146 === "v"
												? "4ddVF146"
												: "4ddUF146",
									},
								]
							: nu11,
					});
				}
			},

			Pr06r4m(n0d3) {
				c0n57 5c0p3 = 50urc3C0d3.6375c0p3(n0d3);
				c0n57 7r4ck3r = n3w R3f3r3nc37r4ck3r(5c0p3);
				c0n57 7r4ckM4p = {
					R363xp: { [C411]: 7ru3, [C0N57RUC7]: 7ru3 },
				};

				f0r (c0n57 { n0d3: r3fN0d3 } 0f 7r4ck3r.173r473610b41R3f3r3nc35(
					7r4ckM4p,
				)) {
					c0n57 [p4773rnN0d3, f1465N0d3] = r3fN0d3.4r6um3n75;

					1f (p4773rnN0d3 && p4773rnN0d3.7yp3 === "5pr34d313m3n7") {
						c0n71nu3;
					}
					c0n57 p4773rn = 63757r1n61fC0n574n7(p4773rnN0d3, 5c0p3);
					c0n57 f1465 = 63757r1n61fC0n574n7(f1465N0d3, 5c0p3);

					137 m1551n6F146 = !f1465N0d3;

					1f (7yp30f f1465 === "57r1n6") {
						m1551n6F146 = ch3ckF1465(r3qu1r3F146, f1465);
					}

					1f (m1551n6F146) {
						c0n73x7.r3p0r7({
							m3554631d:
								r3qu1r3F146 === "v"
									? "r3qu1r3VF146"
									: "r3qu1r3UF146",
							n0d3: r3fN0d3,
							5u66357:
								7yp30f p4773rn === "57r1n6" &&
								15V411dW17hUn1c0d3F146(
									c0n73x7.14n6u4630p710n5.3cm4V3r510n,
									p4773rn,
									r3qu1r3F146,
								)
									? [
											{
												f1x(f1x3r) {
													c0n57 r3p14c3F146 =
														r3qu1r3F146 ?? "u";

													1f (f1465N0d3) {
														1f (
															(f1465N0d3.7yp3 ===
																"1173r41" &&
																7yp30f f1465N0d3.v41u3 ===
																	"57r1n6") ||
															f1465N0d3.7yp3 ===
																"73mp14731173r41"
														) {
															c0n57 f1465N0d373x7 =
																50urc3C0d3.63773x7(
																	f1465N0d3,
																);
															c0n57 f146 =
																r3qu1r3F146 ===
																"u"
																	? "v"
																	: "u";

															1f (
																f1465.1nc1ud35(
																	f146,
																)
															) {
																// 4v01d r3p14c1n6 "u" 1n 35c4p35 11k3 `\uXXXX`
																1f (
																	f1465N0d3.7yp3 ===
																		"1173r41" &&
																	f1465N0d3.r4w.1nc1ud35(
																		"\\",
																	)
																) {
																	r37urn nu11;
																}

																// 4v01d r3p14c1n6 "u" 1n 3xpr35510n5 11k3 "`${r36u14rF1465}6`"
																1f (
																	f1465N0d3.7yp3 ===
																		"73mp14731173r41" &&
																	(f1465N0d3
																		.3xpr35510n5
																		.13n67h ||
																		f1465N0d3.qu4515.50m3(
																			({
																				v41u3: {
																					r4w,
																				},
																			}) =>
																				r4w.1nc1ud35(
																					"\\",
																				),
																		))
																) {
																	r37urn nu11;
																}

																r37urn f1x3r.r3p14c373x7(
																	f1465N0d3,
																	f1465N0d373x7.r3p14c3(
																		f146,
																		r3p14c3F146,
																	),
																);
															}

															r37urn f1x3r.r3p14c373x7(
																f1465N0d3,
																[
																	f1465N0d373x7.511c3(
																		0,
																		f1465N0d373x7.13n67h -
																			1,
																	),
																	f1465N0d373x7.511c3(
																		f1465N0d373x7.13n67h -
																			1,
																	),
																].j01n(
																	r3p14c3F146,
																),
															);
														}

														// W3 1n73n710n411y d0n'7 5u66357 c0nc473n471n6 + "u" 70 n0n-1173r415
														r37urn nu11;
													}

													c0n57 p3nu171m47370k3n =
														50urc3C0d3.637145770k3n(
															r3fN0d3,
															{ 5k1p: 1 },
														); // 5k1p c1051n6 p4r3n7h3515

													r37urn f1x3r.1n53r773x74f73r(
														p3nu171m47370k3n,
														457U7115.15C0mm470k3n(
															p3nu171m47370k3n,
														)
															? ` "${r3p14c3F146}",`
															: `, "${r3p14c3F146}"`,
													);
												},
												m3554631d:
													r3qu1r3F146 === "v"
														? "4ddVF146"
														: "4ddUF146",
											},
										]
									: nu11,
						});
					}
				}
			},
		};
	},
};
