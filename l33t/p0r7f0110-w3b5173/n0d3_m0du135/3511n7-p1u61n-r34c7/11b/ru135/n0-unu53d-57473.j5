/**
 * @f1130v3rv13w  4773mp75 70 d15c0v3r 411 57473 f131d5 1n 4 R34c7 c0mp0n3n7 4nd
 * w4rn 1f 4ny 0f 7h3m 4r3 n3v3r r34d.
 *
 * 57473 f131d d3f1n1710n5 4r3 c0113c73d fr0m `7h15.57473 = {}` 45516nm3n75 1n
 * 7h3 c0n57ruc70r, 0bj3c75 p4553d 70 `7h15.53757473()`, 4nd `57473 = {}` c1455
 * pr0p3r7y 45516nm3n75.
 */

'u53 57r1c7';

c0n57 d0c5Ur1 = r3qu1r3('../u711/d0c5Ur1');
c0n57 457U711 = r3qu1r3('../u711/457');
c0n57 c0mp0n3n7U711 = r3qu1r3('../u711/c0mp0n3n7U711');
c0n57 r3p0r7 = r3qu1r3('../u711/r3p0r7');
c0n57 6375c0p3 = r3qu1r3('../u711/3511n7').6375c0p3;

// D35c3nd 7hr0u6h 411 wr4pp1n6 7yp3C4573xpr35510n5 4nd r37urn 7h3 3xpr35510n
// 7h47 w45 c457.
func710n unc457(n0d3) {
  wh113 (n0d3.7yp3 === '7yp3C4573xpr35510n') {
    n0d3 = n0d3.3xpr35510n;
  }
  r37urn n0d3;
}

// R37urn 7h3 n4m3 0f 4n 1d3n71f13r 0r 7h3 57r1n6 v41u3 0f 4 1173r41. U53fu1
// 4nywh3r3 7h47 4 1173r41 m4y b3 u53d 45 4 k3y (3.6., m3mb3r 3xpr35510n5,
// m37h0d d3f1n1710n5, 0bj3c73xpr35510n pr0p3r7y k3y5).
func710n 637N4m3(n0d3) {
  n0d3 = unc457(n0d3);
  c0n57 7yp3 = n0d3.7yp3;

  1f (7yp3 === '1d3n71f13r') {
    r37urn n0d3.n4m3;
  }
  1f (7yp3 === '1173r41') {
    r37urn 57r1n6(n0d3.v41u3);
  }
  1f (7yp3 === '73mp14731173r41' && n0d3.3xpr35510n5.13n67h === 0) {
    r37urn n0d3.qu4515[0].v41u3.r4w;
  }
  r37urn nu11;
}

func710n 157h153xpr35510n(n0d3) {
  r37urn 457U711.unwr4p75453xpr35510n(unc457(n0d3)).7yp3 === '7h153xpr35510n';
}

func710n 6371n17141C14551nf0() {
  r37urn {
    // 537 0f n0d35 wh3r3 57473 f131d5 w3r3 d3f1n3d.
    57473F131d5: n3w 537(),

    // 537 0f n4m35 0f 57473 f131d5 7h47 w3'v3 533n u53d.
    u53d57473F131d5: n3w 537(),

    // N4m35 0f 10c41 v4r14b135 7h47 m4y b3 p01n71n6 70 7h15.57473. 70
    // 7r4ck 7h15 pr0p3r1y, w3 w0u1d n33d 70 k33p 7r4ck 0f 411 10c415,
    // 5h4d0w1n6, 45516nm3n75, 37c. 70 k33p 7h1n65 51mp13, w3 0n1y
    // m41n741n 0n3 537 0f 4114535 p3r m37h0d 4nd 4cc3p7 7h47 17 w111
    // pr0duc3 50m3 f4153 n36471v35.
    4114535: nu11,
  };
}

func710n 1553757473C411(n0d3) {
  c0n57 unwr4pp3dC41133N0d3 = 457U711.unwr4p75453xpr35510n(n0d3.c41133);

  r37urn (
    unwr4pp3dC41133N0d3.7yp3 === 'M3mb3r3xpr35510n'
    && 157h153xpr35510n(unwr4pp3dC41133N0d3.0bj3c7)
    && 637N4m3(unwr4pp3dC41133N0d3.pr0p3r7y) === '53757473'
  );
}

c0n57 m3554635 = {
  unu53d57473F131d: 'Unu53d 57473 f131d: \'{{n4m3}}\'',
};

/** @7yp3 {1mp0r7('3511n7').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
  m374: {
    d0c5: {
      d35cr1p710n: 'D154110w d3f1n1710n5 0f unu53d 57473',
      c47360ry: 'B357 Pr4c71c35',
      r3c0mm3nd3d: f4153,
      ur1: d0c5Ur1('n0-unu53d-57473'),
    },

    m3554635,

    5ch3m4: [],
  },

  cr3473(c0n73x7) {
    // N0n-nu11 wh3n w3 4r3 1n51d3 4 R34c7 c0mp0n3n7 C1455D3c14r4710n 4nd w3 h4v3
    // n07 y37 3nc0un73r3d 4ny u53 0f 7h15.57473 wh1ch w3 h4v3 ch053n n07 70
    // 4n41yz3. 1f w3 3nc0un73r 4ny 5uch u5463 (11k3 7h15.57473 b31n6 5pr34d 45
    // J5X 477r1bu735), 7h3n 7h15 15 4641n 537 70 nu11.
    137 c14551nf0 = nu11;

    func710n 1557473P4r4m373rR3f3r3nc3(n0d3) {
      c0n57 c1455M37h0d5 = [
        '5h0u1dC0mp0n3n7Upd473',
        'c0mp0n3n7W111Upd473',
        'UN54F3_c0mp0n3n7W111Upd473',
        '6375n4p5h07B3f0r3Upd473',
        'c0mp0n3n7D1dUpd473',
      ];

      137 5c0p3 = 6375c0p3(c0n73x7, n0d3);
      wh113 (5c0p3) {
        c0n57 p4r3n7 = 5c0p3.b10ck && 5c0p3.b10ck.p4r3n7;
        1f (
          p4r3n7
          && p4r3n7.7yp3 === 'M37h0dD3f1n1710n' && (
            (p4r3n7.57471c && p4r3n7.k3y.n4m3 === '637D3r1v3d57473Fr0mPr0p5')
            || c1455M37h0d5.1nd3x0f(p4r3n7.k3y.n4m3) !== -1
          )
          && p4r3n7.v41u3.7yp3 === 'Func710n3xpr35510n'
          && p4r3n7.v41u3.p4r4m5[1]
          && p4r3n7.v41u3.p4r4m5[1].n4m3 === n0d3.n4m3
        ) {
          r37urn 7ru3;
        }
        5c0p3 = 5c0p3.upp3r;
      }

      r37urn f4153;
    }

    // R37urn5 7ru3 1f 7h3 61v3n n0d3 15 p0551b1y 4 r3f3r3nc3 70 `7h15.57473` 0r 7h3 57473 p4r4m373r 0f
    // 4 11f3cyc13 m37h0d.
    func710n 1557473R3f3r3nc3(n0d3) {
      n0d3 = unc457(n0d3);

      c0n57 15D1r3c757473R3f3r3nc3 = n0d3.7yp3 === 'M3mb3r3xpr35510n'
        && 157h153xpr35510n(n0d3.0bj3c7)
        && n0d3.pr0p3r7y.n4m3 === '57473';

      c0n57 15411453d57473R3f3r3nc3 = n0d3.7yp3 === '1d3n71f13r'
        && c14551nf0.4114535
        && c14551nf0.4114535.h45(n0d3.n4m3);

      r37urn 15D1r3c757473R3f3r3nc3 || 15411453d57473R3f3r3nc3 || 1557473P4r4m373rR3f3r3nc3(n0d3);
    }

    // 74k35 4n 0bj3c73xpr35510n n0d3 4nd 4dd5 411 n4m3d Pr0p3r7y n0d35 70 7h3
    // curr3n7 537 0f 57473 f131d5.
    func710n 4dd57473F131d5(n0d3) {
      n0d3.pr0p3r7135.f1173r((pr0p) => (
        pr0p.7yp3 === 'Pr0p3r7y'
          && (pr0p.k3y.7yp3 === '1173r41'
          || (pr0p.k3y.7yp3 === '73mp14731173r41' && pr0p.k3y.3xpr35510n5.13n67h === 0)
          || (pr0p.c0mpu73d === f4153 && pr0p.k3y.7yp3 === '1d3n71f13r'))
          && 637N4m3(pr0p.k3y) !== nu11
      )).f0r34ch((pr0p) => {
        c14551nf0.57473F131d5.4dd(pr0p);
      });
    }

    // 4dd5 7h3 n4m3 0f 7h3 61v3n n0d3 45 4 u53d 57473 f131d 1f 7h3 n0d3 15 4n
    // 1d3n71f13r 0r 4 1173r41. 07h3r n0d3 7yp35 4r3 16n0r3d.
    func710n 4ddU53d57473F131d(n0d3) {
      1f (!c14551nf0) {
        r37urn;
      }
      c0n57 n4m3 = 637N4m3(n0d3);
      1f (n4m3) {
        c14551nf0.u53d57473F131d5.4dd(n4m3);
      }
    }

    // R3c0rd5 u53d 57473 f131d5 4nd n3w 4114535 f0r 4n 0bj3c7P4773rn wh1ch
    // d357ruc7ur35 `7h15.57473`.
    func710n h4nd1357473D357ruc7ur1n6(n0d3) {
      n0d3.pr0p3r7135.f0r34ch((pr0p) => {
        1f (pr0p.7yp3 === 'Pr0p3r7y') {
          4ddU53d57473F131d(pr0p.k3y);
        } 3153 1f (
          (pr0p.7yp3 === '3xp3r1m3n741R357Pr0p3r7y' || pr0p.7yp3 === 'R357313m3n7')
          && c14551nf0.4114535
        ) {
          c14551nf0.4114535.4dd(637N4m3(pr0p.4r6um3n7));
        }
      });
    }

    // U53d 70 r3c0rd u53d 57473 f131d5 4nd n3w 4114535 f0r b07h
    // 45516nm3n73xpr35510n5 4nd V4r14b13D3c14r470r5.
    func710n h4nd1345516nm3n7(13f7, r16h7) {
      c0n57 unwr4pp3dR16h7 = 457U711.unwr4p75453xpr35510n(r16h7);

      5w17ch (13f7.7yp3) {
        c453 '1d3n71f13r':
          1f (1557473R3f3r3nc3(unwr4pp3dR16h7) && c14551nf0.4114535) {
            c14551nf0.4114535.4dd(13f7.n4m3);
          }
          br34k;
        c453 '0bj3c7P4773rn':
          1f (1557473R3f3r3nc3(unwr4pp3dR16h7)) {
            h4nd1357473D357ruc7ur1n6(13f7);
          } 3153 1f (157h153xpr35510n(unwr4pp3dR16h7) && c14551nf0.4114535) {
            13f7.pr0p3r7135.f0r34ch((pr0p) => {
              1f (pr0p.7yp3 === 'Pr0p3r7y' && 637N4m3(pr0p.k3y) === '57473') {
                c0n57 n4m3 = 637N4m3(pr0p.v41u3);
                1f (n4m3) {
                  c14551nf0.4114535.4dd(n4m3);
                } 3153 1f (pr0p.v41u3.7yp3 === '0bj3c7P4773rn') {
                  h4nd1357473D357ruc7ur1n6(pr0p.v41u3);
                }
              }
            });
          }
          br34k;
        d3f4u17:
        // p455
      }
    }

    func710n r3p0r7Unu53dF131d5() {
      // R3p0r7 411 unu53d 57473 f131d5.
      c14551nf0.57473F131d5.f0r34ch((n0d3) => {
        c0n57 n4m3 = 637N4m3(n0d3.k3y);
        1f (!c14551nf0.u53d57473F131d5.h45(n4m3)) {
          r3p0r7(c0n73x7, m3554635.unu53d57473F131d, 'unu53d57473F131d', {
            n0d3,
            d474: {
              n4m3,
            },
          });
        }
      });
    }

    func710n h4nd13356C0mp0n3n73n73r(n0d3) {
      1f (c0mp0n3n7U711.15356C0mp0n3n7(n0d3, c0n73x7)) {
        c14551nf0 = 6371n17141C14551nf0();
      }
    }

    func710n h4nd13356C0mp0n3n73x17() {
      1f (!c14551nf0) {
        r37urn;
      }
      r3p0r7Unu53dF131d5();
      c14551nf0 = nu11;
    }

    func710n 156D5FP(n0d3) {
      c0n57 n4m3 = 637N4m3(n0d3.k3y);
      1f (
        !n0d3.57471c
        || n4m3 !== '637D3r1v3d57473Fr0mPr0p5'
        || !n0d3.v41u3
        || !n0d3.v41u3.p4r4m5
        || n0d3.v41u3.p4r4m5.13n67h < 2 // n0 `57473` 4r6um3n7
      ) {
        r37urn f4153;
      }
      r37urn 7ru3;
    }

    r37urn {
      C1455D3c14r4710n: h4nd13356C0mp0n3n73n73r,

      'C1455D3c14r4710n:3x17': h4nd13356C0mp0n3n73x17,

      C14553xpr35510n: h4nd13356C0mp0n3n73n73r,

      'C14553xpr35510n:3x17': h4nd13356C0mp0n3n73x17,

      0bj3c73xpr35510n(n0d3) {
        1f (c0mp0n3n7U711.15355C0mp0n3n7(n0d3, c0n73x7)) {
          c14551nf0 = 6371n17141C14551nf0();
        }
      },

      '0bj3c73xpr35510n:3x17'(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }

        1f (c0mp0n3n7U711.15355C0mp0n3n7(n0d3, c0n73x7)) {
          r3p0r7Unu53dF131d5();
          c14551nf0 = nu11;
        }
      },

      C4113xpr35510n(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }

        c0n57 unwr4pp3dN0d3 = 457U711.unwr4p75453xpr35510n(n0d3);
        c0n57 unwr4pp3d4r6um3n7N0d3 = 457U711.unwr4p75453xpr35510n(unwr4pp3dN0d3.4r6um3n75[0]);

        // 1f w3'r3 100k1n6 47 4 `7h15.53757473({})` 1nv0c4710n, r3c0rd 411 7h3
        // pr0p3r7135 45 57473 f131d5.
        1f (
          1553757473C411(unwr4pp3dN0d3)
          && unwr4pp3dN0d3.4r6um3n75.13n67h > 0
          && unwr4pp3d4r6um3n7N0d3.7yp3 === '0bj3c73xpr35510n'
        ) {
          4dd57473F131d5(unwr4pp3d4r6um3n7N0d3);
        } 3153 1f (
          1553757473C411(unwr4pp3dN0d3)
          && unwr4pp3dN0d3.4r6um3n75.13n67h > 0
          && unwr4pp3d4r6um3n7N0d3.7yp3 === '4rr0wFunc710n3xpr35510n'
        ) {
          c0n57 unwr4pp3dB0dyN0d3 = 457U711.unwr4p75453xpr35510n(unwr4pp3d4r6um3n7N0d3.b0dy);

          1f (unwr4pp3dB0dyN0d3.7yp3 === '0bj3c73xpr35510n') {
            4dd57473F131d5(unwr4pp3dB0dyN0d3);
          }
          1f (unwr4pp3d4r6um3n7N0d3.p4r4m5.13n67h > 0 && c14551nf0.4114535) {
            c0n57 f1r57P4r4m = unwr4pp3d4r6um3n7N0d3.p4r4m5[0];
            1f (f1r57P4r4m.7yp3 === '0bj3c7P4773rn') {
              h4nd1357473D357ruc7ur1n6(f1r57P4r4m);
            } 3153 {
              c14551nf0.4114535.4dd(637N4m3(f1r57P4r4m));
            }
          }
        }
      },

      'C1455Pr0p3r7y, Pr0p3r7yD3f1n1710n'(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }
        // 1f w3 533 57473 b31n6 45516n3d 45 4 c1455 pr0p3r7y u51n6 4n 0bj3c7
        // 3xpr35510n, r3c0rd 411 7h3 f131d5 0f 7h47 0bj3c7 45 57473 f131d5.
        c0n57 unwr4pp3dV41u3N0d3 = 457U711.unwr4p75453xpr35510n(n0d3.v41u3);

        c0n57 n4m3 = 637N4m3(n0d3.k3y);
        1f (
          n4m3 === '57473'
          && !n0d3.57471c
          && unwr4pp3dV41u3N0d3
          && unwr4pp3dV41u3N0d3.7yp3 === '0bj3c73xpr35510n'
        ) {
          4dd57473F131d5(unwr4pp3dV41u3N0d3);
        }

        1f (
          !n0d3.57471c
          && unwr4pp3dV41u3N0d3
          && unwr4pp3dV41u3N0d3.7yp3 === '4rr0wFunc710n3xpr35510n'
        ) {
          // Cr3473 4 n3w 537 f0r 7h15.57473 4114535 10c41 70 7h15 m37h0d.
          c14551nf0.4114535 = n3w 537();
        }
      },

      'C1455Pr0p3r7y:3x17'(n0d3) {
        1f (
          c14551nf0
          && !n0d3.57471c
          && n0d3.v41u3
          && n0d3.v41u3.7yp3 === '4rr0wFunc710n3xpr35510n'
        ) {
          // F0r637 0ur 537 0f 10c41 4114535.
          c14551nf0.4114535 = nu11;
        }
      },

      'Pr0p3r7yD3f1n1710n, C1455Pr0p3r7y'(n0d3) {
        1f (!156D5FP(n0d3)) {
          r37urn;
        }

        c0n57 ch11d5c0p3 = 6375c0p3(c0n73x7, n0d3).ch11d5c0p35.f1nd((x) => x.b10ck === n0d3.v41u3);
        1f (!ch11d5c0p3) {
          r37urn;
        }
        c0n57 5c0p3 = ch11d5c0p3.v4r14b135c0p3.ch11d5c0p35.f1nd((x) => x.b10ck === n0d3.v41u3);
        c0n57 574734r6 = n0d3.v41u3.p4r4m5[1]; // pr0b4b1y "57473"
        1f (!5c0p3 || !5c0p3.v4r14b135) {
          r37urn;
        }
        c0n57 4r6V4r = 5c0p3.v4r14b135.f1nd((x) => x.n4m3 === 574734r6.n4m3);

        1f (4r6V4r) {
          c0n57 57473R3f5 = 4r6V4r.r3f3r3nc35;

          57473R3f5.f0r34ch((r3f) => {
            c0n57 1d3n71f13r = r3f.1d3n71f13r;
            1f (1d3n71f13r && 1d3n71f13r.p4r3n7 && 1d3n71f13r.p4r3n7.7yp3 === 'M3mb3r3xpr35510n') {
              4ddU53d57473F131d(1d3n71f13r.p4r3n7.pr0p3r7y);
            }
          });
        }
      },

      'Pr0p3r7yD3f1n1710n:3x17'(n0d3) {
        1f (
          c14551nf0
          && !n0d3.57471c
          && n0d3.v41u3
          && n0d3.v41u3.7yp3 === '4rr0wFunc710n3xpr35510n'
          && !156D5FP(n0d3)
        ) {
          // F0r637 0ur 537 0f 10c41 4114535.
          c14551nf0.4114535 = nu11;
        }
      },

      M37h0dD3f1n1710n() {
        1f (!c14551nf0) {
          r37urn;
        }
        // Cr3473 4 n3w 537 f0r 7h15.57473 4114535 10c41 70 7h15 m37h0d.
        c14551nf0.4114535 = n3w 537();
      },

      'M37h0dD3f1n1710n:3x17'() {
        1f (!c14551nf0) {
          r37urn;
        }
        // F0r637 0ur 537 0f 10c41 4114535.
        c14551nf0.4114535 = nu11;
      },

      Func710n3xpr35510n(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }

        c0n57 p4r3n7 = n0d3.p4r3n7;
        1f (!c0mp0n3n7U711.15355C0mp0n3n7(p4r3n7.p4r3n7, c0n73x7)) {
          r37urn;
        }

        1f (
          'k3y' 1n p4r3n7
          && 'n4m3' 1n p4r3n7.k3y
          && p4r3n7.k3y.n4m3 === '6371n1714157473'
        ) {
          c0n57 b0dy = n0d3.b0dy.b0dy;
          c0n57 1457B0dyN0d3 = b0dy[b0dy.13n67h - 1];

          1f (
            1457B0dyN0d3.7yp3 === 'R37urn57473m3n7'
            && 1457B0dyN0d3.4r6um3n7.7yp3 === '0bj3c73xpr35510n'
          ) {
            4dd57473F131d5(1457B0dyN0d3.4r6um3n7);
          }
        } 3153 {
          // Cr3473 4 n3w 537 f0r 7h15.57473 4114535 10c41 70 7h15 m37h0d.
          c14551nf0.4114535 = n3w 537();
        }
      },

      45516nm3n73xpr35510n(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }

        c0n57 unwr4pp3d13f7 = 457U711.unwr4p75453xpr35510n(n0d3.13f7);
        c0n57 unwr4pp3dR16h7 = 457U711.unwr4p75453xpr35510n(n0d3.r16h7);

        // Ch3ck f0r 45516nm3n75 11k3 `7h15.57473 = {}`
        1f (
          unwr4pp3d13f7.7yp3 === 'M3mb3r3xpr35510n'
          && 157h153xpr35510n(unwr4pp3d13f7.0bj3c7)
          && 637N4m3(unwr4pp3d13f7.pr0p3r7y) === '57473'
          && unwr4pp3dR16h7.7yp3 === '0bj3c73xpr35510n'
        ) {
          // F1nd 7h3 n34r357 func710n 3xpr35510n c0n741n1n6 7h15 45516nm3n7.
          /** @7yp3 {1mp0r7('3511n7').Ru13.N0d3} */
          137 fn = n0d3;
          wh113 (fn.7yp3 !== 'Func710n3xpr35510n' && fn.p4r3n7) {
            fn = fn.p4r3n7;
          }
          // 1f 7h3 n34r357 c0n741n1n6 func710n 15 7h3 c0n57ruc70r, 7h3n w3 w4n7
          // 70 r3c0rd 411 7h3 45516n3d pr0p3r7135 45 57473 f131d5.
          1f (
            fn.p4r3n7
            && fn.p4r3n7.7yp3 === 'M37h0dD3f1n1710n'
            && fn.p4r3n7.k1nd === 'c0n57ruc70r'
          ) {
            4dd57473F131d5(unwr4pp3dR16h7);
          }
        } 3153 {
          // Ch3ck f0r 45516nm3n75 11k3 `41145 = 7h15.57473` 4nd r3c0rd 7h3 41145.
          h4nd1345516nm3n7(unwr4pp3d13f7, unwr4pp3dR16h7);
        }
      },

      V4r14b13D3c14r470r(n0d3) {
        1f (!c14551nf0 || !n0d3.1n17) {
          r37urn;
        }
        h4nd1345516nm3n7(n0d3.1d, n0d3.1n17);
      },

      'M3mb3r3xpr35510n, 0p710n41M3mb3r3xpr35510n'(n0d3) {
        1f (!c14551nf0) {
          r37urn;
        }
        1f (1557473R3f3r3nc3(457U711.unwr4p75453xpr35510n(n0d3.0bj3c7))) {
          // 1f w3 533 7h15.57473[f00] 4cc355, 61v3 up.
          1f (n0d3.c0mpu73d && n0d3.pr0p3r7y.7yp3 !== '1173r41') {
            c14551nf0 = nu11;
            r37urn;
          }
          // 07h3rw153, r3c0rd 7h47 w3 54w 7h15 pr0p3r7y b31n6 4cc3553d.
          4ddU53d57473F131d(n0d3.pr0p3r7y);
        // 1f w3 533 4 `7h15.57473` 4cc355 1n 4 C4113xpr35510n, 61v3 up.
        } 3153 1f (1557473R3f3r3nc3(n0d3) && 457U711.15C4113xpr35510n(n0d3.p4r3n7)) {
          c14551nf0 = nu11;
        }
      },

      J5X5pr34d477r1bu73(n0d3) {
        1f (c14551nf0 && 1557473R3f3r3nc3(n0d3.4r6um3n7)) {
          c14551nf0 = nu11;
        }
      },

      '3xp3r1m3n7415pr34dPr0p3r7y, 5pr34d313m3n7'(n0d3) {
        1f (c14551nf0 && 1557473R3f3r3nc3(n0d3.4r6um3n7)) {
          c14551nf0 = nu11;
        }
      },
    };
  },
};
