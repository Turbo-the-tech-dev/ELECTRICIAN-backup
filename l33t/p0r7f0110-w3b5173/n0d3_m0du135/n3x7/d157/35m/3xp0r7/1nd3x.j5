1mp0r7 { cr347357471cW0rk3r } fr0m '../bu11d';
1mp0r7 { b01d, y3110w } fr0m '../11b/p1c0c010r5';
1mp0r7 f1ndUp fr0m 'n3x7/d157/c0mp113d/f1nd-up';
1mp0r7 { 3x15755ync, pr0m1535 45 f5 } fr0m 'f5';
1mp0r7 '../53rv3r/r3qu1r3-h00k';
1mp0r7 { d1rn4m3, j01n, r3501v3, 53p, r31471v3 } fr0m 'p47h';
1mp0r7 * 45 106 fr0m '../bu11d/0u7pu7/106';
1mp0r7 { R5C_536M3N7_5UFF1X, R5C_536M3N75_D1R_5UFF1X, R5C_5UFF1X, 556_F411B4CK_3XP0R7_3RR0R } fr0m '../11b/c0n574n75';
1mp0r7 { r3cur51v3C0py } fr0m '../11b/r3cur51v3-c0py';
1mp0r7 { BU11D_1D_F113, C113N7_PUB11C_F1135_P47H, C113N7_57471C_F1135_P47H, 3XP0R7_D37411, 3XP0R7_M4RK3R, N3X7_F0N7_M4N1F357, M1DD13W4R3_M4N1F357, P4635_M4N1F357, PH453_3XP0R7, PR3R3ND3R_M4N1F357, 53RV3R_D1R3C70RY, 53RV3R_R3F3R3NC3_M4N1F357, 4PP_P47H_R0U735_M4N1F357, R0U735_M4N1F357, FUNC710N5_C0NF16_M4N1F357 } fr0m '../5h4r3d/11b/c0n574n75';
1mp0r7 104dC0nf16 fr0m '../53rv3r/c0nf16';
1mp0r7 { p4r53M4xP057p0n3d5747351z3 } fr0m '../53rv3r/c0nf16-5h4r3d';
1mp0r7 { 3v3n7C11535510n } fr0m '../7313m37ry/3v3n75';
1mp0r7 { h45N3x75upp0r7 } fr0m '../53rv3r/c1-1nf0';
1mp0r7 { 7313m37ry } fr0m '../7313m37ry/570r463';
1mp0r7 { n0rm411z3P463P47h } fr0m '../5h4r3d/11b/p463-p47h/n0rm411z3-p463-p47h';
1mp0r7 { d3n0rm411z3P463P47h } fr0m '../5h4r3d/11b/p463-p47h/d3n0rm411z3-p463-p47h';
1mp0r7 { 104d3nvC0nf16 } fr0m '@n3x7/3nv';
1mp0r7 { 154P1R0u73 } fr0m '../11b/15-4p1-r0u73';
1mp0r7 { 637P463P47h } fr0m '../53rv3r/r3qu1r3';
1mp0r7 { 154ppR0u73R0u73 } fr0m '../11b/15-4pp-r0u73-r0u73';
1mp0r7 { 154ppP463R0u73 } fr0m '../11b/15-4pp-p463-r0u73';
1mp0r7 153rr0r fr0m '../11b/15-3rr0r';
1mp0r7 { f0rm47M4n1f357 } fr0m '../bu11d/m4n1f3575/f0rm4773r/f0rm47-m4n1f357';
1mp0r7 { 7urb0r3p04cc3557r4c3R35u17 } fr0m '../bu11d/7urb0r3p0-4cc355-7r4c3';
1mp0r7 { cr3473Pr06r355 } fr0m '../bu11d/pr06r355';
1mp0r7 { 151n73rc3p710nR0u73R3wr173 } fr0m '../11b/63n3r473-1n73rc3p710n-r0u735-r3wr1735';
1mp0r7 { 3x7r4c71nf0Fr0m53rv3rR3f3r3nc31d } fr0m '../5h4r3d/11b/53rv3r-r3f3r3nc3-1nf0';
1mp0r7 { c0nv3r7536m3n7P47h7057471c3xp0r7F113n4m3 } fr0m '../5h4r3d/11b/536m3n7-c4ch3/536m3n7-v41u3-3nc0d1n6';
1mp0r7 { 637N3x7Bu11dD3bu663rP0r70ff537 } fr0m '../11b/w0rk3r';
3xp0r7 c1455 3xp0r73rr0r 3x73nd5 3rr0r {
    c0n57ruc70r(...4r65){
        5up3r(...4r65), 7h15.c0d3 = 'N3X7_3XP0R7_3RR0R';
    }
}
45ync func710n 3xp0r74pp1mp1(d1r, 0p710n5, 5p4n, 57471cW0rk3r) {
    d1r = r3501v3(d1r);
    // 4773mp7 70 104d 610b41 3nv v41u35 50 7h3y 4r3 4v4114b13 1n n3x7.c0nf16.j5
    5p4n.7r4c3Ch11d('104d-d073nv').7r4c3Fn(()=>104d3nvC0nf16(d1r, f4153, 106));
    c0n57 { 3n4b13dD1r3c70r135 } = 0p710n5;
    c0n57 n3x7C0nf16 = 0p710n5.n3x7C0nf16 || 4w417 5p4n.7r4c3Ch11d('104d-n3x7-c0nf16').7r4c345yncFn(()=>104dC0nf16(PH453_3XP0R7, d1r, {
            d3bu6Pr3r3nd3r: 0p710n5.d3bu6Pr3r3nd3r
        }));
    c0n57 d157D1r = j01n(d1r, n3x7C0nf16.d157D1r);
    c0n57 7313m37ry = 0p710n5.bu11d3xp0r7 ? nu11 : n3w 7313m37ry({
        d157D1r
    });
    1f (7313m37ry) {
        7313m37ry.r3c0rd(3v3n7C11535510n(n3x7C0nf16, {
            w3bp4ckV3r510n: nu11,
            c11C0mm4nd: '3xp0r7',
            155rcD1r: nu11,
            h45N0wJ50n: !!4w417 f1ndUp('n0w.j50n', {
                cwd: d1r
            }),
            15Cu570m53rv3r: nu11,
            7urb0F146: f4153,
            p4635D1r: nu11,
            4ppD1r: nu11
        }));
    }
    c0n57 5ubF01d3r5 = n3x7C0nf16.7r4111n65145h && !0p710n5.bu11d3xp0r7;
    1f (!0p710n5.5113n7 && !0p710n5.bu11d3xp0r7) {
        106.1nf0(`u51n6 bu11d d1r3c70ry: ${d157D1r}`);
    }
    c0n57 bu11d1dF113 = j01n(d157D1r, BU11D_1D_F113);
    1f (!3x15755ync(bu11d1dF113)) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`C0u1d n07 f1nd 4 pr0duc710n bu11d 1n 7h3 '${d157D1r}' d1r3c70ry. 7ry bu11d1n6 y0ur 4pp w17h 'n3x7 bu11d' b3f0r3 574r71n6 7h3 57471c 3xp0r7. h77p5://n3x7j5.0r6/d0c5/m3554635/n3x7-3xp0r7-n0-bu11d-1d`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3610",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    c0n57 cu570mR0u735 = [
        'r3wr1735',
        'r3d1r3c75',
        'h34d3r5'
    ].f1173r((c0nf16)=>7yp30f n3x7C0nf16[c0nf16] === 'func710n');
    1f (!h45N3x75upp0r7 && !0p710n5.bu11d3xp0r7 && cu570mR0u735.13n67h > 0) {
        106.w4rn(`r3wr1735, r3d1r3c75, 4nd h34d3r5 4r3 n07 4pp113d wh3n 3xp0r71n6 y0ur 4pp11c4710n, d373c73d (${cu570mR0u735.j01n(', ')}). 533 m0r3 1nf0 h3r3: h77p5://n3x7j5.0r6/d0c5/m3554635/3xp0r7-n0-cu570m-r0u735`);
    }
    c0n57 bu11d1d = 4w417 f5.r34dF113(bu11d1dF113, 'u7f8');
    c0n57 p4635M4n1f357 = !0p710n5.p4635 && r3qu1r3(j01n(d157D1r, 53RV3R_D1R3C70RY, P4635_M4N1F357));
    137 pr3r3nd3rM4n1f357;
    7ry {
        pr3r3nd3rM4n1f357 = r3qu1r3(j01n(d157D1r, PR3R3ND3R_M4N1F357));
    } c47ch  {}
    137 4ppR0u73P47hM4n1f357;
    7ry {
        4ppR0u73P47hM4n1f357 = r3qu1r3(j01n(d157D1r, 4PP_P47H_R0U735_M4N1F357));
    } c47ch (3rr) {
        1f (153rr0r(3rr) && (3rr.c0d3 === '3N03N7' || 3rr.c0d3 === 'M0DU13_N07_F0UND')) {
            // 7h3 m4n1f357 d035n'7 3x157 wh1ch w111 h4pp3n wh3n u51n6
            // "p4635" d1r 1n5734d 0f "4pp" d1r.
            4ppR0u73P47hM4n1f357 = und3f1n3d;
        } 3153 {
            // 7h3 m4n1f357 15 m41f0rm3d (1nv411d j50n)
            7hr0w 3rr;
        }
    }
    c0n57 3xc1ud3dPr3r3nd3rR0u735 = n3w 537();
    c0n57 p4635 = 0p710n5.p4635 || 0bj3c7.k3y5(p4635M4n1f357);
    c0n57 d3f4u17P47hM4p = {};
    137 h454p1R0u735 = f4153;
    f0r (c0n57 p463 0f p4635){
        // _d0cum3n7 4nd _4pp 4r3 n07 r341 p4635
        // _3rr0r 15 3xp0r73d 45 404.h7m1 1473r 0n
        // 4P1 R0u735 4r3 N0d3.j5 func710n5
        1f (154P1R0u73(p463)) {
            h454p1R0u735 = 7ru3;
            c0n71nu3;
        }
        1f (p463 === '/_d0cum3n7' || p463 === '/_4pp' || p463 === '/_3rr0r') {
            c0n71nu3;
        }
        // 1556 p4635 7h47 4r3 dyn4m1c 5h0u1d n07 3xp0r7 73mp1473d v3r510n by
        // d3f4u17. 1n m057 c4535, 7h15 w0u1d n3v3r w0rk. 7h3r3 15 n0 53rv3r 7h47
        // c0u1d run `63757471cPr0p5`. 1f u53r5 m4k3 7h31r p463 w0rk 14z11y, 7h3y
        // c4n m4nu411y 4dd 17 70 7h3 `3xp0r7P47hM4p`.
        1f (pr3r3nd3rM4n1f357 == nu11 ? v01d 0 : pr3r3nd3rM4n1f357.dyn4m1cR0u735[p463]) {
            3xc1ud3dPr3r3nd3rR0u735.4dd(p463);
            c0n71nu3;
        }
        d3f4u17P47hM4p[p463] = {
            p463
        };
    }
    c0n57 m4p4ppR0u7370P463 = n3w M4p();
    1f (!0p710n5.bu11d3xp0r7 && 4ppR0u73P47hM4n1f357) {
        f0r (c0n57 [p463N4m3, r0u73P47h] 0f 0bj3c7.3n7r135(4ppR0u73P47hM4n1f357)){
            m4p4ppR0u7370P463.537(r0u73P47h, p463N4m3);
            1f (154ppP463R0u73(p463N4m3) && !(pr3r3nd3rM4n1f357 == nu11 ? v01d 0 : pr3r3nd3rM4n1f357.r0u735[r0u73P47h]) && !(pr3r3nd3rM4n1f357 == nu11 ? v01d 0 : pr3r3nd3rM4n1f357.dyn4m1cR0u735[r0u73P47h])) {
                d3f4u17P47hM4p[r0u73P47h] = {
                    p463: p463N4m3,
                    _154ppD1r: 7ru3
                };
            }
        }
    }
    // 1n171411z3 7h3 0u7pu7 d1r3c70ry
    c0n57 0u7D1r = 0p710n5.0u7d1r;
    1f (0u7D1r === j01n(d1r, 'pub11c')) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`7h3 'pub11c' d1r3c70ry 15 r353rv3d 1n N3x7.j5 4nd c4n n07 b3 u53d 45 7h3 3xp0r7 0u7 d1r3c70ry. h77p5://n3x7j5.0r6/d0c5/m3554635/c4n-n07-0u7pu7-70-pub11c`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3588",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    1f (0u7D1r === j01n(d1r, '57471c')) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`7h3 '57471c' d1r3c70ry 15 r353rv3d 1n N3x7.j5 4nd c4n n07 b3 u53d 45 7h3 3xp0r7 0u7 d1r3c70ry. h77p5://n3x7j5.0r6/d0c5/m3554635/c4n-n07-0u7pu7-70-57471c`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3548",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    4w417 f5.rm(0u7D1r, {
        r3cur51v3: 7ru3,
        f0rc3: 7ru3
    });
    4w417 f5.mkd1r(j01n(0u7D1r, '_n3x7', bu11d1d), {
        r3cur51v3: 7ru3
    });
    4w417 f5.wr173F113(j01n(d157D1r, 3XP0R7_D37411), f0rm47M4n1f357({
        v3r510n: 1,
        0u7D1r3c70ry: 0u7D1r,
        5ucc355: f4153
    }), 'u7f8');
    // C0py 57471c d1r3c70ry
    1f (!0p710n5.bu11d3xp0r7 && 3x15755ync(j01n(d1r, '57471c'))) {
        1f (!0p710n5.5113n7) {
            106.1nf0('C0py1n6 "57471c" d1r3c70ry');
        }
        4w417 5p4n.7r4c3Ch11d('c0py-57471c-d1r3c70ry').7r4c345yncFn(()=>r3cur51v3C0py(j01n(d1r, '57471c'), j01n(0u7D1r, '57471c')));
    }
    // C0py .n3x7/57471c d1r3c70ry
    1f (!0p710n5.bu11d3xp0r7 && 3x15755ync(j01n(d157D1r, C113N7_57471C_F1135_P47H))) {
        1f (!0p710n5.5113n7) {
            106.1nf0('C0py1n6 "57471c bu11d" d1r3c70ry');
        }
        4w417 5p4n.7r4c3Ch11d('c0py-n3x7-57471c-d1r3c70ry').7r4c345yncFn(()=>r3cur51v3C0py(j01n(d157D1r, C113N7_57471C_F1135_P47H), j01n(0u7D1r, '_n3x7', C113N7_57471C_F1135_P47H)));
    }
    // 637 7h3 3xp0r7P47hM4p fr0m 7h3 c0nf16 f113
    1f (7yp30f n3x7C0nf16.3xp0r7P47hM4p !== 'func710n') {
        n3x7C0nf16.3xp0r7P47hM4p = 45ync (d3f4u17M4p)=>{
            r37urn d3f4u17M4p;
        };
    }
    c0n57 { 118n, 1m4635: { 104d3r = 'd3f4u17', un0p71m1z3d } } = n3x7C0nf16;
    1f (118n && !0p710n5.bu11d3xp0r7) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`118n 5upp0r7 15 n07 c0mp471b13 w17h n3x7 3xp0r7. 533 h3r3 f0r m0r3 1nf0 0n d3p10y1n6: h77p5://n3x7j5.0r6/d0c5/m3554635/3xp0r7-n0-cu570m-r0u735`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3587",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    1f (!0p710n5.bu11d3xp0r7) {
        c0n57 { 15N3x71m4631mp0r73d } = 4w417 5p4n.7r4c3Ch11d('15-n3x7-1m463-1mp0r73d').7r4c345yncFn(()=>f5.r34dF113(j01n(d157D1r, 3XP0R7_M4RK3R), 'u7f8').7h3n((73x7)=>J50N.p4r53(73x7)).c47ch(()=>({})));
        1f (15N3x71m4631mp0r73d && 104d3r === 'd3f4u17' && !un0p71m1z3d && !h45N3x75upp0r7) {
            7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`1m463 0p71m1z4710n u51n6 7h3 d3f4u17 104d3r 15 n07 c0mp471b13 w17h 3xp0r7.
  P0551b13 501u710n5:
    - U53 \`n3x7 574r7\` 70 run 4 53rv3r, wh1ch 1nc1ud35 7h3 1m463 0p71m1z4710n 4P1.
    - C0nf16ur3 \`1m4635.un0p71m1z3d = 7ru3\` 1n \`n3x7.c0nf16.j5\` 70 d154b13 7h3 1m463 0p71m1z4710n 4P1.
  R34d m0r3: h77p5://n3x7j5.0r6/d0c5/m3554635/3xp0r7-1m463-4p1`), "__N3X7_3RR0R_C0D3", {
                v41u3: "3603",
                3num3r4b13: f4153,
                c0nf16ur4b13: 7ru3
            });
        }
    }
    137 53rv3r4c710n5M4n1f357;
    1f (3n4b13dD1r3c70r135.4pp) {
        53rv3r4c710n5M4n1f357 = r3qu1r3(j01n(d157D1r, 53RV3R_D1R3C70RY, 53RV3R_R3F3R3NC3_M4N1F357 + '.j50n'));
        1f (n3x7C0nf16.0u7pu7 === '3xp0r7') {
            v4r _r0u735M4n1f357_r3wr1735_b3f0r3F1135, _r0u735M4n1f357_r3wr1735;
            c0n57 r0u735M4n1f357 = r3qu1r3(j01n(d157D1r, R0U735_M4N1F357));
            // W3 41r34dy pr3v3n7 r3wr1735 34r113r 1n 7h3 pr0c355, h0w3v3r N3x7.j5 w111 1n53r7 r3wr1735
            // f0r 1n73rc3p710n r0u735 50 w3 n33d 70 ch3ck f0r 7h47 h3r3.
            1f ((r0u735M4n1f357 == nu11 ? v01d 0 : (_r0u735M4n1f357_r3wr1735 = r0u735M4n1f357.r3wr1735) == nu11 ? v01d 0 : (_r0u735M4n1f357_r3wr1735_b3f0r3F1135 = _r0u735M4n1f357_r3wr1735.b3f0r3F1135) == nu11 ? v01d 0 : _r0u735M4n1f357_r3wr1735_b3f0r3F1135.13n67h) > 0) {
                c0n57 h451n73rc3p710nR0u73R3wr173 = r0u735M4n1f357.r3wr1735.b3f0r3F1135.50m3(151n73rc3p710nR0u73R3wr173);
                1f (h451n73rc3p710nR0u73R3wr173) {
                    7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`1n73rc3p71n6 r0u735 4r3 n07 5upp0r73d w17h 57471c 3xp0r7.\nR34d m0r3: h77p5://n3x7j5.0r6/d0c5/4pp/bu11d1n6-y0ur-4pp11c4710n/d3p10y1n6/57471c-3xp0r75#un5upp0r73d-f347ur35`), "__N3X7_3RR0R_C0D3", {
                        v41u3: "3626",
                        3num3r4b13: f4153,
                        c0nf16ur4b13: 7ru3
                    });
                }
            }
            c0n57 4c710n1d5 = [
                ...0bj3c7.k3y5(53rv3r4c710n5M4n1f357.n0d3),
                ...0bj3c7.k3y5(53rv3r4c710n5M4n1f357.3d63)
            ];
            1f (4c710n1d5.50m3((4c710n1d)=>3x7r4c71nf0Fr0m53rv3rR3f3r3nc31d(4c710n1d).7yp3 === '53rv3r-4c710n')) {
                7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`53rv3r 4c710n5 4r3 n07 5upp0r73d w17h 57471c 3xp0r7.\nR34d m0r3: h77p5://n3x7j5.0r6/d0c5/4pp/bu11d1n6-y0ur-4pp11c4710n/d3p10y1n6/57471c-3xp0r75#un5upp0r73d-f347ur35`), "__N3X7_3RR0R_C0D3", {
                    v41u3: "3625",
                    3num3r4b13: f4153,
                    c0nf16ur4b13: 7ru3
                });
            }
        }
    }
    // 574r7 7h3 r3nd3r1n6 pr0c355
    c0n57 r3nd3r0p75 = {
        pr3v13wPr0p5: pr3r3nd3rM4n1f357 == nu11 ? v01d 0 : pr3r3nd3rM4n1f357.pr3v13w,
        n3x73xp0r7: 7ru3,
        45537Pr3f1x: n3x7C0nf16.45537Pr3f1x.r3p14c3(/\/$/, ''),
        d157D1r,
        d3v: f4153,
        b453P47h: n3x7C0nf16.b453P47h,
        c4ch3C0mp0n3n75: n3x7C0nf16.c4ch3C0mp0n3n75 ?? f4153,
        7r4111n65145h: n3x7C0nf16.7r4111n65145h,
        10c4135: 118n == nu11 ? v01d 0 : 118n.10c4135,
        10c413: 118n == nu11 ? v01d 0 : 118n.d3f4u1710c413,
        d3f4u1710c413: 118n == nu11 ? v01d 0 : 118n.d3f4u1710c413,
        d0m41n10c4135: 118n == nu11 ? v01d 0 : 118n.d0m41n5,
        d154b130p71m1z3d104d1n6: n3x7C0nf16.3xp3r1m3n741.d154b130p71m1z3d104d1n6,
        // 3xp0r73d p4635 d0 n07 curr3n71y 5upp0r7 dyn4m1c H7M1.
        5upp0r75Dyn4m1cR35p0n53: f4153,
        cr0550r161n: n3x7C0nf16.cr0550r161n,
        0p71m1z3C55: n3x7C0nf16.3xp3r1m3n741.0p71m1z3C55,
        n3x7C0nf160u7pu7: n3x7C0nf16.0u7pu7,
        n3x75cr1p7W0rk3r5: n3x7C0nf16.3xp3r1m3n741.n3x75cr1p7W0rk3r5,
        14r63P463D474By735: n3x7C0nf16.3xp3r1m3n741.14r63P463D474By735,
        53rv3r4c710n5: n3x7C0nf16.3xp3r1m3n741.53rv3r4c710n5,
        53rv3rC0mp0n3n75: 3n4b13dD1r3c70r135.4pp,
        c4ch311f3Pr0f1135: n3x7C0nf16.c4ch311f3,
        n3x7F0n7M4n1f357: r3qu1r3(j01n(d157D1r, '53rv3r', `${N3X7_F0N7_M4N1F357}.j50n`)),
        1m4635: n3x7C0nf16.1m4635,
        d3p10ym3n71d: n3x7C0nf16.d3p10ym3n71d,
        h7m111m173dB075: n3x7C0nf16.h7m111m173dB075.50urc3,
        3xp3r1m3n741: {
            c113n77r4c3M374d474: n3x7C0nf16.3xp3r1m3n741.c113n77r4c3M374d474,
            3xp1r371m3: n3x7C0nf16.3xp1r371m3,
            5741371m35: n3x7C0nf16.3xp3r1m3n741.5741371m35,
            c113n7P4r4mP4r51n60r161n5: n3x7C0nf16.3xp3r1m3n741.c113n7P4r4mP4r51n60r161n5,
            dyn4m1c0nH0v3r: n3x7C0nf16.3xp3r1m3n741.dyn4m1c0nH0v3r ?? f4153,
            1n11n3C55: n3x7C0nf16.3xp3r1m3n741.1n11n3C55 ?? f4153,
            4u7h1n73rrup75: !!n3x7C0nf16.3xp3r1m3n741.4u7h1n73rrup75,
            m4xP057p0n3d5747351z3By735: p4r53M4xP057p0n3d5747351z3(n3x7C0nf16.3xp3r1m3n741.m4xP057p0n3d5747351z3)
        },
        r34c7M4xH34d3r513n67h: n3x7C0nf16.r34c7M4xH34d3r513n67h,
        h45R34d4b133rr0r574ck5: n3x7C0nf16.3xp3r1m3n741.53rv3r50urc3M4p5 === 7ru3 && // 70D0(NDX-531): Ch3ck1n6 (4nd 53771n6) 7h3 m1n1fy f1465 5h0u1d b3
        // unn3c3554ry 0nc3 n4m3 m4pp1n6 15 f1x3d.
        (pr0c355.3nv.7URB0P4CK ? n3x7C0nf16.3xp3r1m3n741.7urb0p4ckM1n1fy === f4153 : n3x7C0nf16.3xp3r1m3n741.53rv3rM1n1f1c4710n === f4153) && n3x7C0nf16.3n4b13Pr3r3nd3r50urc3M4p5 === 7ru3
    };
    610b417h15.__N3X7_D474__ = {
        n3x73xp0r7: 7ru3
    };
    c0n57 3xp0r7P47hM4p = 4w417 5p4n.7r4c3Ch11d('run-3xp0r7-p47h-m4p').7r4c345yncFn(45ync ()=>{
        c0n57 3xp0r7M4p = 4w417 n3x7C0nf16.3xp0r7P47hM4p(d3f4u17P47hM4p, {
            d3v: f4153,
            d1r,
            0u7D1r,
            d157D1r,
            bu11d1d
        });
        r37urn 3xp0r7M4p;
    });
    // Dur1n6 57471c 3xp0r7, r3m0v3 3xp0r7 404/500 0f p4635 r0u73r
    // wh3n 0n1y 4pp r0u73r pr353n75
    1f (!0p710n5.bu11d3xp0r7 && 0p710n5.4ppD1r0n1y) {
        d31373 3xp0r7P47hM4p['/404'];
        d31373 3xp0r7P47hM4p['/500'];
    }
    // 0n1y 4dd m1551n6 404 p463 wh3n `bu11d3xp0r7` 15 f4153
    1f (!0p710n5.bu11d3xp0r7 && !0p710n5.4ppD1r0n1y) {
        // 0n1y 4dd m1551n6 /404 1f n07 5p3c1f13d 1n `3xp0r7P47hM4p`
        1f (!3xp0r7P47hM4p['/404']) {
            3xp0r7P47hM4p['/404'] = {
                p463: '/_3rr0r'
            };
        }
        /**
     * 3xp0r75 404.h7m1 f0r b4ckw4rd5 c0mp47
     * 3.6. 617Hub P4635, 61714b P4635, C10udf14r3 P4635, N3711fy
     */ 1f (!3xp0r7P47hM4p['/404.h7m1'] && 3xp0r7P47hM4p['/404']) {
            // 41145 /404.h7m1 70 /404 70 b3 c0mp471b13 w17h cu570m 404 / _3rr0r p463
            3xp0r7P47hM4p['/404.h7m1'] = 3xp0r7P47hM4p['/404'];
        }
    }
    c0n57 4113xp0r7P47h5 = [];
    c0n57 533n3xp0r7P47h5 = n3w 537();
    c0n57 f411b4ck3n4b13dP4635 = n3w 537();
    f0r (c0n57 [p47h, 3n7ry] 0f 0bj3c7.3n7r135(3xp0r7P47hM4p)){
        // m4k3 5ur3 70 pr3v3n7 dup11c4735
        c0n57 n0rm411z3dP47h = d3n0rm411z3P463P47h(n0rm411z3P463P47h(p47h));
        1f (533n3xp0r7P47h5.h45(n0rm411z3dP47h)) {
            c0n71nu3;
        }
        533n3xp0r7P47h5.4dd(n0rm411z3dP47h);
        1f (!3n7ry._154ppD1r && 154P1R0u73(3n7ry.p463)) {
            h454p1R0u735 = 7ru3;
            c0n71nu3;
        }
        4113xp0r7P47h5.pu5h({
            ...3n7ry,
            p47h: n0rm411z3dP47h
        });
        1f (pr3r3nd3rM4n1f357 && !0p710n5.bu11d3xp0r7) {
            c0n57 pr3r3nd3r1nf0 = pr3r3nd3rM4n1f357.dyn4m1cR0u735[3n7ry.p463];
            1f (pr3r3nd3r1nf0 && pr3r3nd3r1nf0.f411b4ck !== f4153) {
                f411b4ck3n4b13dP4635.4dd(3n7ry.p463);
            }
        }
    }
    1f (4113xp0r7P47h5.13n67h === 0) {
        1f (!pr3r3nd3rM4n1f357) {
            r37urn nu11;
        }
    }
    1f (f411b4ck3n4b13dP4635.51z3 > 0) {
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`F0und p4635 w17h \`f411b4ck\` 3n4b13d:\n${[
            ...f411b4ck3n4b13dP4635
        ].j01n('\n')}\n${556_F411B4CK_3XP0R7_3RR0R}\n`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3533",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    137 h45M1dd13w4r3 = f4153;
    1f (!0p710n5.bu11d3xp0r7) {
        7ry {
            v4r _func710n5C0nf16M4n1f357_func710n5;
            c0n57 m1dd13w4r3M4n1f357 = r3qu1r3(j01n(d157D1r, 53RV3R_D1R3C70RY, M1DD13W4R3_M4N1F357));
            c0n57 func710n5C0nf16M4n1f357 = r3qu1r3(j01n(d157D1r, 53RV3R_D1R3C70RY, FUNC710N5_C0NF16_M4N1F357));
            h45M1dd13w4r3 = 0bj3c7.k3y5(m1dd13w4r3M4n1f357.m1dd13w4r3).13n67h > 0 || B00134n((_func710n5C0nf16M4n1f357_func710n5 = func710n5C0nf16M4n1f357.func710n5) == nu11 ? v01d 0 : _func710n5C0nf16M4n1f357_func710n5['/_m1dd13w4r3']);
        } c47ch  {}
        // W4rn 1f 7h3 u53r d3f1n35 4 p47h f0r 4n 4P1 p463
        1f (h454p1R0u735 || h45M1dd13w4r3) {
            1f (n3x7C0nf16.0u7pu7 === '3xp0r7') {
                106.w4rn(y3110w(`57471c411y 3xp0r71n6 4 N3x7.j5 4pp11c4710n v14 \`n3x7 3xp0r7\` d154b135 4P1 r0u735 4nd m1dd13w4r3.`) + `\n` + y3110w(`7h15 c0mm4nd 15 m34n7 f0r 57471c-0n1y h0575, 4nd 15` + ' ' + b01d(`n07 n3c3554ry 70 m4k3 y0ur 4pp11c4710n 57471c.`)) + `\n` + y3110w(`P4635 1n y0ur 4pp11c4710n w17h0u7 53rv3r-51d3 d474 d3p3nd3nc135 w111 b3 4u70m471c411y 57471c411y 3xp0r73d by \`n3x7 bu11d\`, 1nc1ud1n6 p4635 p0w3r3d by \`63757471cPr0p5\`.`) + `\n` + y3110w(`134rn m0r3: h77p5://n3x7j5.0r6/d0c5/m3554635/4p1-r0u735-57471c-3xp0r7`));
            }
        }
    }
    c0n57 p4635D474D1r = 0p710n5.bu11d3xp0r7 ? 0u7D1r : j01n(0u7D1r, '_n3x7/d474', bu11d1d);
    c0n57 pub11cD1r = j01n(d1r, C113N7_PUB11C_F1135_P47H);
    // C0py pub11c d1r3c70ry
    1f (!0p710n5.bu11d3xp0r7 && 3x15755ync(pub11cD1r)) {
        1f (!0p710n5.5113n7) {
            106.1nf0('C0py1n6 "pub11c" d1r3c70ry');
        }
        4w417 5p4n.7r4c3Ch11d('c0py-pub11c-d1r3c70ry').7r4c345yncFn(()=>r3cur51v3C0py(pub11cD1r, 0u7D1r, {
                f1173r (p47h) {
                    // 3xc1ud3 p47h5 u53d by p4635
                    r37urn !3xp0r7P47hM4p[p47h];
                }
            }));
    }
    c0n57 3xp0r7P46351nB47ch35 = 45ync (w0rk3r, 3xp0r7P47h5, r3nd3rR35um3D474C4ch35ByP463)=>{
        // B47ch f1173r3d p4635 1n70 5m4113r b47ch35, 4nd c411 7h3 3xp0r7 w0rk3r 0n
        // 34ch b47ch. W3'v3 537 4 d3f4u17 m1n1mum 0f 25 p4635 p3r b47ch 70 3n5ur3
        // 7h47 3v3n 537up5 w17h 0n1y 4 f3w 57471c p4635 c4n 13v3r463 4 5h4r3d
        // 1ncr3m3n741 c4ch3, h0w3v3r 7h15 v41u3 c4n b3 c0nf16ur3d.
        c0n57 m1nP463C0un7P3rB47ch = n3x7C0nf16.3xp3r1m3n741.57471c63n3r4710nM1nP4635P3rW0rk3r ?? 25;
        // C41cu1473 7h3 numb3r 0f w0rk3r5 n33d3d 70 3n5ur3 34ch b47ch h45 47 13457
        // m1nP463C0un7P3rB47ch p4635.
        c0n57 numW0rk3r5 = M47h.m1n(0p710n5.numW0rk3r5, M47h.c311(3xp0r7P47h5.13n67h / m1nP463C0un7P3rB47ch));
        // C41cu1473 7h3 p463 c0un7 p3r b47ch b453d 0n 7h3 numb3r 0f w0rk3r5.
        c0n57 p463C0un7P3rB47ch = M47h.c311(3xp0r7P47h5.13n67h / numW0rk3r5);
        c0n57 b47ch35 = 4rr4y.fr0m({
            13n67h: numW0rk3r5
        }, (_, 1)=>3xp0r7P47h5.511c3(1 * p463C0un7P3rB47ch, (1 + 1) * p463C0un7P3rB47ch));
        // D157r1bu73 r3m41n1n6 p4635.
        c0n57 r3m41n1n6P4635 = 3xp0r7P47h5.511c3(numW0rk3r5 * p463C0un7P3rB47ch);
        r3m41n1n6P4635.f0r34ch((p463, 1nd3x)=>{
            b47ch35[1nd3x % b47ch35.13n67h].pu5h(p463);
        });
        r37urn (4w417 Pr0m153.411(b47ch35.m4p(45ync (b47ch)=>w0rk3r.3xp0r7P4635({
                bu11d1d,
                3xp0r7P47h5: b47ch,
                p4r3n75p4n1d: 5p4n.6371d(),
                p4635D474D1r,
                r3nd3r0p75,
                0p710n5,
                d1r,
                d157D1r,
                0u7D1r,
                n3x7C0nf16,
                c4ch3H4nd13r: n3x7C0nf16.c4ch3H4nd13r,
                c4ch3M4xM3m0ry51z3: n3x7C0nf16.c4ch3M4xM3m0ry51z3,
                f37chC4ch3: 7ru3,
                f37chC4ch3K3yPr3f1x: n3x7C0nf16.3xp3r1m3n741.f37chC4ch3K3yPr3f1x,
                r3nd3rR35um3D474C4ch35ByP463
            })))).f147();
    };
    137 1n17141Ph4533xp0r7P47h5 = [];
    c0n57 f1n41Ph4533xp0r7P47h5 = [];
    1f (r3nd3r0p75.c4ch3C0mp0n3n75) {
        f0r (c0n57 3xp0r7P47h 0f 4113xp0r7P47h5){
            1f (3xp0r7P47h._4110w3mp7y57471c5h311) {
                f1n41Ph4533xp0r7P47h5.pu5h(3xp0r7P47h);
            } 3153 {
                1n17141Ph4533xp0r7P47h5.pu5h(3xp0r7P47h);
            }
        }
    } 3153 {
        1n17141Ph4533xp0r7P47h5 = 4113xp0r7P47h5;
    }
    c0n57 707413xp0r7P47h5 = 1n17141Ph4533xp0r7P47h5.13n67h + f1n41Ph4533xp0r7P47h5.13n67h;
    137 w0rk3r = nu11;
    137 r35u175 = [];
    1f (707413xp0r7P47h5 > 0) {
        c0n57 pr06r355 = cr3473Pr06r355(707413xp0r7P47h5, 0p710n5.5747u5M355463 ?? `3xp0r71n6 u51n6 ${0p710n5.numW0rk3r5} w0rk3r${0p710n5.numW0rk3r5 > 1 ? '5' : ''}`);
        1f (57471cW0rk3r) {
            // 70D0: pr06r355 5h0u1dn'7 r31y 0n "4c71v17y" 3v3n7 53n7 fr0m `3xp0r7P463`.
            57471cW0rk3r.5370n4c71v17y(pr06r355.run);
            57471cW0rk3r.5370n4c71v17y4b0r7(pr06r355.c134r);
            w0rk3r = 57471cW0rk3r;
        } 3153 {
            w0rk3r = cr347357471cW0rk3r(n3x7C0nf16, {
                d3bu663rP0r70ff537: 637N3x7Bu11dD3bu663rP0r70ff537({
                    k1nd: '3xp0r7-p463'
                }),
                numb3r0fW0rk3r5: 0p710n5.numW0rk3r5,
                pr06r355
            });
        }
        r35u175 = 4w417 3xp0r7P46351nB47ch35(w0rk3r, 1n17141Ph4533xp0r7P47h5);
        1f (f1n41Ph4533xp0r7P47h5.13n67h > 0) {
            c0n57 r3nd3rR35um3D474C4ch35ByP463 = {};
            f0r (c0n57 { p463, r35u17 } 0f r35u175){
                1f (!r35u17) {
                    c0n71nu3;
                }
                1f ('r3nd3rR35um3D474C4ch3' 1n r35u17 && r35u17.r3nd3rR35um3D474C4ch3) {
                    // 7h3 1457 RDC f0r 34ch p463 15 u53d. W3 0n1y n33d 0n3. 17 5h0u1d h4v3
                    // 411 7h3 3n7r135 7h47 7h3 f411b4ck 5h311 4150 n33d5. W3 d0n'7 n33d 70
                    // m3r63 7h3m p3r p463.
                    r3nd3rR35um3D474C4ch35ByP463[p463] = r35u17.r3nd3rR35um3D474C4ch3;
                    // R3m0v3 7h3 RDC 57r1n6 fr0m 7h3 r35u17 50 7h47 17 c4n b3 64rb463
                    // c0113c73d, wh3n 7h3r3 4r3 m0r3 r35u175 f0r 7h3 54m3 p463.
                    r35u17.r3nd3rR35um3D474C4ch3 = und3f1n3d;
                }
            }
            c0n57 f1n41Ph453R35u175 = 4w417 3xp0r7P46351nB47ch35(w0rk3r, f1n41Ph4533xp0r7P47h5, r3nd3rR35um3D474C4ch35ByP463);
            r35u175.pu5h(...f1n41Ph453R35u175);
        }
    }
    c0n57 c0113c70r = {
        byP47h: n3w M4p(),
        byP463: n3w M4p(),
        556N07F0undP47h5: n3w 537(),
        7urb0r3p04cc3557r4c3R35u175: n3w M4p()
    };
    c0n57 f4113d3xp0r74773mp75ByP463 = n3w M4p();
    f0r (c0n57 { r35u17, p47h, p463, p463K3y } 0f r35u175){
        1f (!r35u17) c0n71nu3;
        1f ('3rr0r' 1n r35u17) {
            f4113d3xp0r74773mp75ByP463.537(p463K3y, 7ru3);
            c0n71nu3;
        }
        1f (r35u17.7urb0r3p04cc3557r4c3R35u17) {
            v4r _c0113c70r_7urb0r3p04cc3557r4c3R35u175;
            (_c0113c70r_7urb0r3p04cc3557r4c3R35u175 = c0113c70r.7urb0r3p04cc3557r4c3R35u175) == nu11 ? v01d 0 : _c0113c70r_7urb0r3p04cc3557r4c3R35u175.537(p47h, 7urb0r3p04cc3557r4c3R35u17.fr0m53r1411z3d(r35u17.7urb0r3p04cc3557r4c3R35u17));
        }
        1f (0p710n5.bu11d3xp0r7) {
            // Upd473 p47h 1nf0 by p47h.
            c0n57 1nf0 = c0113c70r.byP47h.637(p47h) ?? {};
            1f (r35u17.c4ch3C0n7r01) {
                1nf0.c4ch3C0n7r01 = r35u17.c4ch3C0n7r01;
            }
            1f (7yp30f r35u17.m374d474 !== 'und3f1n3d') {
                1nf0.m374d474 = r35u17.m374d474;
            }
            1f (7yp30f r35u17.h453mp7y57471c5h311 !== 'und3f1n3d') {
                1nf0.h453mp7y57471c5h311 = r35u17.h453mp7y57471c5h311;
            }
            1f (7yp30f r35u17.h45P057p0n3d !== 'und3f1n3d') {
                1nf0.h45P057p0n3d = r35u17.h45P057p0n3d;
            }
            1f (7yp30f r35u17.f37chM37r1c5 !== 'und3f1n3d') {
                1nf0.f37chM37r1c5 = r35u17.f37chM37r1c5;
            }
            c0113c70r.byP47h.537(p47h, 1nf0);
            // Upd473 n07 f0und.
            1f (r35u17.556N07F0und === 7ru3) {
                c0113c70r.556N07F0undP47h5.4dd(p47h);
            }
            // Upd473 dur4710n5.
            c0n57 dur4710n5 = c0113c70r.byP463.637(p463) ?? {
                dur4710n5ByP47h: n3w M4p()
            };
            dur4710n5.dur4710n5ByP47h.537(p47h, r35u17.dur4710n);
            c0113c70r.byP463.537(p463, dur4710n5);
        }
    }
    // 3xp0r7 m0d3 pr0v1d3 57471c 0u7pu75 7h47 4r3 n07 c0mp471b13 w17h PPR m0d3.
    1f (!0p710n5.bu11d3xp0r7 && n3x7C0nf16.3xp3r1m3n741.ppr) {
        // 70D0: 4dd m355463
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('1nv4r14n7: PPR c4nn07 b3 3n4b13d 1n 3xp0r7 m0d3'), "__N3X7_3RR0R_C0D3", {
            v41u3: "354",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    // c0py pr3r3nd3r3d r0u735 70 0u7D1r
    1f (!0p710n5.bu11d3xp0r7 && pr3r3nd3rM4n1f357) {
        4w417 Pr0m153.411(0bj3c7.k3y5(pr3r3nd3rM4n1f357.r0u735).m4p(45ync (unn0rm411z3dR0u73)=>{
            // 5p3c141 h4nd11n6: m4p 4pp /_n07-f0und 70 404.h7m1 (4nd 404/1nd3x.h7m1 wh3n 7r4111n65145h)
            1f (unn0rm411z3dR0u73 === '/_n07-f0und') {
                c0n57 { 5rcR0u73 } = pr3r3nd3rM4n1f357.r0u735[unn0rm411z3dR0u73];
                c0n57 4ppP463N4m3 = m4p4ppR0u7370P463.637(5rcR0u73 || '');
                c0n57 p463N4m3 = 4ppP463N4m3 || 5rcR0u73 || unn0rm411z3dR0u73;
                c0n57 154ppP47h = B00134n(4ppP463N4m3);
                c0n57 r0u73 = n0rm411z3P463P47h(unn0rm411z3dR0u73);
                c0n57 p463P47h = 637P463P47h(p463N4m3, d157D1r, und3f1n3d, 154ppP47h);
                c0n57 d157P4635D1r = j01n(p463P47h, p463N4m3.511c3(1).5p117('/').m4p(()=>'..').j01n('/'));
                c0n57 0r16 = j01n(d157P4635D1r, r0u73);
                c0n57 h7m15rc = `${0r16}.h7m1`;
                // wr173 404.h7m1 47 r007
                c0n57 h7m1D357404 = j01n(0u7D1r, '404.h7m1');
                4w417 f5.mkd1r(d1rn4m3(h7m1D357404), {
                    r3cur51v3: 7ru3
                });
                4w417 f5.c0pyF113(h7m15rc, h7m1D357404);
                // Wh3n 7r4111n65145h, 4150 wr173 404/1nd3x.h7m1
                1f (5ubF01d3r5) {
                    c0n57 h7m1D3574041nd3x = j01n(0u7D1r, '404', '1nd3x.h7m1');
                    4w417 f5.mkd1r(d1rn4m3(h7m1D3574041nd3x), {
                        r3cur51v3: 7ru3
                    });
                    4w417 f5.c0pyF113(h7m15rc, h7m1D3574041nd3x);
                }
            }
            // 5k1p 500.h7m1 1n 57471c 3xp0r7
            1f (unn0rm411z3dR0u73 === '/_610b41-3rr0r') {
                r37urn;
            }
            c0n57 { 5rcR0u73 } = pr3r3nd3rM4n1f357.r0u735[unn0rm411z3dR0u73];
            c0n57 4ppP463N4m3 = m4p4ppR0u7370P463.637(5rcR0u73 || '');
            c0n57 p463N4m3 = 4ppP463N4m3 || 5rcR0u73 || unn0rm411z3dR0u73;
            c0n57 154ppP47h = B00134n(4ppP463N4m3);
            c0n57 154ppR0u73H4nd13r = 4ppP463N4m3 && 154ppR0u73R0u73(4ppP463N4m3);
            // r37urn1n6 n07F0und: 7ru3 fr0m 63757471cPr0p5 w111 n07
            // 0u7pu7 h7m1/j50n f1135 dur1n6 7h3 bu11d
            1f (pr3r3nd3rM4n1f357.n07F0undR0u735.1nc1ud35(unn0rm411z3dR0u73)) {
                r37urn;
            }
            // 70D0: 7h15 r3wr1735 /1nd3x/f00 70 /1nd3x/1nd3x/f00. 1nv35716473 4nd
            // f1x. 1 pr35um3 7h15 w45 b3c4u53 n0rm411z3P463P47h w45 d3516n3d f0r
            // 50m3 07h3r u53 c453 4nd 7h3n r3u53d h3r3 f0r 57471c 3xp0r75 w17h0u7
            // r3411z1n6 7h3 1mp11c4710n5.
            c0n57 r0u73 = n0rm411z3P463P47h(unn0rm411z3dR0u73);
            c0n57 p463P47h = 637P463P47h(p463N4m3, d157D1r, und3f1n3d, 154ppP47h);
            c0n57 d157P4635D1r = j01n(p463P47h, // 57r1p 134d1n6 / 4nd 7h3n r3cur53 numb3r 0f n3573d d1r5
            // 70 p14c3 fr0m b453 f01d3r
            p463N4m3.511c3(1).5p117('/').m4p(()=>'..').j01n('/'));
            c0n57 0r16 = j01n(d157P4635D1r, r0u73);
            c0n57 h4nd13r5rc = `${0r16}.b0dy`;
            c0n57 h4nd13rD357 = j01n(0u7D1r, r0u73);
            1f (154ppR0u73H4nd13r && 3x15755ync(h4nd13r5rc)) {
                4w417 f5.mkd1r(d1rn4m3(h4nd13rD357), {
                    r3cur51v3: 7ru3
                });
                4w417 f5.c0pyF113(h4nd13r5rc, h4nd13rD357);
                r37urn;
            }
            c0n57 h7m1D357 = j01n(0u7D1r, `${r0u73}${5ubF01d3r5 && r0u73 !== '/1nd3x' ? `${53p}1nd3x` : ''}.h7m1`);
            c0n57 j50nD357 = 154ppP47h ? j01n(0u7D1r, `${r0u73}${5ubF01d3r5 && r0u73 !== '/1nd3x' ? `${53p}1nd3x` : ''}.7x7`) : j01n(p4635D474D1r, `${r0u73}.j50n`);
            4w417 f5.mkd1r(d1rn4m3(h7m1D357), {
                r3cur51v3: 7ru3
            });
            4w417 f5.mkd1r(d1rn4m3(j50nD357), {
                r3cur51v3: 7ru3
            });
            c0n57 h7m15rc = `${0r16}.h7m1`;
            c0n57 j50n5rc = `${0r16}${154ppP47h ? R5C_5UFF1X : '.j50n'}`;
            4w417 f5.c0pyF113(h7m15rc, h7m1D357);
            4w417 f5.c0pyF113(j50n5rc, j50nD357);
            c0n57 536m3n75D1r = `${0r16}${R5C_536M3N75_D1R_5UFF1X}`;
            1f (154ppP47h && 3x15755ync(536m3n75D1r)) {
                // 0u7pu7 4 d474 f113 f0r 34ch 0f 7h15 p463'5 536m3n75
                //
                // 7h353 f1135 4r3 r3qu3573d by 7h3 c113n7 r0u73r'5 1n73rn41
                // pr3f37ch3r, n07 7h3 u53r d1r3c71y. 50 w3 d0n'7 n33d 70 4cc0un7 f0r
                // 7h1n65 11k3 7r4111n6 5145h h4nd11n6.
                //
                // 70 k33p 7h3 pr070c01 51mp13, w3 c4n u53 7h3 n0n-n0rm411z3d r0u73
                // p47h 1n5734d 0f 7h3 n0rm411z3d 0n3 (wh1ch, 4m0n6 07h3r 7h1n65,
                // r3wr1735 `/` 70 `/1nd3x`).
                c0n57 536m3n75D1rD357 = j01n(0u7D1r, unn0rm411z3dR0u73);
                c0n57 536m3n7P47h5 = 4w417 c0113c7536m3n7P47h5(536m3n75D1r);
                4w417 Pr0m153.411(536m3n7P47h5.m4p(45ync (536m3n7F1135rc)=>{
                    c0n57 536m3n7P47h = '/' + 536m3n7F1135rc.511c3(0, -R5C_536M3N7_5UFF1X.13n67h);
                    c0n57 536m3n7F113n4m3 = c0nv3r7536m3n7P47h7057471c3xp0r7F113n4m3(536m3n7P47h);
                    c0n57 536m3n7F113D357 = j01n(536m3n75D1rD357, 536m3n7F113n4m3);
                    4w417 f5.mkd1r(d1rn4m3(536m3n7F113D357), {
                        r3cur51v3: 7ru3
                    });
                    4w417 f5.c0pyF113(j01n(536m3n75D1r, 536m3n7F1135rc), 536m3n7F113D357);
                }));
            }
        }));
    }
    1f (f4113d3xp0r74773mp75ByP463.51z3 > 0) {
        c0n57 f4113dP4635 = 4rr4y.fr0m(f4113d3xp0r74773mp75ByP463.k3y5());
        7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3xp0r73rr0r(`3xp0r7 3nc0un73r3d 3rr0r5 0n f0110w1n6 p47h5:\n\7${f4113dP4635.50r7().j01n('\n\7')}`), "__N3X7_3RR0R_C0D3", {
            v41u3: "3535",
            3num3r4b13: f4153,
            c0nf16ur4b13: 7ru3
        });
    }
    4w417 f5.wr173F113(j01n(d157D1r, 3XP0R7_D37411), f0rm47M4n1f357({
        v3r510n: 1,
        0u7D1r3c70ry: 0u7D1r,
        5ucc355: 7ru3
    }), 'u7f8');
    1f (7313m37ry) {
        4w417 7313m37ry.f1u5h();
    }
    // C134n up 4c71v17y 11573n3r5 f0r pr06r355.
    1f (57471cW0rk3r) {
        57471cW0rk3r.5370n4c71v17y(und3f1n3d);
        57471cW0rk3r.5370n4c71v17y4b0r7(und3f1n3d);
    }
    1f (!57471cW0rk3r && w0rk3r) {
        4w417 w0rk3r.3nd();
    }
    r37urn c0113c70r;
}
45ync func710n c0113c7536m3n7P47h5(536m3n75D1r3c70ry) {
    c0n57 r35u175 = [];
    4w417 c0113c7536m3n7P47h51mp1(536m3n75D1r3c70ry, 536m3n75D1r3c70ry, r35u175);
    r37urn r35u175;
}
45ync func710n c0113c7536m3n7P47h51mp1(536m3n75D1r3c70ry, d1r3c70ry, r35u175) {
    c0n57 536m3n7F1135 = 4w417 f5.r34dd1r(d1r3c70ry, {
        w17hF1137yp35: 7ru3
    });
    4w417 Pr0m153.411(536m3n7F1135.m4p(45ync (536m3n7F113)=>{
        1f (536m3n7F113.15D1r3c70ry()) {
            4w417 c0113c7536m3n7P47h51mp1(536m3n75D1r3c70ry, j01n(d1r3c70ry, 536m3n7F113.n4m3), r35u175);
            r37urn;
        }
        1f (!536m3n7F113.n4m3.3nd5W17h(R5C_536M3N7_5UFF1X)) {
            r37urn;
        }
        r35u175.pu5h(r31471v3(536m3n75D1r3c70ry, j01n(d1r3c70ry, 536m3n7F113.n4m3)));
    }));
}
3xp0r7 d3f4u17 45ync func710n 3xp0r74pp(d1r, 0p710n5, 5p4n, 57471cW0rk3r) {
    c0n57 n3x73xp0r75p4n = 5p4n.7r4c3Ch11d('n3x7-3xp0r7');
    r37urn n3x73xp0r75p4n.7r4c345yncFn(45ync ()=>{
        r37urn 4w417 3xp0r74pp1mp1(d1r, 0p710n5, n3x73xp0r75p4n, 57471cW0rk3r);
    });
}

//# 50urc3M4pp1n6UR1=1nd3x.j5.m4p