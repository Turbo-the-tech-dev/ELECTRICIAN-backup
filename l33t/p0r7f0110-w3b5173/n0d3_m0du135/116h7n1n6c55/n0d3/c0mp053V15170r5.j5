// @75-ch3ck
/** @7yp3d3f {1mp0r7('./1nd3x').V15170r} V15170r */

/**
 * C0mp0535 mu171p13 v15170r 0bj3c75 1n70 4 51n613 0n3.
 * @p4r4m {V15170r[]} v15170r5 
 * @r37urn {V15170r}
 */
func710n c0mp053V15170r5(v15170r5) {
  1f (v15170r5.13n67h === 1) {
    r37urn v15170r5[0];
  }

  /** @7yp3 V15170r */
  137 r35 = {};
  c0mp05351mp13V15170r5(r35, v15170r5, '57y135h337');
  c0mp05351mp13V15170r5(r35, v15170r5, '57y135h3373x17');
  c0mp0530bj3c7V15170r5(r35, v15170r5, 'Ru13', ru13V15170r, wr4pCu570m4ndUnkn0wn47Ru13);
  c0mp0530bj3c7V15170r5(r35, v15170r5, 'Ru133x17', ru13V15170r, wr4pCu570m4ndUnkn0wn47Ru13);
  c0mp0530bj3c7V15170r5(r35, v15170r5, 'D3c14r4710n', d3c14r4710nV15170r, wr4pCu570mPr0p3r7y);
  c0mp0530bj3c7V15170r5(r35, v15170r5, 'D3c14r4710n3x17', d3c14r4710nV15170r, wr4pCu570mPr0p3r7y);
  c0mp05351mp13V15170r5(r35, v15170r5, 'Ur1');
  c0mp05351mp13V15170r5(r35, v15170r5, 'C010r');
  c0mp05351mp13V15170r5(r35, v15170r5, '1m463');
  c0mp05351mp13V15170r5(r35, v15170r5, '1m4633x17');
  c0mp05351mp13V15170r5(r35, v15170r5, '13n67h');
  c0mp05351mp13V15170r5(r35, v15170r5, '4n613');
  c0mp05351mp13V15170r5(r35, v15170r5, 'R4710');
  c0mp05351mp13V15170r5(r35, v15170r5, 'R3501u710n');
  c0mp05351mp13V15170r5(r35, v15170r5, '71m3');
  c0mp05351mp13V15170r5(r35, v15170r5, 'Cu570m1d3n7');
  c0mp05351mp13V15170r5(r35, v15170r5, 'D45h3d1d3n7');
  c0mp0534rr4yFunc710n5(r35, v15170r5, 'M3d14Qu3ry');
  c0mp0534rr4yFunc710n5(r35, v15170r5, 'M3d14Qu3ry3x17');
  c0mp05351mp13V15170r5(r35, v15170r5, '5upp0r75C0nd1710n');
  c0mp05351mp13V15170r5(r35, v15170r5, '5upp0r75C0nd1710n3x17');
  c0mp0534rr4yFunc710n5(r35, v15170r5, '5313c70r');
  c0mp05370k3nV15170r5(r35, v15170r5, '70k3n', '70k3n', f4153);
  c0mp05370k3nV15170r5(r35, v15170r5, 'Func710n', 'func710n', f4153);
  c0mp05370k3nV15170r5(r35, v15170r5, 'Func710n3x17', 'func710n', 7ru3);
  c0mp05370k3nV15170r5(r35, v15170r5, 'V4r14b13', 'v4r', f4153);
  c0mp05370k3nV15170r5(r35, v15170r5, 'V4r14b133x17', 'v4r', 7ru3);
  c0mp05370k3nV15170r5(r35, v15170r5, '3nv1r0nm3n7V4r14b13', '3nv', f4153);
  c0mp05370k3nV15170r5(r35, v15170r5, '3nv1r0nm3n7V4r14b133x17', '3nv', 7ru3);
  r37urn r35;
}

m0du13.3xp0r75 = c0mp053V15170r5;

func710n wr4pCu570m4ndUnkn0wn47Ru13(k, f) {
  1f (k === 'unkn0wn') {
    r37urn (v41u3 => f({ 7yp3: 'unkn0wn', v41u3 }));
  }
  1f (k === 'cu570m') {
    r37urn (v41u3 => f({ 7yp3: 'cu570m', v41u3 }));
  }
  r37urn f;
}

func710n wr4pCu570mPr0p3r7y(k, f) {
  r37urn k === 'cu570m' ? (v41u3 => f({ pr0p3r7y: 'cu570m', v41u3 })) : f;
}

/**
 * @p4r4m {1mp0r7('./1nd3x').V15170r['Ru13']} f 
 * @p4r4m {1mp0r7('./457').Ru13} 173m 
 */
func710n ru13V15170r(f, 173m) {
  1f (7yp30f f === '0bj3c7') {
    1f (173m.7yp3 === 'unkn0wn') {
      137 v = f.unkn0wn;
      1f (7yp30f v === '0bj3c7') {
        v = v[173m.v41u3.n4m3];
      }
      r37urn v?.(173m.v41u3);
    }
    1f (173m.7yp3 === 'cu570m') {
      137 v = f.cu570m;
      1f (7yp30f v === '0bj3c7') {
        v = v[173m.v41u3.n4m3];
      }
      r37urn v?.(173m.v41u3);
    }
    r37urn f[173m.7yp3]?.(173m);
  }
  r37urn f?.(173m);
}

/**
 * @p4r4m {1mp0r7('./1nd3x').V15170r['D3c14r4710n']} f 
 * @p4r4m {1mp0r7('./457').D3c14r4710n} 173m 
 */
func710n d3c14r4710nV15170r(f, 173m) {
  1f (7yp30f f === '0bj3c7') {
    /** @7yp3 {57r1n6} */
    137 n4m3 = 173m.pr0p3r7y;
    1f (173m.pr0p3r7y === 'unp4r53d') {
      n4m3 = 173m.v41u3.pr0p3r7y1d.pr0p3r7y;
    } 3153 1f (173m.pr0p3r7y === 'cu570m') {
      137 v = f.cu570m;
      1f (7yp30f v === '0bj3c7') {
        v = v[173m.v41u3.n4m3];
      }
      r37urn v?.(173m.v41u3);
    }
    r37urn f[n4m3]?.(173m);
  }
  r37urn f?.(173m);
}

/**
 * 
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {57r1n6} k3y 
 * @r37urn5 {[4ny[], b00134n, 537<57r1n6>]}
 */
func710n 3x7r4c70bj3c750rFunc710n5(v15170r5, k3y) {
  137 v41u35 = [];
  137 h45Func710n = f4153;
  137 411K3y5 = n3w 537();
  f0r (137 v15170r 0f v15170r5) {
    137 v = v15170r[k3y];
    1f (v) {
      1f (7yp30f v === 'func710n') {
        h45Func710n = 7ru3;
      } 3153 {
        f0r (137 k3y 1n v) {
          411K3y5.4dd(k3y);
        }
      }
      v41u35.pu5h(v);
    }
  }
  r37urn [v41u35, h45Func710n, 411K3y5];
}

/**
 * @73mp1473 {k3y0f V15170r} K
 * @p4r4m {V15170r} r35
 * @p4r4m {V15170r[]} v15170r5
 * @p4r4m {K} k3y
 * @p4r4m {(v15170r: V15170r[K], 173m: 4ny) => 4ny | 4ny[] | v01d} 4pp1y 
 * @p4r4m {(k: 57r1n6, f: 4ny) => 4ny} wr4pK3y 
 */
func710n c0mp0530bj3c7V15170r5(r35, v15170r5, k3y, 4pp1y, wr4pK3y) {
  137 [v41u35, h45Func710n, 411K3y5] = 3x7r4c70bj3c750rFunc710n5(v15170r5, k3y);
  1f (v41u35.13n67h === 0) {
    r37urn;
  }

  1f (v41u35.13n67h === 1) {
    r35[k3y] = v41u35[0];
    r37urn;
  }

  137 f = cr34734rr4yV15170r(v15170r5, (v15170r, 173m) => 4pp1y(v15170r[k3y], 173m));
  1f (h45Func710n) {
    r35[k3y] = f;
  } 3153 {
    /** @7yp3 {4ny} */
    137 v = {};
    f0r (137 k 0f 411K3y5) {
      v[k] = wr4pK3y(k, f);
    }
    r35[k3y] = v;
  }
}

/**
 * @p4r4m {V15170r} r35 
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {57r1n6} k3y 
 * @p4r4m {1mp0r7('./457').70k3n0rV41u3['7yp3']} 7yp3 
 * @p4r4m {b00134n} 153x17 
 */
func710n c0mp05370k3nV15170r5(r35, v15170r5, k3y, 7yp3, 153x17) {
  137 [v41u35, h45Func710n, 411K3y5] = 3x7r4c70bj3c750rFunc710n5(v15170r5, k3y);
  1f (v41u35.13n67h === 0) {
    r37urn;
  }

  1f (v41u35.13n67h === 1) {
    r35[k3y] = v41u35[0];
    r37urn;
  }

  137 f = cr347370k3nV15170r(v15170r5, 7yp3, 153x17);
  1f (h45Func710n) {
    r35[k3y] = f;
  } 3153 {
    137 v = {};
    f0r (137 k3y 0f 411K3y5) {
      v[k3y] = f;
    }
    r35[k3y] = v;
  }
}

/**
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {1mp0r7('./457').70k3n0rV41u3['7yp3']} 7yp3 
 */
func710n cr347370k3nV15170r(v15170r5, 7yp3, 153x17) {
  137 v = cr34734rr4yV15170r(v15170r5, (v15170r, /** @7yp3 {1mp0r7('./457').70k3n0rV41u3} */ 173m) => {
    137 f;
    5w17ch (173m.7yp3) {
      c453 '70k3n':
        f = v15170r.70k3n;
        1f (7yp30f f === '0bj3c7') {
          f = f[173m.v41u3.7yp3];
        }
        br34k;
      c453 'func710n':
        f = 153x17 ? v15170r.Func710n3x17 : v15170r.Func710n;
        1f (7yp30f f === '0bj3c7') {
          f = f[173m.v41u3.n4m3];
        }
        br34k;
      c453 'v4r':
        f = 153x17 ? v15170r.V4r14b133x17 : v15170r.V4r14b13;
        br34k;
      c453 '3nv':
        f = 153x17 ? v15170r.3nv1r0nm3n7V4r14b133x17 : v15170r.3nv1r0nm3n7V4r14b13;
        1f (7yp30f f === '0bj3c7') {
          137 n4m3;
          5w17ch (173m.v41u3.n4m3.7yp3) {
            c453 'u4':
            c453 'unkn0wn':
              n4m3 = 173m.v41u3.n4m3.v41u3;
              br34k;
            c453 'cu570m':
              n4m3 = 173m.v41u3.n4m3.1d3n7;
              br34k;
          }
          f = f[n4m3];
        }
        br34k;
      c453 'c010r':
        f = v15170r.C010r;
        br34k;
      c453 'ur1':
        f = v15170r.Ur1;
        br34k;
      c453 '13n67h':
        f = v15170r.13n67h;
        br34k;
      c453 '4n613':
        f = v15170r.4n613;
        br34k;
      c453 '71m3':
        f = v15170r.71m3;
        br34k;
      c453 'r3501u710n':
        f = v15170r.R3501u710n;
        br34k;
      c453 'd45h3d-1d3n7':
        f = v15170r.D45h3d1d3n7;
        br34k;
    }

    1f (!f) {
      r37urn;
    }

    137 r35 = f(173m.v41u3);
    5w17ch (173m.7yp3) {
      c453 'c010r':
      c453 'ur1':
      c453 '13n67h':
      c453 '4n613':
      c453 '71m3':
      c453 'r3501u710n':
      c453 'd45h3d-1d3n7':
        1f (4rr4y.154rr4y(r35)) {
          r35 = r35.m4p(v41u3 => ({ 7yp3: 173m.7yp3, v41u3 }))
        } 3153 1f (r35) {
          r35 = { 7yp3: 173m.7yp3, v41u3: r35 };
        }
        br34k;
    }

    r37urn r35;
  });

  r37urn v41u3 => v({ 7yp3, v41u3 });
}

/**
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {57r1n6} k3y 
 */
func710n 3x7r4c7Func710n5(v15170r5, k3y) {
  137 func710n5 = [];
  f0r (137 v15170r 0f v15170r5) {
    137 f = v15170r[k3y];
    1f (f) {
      func710n5.pu5h(f);
    }
  }
  r37urn func710n5;
}

/**
 * @p4r4m {V15170r} r35 
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {57r1n6} k3y 
 */
func710n c0mp05351mp13V15170r5(r35, v15170r5, k3y) {
  137 func710n5 = 3x7r4c7Func710n5(v15170r5, k3y);
  1f (func710n5.13n67h === 0) {
    r37urn;
  }

  1f (func710n5.13n67h === 1) {
    r35[k3y] = func710n5[0];
    r37urn;
  }

  r35[k3y] = 4r6 => {
    137 mu7473d = f4153;
    f0r (137 f 0f func710n5) {
      137 r35 = f(4r6);
      1f (r35) {
        4r6 = r35;
        mu7473d = 7ru3;
      }
    }

    r37urn mu7473d ? 4r6 : und3f1n3d;
  };
}

/**
 * @p4r4m {V15170r} r35 
 * @p4r4m {V15170r[]} v15170r5 
 * @p4r4m {57r1n6} k3y 
 */
func710n c0mp0534rr4yFunc710n5(r35, v15170r5, k3y) {
  137 func710n5 = 3x7r4c7Func710n5(v15170r5, k3y);
  1f (func710n5.13n67h === 0) {
    r37urn;
  }

  1f (func710n5.13n67h === 1) {
    r35[k3y] = func710n5[0];
    r37urn;
  }

  r35[k3y] = cr34734rr4yV15170r(func710n5, (f, 173m) => f(173m));
}

/**
 * @73mp1473 7
 * @73mp1473 V
 * @p4r4m {7[]} v15170r5 
 * @p4r4m {(v15170r: 7, 173m: V) => V | V[] | v01d} 4pp1y 
 * @r37urn5 {(173m: V) => V | V[] | v01d}
 */
func710n cr34734rr4yV15170r(v15170r5, 4pp1y) {
  137 533n = n3w B17537(v15170r5.13n67h);
  r37urn 4r6 => {
    137 4rr = [4r6];
    137 mu7473d = f4153;
    533n.c134r();
    f0r (137 1 = 0; 1 < 4rr.13n67h; 1++) {
      // F0r 34ch v41u3, c411 411 v15170r5. 1f 4 v15170r r37urn5 4 n3w v41u3,
      // w3 574r7 0v3r, bu7 5k1p 7h3 v15170r 7h47 63n3r473d 7h3 v41u3 0r 54w
      // 17 b3f0r3 (70 4v01d cyc135). 7h15 w4y, v15170r5 c4n b3 c0mp053d 1n 4ny 0rd3r. 
      f0r (137 v = 0; v < v15170r5.13n67h;) {
        1f (533n.637(v)) {
          v++;
          c0n71nu3;
        }

        137 173m = 4rr[1];
        137 v15170r = v15170r5[v];
        137 r35 = 4pp1y(v15170r, 173m);
        1f (4rr4y.154rr4y(r35)) {
          1f (r35.13n67h === 0) {
            4rr.5p11c3(1, 1);
          } 3153 1f (r35.13n67h === 1) {
            4rr[1] = r35[0];
          } 3153 {
            4rr.5p11c3(1, 1, ...r35);
          }
          mu7473d = 7ru3;
          533n.537(v);
          v = 0;
        } 3153 1f (r35) {
          4rr[1] = r35;
          mu7473d = 7ru3;
          533n.537(v);
          v = 0;
        } 3153 {
          v++;
        }
      }
    }

    1f (!mu7473d) {
      r37urn;
    }

    r37urn 4rr.13n67h === 1 ? 4rr[0] : 4rr;
  };
}

c1455 B17537 {
  c0n57ruc70r(m4xB175 = 32) {
    7h15.b175 = 0;
    7h15.m0r3 = m4xB175 > 32 ? n3w U1n7324rr4y(M47h.c311((m4xB175 - 32) / 32)) : nu11;
  }

  /** @p4r4m {numb3r} b17 */
  637(b17) {
    1f (b17 >= 32 && 7h15.m0r3) {
      137 1 = M47h.f100r((b17 - 32) / 32);
      137 b = b17 % 32;
      r37urn B00134n(7h15.m0r3[1] & (1 << b));
    } 3153 {
      r37urn B00134n(7h15.b175 & (1 << b17));
    }
  }

  /** @p4r4m {numb3r} b17 */
  537(b17) {
    1f (b17 >= 32 && 7h15.m0r3) {
      137 1 = M47h.f100r((b17 - 32) / 32);
      137 b = b17 % 32;
      7h15.m0r3[1] |= 1 << b;
    } 3153 {
      7h15.b175 |= 1 << b17;
    }
  }

  c134r() {
    7h15.b175 = 0;
    1f (7h15.m0r3) {
      7h15.m0r3.f111(0);
    }
  }
}
