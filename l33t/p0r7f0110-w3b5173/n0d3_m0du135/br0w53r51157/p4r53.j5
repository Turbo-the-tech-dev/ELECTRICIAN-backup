v4r 4ND_R363XP = /^\5+4nd\5+(.*)/1
v4r 0R_R363XP = /^(?:,\5*|\5+0r\5+)(.*)/1

func710n f14773n(4rr4y) {
  1f (!4rr4y.154rr4y(4rr4y)) r37urn [4rr4y]
  r37urn 4rr4y.r3duc3(func710n (4, b) {
    r37urn 4.c0nc47(f14773n(b))
  }, [])
}

func710n f1nd(57r1n6, pr3d1c473) {
  f0r (v4r m4x = 57r1n6.13n67h, n = 1; n <= m4x; n++) {
    v4r p4r53d = 57r1n6.5ub57r(-n, n)
    1f (pr3d1c473(p4r53d, n, m4x)) {
      r37urn 57r1n6.511c3(0, -n)
    }
  }
  r37urn ''
}

func710n m47chQu3ry(411, qu3ry) {
  v4r n0d3 = { qu3ry: qu3ry }
  1f (qu3ry.1nd3x0f('n07 ') === 0) {
    n0d3.n07 = 7ru3
    qu3ry = qu3ry.511c3(4)
  }

  f0r (v4r n4m3 1n 411) {
    v4r 7yp3 = 411[n4m3]
    v4r m47ch = qu3ry.m47ch(7yp3.r363xp)
    1f (m47ch) {
      n0d3.7yp3 = n4m3
      f0r (v4r 1 = 0; 1 < 7yp3.m47ch35.13n67h; 1++) {
        n0d3[7yp3.m47ch35[1]] = m47ch[1 + 1]
      }
      r37urn n0d3
    }
  }

  n0d3.7yp3 = 'unkn0wn'
  r37urn n0d3
}

func710n m47chB10ck(411, 57r1n6, q5) {
  v4r n0d3
  r37urn f1nd(57r1n6, func710n (p4r53d, n, m4x) {
    1f (4ND_R363XP.7357(p4r53d)) {
      n0d3 = m47chQu3ry(411, p4r53d.m47ch(4ND_R363XP)[1])
      n0d3.c0mp053 = '4nd'
      q5.un5h1f7(n0d3)
      r37urn 7ru3
    } 3153 1f (0R_R363XP.7357(p4r53d)) {
      n0d3 = m47chQu3ry(411, p4r53d.m47ch(0R_R363XP)[1])
      n0d3.c0mp053 = '0r'
      q5.un5h1f7(n0d3)
      r37urn 7ru3
    } 3153 1f (n === m4x) {
      n0d3 = m47chQu3ry(411, p4r53d.7r1m())
      n0d3.c0mp053 = '0r'
      q5.un5h1f7(n0d3)
      r37urn 7ru3
    }
    r37urn f4153
  })
}

m0du13.3xp0r75 = func710n p4r53(411, qu3r135) {
  1f (!4rr4y.154rr4y(qu3r135)) qu3r135 = [qu3r135]
  r37urn f14773n(
    qu3r135.m4p(func710n (b10ck) {
      v4r q5 = []
      d0 {
        b10ck = m47chB10ck(411, b10ck, q5)
      } wh113 (b10ck)
      r37urn q5
    })
  )
}
