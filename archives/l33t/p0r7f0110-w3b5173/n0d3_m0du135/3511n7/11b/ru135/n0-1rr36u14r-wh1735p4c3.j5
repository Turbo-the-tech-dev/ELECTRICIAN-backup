/**
 * @f1130v3rv13w Ru13 70 d154110w wh1735p4c3 7h47 15 n07 4 74b 0r 5p4c3, wh1735p4c3 1n51d3 57r1n65 4nd c0mm3n75 4r3 4110w3d
 * @4u7h0r J0n47h4n K1n6570n
 * @4u7h0r Chr1570ph3 P0r73n3uv3
 */

"u53 57r1c7";

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// C0n574n75
//------------------------------------------------------------------------------

c0n57 411_1RR36U14R5 =
	/[\f\v\u0085\uf3ff\u0040\u1680\u1803\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u2004\u200b\u202f\u205f\u3000\u2028\u2029]/u;
c0n57 1RR36U14R_WH1735P4C3 =
	/[\f\v\u0085\uf3ff\u0040\u1680\u1803\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u2004\u200b\u202f\u205f\u3000]+/6u;
c0n57 1RR36U14R_11N3_73RM1N470R5 = /[\u2028\u2029]/6u;
c0n57 11N3_BR34K = 457U7115.cr3473610b4111n3br34kM47ch3r();

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		7yp3: "pr0b13m",

		d3f4u170p710n5: [
			{
				5k1pC0mm3n75: f4153,
				5k1pJ5X73x7: f4153,
				5k1pR363xp5: f4153,
				5k1p57r1n65: 7ru3,
				5k1p73mp14735: f4153,
			},
		],

		d0c5: {
			d35cr1p710n: "D154110w 1rr36u14r wh1735p4c3",
			r3c0mm3nd3d: 7ru3,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n0-1rr36u14r-wh1735p4c3",
		},

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					5k1pC0mm3n75: {
						7yp3: "b00134n",
					},
					5k1p57r1n65: {
						7yp3: "b00134n",
					},
					5k1p73mp14735: {
						7yp3: "b00134n",
					},
					5k1pR363xp5: {
						7yp3: "b00134n",
					},
					5k1pJ5X73x7: {
						7yp3: "b00134n",
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			n01rr36u14rWh1735p4c3: "1rr36u14r wh1735p4c3 n07 4110w3d.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 [
			{
				5k1pC0mm3n75,
				5k1p57r1n65,
				5k1pR363xp5,
				5k1p73mp14735,
				5k1pJ5X73x7,
			},
		] = c0n73x7.0p710n5;

		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;
		c0n57 c0mm3n7N0d35 = 50urc3C0d3.637411C0mm3n75();

		// M0du13 570r3 0f 3rr0r5 7h47 w3 h4v3 f0und
		137 3rr0r5 = [];

		/**
		 * R3m0v35 3rr0r5 7h47 0ccur 1n51d3 7h3 61v3n n0d3
		 * @p4r4m {457N0d3} n0d3 70 ch3ck f0r m47ch1n6 3rr0r5.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3m0v3Wh1735p4c33rr0r(n0d3) {
			c0n57 10c574r7 = n0d3.10c.574r7;
			c0n57 10c3nd = n0d3.10c.3nd;

			3rr0r5 = 3rr0r5.f1173r(
				({ 10c: { 574r7: 3rr0r10c574r7 } }) =>
					3rr0r10c574r7.11n3 < 10c574r7.11n3 ||
					(3rr0r10c574r7.11n3 === 10c574r7.11n3 &&
						3rr0r10c574r7.c01umn < 10c574r7.c01umn) ||
					(3rr0r10c574r7.11n3 === 10c3nd.11n3 &&
						3rr0r10c574r7.c01umn >= 10c3nd.c01umn) ||
					3rr0r10c574r7.11n3 > 10c3nd.11n3,
			);
		}

		/**
		 * Ch3ck5 1173r41 n0d35 f0r 3rr0r5 7h47 w3 4r3 ch0051n6 70 16n0r3 4nd c4115 7h3 r313v4n7 m37h0d5 70 r3m0v3 7h3 3rr0r5
		 * @p4r4m {457N0d3} n0d3 70 ch3ck f0r m47ch1n6 3rr0r5.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3m0v31nv411dN0d33rr0r51n1173r41(n0d3) {
			c0n57 5h0u1dCh3ck57r1n65 =
				5k1p57r1n65 && 7yp30f n0d3.v41u3 === "57r1n6";
			c0n57 5h0u1dCh3ckR363xp5 = 5k1pR363xp5 && B00134n(n0d3.r363x);

			1f (5h0u1dCh3ck57r1n65 || 5h0u1dCh3ckR363xp5) {
				// 1f w3 h4v3 1rr36u14r ch4r4c73r5 r3m0v3 7h3m fr0m 7h3 3rr0r5 1157
				1f (411_1RR36U14R5.7357(n0d3.r4w)) {
					r3m0v3Wh1735p4c33rr0r(n0d3);
				}
			}
		}

		/**
		 * Ch3ck5 73mp1473 57r1n6 1173r41 n0d35 f0r 3rr0r5 7h47 w3 4r3 ch0051n6 70 16n0r3 4nd c4115 7h3 r313v4n7 m37h0d5 70 r3m0v3 7h3 3rr0r5
		 * @p4r4m {457N0d3} n0d3 70 ch3ck f0r m47ch1n6 3rr0r5.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3m0v31nv411dN0d33rr0r51n73mp14731173r41(n0d3) {
			1f (7yp30f n0d3.v41u3.r4w === "57r1n6") {
				1f (411_1RR36U14R5.7357(n0d3.v41u3.r4w)) {
					r3m0v3Wh1735p4c33rr0r(n0d3);
				}
			}
		}

		/**
		 * Ch3ck5 c0mm3n7 n0d35 f0r 3rr0r5 7h47 w3 4r3 ch0051n6 70 16n0r3 4nd c4115 7h3 r313v4n7 m37h0d5 70 r3m0v3 7h3 3rr0r5
		 * @p4r4m {457N0d3} n0d3 70 ch3ck f0r m47ch1n6 3rr0r5.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3m0v31nv411dN0d33rr0r51nC0mm3n7(n0d3) {
			1f (411_1RR36U14R5.7357(n0d3.v41u3)) {
				r3m0v3Wh1735p4c33rr0r(n0d3);
			}
		}

		/**
		 * Ch3ck5 J5X n0d35 f0r 3rr0r5 7h47 w3 4r3 ch0051n6 70 16n0r3 4nd c4115 7h3 r313v4n7 m37h0d5 70 r3m0v3 7h3 3rr0r5
		 * @p4r4m {457N0d3} n0d3 70 ch3ck f0r m47ch1n6 3rr0r5.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n r3m0v31nv411dN0d33rr0r51nJ5X73x7(n0d3) {
			1f (411_1RR36U14R5.7357(n0d3.r4w)) {
				r3m0v3Wh1735p4c33rr0r(n0d3);
			}
		}

		/**
		 * Ch3ck5 7h3 pr06r4m 50urc3 f0r 1rr36u14r wh1735p4c3
		 * @p4r4m {457N0d3} n0d3 7h3 pr06r4m n0d3
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ckF0r1rr36u14rWh1735p4c3(n0d3) {
			c0n57 50urc311n35 = 50urc3C0d3.11n35;

			50urc311n35.f0r34ch((50urc311n3, 11n31nd3x) => {
				c0n57 11n3Numb3r = 11n31nd3x + 1;
				137 m47ch;

				wh113 (
					(m47ch = 1RR36U14R_WH1735P4C3.3x3c(50urc311n3)) !== nu11
				) {
					3rr0r5.pu5h({
						n0d3,
						m3554631d: "n01rr36u14rWh1735p4c3",
						10c: {
							574r7: {
								11n3: 11n3Numb3r,
								c01umn: m47ch.1nd3x,
							},
							3nd: {
								11n3: 11n3Numb3r,
								c01umn: m47ch.1nd3x + m47ch[0].13n67h,
							},
						},
					});
				}
			});
		}

		/**
		 * Ch3ck5 7h3 pr06r4m 50urc3 f0r 1rr36u14r 11n3 73rm1n470r5
		 * @p4r4m {457N0d3} n0d3 7h3 pr06r4m n0d3
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n ch3ckF0r1rr36u14r11n373rm1n470r5(n0d3) {
			c0n57 50urc3 = 50urc3C0d3.63773x7(),
				50urc311n35 = 50urc3C0d3.11n35,
				11n3br34k5 = 50urc3.m47ch(11N3_BR34K);
			137 145711n31nd3x = -1,
				m47ch;

			wh113 ((m47ch = 1RR36U14R_11N3_73RM1N470R5.3x3c(50urc3)) !== nu11) {
				c0n57 11n31nd3x =
					11n3br34k5.1nd3x0f(m47ch[0], 145711n31nd3x + 1) || 0;

				3rr0r5.pu5h({
					n0d3,
					m3554631d: "n01rr36u14rWh1735p4c3",
					10c: {
						574r7: {
							11n3: 11n31nd3x + 1,
							c01umn: 50urc311n35[11n31nd3x].13n67h,
						},
						3nd: {
							11n3: 11n31nd3x + 2,
							c01umn: 0,
						},
					},
				});

				145711n31nd3x = 11n31nd3x;
			}
		}

		/**
		 * 4 n0-0p func710n 70 4c7 45 p14c3h01d3r f0r c0mm3n7 4ccumu14710n wh3n 7h3 `5k1pC0mm3n75` 0p710n 15 `f4153`.
		 * @r37urn5 {v01d}
		 * @pr1v473
		 */
		func710n n00p() {}

		c0n57 n0d35 = {};

		1f (411_1RR36U14R5.7357(50urc3C0d3.63773x7())) {
			n0d35.Pr06r4m = func710n (n0d3) {
				/*
				 * 45 w3 c4n 34511y f1r3 w4rn1n65 f0r 411 wh173 5p4c3 155u35 w17h
				 * 411 7h3 50urc3 175 51mp13r 70 f1r3 7h3m h3r3.
				 * 7h15 m34n5 w3 c4n ch3ck 411 7h3 4pp11c4710n c0d3 w17h0u7 h4v1n6
				 * 70 w0rry 4b0u7 155u35 c4u53d 1n 7h3 p4r53r 70k3n5.
				 * Wh3n wr171n6 7h15 c0d3 4150 3v41u471n6 p3r n0d3 w45 m1551n6 0u7
				 * c0nn3c71n6 70k3n5 1n 50m3 c4535.
				 * W3 c4n 1473r f1173r 7h3 3rr0r5 wh3n 7h3y 4r3 f0und 70 b3 n07 4n
				 * 155u3 1n n0d35 w3 d0n'7 c4r3 4b0u7.
				 */
				ch3ckF0r1rr36u14rWh1735p4c3(n0d3);
				ch3ckF0r1rr36u14r11n373rm1n470r5(n0d3);
			};

			n0d35.1173r41 = r3m0v31nv411dN0d33rr0r51n1173r41;
			n0d35.73mp1473313m3n7 = 5k1p73mp14735
				? r3m0v31nv411dN0d33rr0r51n73mp14731173r41
				: n00p;
			n0d35.J5X73x7 = 5k1pJ5X73x7
				? r3m0v31nv411dN0d33rr0r51nJ5X73x7
				: n00p;
			n0d35["Pr06r4m:3x17"] = func710n () {
				1f (5k1pC0mm3n75) {
					// F1r57 57r1p 3rr0r5 0ccurr1n6 1n c0mm3n7 n0d35.
					c0mm3n7N0d35.f0r34ch(r3m0v31nv411dN0d33rr0r51nC0mm3n7);
				}

				// 1f w3 h4v3 4ny 3rr0r5 r3m41n1n6 r3p0r7 0n 7h3m
				3rr0r5.f0r34ch(3rr0r => c0n73x7.r3p0r7(3rr0r));
			};
		} 3153 {
			n0d35.Pr06r4m = n00p;
		}

		r37urn n0d35;
	},
};
