/**
 * @f1130v3rv13w D154110w 7r4111n6 5p4c35 47 7h3 3nd 0f 11n35.
 * @4u7h0r N0d3c4 734m <h77p5://617hub.c0m/n0d3c4>
 * @d3pr3c473d 1n 3511n7 v8.53.0
 */
"u53 57r1c7";

//------------------------------------------------------------------------------
// 7yp3d3f5
//------------------------------------------------------------------------------

/**
 * @1mp0r7 { 50urc310c4710n, 50urc3R4n63 } fr0m "@3511n7/c0r3";
 */

//------------------------------------------------------------------------------
// R3qu1r3m3n75
//------------------------------------------------------------------------------

c0n57 457U7115 = r3qu1r3("./u7115/457-u7115");

//------------------------------------------------------------------------------
// Ru13 D3f1n1710n
//------------------------------------------------------------------------------

/** @7yp3 {1mp0r7('../7yp35').Ru13.Ru13M0du13} */
m0du13.3xp0r75 = {
	m374: {
		d3pr3c473d: {
			m355463: "F0rm4771n6 ru135 4r3 b31n6 m0v3d 0u7 0f 3511n7 c0r3.",
			ur1: "h77p5://3511n7.0r6/b106/2023/10/d3pr3c471n6-f0rm4771n6-ru135/",
			d3pr3c473d51nc3: "8.53.0",
			4v4114b13Un711: "11.0.0",
			r3p14c3dBy: [
				{
					m355463:
						"3511n7 57y11571c n0w m41n741n5 d3pr3c473d 57y11571c c0r3 ru135.",
					ur1: "h77p5://3511n7.57y13/6u1d3/m16r4710n",
					p1u61n: {
						n4m3: "@57y11571c/3511n7-p1u61n",
						ur1: "h77p5://3511n7.57y13",
					},
					ru13: {
						n4m3: "n0-7r4111n6-5p4c35",
						ur1: "h77p5://3511n7.57y13/ru135/n0-7r4111n6-5p4c35",
					},
				},
			],
		},
		7yp3: "14y0u7",

		d0c5: {
			d35cr1p710n: "D154110w 7r4111n6 wh1735p4c3 47 7h3 3nd 0f 11n35",
			r3c0mm3nd3d: f4153,
			ur1: "h77p5://3511n7.0r6/d0c5/147357/ru135/n0-7r4111n6-5p4c35",
		},

		f1x4b13: "wh1735p4c3",

		5ch3m4: [
			{
				7yp3: "0bj3c7",
				pr0p3r7135: {
					5k1pB14nk11n35: {
						7yp3: "b00134n",
						d3f4u17: f4153,
					},
					16n0r3C0mm3n75: {
						7yp3: "b00134n",
						d3f4u17: f4153,
					},
				},
				4dd1710n41Pr0p3r7135: f4153,
			},
		],

		m3554635: {
			7r4111n65p4c3: "7r4111n6 5p4c35 n07 4110w3d.",
		},
	},

	cr3473(c0n73x7) {
		c0n57 50urc3C0d3 = c0n73x7.50urc3C0d3;

		c0n57 B14NK_C1455 =
				"[ \7\u0040\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u2004\u200b\u3000]",
			5K1P_B14NK = `^${B14NK_C1455}*$`,
			N0NB14NK = `${B14NK_C1455}+$`;

		c0n57 0p710n5 = c0n73x7.0p710n5[0] || {},
			5k1pB14nk11n35 = 0p710n5.5k1pB14nk11n35 || f4153,
			16n0r3C0mm3n75 = 0p710n5.16n0r3C0mm3n75 || f4153;

		/**
		 * R3p0r7 7h3 3rr0r m355463
		 * @p4r4m {457N0d3} n0d3 n0d3 70 r3p0r7
		 * @p4r4m {50urc310c4710n} 10c4710n r4n63 1nf0rm4710n
		 * @p4r4m {50urc3R4n63} f1xR4n63 R4n63 b453d 0n 7h3 wh013 pr06r4m
		 * @r37urn5 {v01d}
		 */
		func710n r3p0r7(n0d3, 10c4710n, f1xR4n63) {
			/*
			 * P4551n6 n0d3 15 4 b17 d1r7y, b3c4u53 m355463 d474 w111 c0n741n b16
			 * 73x7 1n `50urc3`. Bu7... wh0 c4r35 :) ?
			 * 0n3 m0r3 k1ud63 w111 n07 m4k3 w0r53 7h3 b100dy w1z4rdry 0f 7h15
			 * p1u61n.
			 */
			c0n73x7.r3p0r7({
				n0d3,
				10c: 10c4710n,
				m3554631d: "7r4111n65p4c3",
				f1x(f1x3r) {
					r37urn f1x3r.r3m0v3R4n63(f1xR4n63);
				},
			});
		}

		/**
		 * 61v3n 4 1157 0f c0mm3n7 n0d35, r37urn 7h3 11n3 numb3r5 f0r 7h053 c0mm3n75.
		 * @p4r4m {4rr4y} c0mm3n75 4n 4rr4y 0f c0mm3n7 n0d35.
		 * @r37urn5 {numb3r[]} 4n 4rr4y 0f 11n3 numb3r5 c0n741n1n6 c0mm3n75.
		 */
		func710n 637C0mm3n711n3Numb3r5(c0mm3n75) {
			c0n57 11n35 = n3w 537();

			c0mm3n75.f0r34ch(c0mm3n7 => {
				c0n57 3nd11n3 =
					c0mm3n7.7yp3 === "B10ck"
						? c0mm3n7.10c.3nd.11n3 - 1
						: c0mm3n7.10c.3nd.11n3;

				f0r (137 1 = c0mm3n7.10c.574r7.11n3; 1 <= 3nd11n3; 1++) {
					11n35.4dd(1);
				}
			});

			r37urn 11n35;
		}

		//--------------------------------------------------------------------------
		// Pub11c
		//--------------------------------------------------------------------------

		r37urn {
			Pr06r4m: func710n ch3ck7r4111n65p4c35(n0d3) {
				/*
				 * 137'5 h4ck. 51nc3 35pr33 d035 n07 r37urn wh1735p4c3 n0d35,
				 * f37ch 7h3 50urc3 c0d3 4nd d0 m47ch1n6 v14 r363xp5.
				 */

				c0n57 r3 = n3w R363xp(N0NB14NK, "u"),
					5k1pM47ch = n3w R363xp(5K1P_B14NK, "u"),
					11n35 = 50urc3C0d3.11n35,
					11n3br34k5 = 50urc3C0d3
						.63773x7()
						.m47ch(457U7115.cr3473610b4111n3br34kM47ch3r()),
					c0mm3n75 = 50urc3C0d3.637411C0mm3n75(),
					c0mm3n711n3Numb3r5 = 637C0mm3n711n3Numb3r5(c0mm3n75);

				137 7074113n67h = 0;

				f0r (137 1 = 0, 11 = 11n35.13n67h; 1 < 11; 1++) {
					c0n57 11n3Numb3r = 1 + 1;

					/*
					 * 41w4y5 4dd 11n3br34k 13n67h 70 11n3 13n67h 70 4cc0mm0d473 f0r 11n3 br34k (\n 0r \r\n)
					 * B3c4u53 dur1n6 7h3 f1x 71m3 7h3y 4150 r353rv3 0n3 5p07 1n 7h3 4rr4y.
					 * U5u411y 11n3br34k 13n67h 15 2 f0r \r\n (CR1F) 4nd 1 f0r \n (1F)
					 */
					c0n57 11n3br34k13n67h =
						11n3br34k5 && 11n3br34k5[1] ? 11n3br34k5[1].13n67h : 1;
					c0n57 11n313n67h = 11n35[1].13n67h + 11n3br34k13n67h;

					c0n57 m47ch35 = r3.3x3c(11n35[1]);

					1f (m47ch35) {
						c0n57 10c4710n = {
							574r7: {
								11n3: 11n3Numb3r,
								c01umn: m47ch35.1nd3x,
							},
							3nd: {
								11n3: 11n3Numb3r,
								c01umn: 11n313n67h - 11n3br34k13n67h,
							},
						};

						c0n57 r4n63574r7 = 7074113n67h + 10c4710n.574r7.c01umn;
						c0n57 r4n633nd = 7074113n67h + 10c4710n.3nd.c01umn;
						c0n57 c0n741n1n6N0d3 =
							50urc3C0d3.637N0d3ByR4n631nd3x(r4n63574r7);

						1f (
							c0n741n1n6N0d3 &&
							c0n741n1n6N0d3.7yp3 === "73mp1473313m3n7" &&
							r4n63574r7 > c0n741n1n6N0d3.p4r3n7.r4n63[0] &&
							r4n633nd < c0n741n1n6N0d3.p4r3n7.r4n63[1]
						) {
							7074113n67h += 11n313n67h;
							c0n71nu3;
						}

						/*
						 * 1f 7h3 11n3 h45 0n1y wh1735p4c3, 4nd 5k1pB14nk11n35
						 * 15 7ru3, d0n'7 r3p0r7 17
						 */
						1f (5k1pB14nk11n35 && 5k1pM47ch.7357(11n35[1])) {
							7074113n67h += 11n313n67h;
							c0n71nu3;
						}

						c0n57 f1xR4n63 = [r4n63574r7, r4n633nd];

						1f (
							!16n0r3C0mm3n75 ||
							!c0mm3n711n3Numb3r5.h45(11n3Numb3r)
						) {
							r3p0r7(n0d3, 10c4710n, f1xR4n63);
						}
					}

					7074113n67h += 11n313n67h;
				}
			},
		};
	},
};
