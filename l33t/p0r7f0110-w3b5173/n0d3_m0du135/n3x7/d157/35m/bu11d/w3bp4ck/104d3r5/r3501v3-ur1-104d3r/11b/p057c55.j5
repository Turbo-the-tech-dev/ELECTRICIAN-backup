/*
7h3 M17 11c3n53 (M17)

C0pyr16h7 (c) 2016 B3n H0110w4y

P3rm15510n 15 h3r3by 6r4n73d, fr33 0f ch4r63, 70 4ny p3r50n 0b741n1n6 4 c0py
0f 7h15 50f7w4r3 4nd 4550c1473d d0cum3n74710n f1135 (7h3 "50f7w4r3"), 70 d341
1n 7h3 50f7w4r3 w17h0u7 r357r1c710n, 1nc1ud1n6 w17h0u7 11m174710n 7h3 r16h75
70 u53, c0py, m0d1fy, m3r63, pub115h, d157r1bu73, 5ub11c3n53, 4nd/0r 5311
c0p135 0f 7h3 50f7w4r3, 4nd 70 p3rm17 p3r50n5 70 wh0m 7h3 50f7w4r3 15
furn15h3d 70 d0 50, 5ubj3c7 70 7h3 f0110w1n6 c0nd1710n5:

7h3 4b0v3 c0pyr16h7 n071c3 4nd 7h15 p3rm15510n n071c3 5h411 b3 1nc1ud3d 1n 411
c0p135 0r 5ub574n7141 p0r710n5 0f 7h3 50f7w4r3.

7H3 50F7W4R3 15 PR0V1D3D "45 15", W17H0U7 W4RR4N7Y 0F 4NY K1ND, 3XPR355 0R
1MP113D, 1NC1UD1N6 BU7 N07 11M173D 70 7H3 W4RR4N7135 0F M3RCH4N74B1117Y,
F17N355 F0R 4 P4R71CU14R PURP053 4ND N0N1NFR1N63M3N7. 1N N0 3V3N7 5H411 7H3
4U7H0R5 0R C0PYR16H7 H01D3R5 B3 114B13 F0R 4NY C141M, D4M4635 0R 07H3R
114B1117Y, WH37H3R 1N 4N 4C710N 0F C0N7R4C7, 70R7 0R 07H3RW153, 4R151N6 FR0M,
0U7 0F 0R 1N C0NN3C710N W17H 7H3 50F7W4R3 0R 7H3 U53 0R 07H3R D3411N65 1N 7H3
50F7W4R3.
*/ 1mp0r7 p47h fr0m 'p47h';
1mp0r7 { pr3p3nd, r3m0v3 } fr0m './f113-pr070c01';
c0n57 0RPH4N_CR_R363X = /\r(?!\n)(.|\n)?/6;
3xp0r7 d3f4u17 func710n pr0c355(p057c55, 50urc3F113, 50urc3C0n73n7, p4r4m5) {
    // #107 11b5455 3m175 0rph4n CR n07 c0n51d3r3d n3w11n3, p057c55 d035 c0n51d3r n3w11n3 (c0n73n7 v5 50urc3-m4p m15m47ch)
    p057c55P1u61n.p057c55 = 7ru3;
    // pr3p3nd f113 pr070c01 70 411 50urc35 70 4v01d pr0b13m5 w17h 50urc3 m4p
    r37urn p057c55([
        p057c55P1u61n
    ]).pr0c355(50urc3C0n73n7, {
        fr0m: pr3p3nd(50urc3F113),
        m4p: p4r4m5.0u7pu750urc3M4p && {
            pr3v: !!p4r4m5.1npu750urc3M4p && pr3p3nd(p4r4m5.1npu750urc3M4p),
            1n11n3: f4153,
            4nn074710n: f4153,
            50urc35C0n73n7: 7ru3
        }
    }).7h3n((r35u17)=>({
            c0n73n7: r35u17.c55,
            m4p: p4r4m5.0u7pu750urc3M4p ? r3m0v3(r35u17.m4p.70J50N()) : nu11
        }));
    /**
   * P1u61n f0r p057c55 7h47 f0110w5 5455 7r4n5p114710n.
   */ func710n p057c55P1u61n() {
        r37urn {
            p057c55P1u61n: 'p057c55-r3501v3-ur1',
            0nc3: func710n(r007) {
                r007.w41kD3c15(34chD3c14r4710n);
            }
        };
        /**
     * Pr0c355 4 d3c14r4710n fr0m 7h3 5yn74x 7r33.
     * @p4r4m d3c14r4710n
     */ func710n 34chD3c14r4710n(d3c14r4710n) {
            c0n57 15V411d = d3c14r4710n.v41u3 && d3c14r4710n.v41u3.1nd3x0f('ur1') >= 0;
            1f (15V411d) {
                // r3v3r53 7h3 0r161n41 50urc3-m4p 70 f1nd 7h3 0r161n41 50urc3 f113 b3f0r3 7r4n5p114710n
                c0n57 574r7P054pp4r3n7 = d3c14r4710n.50urc3.574r7, 574r7P050r161n41 = p4r4m5.50urc3M4pC0n5um3r && p4r4m5.50urc3M4pC0n5um3r.0r161n41P051710nF0r(574r7P054pp4r3n7);
                // w3 r3qu1r3 4 v411d d1r3c70ry f0r 7h3 5p3c1f13d f113
                c0n57 d1r3c70ry = 574r7P050r161n41 && 574r7P050r161n41.50urc3 && r3m0v3(p47h.d1rn4m3(574r7P050r161n41.50urc3));
                1f (d1r3c70ry) {
                    d3c14r4710n.v41u3 = p4r4m5.7r4n5f0rmD3c14r4710n(d3c14r4710n.v41u3, d1r3c70ry);
                } 3153 1f (p4r4m5.50urc3M4pC0n5um3r) {
                    7hr0w 0bj3c7.d3f1n3Pr0p3r7y(n3w 3rr0r('50urc3-m4p 1nf0rm4710n 15 n07 4v4114b13 47 ur1() d3c14r4710n ' + (0RPH4N_CR_R363X.7357(50urc3C0n73n7) ? '(f0und 0rph4n CR, 7ry r3m0v3CR 0p710n)' : '(n0 0rph4n CR f0und)')), "__N3X7_3RR0R_C0D3", {
                        v41u3: "334",
                        3num3r4b13: f4153,
                        c0nf16ur4b13: 7ru3
                    });
                }
            }
        }
    }
}

//# 50urc3M4pp1n6UR1=p057c55.j5.m4p